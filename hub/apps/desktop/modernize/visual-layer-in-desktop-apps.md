---
title: Использование визуального уровня для модернизации классического приложения
description: Используйте визуальный уровень для улучшения пользовательского интерфейса классического приложения .NET или Win32.
ms.date: 03/18/2019
ms.topic: article
keywords: windows 10, uwp
ms.author: jimwalk
author: jwmsft
ms.localizationpriority: medium
ms.openlocfilehash: 249291c59a31036fa967ac338209404557b57503
ms.sourcegitcommit: 76e8b4fb3f76cc162aab80982a441bfc18507fb4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "66215175"
---
# <a name="using-the-visual-layer-in-desktop-apps"></a>Использование визуального уровня в классических приложениях

Теперь API UWP можно использовать и в классических приложениях, созданных не на платформе UWP, чтобы улучшить внешний вид и функции этих приложений (WPF, Windows Forms и C++ Win32) и воспользоваться последними функциями пользовательского интерфейса Windows 10, которые доступны только через UWP.

Во многих случаях для добавления современных элементов управления XAML в приложение можно использовать [области XAML](xaml-islands.md). Однако, когда нужно создать пользовательские функции, которые невозможно реализовать с помощью встроенных элементов управления, можно воспользоваться интерфейсами API визуального слоя.

Визуальный уровень предоставляет высокопроизводительный API абстрактного режима для графики, эффектов и анимации. Это основа пользовательского интерфейса на устройствах с Windows 10. Элементы управления XAML UWP основаны на визуальном уровне и позволяют реализовать множество аспектов [системы Fluent Design](/windows/uwp/design/fluent-design-system/index), таких как освещение, глубина, движение, материал и масштабирование.

![Пользовательский интерфейс, созданный с помощью визуального уровня](images/visual-layer-interop/pull-to-animate.gif)

> _Пользовательский интерфейс, созданный с помощью визуального уровня_

## <a name="create-a-visually-engaging-user-interface-in-any-windows-app"></a>Создание визуально привлекательного пользовательского интерфейса в любом приложении Windows

Визуальный уровень позволяет создавать привлекательный интерфейс с помощью упрощенной компоновки пользовательского прорисовываемого содержимого (визуальных элементов) и применения эффективной анимации, эффектов и манипуляций с этими объектами в приложении. Визуальный уровень не заменяет существующую платформу пользовательского интерфейса, а является ценным дополнением к ней.

Вы можете использовать визуальный уровень, чтобы обеспечить уникальное оформление и интерфейс приложения, придав ему индивидуальность, выделяющую его на фоне других приложений. Кроме того, он позволяет использовать принципы Fluent Design, позволяющие упростить работу с приложениями, а также привлечь внимание пользователей. Например, с его помощью можно создавать визуальные подсказки и анимированные переходы, отображающие связи между элементами на экране.

## <a name="visual-layer-features"></a>Возможности визуального уровня

### <a name="brushes"></a>Кисти

[Кисти композиции](/windows/uwp/composition/composition-brushes) позволяют рисовать объекты пользовательского интерфейса, используя сплошные цвета, градиенты, изображения, видео, сложные эффекты и многое другое.

![Яйцо, созданное с помощью Material Creator](images/visual-layer-interop/egg.gif)

> _Яйцо, созданное с помощью [демонстрационного приложения Material Creator](https://github.com/Microsoft/WindowsCompositionSamples/tree/master/Demos/MaterialCreator)._

### <a name="effects"></a>Эффекты

[Эффекты композиции](/windows/uwp/composition/composition-effects) включают в себя освещение, тень и список эффектов фильтра. Их можно анимировать, настроить и связать, а затем применить непосредственно к визуальным элементам. SceneLightingEffect можно сочетать с освещением, чтобы отобразить атмосферу, глубину и материалы.

![Источники света и материал](images/visual-layer-interop/light-interop.gif)

> _Источники света и материал, демонстрируемые в [коллекции примеров пользовательского интерфейса Windows](https://github.com/Microsoft/WindowsCompositionSamples/tree/master/SampleGallery)._

### <a name="animations"></a>Анимации

[Анимации композиции](/windows/uwp/composition/composition-animation) выполняются непосредственно в процессе компоновщика, независимо от потока пользовательского интерфейса. Это обеспечивает плавность и масштабирование, позволяя одновременно выполнять большое количество видимых анимаций. В дополнение к привычным анимациям по опорным кадрам, используемым для отображения изменения свойств с течением времени, можно использовать выражения, чтобы установить математические взаимосвязи между различными свойствами, включая ввод пользователя. Анимации, управляемые входными данными, позволяют создавать пользовательский интерфейс, который динамически реагирует на ввод пользователя, что может повысить эффективность взаимодействия с пользователем.

![Пользовательский интерфейс, созданный с помощью визуального уровня](images/visual-layer-interop/swipe-scroller.gif)

> _Движение, демонстрируемое в [коллекции примеров пользовательского интерфейса Windows](https://github.com/Microsoft/WindowsCompositionSamples/tree/master/SampleGallery)._

## <a name="keep-your-existing-codebase-and-adopt-incrementally"></a>Сохранение существующей базы кода и поэтапное внедрение

Код существующих приложений представляет собой значительные инвестиции, которые не хочется терять. Можно перенести _области_ содержимого, чтобы использовать визуальный уровень, оставив остальную часть пользовательского интерфейса на существующей платформе. Это означает, что вы можете вносить значительные изменения в пользовательский интерфейс приложения, не внося значительных изменений в существующую базу кода.

## <a name="samples-and-tutorials"></a>Примеры и руководства

Узнайте, как использовать визуальный уровень в приложениях, экспериментируя с нашими примерами. Эти примеры и руководства помогут приступить к работе с визуальным уровнем и продемонстрируют работу функций.

### <a name="win32"></a>Win32

- Руководство по [использованию визуального уровня на платформе Win32](using-the-visual-layer-with-win32.md)
  - [Пример Hello Composition](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/cpp/HelloComposition)
- [Пример Hello Vectors](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/cpp/HelloVectors)
- [Пример виртуальных поверхностей](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/cpp/VirtualSurfaces)
- [Пример записи экрана](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/cpp/ScreenCaptureforHWND)

### <a name="windows-forms"></a>Windows Forms

- Руководство по [использованию визуального уровня на платформе Windows Forms](using-the-visual-layer-with-windows-forms.md)
  - [Пример Hello Composition](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/dotnet/WinForms/HelloComposition)
- [Пример интеграции визуального уровня](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/dotnet/WinForms/VisualLayerIntegration)

### <a name="wpf"></a>WPF

- Руководство по [использованию визуального уровня на платформе WPF](using-the-visual-layer-with-wpf.md)
  - [Пример Hello Composition](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/dotnet/WPF/HelloComposition)
- [Пример интеграции визуального уровня](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/dotnet/WPF/VisualLayerIntegration)
- [Пример записи экрана](https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/dotnet/WPF/ScreenCapture)

## <a name="limitations"></a>Ограничения

Хотя многие функции визуального уровня работают в классическом приложении так же, как и в приложении UWP, у некоторых функций имеются ограничения. Ниже приведены некоторые ограничения, которые следует учитывать.

- Цепочки эффектов используют [Win2D](http://microsoft.github.io/Win2D/html/Introduction.htm) для описания эффектов. [Пакет NuGet Win2D](https://www.nuget.org/packages/Win2D.uwp) не поддерживается в классических приложениях, поэтому его потребуется перекомпилировать из [исходного кода](https://github.com/Microsoft/Win2D).
- Чтобы выполнить проверку нажатия, необходимо выполнить вычисления границ путем самостоятельного обхода визуального дерева. Это не отличается от визуального уровня в UWP, за исключением случаев, когда отсутствует элемент XAML, к которому можно легко выполнить привязку для проверки нажатия.
- В визуальном уровне нет примитива для отрисовки текста.
- При совместном использовании двух различных технологий пользовательского интерфейса, таких как WPF и визуальный уровень, каждая из них отвечает за отрисовку собственных пикселей на экране. У них не может быть общих пикселей. В результате содержимое визуального уровня всегда отображается поверх другого содержимого пользовательского интерфейса. (Это называется проблемой _зазоров_.) Может потребоваться дополнительное программирование и тестирование, чтобы обеспечить изменение размера содержимого визуального уровня с помощью пользовательского интерфейса, в котором оно размещено, без перекрытия другого содержимого.
- Для содержимого, размещенного в классическом приложении, размер или масштаб относительно DPI не изменяется автоматически. Могут потребоваться дополнительные действия, чтобы ваше содержимое учитывало изменения DPI. (Дополнительные сведения можно получить в руководствах по конкретным платформам.)

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Визуальный уровень](/windows/uwp/composition/visual-layer)
- [Визуальный компонент композиции](/windows/uwp/composition/composition-visual-tree)
- [Кисти композиции](/windows/uwp/composition/composition-brushes)
- [Эффекты композиции](/windows/uwp/composition/composition-effects)
- [Анимации композиции](/windows/uwp/composition/composition-animation)

Справочник по API

- [Windows.UI.Composition](/uwp/api/Windows.UI.Composition)