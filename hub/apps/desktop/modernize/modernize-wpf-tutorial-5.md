---
description: В этом руководстве показано, как добавлять пользовательские интерфейсы XAML UWP, создавать пакеты MSIX и внедрять в приложение WPF другие современные компоненты.
title: Упаковка и развертывание с помощью MSIX
ms.topic: article
ms.date: 06/27/2019
ms.author: mcleans
author: mcleanbyron
keywords: Windows 10, UWP, Windows Forms, WPF, о-ва XAML
ms.localizationpriority: medium
ms.custom: RS5, 19H1
ms.openlocfilehash: 961157bc3d3429b56d3da24a46d71cbb5b84e7a3
ms.sourcegitcommit: 3cc6eb3bab78f7e68c37226c40410ebca73f82a9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/02/2019
ms.locfileid: "68729492"
---
# <a name="part-5-package-and-deploy-with-msix"></a>Часть 5. Упаковка и развертывание с помощью MSIX

Это заключительная часть учебника, в котором показано, как модернизировать пример классического приложения WPF с именем Contoso расходы. Общие сведения о руководстве, предварительных требованиях и инструкциях по скачиванию примера приложения см [. в разделе Учебник. Модернизировать приложение](modernize-wpf-tutorial.md)WPF. В этой статье предполагается, что вы уже выполнили [часть 4](modernize-wpf-tutorial-4.md).

В [части 4](modernize-wpf-tutorial-4.md) вы узнали, что для некоторых API-интерфейсов WinRT, включая API уведомлений, требуется удостоверение пакета, прежде чем их можно будет использовать в приложении. Удостоверение пакета можно получить путем упаковки расходов contoso с помощью [MSIX](https://docs.microsoft.com/windows/msix), формата упаковки, представленного в Windows 10, для упаковки и развертывания приложений Windows. MSIX предоставляет преимущества для таблицы как для разработчиков, так и для ИТ-специалистов, включая:

- Оптимизированное использование сети и дисковое пространство.
- Полное удаление с очисткой благодаря упрощенному контейнеру, в котором выполняется приложение. В системе не осталось разделов реестра и временных файлов.
- Отделяет обновления ОС от обновлений и настроек приложений.
- Упрощает процесс установки, обновления и удаления. 

В этой части руководства вы узнаете, как упаковать приложение "расходы Contoso" в пакет MSIX.

## <a name="package-the-application"></a>Упаковка приложения

Visual Studio 2019 предоставляет простой способ упаковки классического приложения с помощью проекта упаковки приложений Windows. 

1. В **Обозреватель решений**щелкните правой кнопкой мыши решение **Контосоекспенсес** и выберите **Добавить-> новый проект**.

    ![Добавить новый проект](images/wpf-modernize-tutorial/AddNewProject.png)

3. В диалоговом окне **Добавление нового проекта** найдите `packaging`и выберите шаблон проект **упаковки приложений Windows** в C# категории и нажмите кнопку **Далее**.

    ![Проект упаковки приложений Windows](images/wpf-modernize-tutorial/WAP.png)

4. Присвойте новому проекту `ContosoExpenses.Package` имя и нажмите кнопку **создать**.

5. Выберите **Windows 10, версия 1903 (10,0; Сборка 18362)** для **целевой версии** и **минимальной версии** и нажмите кнопку **ОК**.

    Проект **контосоекспенсес. Package** добавляется в решение **контосоекспенсес** . Этот проект включает [манифест пакета](https://docs.microsoft.com/uwp/schemas/appxpackage/uapmanifestschema/schema-root), который описывает приложение, и некоторые ресурсы по умолчанию, используемые для таких элементов, как значок в меню программы и плитка на начальном экране. Однако в отличие от проекта UWP проект упаковки не содержит код. Его целью является упаковка существующего классического приложения.

6. В проекте **контосоекспенсес. Package** щелкните правой кнопкой мыши узел **приложения** и выберите команду **Добавить ссылку**. Этот узел указывает, какие приложения в решении будут включаться в пакет.

7. В списке проектов выберите **контосоекспенсес. Core** и нажмите кнопку **ОК**.

8. Разверните узел **приложения** и убедитесь, что на проект **контосоекспенсе. Core** есть ссылка и выделен полужирным шрифтом. Это означает, что он будет использоваться в качестве отправной точки для пакета.

9. Щелкните правой кнопкой мыши проект **контосоекспенсес. Package** и выберите команду **Назначить запускаемым проектом**.

10. В обозреватель решений щелкните правой кнопкой мыши узел проекта **контосоекспенсес. Package** и выберите пункт **изменить файл проекта**.

11. Найдите в этом файле элемент `<Import Project="$(WapProjPath)\Microsoft.DesktopBridge.targets" />`.

12. Замените этот элемент следующим XML-кодом.

    ``` xml
    <ItemGroup>
        <SDKReference Include="Microsoft.VCLibs,Version=14.0">
        <TargetedSDKConfiguration Condition="'$(Configuration)'!='Debug'">Retail</TargetedSDKConfiguration>
        <TargetedSDKConfiguration Condition="'$(Configuration)'=='Debug'">Debug</TargetedSDKConfiguration>
        <TargetedSDKArchitecture>$(PlatformShortName)</TargetedSDKArchitecture>
        <Implicit>true</Implicit>
        </SDKReference>
    </ItemGroup>
    <Import Project="$(WapProjPath)\Microsoft.DesktopBridge.targets" />
    <Target Name="_StompSourceProjectForWapProject" BeforeTargets="_ConvertItems">
        <ItemGroup>
        <_TemporaryFilteredWapProjOutput Include="@(_FilteredNonWapProjProjectOutput)" />
        <_FilteredNonWapProjProjectOutput Remove="@(_TemporaryFilteredWapProjOutput)" />
        <_FilteredNonWapProjProjectOutput Include="@(_TemporaryFilteredWapProjOutput)">
            <SourceProject>
            </SourceProject>
        </_FilteredNonWapProjProjectOutput>
        </ItemGroup>
    </Target>
    ```

13. Сохраните файл проекта и закройте его.

14. Нажмите клавишу **F5** , чтобы запустить упакованное приложение в отладчике.

На этом этапе можно заметить некоторые изменения, которые указывают, что приложение теперь выполняется как упакованное:

- Значок на панели задач или в меню "Пуск" теперь является ресурсом по умолчанию, включенным в каждый **проект упаковки приложений Windows**.
- Если щелкнуть правой кнопкой мыши приложение **контосоекспенсе. Package** , указанное в меню "Пуск", можно заметить параметры, которые обычно зарезервированы для приложений, скачанных из Microsoft Store, таких как **Параметры приложения**, **Частота, обзор** и **общий доступ.** .

    ![Контосоекспенсес в меню "Пуск"](images/wpf-modernize-tutorial/StartMenu.png)

- Если вы хотите удалить приложение, щелкните правой кнопкой мыши **контосоекспенсе. Package** в меню "Пуск" и выберите команду " **Удалить**". Приложение будет немедленно удалено, не выходя из оставшихся в системе.

## <a name="test-the-notification"></a>Проверка уведомления

Теперь, когда вы выполнили упаковку приложения "расходы Contoso" с помощью MSIX, вы можете протестировать сценарий уведомления, который не работал в конце [части 4](modernize-wpf-tutorial-4.md).

1. В приложении "расходы Contoso" выберите сотрудника из списка и нажмите кнопку **Добавить новый расход** . 
2. Заполните все поля в форме и нажмите кнопку **сохранить**.
3. Убедитесь, что отображается уведомление ОС.

![Всплывающее уведомление](images/wpf-modernize-tutorial/ToastNotification.png)
