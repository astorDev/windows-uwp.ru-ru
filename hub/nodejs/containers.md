---
title: Приступая к работе с контейнерами DOCKER с Node. js
description: Пошаговое руководство, помогающее приступить к использованию контейнеров DOCKER в приложениях Node. js.
author: mattwojo
ms.author: mattwoj
manager: jken
ms.topic: article
keywords: ''
ms.localizationpriority: medium
ms.date: 09/19/2019
ms.openlocfilehash: 9467224814b1e26f18031662f5e8d994a8fae1ac
ms.sourcegitcommit: 26bb75084b9d2d2b4a76d4aa131066e8da716679
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2020
ms.locfileid: "75683677"
---
# <a name="get-started-using-docker-containers-with-nodejs"></a>Приступая к работе с контейнерами DOCKER с Node. js

Пошаговое руководство, помогающее приступить к использованию контейнеров DOCKER в приложениях Node. js.

## <a name="prerequisites"></a>Необходимые условия

В этом руководстве предполагается, что вы уже выполнили действия по [настройке среды разработки Node. js с помощью WSL 2](./setup-on-wsl2.md), включая:

- Установите Windows 10 Insider Preview Build 18932 или более поздней версии.
- Включите функцию WSL 2 в Windows.
- Установите дистрибутив Linux (Ubuntu 18,04 для наших примеров). Это можно проверить с помощью: `wsl lsb_release -a`.
- Убедитесь, что дистрибутив Ubuntu 18,04 работает в режиме WSL 2. (WSL может запускать дистрибутивы в режиме v1 или v2.) Это можно проверить, открыв PowerShell и введя: `wsl -l -v`.
- С помощью PowerShell установите Ubuntu 18,04 в качестве дистрибутива по умолчанию с помощью: `wsl -s ubuntu 18.04`.

## <a name="overview-of-docker-containers"></a>Общие сведения о контейнерах DOCKER

**DOCKER** — это средство, используемое для создания, развертывания и запуска приложений с помощью контейнеров. Контейнеры позволяют разработчикам упаковывать приложения с использованием всех необходимых компонентов (библиотек, платформ, зависимостей и т. д.) и поставлять все это как один пакет. Использование контейнера гарантирует, что приложение будет работать одинаково независимо от настроенных параметров или ранее установленных библиотек на компьютере, где он работает, который может отличаться от компьютера, который использовался для написания и тестирования кода приложения. Это позволяет разработчикам сосредоточиться на написании кода, не беспокоясь о том, на какой системе будет выполняться код.

Контейнеры DOCKER похожи на виртуальные машины, но не создают всю виртуальную операционную систему. Вместо этого DOCKER позволяет приложению использовать тот же ядро Linux, что и система, на которой он работает. Это позволяет пакету приложения требовать только те части, которые еще не находятся на главном компьютере, уменьшая размер пакета и повышая производительность.

Постоянная доступность, использование контейнеров DOCKER с такими инструментами, как [Kubernetes](https://docs.microsoft.com/azure/aks/), является еще одной причиной популярности контейнеров. Это позволяет создавать несколько версий контейнера приложения в разное время. Вместо того чтобы занимать всю систему для обновления или обслуживания, каждый контейнер (и его конкретные микрослужбы) можно заменить на лету. Вы можете подготовить новый контейнер со всеми обновлениями, настроить контейнер для рабочей среды и просто указать новый контейнер после его готовности. Вы также можете архивировать различные версии приложения, используя контейнеры, и при необходимости обеспечить их запуск в качестве резервной стратегии обеспечения безопасности.

## <a name="install-docker-desktop-wsl-2-tech-preview"></a>Установка DOCKER Desktop WSL 2 Technical Preview

Ранее WSL 1 не удалось запустить управляющую программу DOCKER напрямую, но она изменилась с WSL 2 и привела к существенным улучшениям скорости и производительности с помощью DOCKER Desktop для WSL 2.

Чтобы установить и запустить DOCKER Desktop WSL 2 Technical Preview:

1. Скачайте [установщик DOCKER Desktop WSL 2 Technical Preview](https://download.docker.com/win/edge/36883/Docker%20Desktop%20Installer.exe). (При необходимости можно сослаться на [документацию по установщику](https://docs.docker.com/docker-for-windows/wsl-tech-preview/) ).

2. Откройте только что скачанный установщик DOCKER. Мастер установки выдаст запрос, нужно ли использовать контейнеры Windows вместо контейнеров Linux. не устанавливайте этот флажок, так как мы будем использовать подсистему Linux. DOCKER будет установлен в управляемом каталоге в дистрибутиве WSL 2 по умолчанию и будет включать управляющую программу DOCKER, CLI и интерфейс командной строки компоновки.

    ![Запуск DOCKER Desktop](../images/install-docker-1.png)

3. Если у вас еще нет идентификатора DOCKER, необходимо настроить его, посетив: [https://hub.docker.com/signup](https://hub.docker.com/signup). Идентификатор должен содержать все строчные алфавитно-цифровые символы.

4. После установки запустите приложение DOCKER Desktop, выбрав значок ярлыка на рабочем столе или находясь в меню "Пуск" Windows. Значок DOCKER появится в меню "скрытые значки" панели задач. Щелкните правой кнопкой мыши значок, чтобы открыть меню команд DOCKER, и выберите "WSL 2 Technical Preview".

5. После открытия окна Technical Preview нажмите кнопку **начать** , чтобы начать выполнение управляющей программы DOCKER (фоновый процесс) в WSL 2. При запуске управляющей программы DOCKER WSL 2 для нее автоматически создается контекст CLI DOCKER.

    ![Запуск DOCKER Desktop](../images/start-docker.gif)

6. Чтобы убедиться, что DOCKER установлен, и отобразить номер версии, откройте командную строку (WSL или PowerShell) и введите: `docker --version`

7. Проверьте, правильно ли работает установка, выполнив простой встроенный образ docker: `docker run hello-world`

Вот несколько команд DOCKER, которые следует иметь в курсе:

- Перечислите команды, доступные в интерфейсе командной строки DOCKER, введя: `docker`
- Вывод сведений о конкретной команде с помощью: `docker <COMMAND> --help`
- Перечислите образы DOCKER на своем компьютере (это только образ Hello-World), используя: `docker image ls --all`
- Перечислите контейнеры на компьютере с помощью: `docker container ls --all`
- Перечислите вашу статистику системы DOCKER и ресурсы (память & ЦП), доступные в контексте WSL 2, с помощью: `docker info`
- Показать, где в данный момент выполняется DOCKER с: `docker context ls`

Можно увидеть, что в используется два контекста: `default` (классическая управляющая программа DOCKER) и `wsl` (Наша рекомендация, использующая техническую предварительную версию). (Кроме того, команда `ls` короткий для `list` и может использоваться взаимозаменяемой).

![Контекст для вывода DOCKER в PowerShell](../images/docker-context.png)

> [!TIP]
> Попробуйте построить пример образа DOCKER с помощью этого [руководства в центре DOCKER](https://hub.docker.com/?overlay=onboarding). Центр DOCKER также содержит множество тысяч образов с открытым кодом, которые могут соответствовать типу приложения, которое вы хотите контейнеризовать. Вы можете скачать образы, например этот [контейнер платформы Гатсби. js](https://hub.docker.com/r/gatsbyjs/gatsby-dev-builds) или [контейнер платформы нукст. js](https://hub.docker.com/r/hobord/nuxtexpress), и расширить его с помощью собственного кода приложения. Можно выполнить поиск в реестре с помощью [DOCKER из командной строки](https://docs.docker.com/engine/reference/commandline/search/) или [веб-сайта DOCKER Hub](https://hub.docker.com/search/?type=image).

## <a name="install-the-docker-extension-on-vs-code"></a>Установка расширения DOCKER на VS Code

Расширение DOCKER упрощает создание и развертывание контейнерных приложений, а также управление ими из Visual Studio Code.

1. Откройте окно **расширения** (CTRL + SHIFT + X) в VS Code и выполните поиск **DOCKER**.

2. Выберите [расширение Microsoft DOCKER](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker) и **установите**. Чтобы включить расширение, необходимо перезагрузить VS Code после установки.

    ![Расширение DOCKER на VS Code в удаленном WSL](../images/docker-vscode-extension.png)

Установив расширение DOCKER на VS Code, вы сможете открыть список команд `Dockerfile`, которые использовались в следующем разделе, с помощью ярлыка: `Ctrl+Space`

Дополнительные сведения о [работе с DOCKER в VS Code](https://code.visualstudio.com/docs/azure/docker).

## <a name="create-a-container-image-with-dockerfile"></a>Создание образа контейнера с помощью DockerFile

**Образ контейнера** хранит код приложения, библиотеки, файлы конфигурации, переменные среды и среду выполнения. Использование образа гарантирует, что среда в контейнере будет стандартизирована и будет содержать только то, что необходимо для создания и запуска приложения.

**DockerFile** содержит инструкции, необходимые для создания нового образа контейнера. Иными словами, этот файл создает образ контейнера, который определяет среду приложения, чтобы его можно было воссоздать в любом месте.

Давайте создадим образ контейнера с помощью приложения Next. js, настроенного в разделе руководств по [веб-платформам](./web-frameworks.md) .

1. Откройте приложение Next. js в VS Code (убедитесь, что расширение Remote-WSL выполняется, как указано на левой нижней вкладке слева). Откройте окно терминала WSL, интегрированное в VS Code (**просмотр > терминала**) и убедитесь, что путь к терминалу указывает на каталог следующего проекта. js (ie. `~/NextProjects/my-next-app$`).

2. Создайте новый файл с именем `Dockerfile` в корневом каталоге следующего проекта. js и добавьте следующее:

    ```docker
    # Specifies where to get the base image (Node v12 in our case) and creates a new container for it
    FROM node:12
    
    # Set working directory. Paths will be relative this WORKDIR.
    WORKDIR /usr/src/app
    
    # Install dependencies
    COPY package*.json ./
    RUN npm install
    
    # Copy source files from host computer to the container
    COPY . .
    
    # Build the app
    RUN npm run build
    
    # Specify port app runs on
    EXPOSE 3000

    # Run the app
    CMD [ "npm", "start" ]
    ```

3. Чтобы создать образ DOCKER, выполните следующую команду в корневом каталоге проекта (но замените `<your_docker_username>` именем пользователя, созданным в DOCKER HUB): `docker build -t <your_docker_username>/my-nextjs-app .`

> [!NOTE]
> Чтобы эта команда работала, Docker должен работать с WSL Technical Preview. Напоминание о запуске DOCKER см. в разделе [step #4](#install-docker-desktop-wsl-2-tech-preview) раздела install. Флаг `-t` указывает имя создаваемого образа, "My-некстжс-App: V1" в нашем случае. При создании образа рекомендуется всегда [использовать номер версии в именах тегов](https://medium.com/@mccode/the-misunderstood-docker-tag-latest-af3babfd6375) . Не забудьте включить точку в конце команды, которая указывает текущий рабочий каталог, который будет использоваться для поиска и копирования файлов сборки для следующего приложения. js.

4. Чтобы запустить новый образ DOCKER для следующего приложения с. js в контейнере, введите команду: `docker run -d -p 3333:3000 <your_docker_username>/my-nextjs-app:v1`

5. Флаг `-p` привязывает порт "3000" (порт, который выполняется приложением в контейнере) с локальным портом "3333" на компьютере, чтобы можно было указать в веб-браузере, [http://localhost:3333](http://localhost:3333) и увидеть приложение, отображаемое на стороне сервера, которое выполняется в виде образа контейнера DOCKER.

> [!TIP]
> Мы создали образ контейнера с помощью `FROM node:12`, который ссылается на образ по умолчанию Node. js версии 12, хранящийся в центре DOCKER. Этот образ Node. js по умолчанию основан на системе Debian/Ubuntu Linux, однако существует множество различных образов Node. js, которые можно выбрать, но вы можете использовать нечто более простое или адаптированное в соответствии с вашими потребностями. Дополнительные сведения см. в [разделе реестр образов Node. js в DOCKER Hub](https://hub.docker.com/_/node/).

## <a name="upload-your-container-image-to-a-repository"></a>Передача образа контейнера в репозиторий

**Репозиторий контейнеров** хранит образ контейнера в облаке. Как правило, репозиторий контейнеров будет содержать коллекцию связанных образов, таких как различные версии, которые доступны для простоты установки и быстрого развертывания. Как правило, вы можете получить доступ к образам в репозиториях контейнеров с помощью защищенных конечных точек HTTPs, что позволяет извлекать образы, отправлять их или управлять ими с помощью любого экземпляра системы, оборудования или виртуальной машины.

**Реестр контейнеров**, с другой стороны, хранит коллекцию репозиториев, а также индексы, правила управления доступом и пути API. Они могут размещаться в общедоступном или частном порядке. [DOCKER Hub](https://hub.docker.com/) — это реестр DOCKER с открытым кодом, используемый по умолчанию при выполнении команд `docker push` и `docker pull`. Он предоставляется бесплатно для общедоступных репозиториев и требует оплаты для частных репозиториев.

Чтобы отправить новый образ контейнера в репозиторий, размещенный в DOCKER Hub:

1. Войдите в центр DOCKER. Вам будет предложено ввести имя пользователя и пароль, которые использовались для создания учетной записи центра DOCKER на этапе установки. Чтобы войти в DOCKER в окне терминала, введите: `docker login`

2. Чтобы получить список образов контейнеров DOCKER, созданных на компьютере, введите: `docker image ls --all`

3. Отправьте образ контейнера в центр DOCKER, создав новый репозиторий для него с помощью следующей команды: `docker push <your_docker_username>/my-nextjs-app:v1`

4. Теперь вы можете просмотреть репозиторий в центре DOCKER, ввести описание и связать учетную запись GitHub (если вы хотите), посетив: https://cloud.docker.com/repository/list

5. Вы также можете просмотреть список активных контейнеров DOCKER с помощью: `docker container ls` (или `docker ps`).

6. Вы увидите, что контейнер My-некстжс-App: v1 активен в порте 3333-> 3000/TCP. Вы также можете увидеть идентификатор контейнера, указанный здесь. Чтобы прерывать работу контейнера, введите команду: `docker stop <container ID>`

7. Обычно после остановки контейнера его также следует удалить. Это приводит к очистке всех оставшихся в нем ресурсов. После удаления контейнера все изменения, внесенные в файловую систему образа, будут безвозвратно утеряны. Вам потребуется создать новый образ для представления изменений. ЧТОБЫ удалить контейнер, используйте команду: `docker rm <container ID>`

Узнайте больше о [создании контейнерного веб-приложения с помощью DOCKER](https://docs.microsoft.com/learn/modules/intro-to-containers/).

## <a name="deploy-to-azure-container-registry"></a>Развертывание в Реестре контейнеров Azure

[**Реестр контейнеров Azure**](https://azure.microsoft.com/services/container-registry/) (записи контроля доступа) позволяет хранить образы контейнеров, а также управлять ими в частных и проверенных репозиториях. С помощью стандартных команд DOCKER запись контроля доступа может выполнять критически важные задачи, например мониторинг работоспособности контейнеров и обслуживание, связывание с [Kubernetes](https://docs.microsoft.com/azure/aks/intro-kubernetes) для создания масштабируемых систем оркестрации. Создавайте сборки по требованию или полностью автоматизированные сборки с помощью триггеров, таких как принятие исходного кода и обновление базового образа. Кроме того, запись контроля доступа использует обширную облачную сеть Azure для управления задержкой в сети, глобальными развертываниями и создания простого собственного интерфейса для всех пользователей, использующих [службу приложений Azure](https://docs.microsoft.com/azure/app-service/) (для размещения веб-сайтов, мобильных серверных интерфейсов, интерфейса API сотовой связи) или [других облачных служб Azure](https://azure.microsoft.com/product-categories/containers/)

> [!IMPORTANT]
> Вам потребуется собственная подписка Azure, чтобы развернуть контейнер в Azure, и вы можете получить оплату. Если у вас еще нет подписки Azure, [Создайте бесплатную учетную запись](https://azure.microsoft.com/free/) , прежде чем начинать работу.

Сведения о создании реестра контейнеров Azure и развертывании образа контейнера приложения см. в разделе Упражнение. [развертывание образа DOCKER в экземпляре контейнера Azure](https://docs.microsoft.com/learn/modules/intro-to-containers/7-exercise-deploy-docker-image-to-container-instance).

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Node.js в Azure](https://azure.microsoft.com/develop/nodejs/)
- Краткое руководство. [Создание веб-приложения Node. js в Azure](https://docs.microsoft.com/azure/app-service/app-service-web-get-started-nodejs)
- Интерактивный курс: [Администрирование контейнеров в Azure](https://docs.microsoft.com/learn/paths/administer-containers-in-azure/)
- Использование VS Code: [Работа с DOCKER](https://code.visualstudio.com/docs/azure/docker)
- Документы docker: [DOCKER Desktop WSL 2 Technical Preview](https://docs.docker.com/docker-for-windows/wsl-tech-preview/)
