---
title: Начало работы с контейнерами Docker для Node.js
description: Пошаговое руководство, помогающее приступить к использованию контейнеров Docker с приложениями Node.js.
author: mattwojo
ms.author: mattwoj
manager: jken
ms.topic: article
keywords: ''
ms.localizationpriority: medium
ms.date: 09/19/2019
ms.openlocfilehash: 9467224814b1e26f18031662f5e8d994a8fae1ac
ms.sourcegitcommit: 26bb75084b9d2d2b4a76d4aa131066e8da716679
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2020
ms.locfileid: "75683677"
---
# <a name="get-started-using-docker-containers-with-nodejs"></a>Начало работы с контейнерами Docker для Node.js

Пошаговое руководство, помогающее приступить к использованию контейнеров Docker с приложениями Node.js.

## <a name="prerequisites"></a>Предварительные условия

В этом руководстве предполагается, что вы уже [настроили в среде разработки Node.js подсистему Windows для Linux версии 2](./setup-on-wsl2.md) (WSL 2), в том числе:

- установили Windows 10 Insider Preview (сборки 18932) или более поздней версии;
- включили компонент WSL 2 в Windows;
- установили дистрибутив Linux (Ubuntu 18.04 для наших примеров), что можно проверить с помощью команды `wsl lsb_release -a`;
- убедились, что дистрибутив Ubuntu 18.04 работает в режиме WSL 2 (WSL может запускать дистрибутивы в режиме версии 1 или 2), что можно проверить, открыв PowerShell и выполнив команду `wsl -l -v`;
- с помощью PowerShell установили Ubuntu 18.04 в качестве дистрибутива по умолчанию с помощью команды `wsl -s ubuntu 18.04`.

## <a name="overview-of-docker-containers"></a>Общие сведения о контейнерах Docker

**Docker** — это средство для создания, развертывания и запуска приложений с использованием контейнеров. Контейнеры позволяют разработчикам упаковывать приложения с использованием всех необходимых компонентов (библиотек, платформ, зависимостей и т. п.) и поставлять все это как один пакет. Использование контейнера дает возможность приложению работать одинаково, независимо от настроенных параметров или ранее установленных библиотек на компьютере, где оно запускается, так как он может отличаться от компьютера, который использовался для написания и тестирования кода приложения. Это позволяет разработчикам сосредоточиться на написании кода, не беспокоясь о том, в какой системе он будет выполняться.

Контейнеры Docker похожи на виртуальные машины, но не создают всю виртуальную операционную систему. Вместо этого контейнер Docker позволяет приложению использовать то же ядро Linux, что и система, в которой оно работает. Таким образом пакету приложения требуются только те части, которых еще нет на главном компьютере. В результате размер пакета уменьшается, а производительность увеличивается.

Постоянная доступность, которую обеспечивает использование контейнеров Docker с такими инструментами, как [Kubernetes](https://docs.microsoft.com/azure/aks/), — еще одна причина популярности контейнеров. Это позволяет создавать несколько версий контейнера приложения в разное время. Вместо того чтобы останавливать всю систему для обновления или обслуживания, каждый контейнер (и определенные микрослужбы) можно заменить на лету. Вы можете подготовить новый контейнер со всеми обновлениями, настроить его для рабочей среды и просто указать новый контейнер после его готовности. Можно также архивировать различные версии вашего приложения, используя контейнеры, и при необходимости поддерживать их работу в качестве резервного ресурса.

## <a name="install-docker-desktop-wsl-2-tech-preview"></a>Установка Docker Desktop для WSL 2 Technical Preview

Ранее в WSL 1 нельзя было запустить управляющую программу Docker напрямую, но подсистема изменилась с выпуском WSL 2: существенно увеличена скорость работы и производительность Docker Desktop для WSL 2.

Чтобы установить и запустить Docker Desktop для WSL 2 Technical Preview, выполните шаги ниже:

1. Скачайте установщик [Docker Desktop для WSL 2 Technical Preview](https://download.docker.com/win/edge/36883/Docker%20Desktop%20Installer.exe). (При необходимости см. документацию по работе [с установщиком](https://docs.docker.com/docker-for-windows/wsl-tech-preview/).)

2. Откройте установщик Docker, который вы только что скачали. Мастер установки выдаст запрос, нужно ли использовать контейнеры Windows вместо контейнеров Linux. Не устанавливайте флажок, так как мы будем использовать подсистему Linux. ПО Docker будет установлено в управляемом каталоге в дистрибутиве WSL 2 по умолчанию и будет включать в себя управляющую программу Docker, CLI и интерфейс командной строки Compose.

    ![Запуск Docker Desktop](../images/install-docker-1.png)

3. Если у вас еще нет идентификатора Docker, необходимо настроить его, посетив страницу: [https://hub.docker.com/signup](https://hub.docker.com/signup). Идентификатор должен содержать только строчные алфавитно-цифровые символы.

4. После установки запустите приложение Docker Desktop, щелкнув значок ярлыка на рабочем столе, или найдите его в меню "Пуск" Windows. Значок Docker появится в меню скрытых значков на панели задач. Щелкните правой кнопкой мыши значок, чтобы открыть меню команд Docker, и выберите WSL 2 Technical Preview.

5. После открытия окна Technical Preview нажмите кнопку **Запуск**, чтобы начать выполнение управляющей программы Docker (фоновый процесс) в WSL 2. При запуске управляющей программы Docker WSL 2 для нее автоматически создается контекст интерфейса командной строки Docker.

    ![Запуск Docker Desktop](../images/start-docker.gif)

6. Чтобы убедиться, что программа Docker установлена, и просмотреть номер версии, откройте командную строку (WSL или PowerShell) и введите команду `docker --version`.

7. Проверьте, правильно ли работает установка, запустив простой встроенный образ Docker: `docker run hello-world`.

Вот несколько команд Docker, которые следует знать:

- Перечислить команды, доступные в интерфейсе командной строки Docker, можно, выполнив команду `docker`.
- Просмотреть сведения о конкретной команде можно, выполнив команду `docker <COMMAND> --help`.
- Перечислить образы Docker на вашем компьютере (сейчас только образ Hello-World) можно, используя следующие команды `docker image ls --all`.
- Перечислить контейнеры на компьютере можно с помощью команды `docker container ls --all`.
- Просмотреть статистику и ресурсы (память и ЦП) системы Docker, доступные в контексте WSL 2, можно с помощью команды `docker info`.
- Увидеть, где сейчас выполняется контейнер Docker, можно с помощью команды `docker context ls`.

Можно увидеть, что Docker работает в двух контекстах: `default` — классическая управляющая программа Docker и `wsl` — рекомендуемая техническая предварительная версия. (Кроме того, можно использовать команду `ls` (сокращение от `list`).)

![Контекст для вывода Docker в PowerShell](../images/docker-context.png)

> [!TIP]
> Попробуйте создать пример образа Docker с помощью этого [учебника на сайте Docker Hub](https://hub.docker.com/?overlay=onboarding). На сайте Docker Hub также содержатся тысячи образов с открытым исходным кодом, что могут соответствовать типу приложения, которое вы хотите контейнеризовать. Вы можете скачать такие образы, как [контейнер платформы Gatsby.js](https://hub.docker.com/r/gatsbyjs/gatsby-dev-builds) или этот [контейнер платформы Nuxt.js](https://hub.docker.com/r/hobord/nuxtexpress), а затем расширить его с помощью собственного кода приложения. Можно выполнить поиск реестра в [Docker из командной строки](https://docs.docker.com/engine/reference/commandline/search/) или на [веб-сайте Docker Hub](https://hub.docker.com/search/?type=image).

## <a name="install-the-docker-extension-on-vs-code"></a>Установка расширения Docker для Visual Studio Code

Расширение Docker упрощает создание и развертывание контейнерных приложений, а также управление ими в Visual Studio Code (VS Code).

1. Откройте в VS Code окно **Расширения** (нажмите клавиши CTRL+SHIFT+X) и найдите **Docker**.

2. Выберите [расширение Microsoft Docker](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker) и **установите его**. Чтобы включить расширение, необходимо перезапустить VS Code после установки.

    ![Расширение Docker в VS Code с Remote-WSL](../images/docker-vscode-extension.png)

Установив расширение Docker в VS Code, можно вызвать список команд `Dockerfile`, используемых в следующем разделе, нажимая клавиши: `Ctrl+Space`.

См. дополнительные сведения о [работе с Docker в VS Code](https://code.visualstudio.com/docs/azure/docker).

## <a name="create-a-container-image-with-dockerfile"></a>Создание образа контейнера с помощью DockerFile

В **образе контейнера** хранятся код приложения, библиотеки, файлы конфигурации, переменные среды и среда выполнения. Использование образа гарантирует, что среда в контейнере стандартизирована и содержит только то, что необходимо для сборки и запуска приложения.

**DockerFile** — это текстовый файл с инструкциями, необходимыми для создания образа контейнера. Другими словами, этот файл создает образ контейнера, который определяет среду приложения, чтобы его можно было воссоздать в любом месте.

Создайте образ контейнера, используя приложение Next.js, настроенное при работе с руководством по использованию [веб-платформ](./web-frameworks.md).

1. Откройте приложение Next.js в VS Code (убедитесь, что расширение Remote-WSL выполняется, как указано на левой нижней зеленой вкладке слева). Откройте окно терминала WSL, интегрированного в VS Code (**Представление > Терминал**), и убедитесь, что путь терминала указывает на каталог проекта Next.js (например, `~/NextProjects/my-next-app$`).

2. Создайте файл с именем `Dockerfile` в корневом каталоге проекта Next.js и добавьте следующее:

    ```docker
    # Specifies where to get the base image (Node v12 in our case) and creates a new container for it
    FROM node:12
    
    # Set working directory. Paths will be relative this WORKDIR.
    WORKDIR /usr/src/app
    
    # Install dependencies
    COPY package*.json ./
    RUN npm install
    
    # Copy source files from host computer to the container
    COPY . .
    
    # Build the app
    RUN npm run build
    
    # Specify port app runs on
    EXPOSE 3000

    # Run the app
    CMD [ "npm", "start" ]
    ```

3. Чтобы создать образ Docker, выполните следующую команду в корневом каталоге проекта (но замените `<your_docker_username>` именем пользователя, созданного на Docker Hub): `docker build -t <your_docker_username>/my-nextjs-app .`

> [!NOTE]
> Чтобы эта команда работала, Docker должен работать с WSL Technical Preview. Сведения о запуске Docker см. на [шаге 4](#install-docker-desktop-wsl-2-tech-preview) раздела об установке. Флаг `-t` указывает имя создаваемого образа (в нашем случае my-nextjs-app:v1). Рекомендуется всегда [использовать номер версии в именах тегов](https://medium.com/@mccode/the-misunderstood-docker-tag-latest-af3babfd6375) при создании образа. Не забудьте поставить точку в конце команды, которая указывает текущий рабочий каталог, используемый для поиска и копирования файлов сборки для приложения Next.js.

4. Чтобы запустить новый образ Docker для приложения Next.js в контейнере, введите команду: `docker run -d -p 3333:3000 <your_docker_username>/my-nextjs-app:v1`

5. Флаг `-p` привязывает порт 3000 (который используется приложением в контейнере) к локальному порту 3333 на компьютере, поэтому вы можете указать в веб-браузере [http://localhost:3333](http://localhost:3333) и увидеть приложение, отображаемое на стороне сервера, которое выполняется как образ контейнера Docker.

> [!TIP]
> Вы создали образ контейнера с помощью `FROM node:12`, который ссылается на образ Node.js версии 12 по умолчанию, хранящийся на Docker Hub. Этот образ Node.js по умолчанию основан на системе Linux (Debian или Ubuntu), но существует множество различных образов Node.js, которые можно выбрать, и вы можете использовать более простой или соответствующий вашим потребностями образ. Дополнительные сведения см. на странице [о реестре образов Node.js в Docker Hub](https://hub.docker.com/_/node/).

## <a name="upload-your-container-image-to-a-repository"></a>Передача образа контейнера в репозиторий

**Репозиторий контейнеров** сохраняет образ контейнера в облаке. Часто репозиторий контейнеров фактически содержит набор связанных образов, таких как различные версии, которые доступны для простой настройки и быстрого развертывания. Как правило, вы можете получить доступ к образам в хранилищах контейнеров через защищенные конечные точки HTTP, что позволяет извлекать, передавать образы или управлять ими с помощью любой системы, аппаратного обеспечения или экземпляра виртуальной машины.

С другой стороны, в **реестре контейнеров** хранятся коллекция репозиториев, а также индексы, правила управления доступом и пути API. Они могут быть размещены в общедоступном или частном порядке. [Docker Hub](https://hub.docker.com/) — это реестр Docker с открытым исходным кодом, используемый по умолчанию при выполнении команд `docker push` и `docker pull`. Он предоставляется бесплатно для общедоступных репозиториев и на платной основе для частных репозиториев.

Чтобы отправить новый образ контейнера в репозиторий, размещенный на сайте Docker Hub, сделайте следующее:

1. Войдите на Docker Hub. Вам будет предложено ввести имя пользователя и пароль, которые использовались для создания учетной записи Docker Hub на этапе установки. Чтобы войти в Docker через терминал, введите команду `docker login`.

2. Чтобы получить список образов контейнеров Docker, созданных на компьютере, введите команду `docker image ls --all`.

3. Отправьте образ контейнера на Docker Hub, создав репозиторий для него с помощью команды `docker push <your_docker_username>/my-nextjs-app:v1`.

4. Теперь можно просмотреть репозиторий на Docker Hub, ввести описание и связать учетную запись GitHub (если необходимо), посетив страницу https://cloud.docker.com/repository/list.

5. Можно также просмотреть список активных контейнеров Docker с помощью команды `docker container ls` или `docker ps`.

6. Вы увидите, что контейнер my-nextjs-app:v1 активен на портах 3333 -> 3000 с использует протокол TCP. Вы также можете увидеть идентификатор контейнера, указанный здесь. Чтобы прервать работу контейнера, введите команду `docker stop <container ID>`.

7. Как правило, после остановки контейнера его также следует удалить. При удалении контейнера удаляются все оставшиеся ресурсы. После удаления контейнера все изменения, внесенные в файловую систему образа, будут безвозвратно утеряны. Вам потребуется создать образ для представления изменений. Чтобы удалить контейнер, используйте команду `docker rm <container ID>`.

Дополнительные сведения см. в модуле [Создание контейнерного веб-приложения с помощью Docker](https://docs.microsoft.com/learn/modules/intro-to-containers/).

## <a name="deploy-to-azure-container-registry"></a>Развертывание в Реестре контейнеров Azure

[**Реестр контейнеров Azure**](https://azure.microsoft.com/services/container-registry/) (ACR) позволяет хранить образы контейнеров, а также управлять ими в частных и прошедших проверку подлинности репозиториях. С помощью стандартных команд Docker ACR может автоматически выполнять критически важные задачи, такие как мониторинг работоспособности контейнеров и обслуживание, связывание с [Kubernetes](https://docs.microsoft.com/azure/aks/intro-kubernetes) для создания масштабируемых систем оркестрации. Можно выполнить сборку по требованию или полностью автоматизировать сборки с помощью триггеров, таких как фиксации исходного кода и обновление базовых образов. Кроме того, ACR использует обширную облачную сеть Azure для управления задержками в сети, глобальными развертываниями и создания простого собственного интерфейса для всех пользователей, использующих [Службу приложений Azure](https://docs.microsoft.com/azure/app-service/) (для размещения веб-служб, мобильных серверных интерфейсов, интерфейсов REST API) или [другие облачные службы Azure](https://azure.microsoft.com/product-categories/containers/).

> [!IMPORTANT]
> Вам потребуется собственная подписка Azure, чтобы развернуть контейнер в Azure, также вам может быть выставлен счет за использование. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.

Дополнительные сведения о создании реестра контейнеров Azure и развертывании образа контейнера приложения см. в этом упражнении: [Упражнение. Развертывание образа Docker в экземпляре контейнера Azure](https://docs.microsoft.com/learn/modules/intro-to-containers/7-exercise-deploy-docker-image-to-container-instance).

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Node.js в Azure](https://azure.microsoft.com/develop/nodejs/).
- Краткое руководство. [Создание веб-приложений Node.js в Azure](https://docs.microsoft.com/azure/app-service/app-service-web-get-started-nodejs).
- Интерактивный курс. [Администрирование контейнеров в Azure](https://docs.microsoft.com/learn/paths/administer-containers-in-azure/).
- Использование VS Code. [Работа с контейнерами](https://code.visualstudio.com/docs/azure/docker).
- Документация Docker. [Серверная часть Docker Desktop WSL 2](https://docs.docker.com/docker-for-windows/wsl-tech-preview/).
