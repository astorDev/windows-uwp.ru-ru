---
author: Xansky
ms.assetid: F45E6F35-BC18-45C8-A8A5-193D528E2A4E
description: Узнайте, как включить покупки из приложения и пробные версии в приложениях UWP.
title: Покупки из приложения и пробные версии
ms.author: mhopkins
ms.date: 05/09/2018
ms.topic: article
keywords: windows 10, uwp, покупки из приложения, IAP, надстройки, пробные версии, потребляемые, длительного пользования, подписка
ms.localizationpriority: medium
ms.openlocfilehash: 17a93e10f7b440ac7c1926bc64bba4d9be248710
ms.sourcegitcommit: 086001cffaf436e6e4324761d59bcc5e598c15ea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2018
ms.locfileid: "5710453"
---
# <a name="in-app-purchases-and-trials"></a>Покупки из приложения и пробные версии

Пакет Windows SDK предоставляет API, которые можно использовать для реализации следующих функций, позволяющих получать прибыль от своего приложения универсальной платформы Windows (UWP):

* **Покупки из приложения**&nbsp;&nbsp;Независимо от того, является ли ваше приложение бесплатным или нет, вы можете продавать содержимое, другие приложения или новые функциональные возможности (например, разблокирование следующего уровня игры) прямо из приложения.

* **Функциональность пробной версии**&nbsp;&nbsp;Если вы настраиваете свое приложение в качестве [бесплатной пробной версии на информационной панели Центра разработки для Windows](../publish/set-app-pricing-and-availability.md#free-trial), можно привлечь их к приобретению полной версии приложения путем удаления или ограничения некоторых функций в течение пробного периода. Вы можете также включить такие компоненты, как баннеры или водяные знаки, которые будут отображаться только во время испытательного срока, пока пользователь не купит приложение.

Эта статья содержит обзорные сведения о том, как в приложениях UWP работают покупки из приложения и пробные версии.

<span id="choose-namespace" />

## <a name="choose-which-namespace-to-use"></a>Выбор пространства имен

Существует два разных пространствах имен, которые можно использовать для добавления функций покупок из приложения и пробной версии в приложениях UWP в зависимости от того, для какой версии Windows 10 предназначены ваши приложения. Несмотря на то что API в этих пространствах имен служат тем же целям, они различаются принципами разработки и имеют несовместимый код.

* **[Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx)**&nbsp;&nbsp;Начиная с Windows 10 версии 1607, приложения могут использовать API в этом пространстве имен для реализации функциональности покупок из приложения и пробных версий. Рекомендуется использовать элементы из этого пространства имен, если ваше проект вашего приложения предназначен для **Windows 10 Anniversary Edition (10.0; сборка 14393)** или более позднего выпуска в Visual Studio.. Это пространство имен поддерживает новейшие типы надстроек, включая потребляемые надстройки, управляемые Магазином, а его архитектура обеспечивает совместимость с будущими продуктами и компонентами, которые поддерживаются Центром разработки для Windows и Магазином. Дополнительные сведения об этом пространстве имен см. в разделе [Покупки из приложения и пробные версии, использующие пространство имен Windows.Services.Store](#api_intro) этой статьи.

* **[Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx)**&nbsp;&nbsp;Все версии Windows 10 также поддерживают устаревший API для покупок из приложения и пробных версий в этом пространстве имен. Сведения об использовании элементов пространства имен **Windows.ApplicationModel.Store** см. в разделе [Внутренние покупки приложения и пробные версии, использующие пространство имен Windows.ApplicationModel.Store](in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md).

> [!IMPORTANT]
> Пространство имен **Windows.ApplicationModel.Store** больше не дополняется новыми функциями, и мы рекомендуем вместо него использовать пространство имен **Windows.Services.Store**, если это возможно для вашего приложения. Пространство имен **Windows.ApplicationModel.Store** не поддерживается в классических приложениях Windows, использующих [мост для классических приложений](https://developer.microsoft.com/windows/bridges/desktop), и в приложениях и играх, использующих изолированную среду разработки в центре разработки (например, такая ситуация возникает с любой игрой, которая интегрируется с Xbox Live).

<span id="concepts" />

## <a name="basic-concepts"></a>Основные понятия

Каждый элемент, предлагаемый в Магазине, как правило, называется *продукт*. Большинство разработчиков работают только со следующими типами продуктов: *приложения* и *надстройки*.

Надстройка представляет собой продукт или функцию, которую вы предоставляете своим клиентам (пользователям) в контексте приложения: например, валюту для использования в приложении или игре, новые карты или оружие для игры, возможность использовать приложение без рекламы, а также цифровое содержимое (музыку или видео) для приложений, в которых реализована возможность предоставления такого типа содержимого. С каждым приложением и каждой надстройкой связана лицензия, указывающая, имеет ли пользователь право на использование приложения или надстройки. Если пользователь имеет право на использование приложения или надстройки в качестве пробной версии, лицензия также предоставляет дополнительную информацию об этой пробной версии.

Чтобы предоставлять клиентам надстройки в своем приложении, необходимо [определить надстройку для вашего приложения на информационной панели Центра разработки](../publish/add-on-submissions.md), чтобы Магазин был оповещен об этом. Затем ваше приложение может использовать API в пространстве имен **Windows.Services.Store** или **Windows.ApplicationModel.Store**, чтобы предложить пользователю надстройку в качестве покупки из приложения.

Приложения UWP могут иметь следующие типы надстроек.

| Тип надстройки |  Описание  |
|---------|-------------------|
| Длительное пользование  |  Надстройка, которая существует в течение срока, указанного вами на [информационной панели Центра разработки для Windows](../publish/enter-iap-properties.md). <p/><p/>По умолчанию срок действия надстроек длительного пользования никогда не истекает, а приобрести их можно только один раз. Если указать для надстройки определенный срок действия, пользователь сможет повторно приобрести ее по окончании срока действия. |
| Потребляемые надстройки, управляемые разработчиком  |  Надстройка, которую можно купить, использовать, а затем снова купить, если она был употреблена. Вы отвечаете за отслеживание потребляемых элементов на балансе пользователя, которые предоставляет надстройка.<p/><p/>Когда пользователь потребляет любые элементы, связанные с надстройкой, вы отвечаете за учет баланса пользователя, а также за сообщение Store о том, что купленная надстройка израсходована, после того как пользователь израсходует все элементы. Пользователь не может снова приобрести надстройку, пока ваше приложение не сообщит об израсходовании предыдущей покупки. <p/><p/>Например, если ваша надстройка представляет 100 игровых монет и пользователь израсходовал 10 монет, ваше приложение или служба должны поддерживать для пользователя новый баланс остатка в 90 монет. Когда пользователь израсходует все 100 монет, ваше приложение должно сообщить, что надстройка израсходована, после чего пользователь снова сможет приобрести 100 монет из надстройки.    |
| Потребляемые надстройки, управляемые Store  |  Надстройка, которую можно приобрести, использовать и приобрести снова в любое время. Для этого типа надстроек учет элементов на балансе пользователя производится Store.<p/><p/>Когда пользователь использует какие-либо элементы, связанные с этой надстройкой, вы должны сообщить Store, что эти элементы израсходованы, после чего Store обновляет баланс пользователя. Пользователь может приобрести надстройку сколько угодно раз (для этого не требуется сначала использовать элементы). Приложение может в любой момент запросить текущий баланс пользователя. <p/><p/> Например, если надстройка представляет начальную сумму в 100 игровых монет и пользователь израсходовал 50 монет, приложение сообщает Store, что израсходованы 50 единиц надстройки, и Store обновляет баланс. Если пользователь затем снова приобретает надстройку, чтобы получить еще 100 монет, общее число монет составит 150. <p/><p/>**Примечание.**&nbsp;&nbsp;Для использования управляемых Microsoft Store надстроек ваше приложение должно быть предназначено для **Windows 10 Anniversary Edition (10.0; сборка 14393)** или более позднего выпуска в Visual Studio, и оно должно использовать пространство имен **Windows.Services.Store**, а не **Windows.ApplicationModel.Store**.  |
| Подписка | Надстройка длительного пользования, где плата с пользователей взымается периодически, что позволяет им продолжать пользоваться надстройкой. Клиент может отменить подписку в любое время, чтобы избежать дальнейших расходов. <p/><p/>**Примечание.**&nbsp;&nbsp;Для использования управляемых надстроек с подпиской ваше приложение должно быть предназначено для **Windows 10 Anniversary Edition (10.0; сборка 14393)** или более позднего выпуска в Visual Studio, и оно должно использовать пространство имен **Windows.Services.Store**, а не **Windows.ApplicationModel.Store**.  |

<span />

> [!NOTE]
> Другие типы надстроек, например надстройки длительного пользования с пакетами (также известны как "загружаемое содержимое" или DLC), доступны ограниченному кругу разработчиков и не освещаются в этой документации.

<span id="api_intro" />

## <a name="in-app-purchases-and-trials-using-the-windowsservicesstore-namespace"></a>Покупки из приложения и пробные версии, использующие пространство имен Windows.Services.Store

В этом разделе содержится обзор важных задач и понятий пространства имен [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx). Это пространство имен доступно только приложениям, предназначенным для **Windows 10 Anniversary Edition (10.0; сборка 14393)** и более поздних выпусков в Visual Studio (это соответствует Windows 10 версии 1607). Рекомендуется по возможности использовать пространство имен **Windows.Services.Store**, а не [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx). Информацию о пространстве имен **Windows.ApplicationModel.Store** см. [в этой статье](in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md).

**В этом разделе**

* [Видео](#video)
* [Начало работы с классом StoreContext](#get-started-storecontext)
* [Реализация покупок из приложения](#implement-iap)
* [Реализации функциональности пробной версии](#implement-trial)
* [Проверка вашей покупки из приложения или реализации пробной версии](#testing)
* [Чеки для покупок из приложения](#receipts)
* [Использование класса StoreContext с мостом для классических приложений](#desktop)
* [Продукты, SKU и доступность](#products-skus)
* [Коды продукта в Магазине](#store-ids)

<span id="video" />

### <a name="video"></a>Видео

Посмотрите видеоролик, чтобы ознакомиться с общими сведениями о том, как реализовать покупки из приложения с помощью пространства имен [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx).
<br/>
<br/>
> [!VIDEO https://channel9.msdn.com/Blogs/One-Dev-Minute/Adding-In-App-Purchases-to-Your-UWP-App/player]

<span id="get-started-storecontext" />

### <a name="get-started-with-the-storecontext-class"></a>Начало работы с классом StoreContext

Главной точкой входа в пространство имен **Windows.Services.Store** является класс [StoreContext](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storecontext.aspx). Этот класс предоставляет методы, которые можно использовать, чтобы получить сведения о текущем приложении и его доступных надстройках, получить лицензионные сведения о текущем приложении или его надстройках, приобрести приложение или надстройку для текущего пользователя и решить другие задачи. Чтобы получить объект [StoreContext](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storecontext.aspx), выполните одно из следующих действий.

* В однопользовательском приложении (то есть приложении, которое работает только в контексте пользователя, который запустил это приложение) воспользуйтесь статическим методом [GetDefault](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getdefault), чтобы получить объект **StoreContext**, который можно использовать для доступа к актуальным для пользователя данным, связанным с Microsoft Store. Большинство приложений UWP— это однопользовательские приложения.

  ```csharp
  Windows.Services.Store.StoreContext context = StoreContext.GetDefault();
  ```

* В [многопользовательском](../xbox-apps/multi-user-applications.md) приложении используйте статический метод [GetForUser](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getforuser), чтобы получить объект **StoreContext**, который можно использовать для доступа к данным, связанным с Microsoft Store. Речь идет о данных для конкретного пользователя, который при работе с приложением выполнил вход с учетной записью Майкрософт. В следующем примере мы получим объект **StoreContext** для первого доступного пользователя.

  ```csharp
  var users = await Windows.System.User.FindAllAsync();
  Windows.Services.Store.StoreContext context = StoreContext.GetForUser(users[0]);
  ```

> [!NOTE]
> Классические приложения для Windows, использующие [мост для классических приложений](https://developer.microsoft.com/windows/bridges/desktop), должны выполнить дополнительные действия для настройки объекта [StoreContext](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storecontext.aspx), чтобы его можно было использовать. Дополнительные сведения см. в [этом разделе](#desktop).

Получив объект [StoreContext](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storecontext.aspx), можно начать вызывать методы этого объекта для получения сведений о продукте из Магазина для текущего приложения и его надстроек, получать сведения о лицензии для текущего приложения и его надстроек, приобретать приложение или надстройку для текущего пользователя и выполнять другие задачи. Дополнительные сведения об общих задачах, которые можно выполнять с помощью этого объекта, см. в следующих статьях:

* [Получение информации о продукте для приложений и надстроек](get-product-info-for-apps-and-add-ons.md)
* [Получение информации о лицензии для приложений и надстроек](get-license-info-for-apps-and-add-ons.md)
* [Поддержка покупок приложений и надстроек внутри приложения](enable-in-app-purchases-of-apps-and-add-ons.md)
* [Поддержка покупок потребляемых надстроек внутри приложения](enable-consumable-add-on-purchases.md)
* [Включение надстроек с подпиской для приложения](enable-subscription-add-ons-for-your-app.md)
* [Реализация пробной версии приложения](implement-a-trial-version-of-your-app.md)

Пример приложения, в котором показано, как использовать класс **StoreContext** и другие типы в пространстве имен **Windows.Services.Store**, см. в разделе [Образец из Магазина](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/Store).

<span id="implement-iap" />

### <a name="implement-in-app-purchases"></a>Реализация покупок из приложения

Чтобы предложить покупки из приложения пользователям вашего приложения, используя пространство имен **Windows.Services.Store**, выполните следующие действия:

1. Если ваше приложение предлагает надстройки, которые можно приобрести, [создайте отправки надстроек для вашего приложения на информационной панели Центра разработки](https://msdn.microsoft.com/windows/uwp/publish/add-on-submissions).

2. Напишите код в приложении для [извлечения сведений о продукте для вашего приложения или надстройки, предлагаемой приложением,](get-product-info-for-apps-and-add-ons.md) а затем [определите, активна ли лицензия](get-license-info-for-apps-and-add-ons.md) (то есть имеется ли у пользователя лицензия на использование приложения или надстройки). Если лицензия неактивна, отобразите пользовательский интерфейс, предлагающий приложение или надстройку для продажи пользователю в качестве покупки из приложения.

3. Если пользователь решает приобрести ваше приложение или надстройку, используйте для покупки продукта соответствующий метод.

    * Если пользователь покупает приложение или надстройку для долгосрочного использования, следуйте указаниям в разделе [Включение покупок из приложений для приложений и надстроек](enable-in-app-purchases-of-apps-and-add-ons.md).
    * Если пользователь покупает потребляемую надстройку, следуйте инструкциям в разделе [Включение покупок потребляемых надстроек](enable-consumable-add-on-purchases.md).
    * Если пользователь покупает надстройку с подпиской, следуйте указаниям в разделе [Включение надстроек с подпиской для приложения](enable-subscription-add-ons-for-your-app.md).

4. Проверьте реализацию, следуя [руководству по тестированию](#testing) в этой статье.

<span id="implement-trial" />

### <a name="implement-trial-functionality"></a>Реализации функциональности пробной версии

Чтобы исключить или ограничить функции в пробной версии приложения с помощью пространства имен **Windows.Services.Store**, выполните следующие действия:

1. [Настройте приложение в качестве бесплатной пробной версии на информационной панели Центра разработки Windows](../publish/set-app-pricing-and-availability.md#free-trial).

2. Напишите код в приложении, чтобы [извлечь сведения о продукте для вашего приложения или надстройки, предлагаемой в приложении,](get-product-info-for-apps-and-add-ons.md) а затем [определить, является ли связанная с приложением лицензия лицензией на пробную версию](get-license-info-for-apps-and-add-ons.md).

3. Исключите или ограничьте определенные функции приложения, если это пробная версия, а затем включите их, если пользователь приобретет полную лицензию. Дополнительные сведения и пример кода см. в разделе [Внедрение пробной версии приложения](implement-a-trial-version-of-your-app.md).

4. Проверьте внедрение, следуя [руководству по тестированию](#testing) в этой статье.

<span id="testing" />

### <a name="test-your-in-app-purchase-or-trial-implementation"></a>Проверка вашей покупки из приложения или реализации пробной версии

Если ваше приложение использует API-интерфейсы в пространстве имен **Windows.Services.Store** для реализации покупок из приложения и пробного периода, вам необходимо опубликовать приложение в Microsoft Store и скачать его на свое устройство разработки, чтобы использовать его лицензию для тестирования. Выполните следующие действия, чтобы протестировать код.

1. Если ваше приложение еще не опубликовано и не доступно в Microsoft Store, убедитесь, что оно соответствует минимальным требованиям [комплекта сертификации приложений для Windows](https://developer.microsoft.com/windows/develop/app-certification-kit), [отправьте свое приложение](https://msdn.microsoft.com/windows/uwp/publish/app-submissions) на информационную панель Центра разработки для Windows и убедитесь, что ваше приложение прошло сертификацию. При необходимости можно [настроить приложение, чтобы его нельзя было найти в Магазине](https://msdn.microsoft.com/windows/uwp/publish/set-app-pricing-and-availability), пока вы его тестируете. Обратите внимание, правильная настройка [тестовых пакетов](../publish/package-flights.md). Неправильно настроенные пакета, который может быть тестовых пакетов не смогут загрузить.

2. Затем убедитесь, что вы выполнили следующие действия:

    * Напишите код в приложении, которое использует класс [StoreContext](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storecontext.aspx) и другие связанные типы в пространстве имен **Windows.Services.Store**, чтобы реализовать функцию [покупок из приложения](#implement-iap) или [пробной версии](#implement-trial).
    * Если ваше приложение предлагает надстройку, которую можно приобрести, [создайте отправку надстройки для вашего приложения на информационной панели Центра разработки](https://msdn.microsoft.com/windows/uwp/publish/add-on-submissions).
    * Если вы хотите исключить или ограничить некоторые функциональные возможности пробной версии приложения, [настройте приложение в качестве бесплатной пробной версии на информационной панели Центра разработки для Windows](../publish/set-app-pricing-and-availability.md#free-trial).

3. Открыв проект в Visual Studio, щелкните **Меню проекта**, укажите на **Магазин** и выберите **Связать приложение с Магазином**. Выполните инструкции мастера, чтобы связать проект приложения с приложением в вашей учетной записи Центра разработки для Windows, которое требуется использовать для тестирования.
    > [!NOTE]
    > Если не связать свой проект с приложением в Магазине, методы [StoreContext](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storecontext.aspx) присвоят свойству **ExtendedError** возвращаемых значений этих методов значение кода ошибки 0x803F6107. Это значение указывает, что Магазин ничего не знает об этом приложении.
4. Если вы еще не сделали этого, установите приложение из Магазина (см. предыдущий шаг), запустите приложение один раз и затем закройте его. Это гарантирует, что на устройстве разработки установлена действующая лицензия приложения.

5. Запустите свой проект или начните его отладку в Visual Studio. Код должен извлечь данные приложения и надстройки из приложения Магазина, которое вы связали с локальным проектом. В ответ на предложение переустановить приложение выполните инструкции, а затем запустите свой проект или начните его отладку.
    > [!NOTE]
    > После выполнения этих шагов вы сможете продолжить обновлять код вашего приложения, а затем выполнить отладку обновленного проекта на компьютере для разработки без отправки новых пакетов приложения в Магазин. Чтобы получить локальную лицензию, которая будет использоваться для тестирования, необходимо всего один раз скачать версию вашего приложения в Магазине на ваш компьютер для разработки. Вам всего лишь необходимо отправить новые пакеты приложения в Магазин после завершения тестирования, и когда вам потребуется открыть доступ для пользователей к покупкам из приложения или возможностям пробной версии вашего приложения.

Если ваше приложение использует пространство имен **Windows.ApplicationModel.Store**, вы можете использовать в своем приложении класс [CurrentAppSimulator](https://msdn.microsoft.com/library/windows/apps/hh779766) для моделирования лицензионных сведений во время тестирования перед отправкой приложения в Магазин. Дополнительные сведения см. в разделе [Начало работы с классами CurrentApp и CurrentAppSimulator] (in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md#get-started-with-the-currentapp-and-currentappsimulator-classes).  

> [!NOTE]
> Пространство имен **Windows.Services.Store** не предоставляет класс, который можно использовать для имитации лицензионных сведений во время тестирования. Если вы используете пространство имен **Windows.Services.Store** для реализации покупок из приложения и пробных версий, вам необходимо опубликовать приложение в Магазине и скачать его на свое устройство разработки, чтобы использовать его лицензию для тестирования, как описано выше.

<span id="receipts" />

### <a name="receipts-for-in-app-purchases"></a>Чеки для покупок из приложения

Пространство имен **Windows.Services.Store** не предоставляет API, который можно использовать для получения чека об успешном совершении покупки, в коде приложения. Это отличается от приложений, использующих пространство имен **Windows.ApplicationModel.Store**, которое может использовать [клиентский API для извлечения чека о выполнении транзакции](use-receipts-to-verify-product-purchases.md).

Если функция покупок из приложения реализована с использованием пространства имен **Windows.Services.Store** и требуется поверить, приобрел ли этот клиент приложение или надстройку, можно воспользоваться [запросом метода продуктов](query-for-products.md) в [API REST коллекции Microsoft Store](view-and-grant-products-from-a-service.md). Возвращаемые этим методом данные подтверждают, имеет ли указанный клиент право на использование этого продукта, и предоставляют информацию для транзакции, в которой пользователь приобрел этот продукт. API коллекции Microsoft Store использует для извлечения этой информации аутентификацию Azure AD.

<span id="desktop" />

### <a name="using-the-storecontext-class-with-the-desktop-bridge"></a>Использование класса StoreContext с мостом для настольных ПК

Классические приложения, использующие [мост для настольных компьютеров](https://developer.microsoft.com/windows/bridges/desktop), могут реализовать покупки из приложения и пробную версию с помощью класса [StoreContext](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storecontext.aspx). Тем не менее если у вас есть классические приложения Win32 или классическое приложение, которое содержит дескриптор окна (HWND), связанный со структурой визуализации (например, приложение WPF), приложение должно настроить объект **StoreContext** так, чтобы указать, какое окно приложения является окном-владельцем модальных диалоговых окон, отображаемых объектом.

Многие участники класса **StoreContext** (и участники других связанных типов, доступ к которым осуществляется через объект **StoreContext**) отображают пользователю модальное диалоговое окно для выполнения связанных с Магазином операций, например покупки продукта. Если в классическом приложении не настроен объект **StoreContext**, чтобы задать владельца окна для модальных диалоговых окон, этот объект будет возвращать неточные данные или ошибки.

Чтобы настроить объект **StoreContext** в классическом приложении, использующем мост для настольных компьютеров, выполните следующие действия.

1. Выполните одно из следующих действий, чтобы предоставить приложению доступ к интерфейсу [IInitializeWithWindow](https://msdn.microsoft.com/library/windows/desktop/hh706981.aspx).

    * Если приложение написано на управляемом языке, например C# или Visual Basic, объявите интерфейс **IInitializeWithWindow** в коде приложения с атрибутом [ComImport](https://msdn.microsoft.com/library/system.runtime.interopservices.comimportattribute.aspx), как показано в следующем примере кода на C#. В этом примере предполагается, что файл кода имеет оператор **using** для пространства имен **System.Runtime.InteropServices**.

        ```csharp
        [ComImport]
        [Guid("3E68D4BD-7135-4D10-8018-9FB6D9F33FA1")]
        [InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
        public interface IInitializeWithWindow
        {
            void Initialize(IntPtr hwnd);
        }
        ```

    * Если приложения написано на языке C++, добавьте ссылку на файл заголовка shobjidl.h в коде. Файл заголовка содержит объявление интерфейса **IInitializeWithWindow**.

2. Получите объект [StoreContext](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storecontext.aspx), используя метод [GetDefault](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getdefault) (или метод [GetForUser](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getforuser), если ваше приложение является [многопользовательским](../xbox-apps/multi-user-applications.md)), как описано выше в этой статье, и приведите этот объект к объекту [IInitializeWithWindow](https://msdn.microsoft.com/library/windows/desktop/hh706981.aspx). Затем вызовите метод [IInitializeWithWindow.Initialize](https://msdn.microsoft.com/library/windows/desktop/hh706982.aspx) и передайте дескриптор окна, которое вы хотите сделать владельцем любых модальных диалоговых окон, которые отображаются методами **StoreContext**. В следующем примере кода на C# показана передача дескриптора главного окна приложения методу.
    ```csharp
    StoreContext context = StoreContext.GetDefault();
    IInitializeWithWindow initWindow = (IInitializeWithWindow)(object)context;
    initWindow.Initialize(System.Diagnostics.Process.GetCurrentProcess().MainWindowHandle);
    ```

<span id="products-skus" />

### <a name="products-skus-and-availabilities"></a>Продукты, SKU и доступность

Каждый продукт в Магазине имеет по меньшей мере одну *SKU*, а каждая SKU— по меньшей мере одну *доступность*. Разработчики избавлены от необходимости работать с этими абстрактными концепциями на информационной панели Центра разработки для Windows, и большинство разработчиков никогда не определяют SKU или доступности для своих приложений или надстроек. Поскольку объектная модель для продуктов из Магазина в пространстве имен **Windows.Services.Store** все же содержит SKU и доступности, общие сведения об этих понятиях будут вам полезны в некоторых ситуациях.

| Объект |  Описание  |
|---------|-------------------|
| Продукт  |  Термин *продукт* обозначает любой тип продукта, который доступен в Магазине, включая приложение или надстройку. <p/><p/> Каждый продукт в Магазине имеет соответствующий объект [StoreProduct](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storeproduct.aspx). Этот класс предоставляет свойства, которые можно использовать для получения доступа к данным, таким как код продукта в Магазине, изображения и видео для описания в Магазине и сведения о ценах. Кроме того, класс предоставляет методы, которые можно использовать для приобретения продукта. |
| SKU |  *SKU* — это конкретная версия продукта с уникальным описанием, ценой и прочими сведениями. У каждого приложения или надстройки имеется SKU по умолчанию. Единственный случай, когда разработчик может иметь несколько SKU для приложения, это если публикуется и полная, и пробная версии приложения (в каталоге Магазина каждая из этих версий будет иметь свою SKU одного и того же приложения). <p/><p/> Некоторые издатели могут определять собственные SKU. Например, крупный издатель игр может выпустить игру с одной SKU для стран, где показывать кровь красным запрещено и, следовательно, нужно показать ее зеленым цветом, а другую SKU— чтобы показывать кровь красной в любых странах. Кроме того, издатель, продающий цифровое видеосодержимое, может опубликовать две SKU для видео: одну— для версии высокой четкости, а другую— для версии стандартной четкости. <p/><p/> Каждый SKU в Магазине имеет соответствующий объект [StoreSku](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storesku.aspx). Каждый [StoreProduct](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storeproduct.aspx) имеет свойство [Skus](https://docs.microsoft.com/uwp/api/windows.services.store.storeproduct.skus), которое можно использовать для доступа к SKU этого продукта. |
| Доступность  |  *Доступность* — это конкретная версия SKU с уникальной ценовой информацией. Каждая SKU имеет доступность по умолчанию. Некоторые издатели имеют возможность определять собственные доступности, предлагая разные ценовые варианты для данной SKU. <p/><p/> Каждая доступность в Магазине имеет соответствующий объект [StoreAvailability](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storeavailability.aspx). Каждый объект [StoreSku](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storesku.aspx) имеет свойство [Availabilities](https://docs.microsoft.com/uwp/api/windows.services.store.storesku.availabilities), которое можно использовать для доступа к доступностям этого SKU. Для большинства разработчиков каждая SKU имеет одну доступность по умолчанию.  |

<span id="store_ids" />

### <a name="store-ids"></a>Коды продукта в Магазине

Все приложения, надстройки и другие продукты в Магазине имеют соответствующий **код в Магазине** (его также иногда называют *кодом продукта в Магазине*). Многие API-интерфейсы требуют указания кода продукта в Магазине для выполнения операции с приложением или надстройкой.

Код любого продукта в Магазине — это буквенно-цифровая строка, состоящая из 12 символов, например ```9NBLGGH4R315```. Существует несколько различных способов получить код продукта в Магазине для продукта в Магазине.

* Для приложения можно получить код продукта в Магазине на [странице удостоверения приложения](../publish/view-app-identity-details.md) информационной панели Центра разработки.
* Для надстройки код продукта в Магазине можно найти на странице обзора надстройки на информационной панели.
* Для любого продукта вы также можете получить код продукта в Магазине программными средствами с помощью свойства [StoreId](https://docs.microsoft.com/uwp/api/windows.services.store.storeproduct.storeid) объекта [StoreProduct](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storeproduct.aspx), представляющего продукт.

Для продуктов с SKU и доступностями каждый объект SKU и доступности также имеют собственные коды продукта в Магазине с различными форматами.

| Объект |  Формат кода продукта в Магазине  |
|---------|-------------------|
| SKU |  Код продукта в Магазине для SKU имеет формат ```<product Store ID>/xxxx```, где ```xxxx``` — это буквенно-цифровая строка из 4 символов, идентифицирующая SKU для продукта. Например, ```9NBLGGH4R315/000N```. Этот идентификатор возвращается свойством [StoreId](https://docs.microsoft.com/uwp/api/windows.services.store.storesku.storeid) объекта [StoreSku](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storesku.aspx) и иногда называется *кодом SKU в Магазине*. |
| Доступность  |  Код продукта в Магазине для доступности имеет формат ```<product Store ID>/xxxx/yyyyyyyyyyyy```, где ```xxxx``` — это буквенно-цифровая строка из 4 символов, которая определяет SKU для продукта, а ```yyyyyyyyyyyy``` — это буквенно-цифровая строка из 12 символов, которая определяет доступность для SKU. Например, ```9NBLGGH4R315/000N/4KW6QZD2VN6X```. Этот идентификатор возвращается свойством [StoreId](https://docs.microsoft.com/uwp/api/windows.services.store.storeavailability.storeid) объекта [StoreAvailability](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storeavailability.aspx) и иногда называется *кодом доступности в Магазине*.  |

<span id="product-ids" />

## <a name="how-to-use-product-ids-for-add-ons-in-your-code"></a>Как использовать коды продуктов для надстроек в коде

Если вы хотите обеспечить доступ пользователей к надстройке в контексте приложения, необходимо [ввести уникальный код продукта](../publish/set-your-add-on-product-id.md#product-id) для надстройки при [создании отправки надстройки](../publish/add-on-submissions.md) на информационной панели Центра разработки. Этот код продукта можно использовать для отсылки к надстройке в коде, хотя конкретные ситуации, в которых можно использовать код продукта, зависят от того, какое пространство имен используется для покупок из приложения.

> [!NOTE]
> Код продукта, который вы укажете на информационной панели Центра разработки для надстройки, отличается от [кода продукта в Магазине](#store-ids) для этой надстройки. Код продукта в Магазине создается в Центре разработки.

### <a name="apps-that-use-the-windowsservicesstore-namespace"></a>Приложения, использующие пространство имен Windows.Services.Store

Если ваше приложение использует пространство имен **Windows.Services.Store**, можно использовать код продукта для легкой идентификации объекта [StoreProduct](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreProduct), представляющего вашу надстройку, или объекта [StoreLicense](https://docs.microsoft.com/uwp/api/windows.services.store.storelicense), представляющего лицензию вашей надстройки. Код продукта предоставляется свойствами [StoreProduct.InAppOfferToken](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreProduct.InAppOfferToken) и [StoreLicense.InAppOfferToken](https://docs.microsoft.com/uwp/api/windows.services.store.storelicense.InAppOfferToken).

> [!NOTE]
> Несмотря на то что код продукта является полезным средством для идентификации надстройки в коде, большинство операций в пространстве имен **Windows.Services.Store** используют [код продукта в Магазине](#store-ids) для надстройки, а не код продукта. Например, для программного извлечения одной или нескольких известных надстроек для приложения, передайте коды продуктов в магазине (а не коды продуктов) для этих надстроек методу [GetStoreProductsAsync](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getstoreproductsasync). Аналогичным образом, чтобы объявить об израсходовании потребляемой надстройки, передайте код продукта в Магазине для этой надстройки (а не код продукта) методу [ReportConsumableFulfillmentAsync](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.reportconsumablefulfillmentasync).

### <a name="apps-that-use-the-windowsapplicationmodelstore-namespace"></a>Приложения, использующие пространство имен Windows.ApplicationModel.Store

Если ваше приложение использует пространство имен **Windows.ApplicationModel.Store**, необходимо использовать код продукта, который можно назначить надстройке на информационной панели Центра разработки для большинства операций. Пример

* Используйте код продукта для идентификации описания [ProductListing](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.productlisting), представляющего вашу надстройку, или [ProductLicense](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.productlicense), представляющей лицензию вашей надстройки. Код продукта предоставляется свойствами [ProductListing.ProductId](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.productlisting.ProductId) и [ProductLicense.ProductId](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.productlicense.ProductId).

* Укажите код продукта при покупке вашей надстройки для пользователя с помощью метода [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.requestproductpurchaseasync). Дополнительные сведения см. в разделе [Поддержка покупок внутренних продуктов приложения](enable-in-app-product-purchases.md).

* Укажите код продукта при сообщении об израсходовании потребляемой надстройки с помощью метода [ReportConsumableFulfillmentAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.reportconsumablefulfillmentasync). Дополнительные сведения см. в разделе [Поддержка покупок потребляемых внутренних продуктов приложения](enable-consumable-in-app-product-purchases.md).

## <a name="related-topics"></a>Еще по теме:

* [Получение информации о продукте для приложений и надстроек](get-product-info-for-apps-and-add-ons.md)
* [Получение информации о лицензии для приложений и надстроек](get-license-info-for-apps-and-add-ons.md)
* [Поддержка покупок приложений и надстроек внутри приложения](enable-in-app-purchases-of-apps-and-add-ons.md)
* [Поддержка покупок потребляемых надстроек внутри приложения](enable-consumable-add-on-purchases.md)
* [Включение надстроек с подпиской для приложения](enable-subscription-add-ons-for-your-app.md)
* [Внедрение пробной версии приложения](implement-a-trial-version-of-your-app.md)
* [Коды ошибок для операций Microsoft Store](error-codes-for-store-operations.md)
* [Покупки из приложения и пробные версии, использующие пространство имен Windows.ApplicationModel.Store](in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md)
