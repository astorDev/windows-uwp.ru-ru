---
author: mcleanbyron
ms.assetid: 9621641A-7462-425D-84CC-101877A738DA
description: "Узнайте, как перейти с AdMediatorControl на AdControl в приложениях UWP."
title: "Переход с AdMediatorControl на AdControl для приложений UWP"
ms.author: mcleans
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: "windows 10, uwp, объявления, реклама, AdMediatorControl, AdControl, переход"
translationtype: Human Translation
ms.sourcegitcommit: c6b64cff1bbebc8ba69bc6e03d34b69f85e798fc
ms.openlocfilehash: 83235595a6a7f9e9b0b5d8de154d6e5d8a8db8ef
ms.lasthandoff: 02/07/2017

---

# <a name="migrate-from-admediatorcontrol-to-adcontrol-for-uwp-apps"></a>Переход с AdMediatorControl на AdControl для приложений UWP

Предыдущие выпуски пакетов SDK от Майкрософт позволили приложениям универсальной платформы Windows (UWP) отображать рекламные баннеры с помощью класса **AdMediatorControl**, благодаря чему разработчики смогли оптимизировать свой доход от рекламы путем показа рекламных баннеров из наших партнерских сетей (AOL и AppNexus), а также AdDuplex. Пакет [Microsoft Store Services SDK](http://aka.ms/store-em-sdk) больше не поддерживает класс **AdMediatorControl**. Если у вас есть приложение, в котором используется класс **AdMediatorControl** из предыдущего пакета SDK, и вы хотите перенести его в приложение UWP, в котором используется [Microsoft Store Services SDK](http://aka.ms/store-em-sdk), следуйте инструкциям в этой статье, чтобы обновить код для использования класса **AdControl** вместо **AdMediatorControl**. Вы также можете настроить приложение в качестве рекламного посредника для AdDuplex при помощи пропорционального или приоритетного подхода.

>**Примечание**.&nbsp;&nbsp;Примеры кода в этой статье предоставлены исключительно в демонстрационных целях. Вам может потребоваться внести изменения в примеры кода для их использования в вашем приложении.

## <a name="prerequisites"></a>Необходимые условия

* опубликованное в Магазине Windows приложение UWP, в котором используется AdMediatorControl;
* компьютер для разработки с установленными Visual Studio 2015 и [Microsoft Store Services SDK](http://aka.ms/store-em-sdk);
* если вы планируете выполнять роль рекламного посредника для AdDuplex, вам также потребуется установить пакет [AdDuplex Windows 10 SDK](https://visualstudiogallery.msdn.microsoft.com/6930860a-e64b-4b46-9d72-62d7fddda077) на компьютере для разработки.

  >**Примечание**.&nbsp;&nbsp;В качестве альтернативы запуску установщика пакета SDK AdDuplex по ссылке выше вы можете установить библиотеки AdDuplex для проекта приложения UWP в Visual Studio 2015. Откройте проект приложения UWP в Visual Studio 2015, нажмите **Проект** > **Управление проектами NuGet**, найдите пакет NuGet с именем **AdDuplexWin10** и установите его.

## <a name="step-1-retrieve-your-application-ids-and-ad-unit-ids"></a>Шаг 1. Получение идентификаторов приложения и рекламных блоков

При переносе кода для использования класса **AdControl** необходимо знать идентификаторы приложения и рекламных блоков. Проще всего получить самые свежие идентификаторы из файла конфигурации посредника.

1. Войдите на информационную панель Центра разработки для Windows и щелкните приложение, в котором используется **AdMediatorControl**.
2. Нажмите **Монетизация**, а затем — **Получение дохода с помощью рекламы**.
3. В разделе **Рекламный посредник Windows** щелкните ссылку **Скачать конфигурацию посредника** и откройте файл AdMediator.config в текстовом редакторе, таком как "Блокнот".
4. В файле найдите элемент ```<AdAdapterInfo>``` с дочерним элементом ```<Name>MicrosoftAdvertising</Name>```. Этот раздел содержит конфигурацию для платной рекламы Майкрософт.
5. В элементе ```<AdAdapterInfo>``` найдите элементы ```<Property>```, содержащие элементы ```<Key>``` со значениями **WApplicationId** и **WAdUnitId**. В примере ниже значения элементов ```<Value>``` взяты в качестве примера.

  > [!div class="tabbedCodeSnippets"]
  ```xml
  <Metadata>
      <Property>
          <Key>WApplicationId</Key>
          <Value>364d4938-c0f5-4c3d-8aae-090206211dc9</Value>
      </Property>
      <Property>
          <Key>WAdUnitId</Key>
          <Value>301568</Value>
      </Property>
  </Metadata>
  ```

6. Скопируйте оба значения элементов ```<Value>```. Они пригодятся в дальнейшем. Эти значения содержат идентификаторы приложения и рекламного блока для немобильного рекламного блока для платной рекламы Майкрософт.
5. В том же элементе ```<AdAdapterInfo>``` найдите элементы ```<Property>```, содержащие элементы ```<Key>``` со значениями **MApplicationId** и **MAdUnitId**. В примере ниже значения элементов ```<Value>``` взяты в качестве примера.

  > [!div class="tabbedCodeSnippets"]
  ```xml
  <Metadata>
      <Property>
          <Key>MApplicationId</Key>
          <Value>e2cf8388-7018-4a11-8ab0de90f2a7a401</Value>
      </Property>
      <Property>
          <Key>MAdUnitId</Key>
          <Value>301056</Value>
      </Property>
  </Metadata>
  ```

6. Скопируйте оба значения элементов ```<Value>```. Они пригодятся в дальнейшем. Эти значения содержат идентификаторы приложения и рекламного блока для мобильного рекламного блока для платной рекламы Майкрософт.
7. Если вы используете [собственную рекламу](../publish/about-house-ads.md), найдите элемент ```<AdAdapterInfo>``` с дочерним элементом ```<Name>MicrosoftAdvertisingHouse</Name>```. В этом элементе найдите элементы ```<Key>``` со значениями **MAdUnitId** и **WAdUnitId** и сохраните значения соответствующих элементов ```<Value>```. Они пригодятся в дальнейшем. Это идентификаторы мобильных и немобильных рекламных блоков для собственной рекламы Майкрософт соответственно.
8. Если вы используете AdDuplex, найдите элемент ```<AdAdapterInfo>``` с дочерним элементом ```<Name>AdDuplex</Name>```. В этом элементе найдите элементы ```<Key>``` со значениями **AppKey** и **AdUnitId** и сохраните значения соответствующих элементов ```<Value>```. Они пригодятся в дальнейшем. Это ключ приложения AdDuplex и идентификатор рекламного блока соответственно.

## <a name="step-2-update-your-app-code"></a>Шаг 2. Обновление кода приложения

Получив идентификаторы приложения и рекламных блоков, вы готовы приступить к обновлению кода приложения для использования **AdControl** вместо **AdMediatorControl**.

### <a name="microsoft-paid-ads-only"></a>Только платная реклама Майкрософт

Если в своей конфигурации рекламного посредника вы используете только платную рекламу Майкрософт, выполните следующие действия.

  >**Примечание**.&nbsp;&nbsp;Эти действия предполагают, что страница приложения, на которой вы планируете показывать рекламу, содержит пустую сетку с именем **myAdGrid**, например: ```<Grid x:Name="myAdGrid"/>```. Выполняя эти действия, вы создадите и настроите элементы управления рекламой полностью в виде кода, а не XAML.

1. Откройте проект приложения UWP в Visual Studio.
2.  В **Обозревателе решений** щелкните правой кнопкой мыши элемент **Ссылки** и выберите **Добавить ссылку...**.
В **Диспетчере ссылок** разверните раздел **Универсальная платформа Windows**, нажмите **Расширения** и выберите флажок рядом с **SDK Microsoft Advertising для XAML** (версия 10.0).
3. В **Диспетчере ссылок** нажмите "ОК".
4. Удалите объявление **AdMediatorControl** из XAML и удалите весь код, в котором используется этот объект **AdMediatorControl**, включая любые связанные обработчики событий.
5. Откройте файл кода для **Страницы** приложения, на которой вы планируете показывать рекламу.
6. Добавьте следующий оператор в верхнюю часть файла с кодом, если его еще нет.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[TrialVersion](./code/AdvertisingSamples/MigrateToAdControl/cs/MainPage.xaml.cs#Snippet1)]

7. Добавьте следующие постоянные объявления в класс **Page**.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[TrialVersion](./code/AdvertisingSamples/MigrateToAdControl/cs/MainPage.xaml.cs#Snippet2)]

7. В каждом из постоянных объявлений замените значения следующим образом:

  * **AD_WIDTH** и **AD_HEIGHT**. Назначьте этим свойствам один из [поддерживаемых размеров рекламных баннеров]( https://msdn.microsoft.com/windows/uwp/monetize/supported-ad-sizes-for-banner-ads).
  * **WAPPLICATIONID** и **WADUNITID**. Назначьте этим свойствам значения **WApplicationId** и **WAdUnitId** для платной рекламы Майкрософт, полученные ранее из файла конфигурации посредника (это значения для немобильного рекламного блока для платной рекламы).
  * **MAPPLICATIONID** и **MADUNITID**. Назначьте этим свойствам значения **MApplicationId** и **MAdUnitId** для платной рекламы Майкрософт, полученные ранее из файла конфигурации посредника (это значения для мобильного рекламного блока для платной рекламы).

8. Добавьте следующие переменные объявления в класс **Page**.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[AdControl](./code/AdvertisingSamples/MigrateToAdControl/cs/MainPage.xaml.cs#Snippet3)]

5. Добавьте следующий код в конструктор класса **Page** после вызова метода **InitializeComponent()**.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[AdControl](./code/AdvertisingSamples/MigrateToAdControl/cs/MainPage.xaml.cs#Snippet4)]

### <a name="microsoft-paid-ads-house-ads-and-adduplex"></a>Платная и собственная реклама Майкрософт и AdDuplex

Если вы используете собственную рекламу Майкрософт или AdDuplex и платную рекламу Майкрософт и планируете продолжать выполнять роль рекламного посредника для AdDuplex, выполните действия в этом разделе. Эти примеры кода поддерживают AdDuplex и собственную рекламу Майкрософт. Если вы используете AdDuplex без собственной рекламы Майкрософт или наоборот, удалите код, неактуальный для вашего сценария.

  >**Примечание**.&nbsp;&nbsp;Эти действия предполагают, что страница приложения, на которой вы планируете показывать рекламу, содержит пустую сетку с именем **myAdGrid**, например: ```<Grid x:Name="myAdGrid"/>```. Выполняя эти действия, вы создадите и настроите элементы управления рекламой полностью в виде кода, а не XAML.

1. Откройте проект приложения UWP в Visual Studio.
2.  В **Обозревателе решений** щелкните правой кнопкой мыши элемент **Ссылки** и выберите **Добавить ссылку...**.
В **Диспетчере ссылок** разверните раздел **Универсальная платформа Windows**, нажмите **Расширения** и выберите флажок рядом с **SDK Microsoft Advertising для XAML** (версия 10.0).
3. В **Диспетчере ссылок** нажмите "ОК".
4. Удалите объявление **AdMediatorControl** из XAML и удалите весь код, в котором используется этот объект **AdMediatorControl**, включая любые связанные обработчики событий.
5. Откройте файл кода для **Страницы** приложения, на которой вы планируете показывать рекламу.
6. Добавьте следующие операторы в верхнюю часть файла с кодом, если их еще нет.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[AdControl](./code/AdvertisingSamples/MigrateToAdControl/cs/ExamplePage1.xaml.cs#Snippet1)]

7. Добавьте следующие постоянные объявления в класс **Page**.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[AdControl](./code/AdvertisingSamples/MigrateToAdControl/cs/ExamplePage1.xaml.cs#Snippet2)]

4. В этих постоянных объявлениях замените значения следующим образом:

  * **AD_WIDTH** и **AD_HEIGHT**. Назначьте этим свойствам один из [поддерживаемых размеров рекламных баннеров]( https://msdn.microsoft.com/windows/uwp/monetize/supported-ad-sizes-for-banner-ads).
  * **HOUSE_AD_WEIGHT**. Назначьте этому свойству значение в виде целого числа от 0 до 100, указывающее пропорциональное значение, которое требуется применить к собственной рекламе Майкрософт относительно платной рекламы Майкрософт (где 0 означает полное отсутствие показа собственной рекламы, а 100 — показ только собственной рекламы).
  * **WAPPLICATIONID** и **WADUNITID_PAID**. Назначьте этим свойствам значения **WApplicationId** и **WAdUnitId** для платной рекламы Майкрософт, полученные ранее из файла конфигурации посредника (это значения для немобильного рекламного блока для платной рекламы).
  * **WADUNITID_HOUSE**. Назначьте этому свойству значение **WAdUnitId** для собственной рекламы Майкрософт, полученное ранее из файла конфигурации посредника (это значение для немобильного рекламного блока для собственной рекламы).
  * **MAPPLICATIONID** и **MADUNITID_PAID**. Назначьте этим свойствам значения **MApplicationId** и **MAdUnitId** для платной рекламы Майкрософт, полученные ранее из файла конфигурации посредника (это значения для мобильного рекламного блока для платной рекламы).
  * **WADUNITID_HOUSE**. Назначьте этому свойству значение **WAdUnitId** для собственной рекламы Майкрософт, полученное ранее из файла конфигурации посредника (это значение для немобильного рекламного блока для собственной рекламы).
  * **ADDUPLEX_APPKEY** и **ADDUPLEX_ADUNIT**. Назначьте этим свойствам значения ключа приложения AdDuplex и идентификаторов рекламных блоков, полученные ранее из файла конфигурации посредника.

  >**Примечание.**&nbsp;&nbsp;Не изменяйте значения **AD_REFRESH_SECONDS** и **MAX_ERRORS_PER_REFRESH**, приведенные в предыдущем примере.

5. Добавьте следующие переменные объявления в класс **Page**.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[AdControl](./code/AdvertisingSamples/MigrateToAdControl/cs/ExamplePage1.xaml.cs#Snippet3)]

5. Добавьте следующий код в конструктор класса **Page** после вызова метода **InitializeComponent()**.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[AdControl](./code/AdvertisingSamples/MigrateToAdControl/cs/ExamplePage1.xaml.cs#Snippet4)]

6. Наконец, добавьте следующие методы в класс **Page**. Эти методы создают объекты Microsoft **AdControl** и AdDuplex **AdControl** и используют генератор случайных чисел вместе с данными пропорциональными значениями для регулярного обновления рекламных баннеров в этих элементах управления.

  > [!div class="tabbedCodeSnippets"]
  [!code-cs[AdControl](./code/AdvertisingSamples/MigrateToAdControl/cs/ExamplePage1.xaml.cs#Snippet5)]

