---
ms.assetid: 9F0A59A1-FAD7-4AD5-B78B-C1280F215D23
description: Использование API целевых предложений в Microsoft Store для заявки на целевые предложения, доступные для данного пользователя вашего приложения.
title: Управление целевыми предложениями с помощью служб Магазина
ms.date: 10/10/2017
ms.topic: article
keywords: windows 10, uwp, службы Store, API целевых предложений Microsoft Store, целевые предложения
ms.localizationpriority: medium
ms.openlocfilehash: 27d99d2008352ff291f0cb620afab8ccb8f6977c
ms.sourcegitcommit: b11f305dbf7649c4b68550b666487c77ea30d98f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/27/2018
ms.locfileid: "7833487"
---
# <a name="manage-targeted-offers-using-store-services"></a>Управление целевыми предложениями с помощью служб Магазина

Если вы создаете на *целевое предложение* в **привлечение > целевые предложения** страницы для вашего приложения в центре партнеров *Майкрософт API целевых предложений магазина* в коде приложения для получения информации, способствующей в реализации взаимодействие в приложении для использования Целевое предложение. Дополнительные сведения о целевых предложениях и способах их создания на информационной панели см. в разделе [Использование целевых предложений для повышения вовлеченности и количества конверсий](../publish/use-targeted-offers-to-maximize-engagement-and-conversions.md).

API целевых предложений представляет собой простой API REST, который можно использовать для получения целевых предложений, которые доступны для текущего пользователя, в зависимости от того, является ли пользователь частью клиентского сегмента для целевого предложения. Для использования этого API в коде приложения выполните следующие действия:

1.  [Получите маркер учетной записи Майкрософт](#obtain-a-microsoft-account-token) для текущего пользователя приложения, который вошел в систему.
2.  [Получите целевые предложения для текущего пользователя](#get-targeted-offers).
3.  Реализация возможности покупки из приложения для надстройки, связанной с использованием одного из целевых предложений. Дополнительные сведения о реализации покупок из приложений см. в [этой статье](enable-in-app-purchases-of-apps-and-add-ons.md).

Полный пример кода, демонстрирующий все эти действия, см. в [примере кода](#code-example) в конце данной статьи. Все эти действия более подробно описаны в следующих разделах.

<span id="obtain-a-microsoft-account-token" />

## <a name="get-a-microsoft-account-token-for-the-current-user"></a>Получите маркер учетной записи Майкрософт для текущего пользователя

В коде приложения получите маркер учетной записи Майкрософт (MSA) для текущего пользователя, вошедшего в систему. Необходимо передать этот маркер в заголовок запроса ```Authorization``` для API целевых предложений Microsoft Store. Этот маркер используется в Store для получения целевых предложений, которые доступны для текущего пользователя.

Чтобы получить маркер MSA, используйте класс [WebAuthenticationCoreManager](https://docs.microsoft.com/uwp/api/windows.security.authentication.web.core.webauthenticationcoremanager) для запроса маркера с помощью области ```devcenter_implicit.basic,wl.basic```. В приведенном ниже примере показано, как это сделать. В этом примере приведен фрагмент из [полного примера](#code-example), и он требует **использования** инструкций, которые содержатся в полном примере.

[!code-cs[TargetedOffers](./code/StoreServicesExamples_TargetedOffers/cs/TargetedOffers.cs#GetMSAToken)]

Дополнительные сведения о получении маркеров MSA см. в разделе [Диспетчер учетных записей в Интернете](../security/web-account-manager.md).

<span id="get-targeted-offers" />

## <a name="get-the-targeted-offers-for-the-current-user"></a>Получение целевых предложений для текущего пользователя

После получения маркера MSA для текущего пользователя вызовите метод GET URI ```https://manage.devcenter.microsoft.com/v2.0/my/storeoffers/user``` для получения целевых предложений, доступных для текущего пользователя. Дополнительные сведения об этом методе REST см. в разделе [Получение целевых предложений](get-targeted-offers.md).

Этот метод возвращает ИД продуктов для надстроек, связанных с целевыми предложениями, доступными для текущего пользователя. С помощью этих сведений вы можете показать пользователю одно или несколько целевых предложений как покупку из приложения.

В примере ниже показано, как получить целевые предложения для текущего пользователя. Этот пример представляет собой фрагмент [полного примера](#code-example). Он требует библиотеку [Json.NET](http://www.newtonsoft.com/json) от Newtonsoft, а также дополнительные классы и инструкции **using**, которые содержатся в полном примере.

[!code-cs[TargetedOffers](./code/StoreServicesExamples_TargetedOffers/cs/TargetedOffers.cs#GetTargetedOffers)]

<span id="code-example" />

## <a name="complete-code-example"></a>Полный пример кода

В следующем примере кода показаны следующие задачи:

* Получение маркера MSA для текущего пользователя.
* Получение всех целевых предложений для текущего пользователя с помощью метода [Получение целевого предложения](get-targeted-offers.md).
* Приобретите надстройку, которая связана с целевым предложением.

Для этого примера требуется библиотека [Json.NET](http://www.newtonsoft.com/json) от Newtonsoft. В примере эта библиотека используется для сериализации и десериализации данных формата JSON.

[!code-cs[TargetedOffers](./code/StoreServicesExamples_TargetedOffers/cs/TargetedOffers.cs#GetTargetedOffersSample)]

## <a name="related-topics"></a>Статьи по теме

* [Используйте целевые предложения, чтобы повысить вовлеченность и количество конверсий](../publish/use-targeted-offers-to-maximize-engagement-and-conversions.md)
* [Получение целевых предложений](get-targeted-offers.md)
