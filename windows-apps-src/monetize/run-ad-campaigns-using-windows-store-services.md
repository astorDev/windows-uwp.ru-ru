---
ms.assetid: 8e6c3d3d-0120-40f4-9f90-0b0518188a1a
description: Используйте API Microsoft Storeных рекламных акций, чтобы программно управлять рекламными кампаниями рекламных акций для приложений, зарегистрированных в учетной записи центра партнеров или вашей организации.
title: Проведение рекламных кампаний с помощью служб Магазина
ms.date: 06/04/2018
ms.topic: article
keywords: Windows 10, UWP, API рекламных акций Microsoft Store, рекламные кампании
ms.localizationpriority: medium
ms.openlocfilehash: 54a9fcf524231f641ca92cb037bb6dcd01b8502f
ms.sourcegitcommit: b52ddecccb9e68dbb71695af3078005a2eb78af1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2019
ms.locfileid: "74260190"
---
# <a name="run-ad-campaigns-using-store-services"></a>Проведение рекламных кампаний с помощью служб Магазина

Используйте *API Microsoft Storeных рекламных акций* , чтобы программно управлять рекламными кампаниями рекламных акций для приложений, зарегистрированных в учетной записи центра партнеров или вашей организации. С помощью этого API можно создавать, обновлять и отслеживать ваши кампании и связанные с ними ресурсы, такие как таргетинг и оформление рекламы. Этот API особенно полезен для разработчиков, создающих большие объемы кампаний и желающих сделать это без использования центра партнеров. Для проверки подлинности вызовов из приложения или службы в этом интерфейсе используется служба Azure Active Directory (Azure AD).

Далее описан весь процесс.

1.  Убедитесь, что вы выполнили все [необходимые условия](#prerequisites).
2.  Перед вызовом метода API промоакций Microsoft Store, [получите маркер доступа Azure AD](#obtain-an-azure-ad-access-token). После получения маркера доступа у вас будет 60 минут, чтобы использовать его в вызовах к API промоакций Microsoft Store до окончания срока действия маркера. После истечения срока действия маркера можно сформировать новый маркер.
3.  [Вызовите API промоакций Microsoft Store](#call-the-windows-store-promotions-api).

Вы также можете создавать кампании AD и управлять ими с помощью центра партнеров, а любые кампании, создаваемые программно с помощью API Microsoft Storeных рекламных акций, могут быть доступны в центре партнеров. Дополнительные сведения об управлении кампаниями AD в центре партнеров см. в статье [Создание рекламной кампании для приложения](../publish/create-an-ad-campaign-for-your-app.md).

> [!NOTE]
> Любой разработчик с учетной записью центра партнеров может использовать API Microsoft Storeных рекламных акций для управления обработкой рекламных кампаний в своих приложениях. Рекламные агентства также могут запросить доступ к данному API-интерфейса для проведения кампаний от лица своих клиентов. Если вы являетесь представителем рекламного агентства, который хочет получить больше информации о данном API-интерфейсе или запросить доступ к нему, то отправьте запрос на storepromotionsapi@microsoft.com.

<span id="prerequisites" />

## <a name="step-1-complete-prerequisites-for-using-the-microsoft-store-promotions-api"></a>Шаг 1. Выполнение необходимых условий для использования API промоакций Microsoft Store

Перед тем как начать писать код для вызова API промоакций Microsoft Store, убедитесь, что выполнены следующие необходимые условия.

* Перед тем как вы сможете успешно создать и запустить кампанию AD с помощью этого API, необходимо сначала [создать одну платную кампанию AD, используя страницу " **кампании AD** " в центре партнеров](../publish/create-an-ad-campaign-for-your-app.md), и на этой странице необходимо добавить хотя бы один платежный инструмент. После выполнения этих действий можно создавать платные строки поставки для рекламных кампаний с помощью этого API. Строки доставки для кампаний AD, создаваемых с помощью этого API, автоматически выставляют платежное средство по умолчанию, выбранное на странице " **кампании по рекламе** " в центре партнеров.

* У вас (или у вашей организации) должен быть каталог Azure AD, а также разрешение [глобального администратора](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles) для этого каталога. Если вы уже используете Office 365 или другие бизнес-службы Майкрософт, то у вас уже есть Azure Active Directory. В противном случае вы можете [создать новую службу Azure AD в центре партнеров](../publish/associate-azure-ad-with-partner-center.md#create-a-brand-new-azure-ad-to-associate-with-your-partner-center-account) без дополнительной платы.

* Необходимо связать приложение Azure AD с учетной записью центра партнеров, получить идентификатор клиента и идентификатор клиента для приложения и создать ключ. Приложение Azure AD представляет собой приложение или службу, из которой отправляются вызовы к API промоакций Microsoft Store. Чтобы получить маркер доступа Azure AD, который вы передадите в API, необходимо иметь в наличии идентификатор владельца, идентификатор клиента и ключ.
    > [!NOTE]
    > Эту операцию необходимо выполнить только один раз. После того как вы получите идентификатор владельца, идентификатор клиента и ключ, их можно будет использовать повторно в любое время для создания нового маркера доступа Azure AD.

Чтобы связать приложение Azure AD с учетной записью центра партнеров и получить необходимые значения:

1.  В центре партнеров [свяжите учетную запись центра партнеров Организации с каталогом Azure AD вашей организации](../publish/associate-azure-ad-with-partner-center.md).

2.  Затем на странице **Пользователи** в разделе " **Параметры учетной записи** " центра партнеров [добавьте приложение Azure AD](../publish/add-users-groups-and-azure-ad-applications.md#add-azure-ad-applications-to-your-partner-center-account) , которое представляет приложение или службу, которые будут использоваться для управления кампаниями по маркетингу для учетной записи центра партнеров. Обязательно назначьте этому приложению роль **Менеджер**. Если приложение еще не существует в каталоге Azure AD, вы можете [создать новое приложение Azure AD в центре партнеров](../publish/add-users-groups-and-azure-ad-applications.md#create-a-new-azure-ad-application-account-in-your-organizations-directory-and-add-it-to-your-partner-center-account). 

3.  Вернитесь на страницу **Пользователи**, щелкните имя приложения Azure AD, чтобы перейти к параметрам приложения, и скопируйте значения **идентификатора владельца** и **идентификатора клиента**.

4. Нажмите кнопку **Добавить новый ключ**. На следующем экране скопируйте **ключ**. Вы не сможете получить доступ к этой информации после закрытия страницы. Дополнительные сведения см. в разделе [Управление ключами для приложения Azure AD](../publish/add-users-groups-and-azure-ad-applications.md#manage-keys).

<span id="obtain-an-azure-ad-access-token" />

## <a name="step-2-obtain-an-azure-ad-access-token"></a>Шаг 2. Получение маркера доступа Azure AD

Перед тем как можно будет вызвать любой из методов в API промоакций Microsoft Store, сначала необходимо получить маркер доступа Azure AD и передать его в заголовок **Авторизация** каждого метода в API. После получения маркера доступа у вас будет 60 минут, чтобы использовать его до окончания срока действия маркера. После истечения срока действия маркера вы можете обновить его, чтобы дальше использовать в последующих вызовах к API.

Для получения маркера доступа следуйте инструкциям в разделе [Вызовы между службами с помощью учетных данных клиентов](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-service-to-service/), чтобы отправить HTTP-запрос POST в конечную точку ```https://login.microsoftonline.com/<tenant_id>/oauth2/token```. Ниже приведен пример запроса.

```syntax
POST https://login.microsoftonline.com/<tenant_id>/oauth2/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded; charset=utf-8

grant_type=client_credentials
&client_id=<your_client_id>
&client_secret=<your_client_secret>
&resource=https://manage.devcenter.microsoft.com
```

Для значения *идентификатора\_клиента* в URI POST и параметров *Client\_id* и *Client\_Secret* укажите идентификатор клиента, идентификатор клиента и ключ для приложения, полученные из центра партнеров в предыдущем разделе. Для параметра *resource* укажите ```https://manage.devcenter.microsoft.com```.

После истечения срока действия маркера доступа вы можете обновить его, следуя инструкциям, приведенным [здесь](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-code/#refreshing-the-access-tokens).

<span id="call-the-windows-store-promotions-api" />

## <a name="step-3-call-the-microsoft-store-promotions-api"></a>Шаг 3. Вызов интерфейса API промоакций Microsoft Store

После получения маркера доступа Azure AD вы можете вызвать API-интерфейс промоакций Microsoft Store. Необходимо передать токен доступа в заголовок **Authorization** каждого метода.

В контексте API промоакций Microsoft Store рекламная кампания состоит из объекта *кампания*, который содержит общие сведения о кампании, и дополнительных объектов, представляющих *каналы доставки*, *целевые профили* и *элементы* рекламной кампании. API-интерфейс содержит различные методы, которые сгруппированы по типам объектов. Чтобы создать кампанию, обычно следует вызвать отдельный POST-метод для каждого из этих объектов. API также предоставляет GET-методы , используемые для получения любого объекта, и методы PUT, которые применяются для изменения объектов кампании, каналов доставки и целевых профилей.

Дополнительные сведения об этих объектах и связанных с ними методах см. в следующей таблице.


| Объект       | Описание   |
|---------------|-----------------|
| Кампании |  Этот объект представляет рекламную кампанию, и он размещается в верхней части иерархии объектов модели для рекламных кампаний. Этот объект определяет тип проводимой кампании (платная, локальная или для сообщества), цель кампании, каналы доставки и другие сведения. Каждая кампания может быть связана только с одним приложением.<br/><br/>Дополнительные сведения о методах, связанных с данным объектом, см. в разделе [Управление рекламными кампаниями](manage-ad-campaigns.md).<br/><br/>**Примечание**&nbsp;&nbsp;После создания рекламной кампании, вы можете получать данные о ее результативности с помощью метода [Получить данные о результативности кампании](get-ad-campaign-performance-data.md) в [API аналитики для Microsoft Store](access-analytics-data-using-windows-store-services.md).  |
| Каналы доставки | Каждая кампания имеет один или несколько каналов доставки, которые применяются для покупки инвентаря и доставки вашей рекламы. Для каждого канала доставки можно задать целевую аудиторию, цену заявки, установить бюджет на допустимые траты и связать канал с нужными элементами рекламы.<br/><br/>Дополнительные сведения о методах, связанных с этим объектом, см. в разделе [управление каналами доставки для рекламных кампаний](manage-delivery-lines-for-ad-campaigns.md). |
| Целевые профили | Каждый канал доставки имеет один целевой профиль, в котором описываются пользователи, регионы и типы инвентаря, которые вас интересуют. Целевые профили могут создаваться как шаблоны и совместно применяться в разных каналах доставки.<br/><br/>Дополнительные сведения о методах, связанных с этим объектом, см. в разделе [Управление целевыми профилями для рекламных кампаний](manage-targeting-profiles-for-ad-campaigns.md). |
| Рекламные элементы | Каждый канал доставки имеет один или несколько рекламных элементов — это объявления, которые отображаются пользователям в рамках кампании. Рекламный элемент может быть связан с одним или несколькими каналами доставки (даже в разных рекламных кампаниях) при условии, что элемент всегда представляет одно и тоже приложение.<br/><br/>Дополнительные сведения о методах, связанных с этим объектом, см. в разделе [управление рекламными элементами для кампаний](manage-creatives-for-ad-campaigns.md). |


На следующей схеме показана связь между кампаниями, каналами доставки, целевыми профилями и рекламными элементами.

![Иерархия рекламной кампании](images/ad-campaign-hierarchy.png)

## <a name="code-example"></a>Пример кода

В следующем примере кода показано, как получить маркер доступа Azure AD и вызвать API промоакций Microsoft Store из консольного приложения C#. Чтобы использовать этот пример кода, назначьте переменным *tenantId*, *clientId*, *clientSecret* и *appID* соответствующие вашему сценарию значения. Для этого примера требуется [пакет Json.NET](https://www.newtonsoft.com/json) от Newtonsoft для десериализации JSON-данных, возвращаемых API промоакций Microsoft Store.

[!code-csharp[PromotionsApi](./code/StoreServicesExamples_Promotions/cs/Program.cs#PromotionsApiExample)]

## <a name="related-topics"></a>Статьи по теме

* [Управление кампаниями AD](manage-ad-campaigns.md)
* [Управление линиями доставки для кампаний AD](manage-delivery-lines-for-ad-campaigns.md)
* [Управление профилями нацеливания для кампаний AD](manage-targeting-profiles-for-ad-campaigns.md)
* [Управляйте творческими решениями для кампаний AD](manage-creatives-for-ad-campaigns.md)
* [Получение данных о производительности кампании ad](get-ad-campaign-performance-data.md)


 
