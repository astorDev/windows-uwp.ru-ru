---
author: mcleanbyron
ms.assetid: 8e6c3d3d-0120-40f4-9f90-0b0518188a1a
description: Используйте API промоакций Microsoft Store, чтобы управлять рекламными кампаниями для приложений, зарегистрированных на вашу учетную запись (или учетную запись вашей организации) Центра разработки для Windows, программным образом.
title: Проведение рекламных кампаний с помощью служб Магазина
ms.author: mcleans
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows 10, UWP, API рекламных акций Microsoft Store, рекламные кампании
ms.localizationpriority: medium
ms.openlocfilehash: dd90b970a126495d7a1035256f4bdd219aee9ee5
ms.sourcegitcommit: 0ab8f6fac53a6811f977ddc24de039c46c9db0ad
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2018
ms.locfileid: "1655286"
---
# <a name="run-ad-campaigns-using-store-services"></a>Проведение рекламных кампаний с помощью служб Магазина

Используйте *API промоакций Microsoft Store*, чтобы управлять рекламными кампаниями для приложений, зарегистрированных на вашу учетную запись (или учетную запись вашей организации) Центра разработки для Windows, программным образом. С помощью данного API-интерфейса можно создавать, обновлять, отслеживать рекламные кампании и сопутствующие материалы, такие как сведения о целевой аудитории и рекламные элементы. Этот API-интерфейс особенно полезен тем разработчикам, которые создают большое количество рекламных кампаний и не желают использовать для этого информационную панель Центра разработки для Windows. Для проверки подлинности вызовов из приложения или службы в этом интерфейсе используется служба Azure Active Directory (Azure AD).

Далее описан весь процесс.

1.  Убедитесь, что вы выполнили все [необходимые условия](#prerequisites).
2.  Перед вызовом метода API промоакций Microsoft Store, [получите маркер доступа Azure AD](#obtain-an-azure-ad-access-token). После получения маркера доступа у вас будет 60минут, чтобы использовать его в вызовах к API промоакций Microsoft Store до окончания срока действия маркера. После истечения срока действия маркера можно сформировать новый маркер.
3.  [Вызовите API промоакций Microsoft Store](#call-the-windows-store-promotions-api).

Кроме того вы можете создавать рекламные кампании и работать с ними в информационной панели Центра разработки для Windows. Все рекламные кампании, созданные программно через API промоакций Microsoft Store, также будут доступны в этой информационной панели. Дополнительные сведения по работе с рекламными кампаниями в информационной панели, см. в разделе [Создание рекламной кампании для приложения](../publish/create-an-ad-campaign-for-your-app.md).

> [!NOTE]
> Любой разработчик с учетной записью Центра разработки для Windows может применять API промоакций Microsoft Store для управления рекламными кампаниями своих приложений. Рекламные агентства также могут запросить доступ к данному API-интерфейса для проведения кампаний от лица своих клиентов. Если вы являетесь представителем рекламного агентства, который хочет получить больше информации о данном API-интерфейсе или запросить доступ к нему, то отправьте запрос на storepromotionsapi@microsoft.com.

<span id="prerequisites" />

## <a name="step-1-complete-prerequisites-for-using-the-microsoft-store-promotions-api"></a>Шаг 1. Выполнение необходимых условий для использования API промоакций Microsoft Store

Перед тем как начать писать код для вызова API промоакций Microsoft Store, убедитесь, что выполнены следующие необходимые условия.

* Перед тем как создать и запустить рекламную кампанию с помощью этого API, необходимо сначала [создать одну платную рекламную кампанию на странице **Продвижение вашего приложения** информационной панели Центра разработки](../publish/create-an-ad-campaign-for-your-app.md) и добавить там же по крайней мере одно платежное средство. После выполнения этих действий можно создавать платные строки поставки для рекламных кампаний с помощью этого API. Строки поставки для рекламных кампаний, созданных с использованием этого API, будут автоматически выставлять счет на оплату платежному средству по умолчанию, выбранному на странице **Продвижение вашего приложения** на информационной панели.

* У вас (или у вашей организации) должен быть каталог Azure AD, а также разрешение [глобального администратора](http://go.microsoft.com/fwlink/?LinkId=746654) для этого каталога. Если вы уже используете Office 365 или другие бизнес-службы Майкрософт, то у вас уже есть Azure Active Directory. В противном случае можно [создать новый каталог Azure AD в Центре разработки](../publish/associate-azure-ad-with-dev-center.md#create-a-brand-new-azure-ad-to-associate-with-your-dev-center-account) без дополнительной платы.

* Вам необходимо привязать приложение Azure AD к учетной записи Центра разработки, получить идентификатор клиента для приложения и идентификатор клиента и создать ключ. Приложение Azure AD представляет собой приложение или службу, из которой отправляются вызовы к API промоакций Microsoft Store. Чтобы получить маркер доступа Azure AD, который вы передадите в API, необходимо иметь в наличии идентификатор владельца, идентификатор клиента и ключ.
    > [!NOTE]
    > Эту операцию необходимо выполнить только один раз. После того как вы получите идентификатор владельца, идентификатор клиента и ключ, их можно будет использовать повторно в любое время для создания нового маркера доступа Azure AD.

Чтобы привязать приложение Azure AD к учетной записи Центра разработки и получить необходимые значения, выполните следующие действия.

1.  В Центре разработки перейдите в раздел **Параметры учетной записи**, щелкните **Управление пользователями** и [привяжите учетную запись своей организации в Центре разработки к каталогу Azure AD вашей организации](../publish/associate-azure-ad-with-dev-center.md).

2.  На странице **Управление пользователями** нажмите кнопку **Добавить приложения Azure AD**, добавьте приложение Azure AD, представляющее собой приложение или службу, которые вы будете использовать для управления рекламными кампаниями вашей учетной записи Центра разработки, и назначьте ему роль **Менеджер**. Если приложение уже есть в каталоге Azure AD, вы можете выбрать его на странице **Добавление приложений Azure AD**, чтобы добавить его к учетной записи Центра разработки. Также можно создать приложение Azure AD на странице **Добавление приложений Azure AD**. Дополнительные сведения см. в разделе [Добавление приложений Azure AD к учетной записи в Центре разработки](../publish/add-users-groups-and-azure-ad-applications.md#azure-ad-applications).

3.  Вернитесь на страницу **Управление пользователями**, щелкните имя приложения Azure AD, чтобы перейти к параметрам приложения и скопируйте **идентификатора владельца** и **идентификатор клиента**.

4. Нажмите кнопку **Добавить новый ключ**. На следующем экране скопируйте **ключ**. Вы не сможете получить доступ к этой информации после закрытия страницы. Дополнительные сведения см. в разделе [Управление ключами для приложения Azure AD](../publish/add-users-groups-and-azure-ad-applications.md#manage-keys).

<span id="obtain-an-azure-ad-access-token" />

## <a name="step-2-obtain-an-azure-ad-access-token"></a>Шаг 2. Получение маркера доступа Azure AD

Перед тем как можно будет вызвать любой из методов в API промоакций Microsoft Store, сначала необходимо получить маркер доступа Azure AD и передать его в заголовок **Авторизация** каждого метода в API. После получения маркера доступа у вас будет 60 минут, чтобы использовать его до окончания срока действия маркера. После истечения срока действия маркера вы можете обновить его, чтобы дальше использовать в последующих вызовах к API.

Для получения маркера доступа следуйте инструкциям в разделе [Вызовы между службами с помощью учетных данных клиентов](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-service-to-service/), чтобы отправить HTTP-запрос POST в конечную точку ```https://login.microsoftonline.com/<tenant_id>/oauth2/token```. Ниже приведен пример запроса.

```syntax
POST https://login.microsoftonline.com/<tenant_id>/oauth2/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded; charset=utf-8

grant_type=client_credentials
&client_id=<your_client_id>
&client_secret=<your_client_secret>
&resource=https://manage.devcenter.microsoft.com
```

Для значения *tenant\_id* в POST URI и параметров *client\_id* и *client\_secret* укажите идентификатор владельца, идентификатор клиента и ключ вашего приложения, который был получен в Центре разработки, как описано в предыдущем разделе. Для параметра *resource* укажите ```https://manage.devcenter.microsoft.com```.

После истечения срока действия маркера доступа вы можете обновить его, следуя инструкциям, приведенным [здесь](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-code/#refreshing-the-access-tokens).

<span id="call-the-windows-store-promotions-api" />

## <a name="step-3-call-the-microsoft-store-promotions-api"></a>Шаг 3. Вызов интерфейса API промоакций Microsoft Store

После получения маркера доступа Azure AD вы можете вызвать API-интерфейс промоакций Microsoft Store. Необходимо передать маркер доступа в заголовок **Authorization** каждого метода.

В контексте API промоакций Microsoft Store рекламная кампания состоит из объекта *кампания*, который содержит общие сведения о кампании, и дополнительных объектов, представляющих *каналы доставки*, *целевые профили* и *элементы* рекламной кампании. API-интерфейс содержит различные методы, которые сгруппированы по типам объектов. Чтобы создать кампанию, обычно следует вызвать отдельный POST-метод для каждого из этих объектов. API также предоставляет GET-методы , используемые для получения любого объекта, и методы PUT, которые применяются для изменения объектов кампании, каналов доставки и целевых профилей.

Дополнительные сведения об этих объектах и связанных с ними методах см. в следующей таблице.


| Объект       | Описание   |
|---------------|-----------------|
| Кампании |  Этот объект представляет рекламную кампанию, и он размещается в верхней части иерархии объектов модели для рекламных кампаний. Этот объект определяет тип проводимой кампании (платная, локальная или для сообщества), цель кампании, каналы доставки и другие сведения. Каждая кампания может быть связана только с одним приложением.<br/><br/>Дополнительные сведения о методах, связанных с данным объектом, см. в разделе [Управление рекламными кампаниями](manage-ad-campaigns.md).<br/><br/>**Примечание**&nbsp;&nbsp;После создания рекламной кампании, вы можете получать данные о ее результативности с помощью метода [Получить данные о результативности кампании](get-ad-campaign-performance-data.md) в [API аналитики для Microsoft Store](access-analytics-data-using-windows-store-services.md).  |
| Каналы доставки | Каждая кампания имеет один или несколько каналов доставки, которые применяются для покупки инвентаря и доставки вашей рекламы. Для каждого канала доставки можно задать целевую аудиторию, цену заявки, установить бюджет на допустимые траты и связать канал с нужными элементами рекламы.<br/><br/>Дополнительные сведения о методах, связанных с этим объектом, см. в разделе [управление каналами доставки для рекламных кампаний](manage-delivery-lines-for-ad-campaigns.md). |
| Целевые профили | Каждый канал доставки имеет один целевой профиль, в котором описываются пользователи, регионы и типы инвентаря, которые вас интересуют. Целевые профили могут создаваться как шаблоны и совместно применяться в разных каналах доставки.<br/><br/>Дополнительные сведения о методах, связанных с этим объектом, см. в разделе [Управление целевыми профилями для рекламных кампаний](manage-targeting-profiles-for-ad-campaigns.md).. |
| Рекламные элементы | Каждый канал доставки имеет один или несколько рекламных элементов — это объявления, которые отображаются пользователям в рамках кампании. Рекламный элемент может быть связан с одним или несколькими каналами доставки (даже в разных рекламных кампаниях) при условии, что элемент всегда представляет одно и тоже приложение.<br/><br/>Дополнительные сведения о методах, связанных с этим объектом, см. в разделе [управление рекламными элементами для кампаний](manage-creatives-for-ad-campaigns.md). |


На следующей схеме показана связь между кампаниями, каналами доставки, целевыми профилями и рекламными элементами.

![Иерархия рекламной кампании](images/ad-campaign-hierarchy.png)

## <a name="code-example"></a>Пример кода

В следующем примере кода показано, как получить маркер доступа Azure AD и вызвать API промоакций Microsoft Store из консольного приложения C#. Чтобы использовать этот пример кода, назначьте переменным *tenantId*, *clientId*, *clientSecret* и *appID* соответствующие вашему сценарию значения. Для этого примера требуется [пакет Json.NET](http://www.newtonsoft.com/json) от Newtonsoft для десериализации JSON-данных, возвращаемых API промоакций Microsoft Store.

[!code-cs[PromotionsApi](./code/StoreServicesExamples_Promotions/cs/Program.cs#PromotionsApiExample)]

## <a name="related-topics"></a>Статьи по теме

* [Управление рекламными кампаниями](manage-ad-campaigns.md)
* [Управление каналами доставки для рекламных кампаний](manage-delivery-lines-for-ad-campaigns.md)
* [Управление целевыми профилями для рекламных кампаний](manage-targeting-profiles-for-ad-campaigns.md)
* [Управление рекламными элементами для кампаний](manage-creatives-for-ad-campaigns.md)
* [Получение данных об эффективности рекламной кампании](get-ad-campaign-performance-data.md)


 
