---
author: Xansky
ms.assetid: 7CC11888-8DC6-4FEE-ACED-9FA476B2125E
description: Используйте API отправки Microsoft Store, чтобы программным образом создавать и администрировать отправки для приложений, которые зарегистрированы в вашей учетной записи Центра разработки для Windows.
title: Создание отправок и управление ими
ms.author: mhopkins
ms.date: 06/04/2018
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows 10, UWP, API отправки Microsoft Store
ms.localizationpriority: medium
ms.openlocfilehash: a6ba5678fc7b66e15d0e189cd75792f97c2353db
ms.sourcegitcommit: e16c9845b52d5bd43fc02bbe92296a9682d96926
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2018
ms.locfileid: "4950206"
---
# <a name="create-and-manage-submissions"></a>Создание отправок и управление ими


Используйте *API отправки Microsoft Store*, чтобы программировать запросы и создавать отправки для приложений, надстроек и тестовых пакетов для вашей учетной записи Центра разработки для Windows или учетной записи Центра разработки для Windows вашей организации. Этот API-интерфейс удобно использовать, если под вашей учетной записью выполняется управление большим количеством приложений или надстроек и вам необходимо оптимизировать процесс отправки для этих ресурсов. Для проверки подлинности вызовов из приложения или службы в этом интерфейсе используется служба Azure Active Directory (Azure AD).

Ниже приведен список всех действий, которые необходимо выполнить, чтобы начать работу с API отправки Microsoft Store.

1.  Убедитесь, что вы выполнили все [необходимые условия](#prerequisites).
3.  Перед вызовом метода в API отправки Microsoft Store [получите маркер доступа Azure AD](#obtain-an-azure-ad-access-token). После получения маркера доступа у вас будет 60минут, чтобы использовать его в вызовах к API отправки Microsoft Store до окончания срока действия маркера. После истечения срока действия маркера можно сформировать новый маркер.
4.  [Вызовите API отправки Microsoft Store](#call-the-windows-store-submission-api).

<span id="not_supported" />

> [!IMPORTANT]
> Если вы используете этот API для создания отправки для приложения, тестового пакета или надстройки, обязательно вносите изменения в эту отправку в дальнейшем только с помощью этого API, а не информационной панели Центра разработки. Если вы используете информационную панель для изменения отправки, изначально созданной с помощью API, вы более не сможете изменять или фиксировать эту отправку с помощью этого API. В некоторых случаях отправка может оставаться в состоянии ошибки, когда продолжить процесс отправки невозможно. В этом случае необходимо удалить отправку и создать новую.

> [!IMPORTANT]
> Этот API нельзя использовать для публикации отправок для [покупок в больших объемах через Microsoft Store для бизнеса и Microsoft Store для образования](../publish/organizational-licensing.md) и для публикации отправок [бизнес-приложений](../publish/distribute-lob-apps-to-enterprises.md) непосредственно для предприятий. В обоих этих сценариях необходимо использовать информационную панель Центра разработки для Windows для публикации отправки.

> [!NOTE]
> Этот API не может использоваться с приложениями или надстройками, использующими обязательные обновления приложений и управляемые Store потребляемые надстройки. Если вы используете API отправки Microsoft Store с приложением или надстройкой, в которой есть одна из этих функций, API вернет код ошибки 409. В этом случае для управления отправками для приложения или надстройки необходимо будет использовать панель мониторинга.

<span id="prerequisites" />

## <a name="step-1-complete-prerequisites-for-using-the-microsoft-store-submission-api"></a>Шаг 1. Выполнение необходимых условий для использования API отправки в Microsoft Store

Перед тем как начать писать код для вызова API отправки в Microsoft Store, убедитесь, что вы выполнили следующие необходимые условия.

* У вас (или у вашей организации) должен быть каталог Azure AD, а также разрешение [глобального администратора](http://go.microsoft.com/fwlink/?LinkId=746654) для этого каталога. Если вы уже используете Office 365 или другие бизнес-службы Майкрософт, то у вас уже есть Azure Active Directory. В противном случае можно [создать новый каталог Azure AD в Центре разработки](../publish/associate-azure-ad-with-dev-center.md#create-a-brand-new-azure-ad-to-associate-with-your-dev-center-account) без дополнительной платы.

* Вы должны [привязать приложение Azure AD к своей учетной записи Центра разработки для Windows](#associate-an-azure-ad-application-with-your-windows-dev-center-account) и получить идентификатор владельца, идентификатор клиента и ключ. Эти данные вам понадобятся для получения маркера доступа Azure AD, который будет использоваться в вызовах к API отправки в Microsoft Store.

* Подготовка приложения для использования с API отправки в Microsoft Store.

  * Если ваше приложение еще отсутствует в Центре разработки, [создайте приложение на информационной панели Центра разработки](https://msdn.microsoft.com/windows/uwp/publish/create-your-app-by-reserving-a-name). API отправки в Microsoft Store нельзя использовать для создания приложения в Центре разработки; необходимо создать приложение с помощью панели мониторинга, а затем использовать API для доступа к приложению и программного создания отправки для него. Однако API можно использовать для программного создания надстроек и тестовых пакетов, прежде чем вы начнете создавать для них отправки.

  * Перед тем как можно будет создать отправку для конкретного приложения с помощью этого API, сначала необходимо [создать одну отправку для приложения на панели мониторинга Центра разработки](https://msdn.microsoft.com/windows/uwp/publish/app-submissions) и указать сведения для [возрастной категории](https://msdn.microsoft.com/windows/uwp/publish/age-ratings). После этого можно будет программным образом создавать новые отправки для этого приложения с помощью API. Необходимость в создании отправки надстройки или отправки тестового пакета перед началом использования API для этих типов отправок отсутствует.

  * Если при создании или обновлении отправки приложения требуется добавить пакет приложения, [подготовьте пакет приложения](https://msdn.microsoft.com/windows/uwp/publish/app-package-requirements).

  * Если при создании или обновлении отправки приложения требуется добавить снимки экрана или изображения для описания в Магазине, [подготовьте снимки экрана и изображения приложения](https://msdn.microsoft.com/windows/uwp/publish/app-screenshots-and-images).

  * Если при создании или обновлении отправки надстройки требуется добавить значок, [подготовьте значок](https://msdn.microsoft.com/windows/uwp/publish/create-iap-descriptions#icon).

<span id="associate-an-azure-ad-application-with-your-windows-dev-center-account" />

### <a name="how-to-associate-an-azure-ad-application-with-your-windows-dev-center-account"></a>Привязка приложения Azure AD к учетной записи в Центре разработки для Windows

Прежде чем можно будет использовать API отправки в Microsoft Store, необходимо привязать приложение Azure AD к учетной записи Центра разработки, получить идентификатор владельца и идентификатор клиента для приложения, а также сформировать ключ. Приложение Azure AD представляет собой приложение или службу, из которой отправляются вызовы к API отправки в Microsoft Store. Чтобы получить маркер доступа Azure AD, который вы передадите в API, необходимо иметь в наличии идентификатор арендатора, ключ и идентификатор клиента.

> [!NOTE]
> Эту операцию необходимо выполнить только один раз. После того как вы получите идентификатор владельца, идентификатор клиента и ключ, их можно будет использовать повторно в любое время для создания нового маркера доступа Azure AD.

1.  В Центре разработки [привяжите учетную запись своей организации к каталогу Azure AD организации](../publish/associate-azure-ad-with-dev-center.md).

2.  Затем на странице **Пользователи** в разделе **Параметры учетной записи** Центра разработки [добавьте приложение Azure AD](../publish/add-users-groups-and-azure-ad-applications.md#add-azure-ad-applications-to-your-dev-center-account), представляющее собой приложение или службу, которые вы будете использовать для доступа к отправкам вашей учетной записи Центра разработки. Обязательно назначьте этому приложению роль **Менеджер**. Если приложение еще не существует в каталоге Azure AD, вы можете [создать новое приложение Azure AD в Центре разработки](../publish/add-users-groups-and-azure-ad-applications.md#create-a-new-azure-ad-application-account-in-your-organizations-directory-and-add-it-to-your-dev-center-account).  

3.  Вернитесь на страницу **Пользователи**, щелкните имя приложения Azure AD, чтобы перейти к параметрам приложения, и скопируйте значения **идентификатора владельца** и **идентификатора клиента**.

4. Нажмите кнопку **Добавить новый ключ**. На следующем экране скопируйте **ключ**. Вы не сможете получить доступ к этой информации после закрытия страницы. Дополнительные сведения см. в разделе [Управление ключами для приложения Azure AD](../publish/add-users-groups-and-azure-ad-applications.md#manage-keys).

<span id="obtain-an-azure-ad-access-token" />

## <a name="step-2-obtain-an-azure-ad-access-token"></a>Шаг 2. Получение маркера доступа Azure AD

Перед тем как можно будет вызвать любой из методов в API отправки в Microsoft Store, сначала необходимо получить маркер доступа Azure AD и передать его в заголовок **Авторизация** каждого метода в API. После получения маркера доступа у вас будет 60 минут, чтобы использовать его до окончания срока действия маркера. После истечения срока действия маркера вы можете обновить его, чтобы дальше использовать в последующих вызовах к API.

Для получения маркера доступа следуйте инструкциям в разделе [Вызовы между службами с помощью учетных данных клиентов](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-service-to-service/), чтобы отправить HTTP-запрос POST в конечную точку ```https://login.microsoftonline.com/<tenant_id>/oauth2/token```. Ниже приведен пример запроса.

```
POST https://login.microsoftonline.com/<tenant_id>/oauth2/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded; charset=utf-8

grant_type=client_credentials
&client_id=<your_client_id>
&client_secret=<your_client_secret>
&resource=https://manage.devcenter.microsoft.com
```

Для значения *tenant\_id* в POST URI и параметров *client\_id* и *client\_secret* укажите идентификатор владельца, идентификатор клиента и ключ вашего приложения, который был получен в Центре разработки, как описано в предыдущем разделе. Для параметра *resource* укажите ```https://manage.devcenter.microsoft.com```.

После истечения срока действия маркера доступа вы можете обновить его, следуя инструкциям, приведенным [здесь](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-code/#refreshing-the-access-tokens).

Примеры, демонстрирующие, как получить маркер доступа с помощью кода C#, Java или Python, см. в [примерах кода](#code-examples) API для отправки в Microsoft Store.

<span id="call-the-windows-store-submission-api">

## <a name="step-3-use-the-microsoft-store-submission-api"></a>Шаг 3. Использование API отправки в Microsoft Store

После получения маркера доступа Azure AD можно будет вызывать методы в API отправки в Microsoft Store. В состав API входит большое количество методов, которые сгруппированы в сценарии для приложения, надстроек и тестовых пакетов. Чтобы создать или обновить отправки, как правило, необходимо вызвать несколько методов в API отправки в Microsoft Store в определенном порядке. Сведения о каждом сценарии и синтаксисе каждого метода см. в статьях, приведенных в следующей таблице.

> [!NOTE]
> После получения маркера доступа у вас будет 60 минут, чтобы использовать его в вызовах к API отправки в Microsoft Store до окончания срока действия маркера.

| Сценарий       | Описание                                                                 |
|---------------|----------------------------------------------------------------------|
| Приложения |  Получите данные для всех приложений, которые зарегистрированы в вашей учетной записи Центра разработки для Windows, и создавайте отправки для приложений. Дополнительные сведения об этих методах см. в следующих статьях. <ul><li>[Получение данных приложения](get-app-data.md)</li><li>[Управление отправками приложений](manage-app-submissions.md)</li></ul> |
| Надстройки | Получайте, создавайте или удаляйте надстройки для ваших приложений, а затем получайте, создавайте или удаляйте отправки для надстроек. Дополнительные сведения об этих методах см. в следующих статьях. <ul><li>[Управление надстройками](manage-add-ons.md)</li><li>[Управление отправками надстроек](manage-add-on-submissions.md)</li></ul> |
| Тестовые пакеты | Получайте, создавайте или удаляйте тестовые пакеты для ваших приложений, а затем получайте, создавайте или удаляйте отправки для тестовых пакетов. Дополнительные сведения об этих методах см. в следующих статьях. <ul><li>[Управление тестовыми пакетами](manage-flights.md)</li><li>[Управление отправками тестового пакета](manage-flight-submissions.md)</li></ul> |

<span id="code-samples"/>

## <a name="code-examples"></a>Примеры кода

Следующие статьи содержат подробные примеры кода на нескольких разных языках программирования, демонстрирующие способы использования API отправки в Microsoft Store.

* [Пример на языке C#: отправки для приложений, надстроек и тестовых пакетов](csharp-code-examples-for-the-windows-store-submission-api.md)
* [Пример на языке C#: отправка приложения с трейлерами и параметрами игры](csharp-code-examples-for-submissions-game-options-and-trailers.md)
* [Пример на языке Java: отправки для приложений, надстроек и тестовых пакетов](java-code-examples-for-the-windows-store-submission-api.md)
* [Пример на языке Java: отправка приложения с трейлерами и параметрами игры](java-code-examples-for-submissions-game-options-and-trailers.md)
* [Пример на языке Python: отправки для приложений, надстроек и тестовых пакетов](python-code-examples-for-the-windows-store-submission-api.md)
* [Пример на языке Python: отправка приложения с трейлерами и параметрами игры](python-code-examples-for-submissions-game-options-and-trailers.md)

## <a name="storebroker-powershell-module"></a>Модуль StoreBroker PowerShell

В качестве альтернативы прямому вызову API отправки в Microsoft Store также предоставляется модуль PowerShell с открытым исходным кодом, в котором поверх API реализован интерфейс командной строки. Этот модуль называется [StoreBroker](https://aka.ms/storebroker). Этот модуль можно использовать для управления приложением, тестируемой возможностью и отправками надстроек из командной строки, вместо того чтобы вызывать API отправки в Microsoft Store напрямую. Кроме того, можно просмотреть дополнительные примеры вызова этого API, изучив исходный код. Модуль StoreBroker активно используется Microsoft в качестве основного способа отправки многих собственных приложений компании в Магазин.

Дополнительные сведения см. на нашей [странице StoreBroker на GitHub](https://aka.ms/storebroker).

## <a name="troubleshooting"></a>Устранение неполадок

| Проблема      | Разрешение                                          |
|---------------|---------------------------------------------|
| После вызова API отправки в Microsoft Store из PowerShell данные ответа для API повреждаются при их преобразовании из формата JSON в объект PowerShell с помощью командлета [ConvertFrom-Json](https://technet.microsoft.com/library/hh849898.aspx) и обратно в формат JSON с помощью командлета [ConvertTo-Json](https://technet.microsoft.com/library/hh849922.aspx). |  По умолчанию параметру *-Depth* для командлета [ConvertTo-Json](https://technet.microsoft.com/library/hh849922.aspx) задано значение 2 уровней объектов, которое является слишком плоским для большинства объектов JSON, возвращаемых API отправки в Microsoft Store. При вызове командлета [ConvertTo Json](https://technet.microsoft.com/library/hh849922.aspx) задайте параметру *-Depth* более высокое значение (например, 20). |

## <a name="additional-help"></a>Дополнительная справка

Если у вас есть вопросы по работе с API отправки в Microsoft Store или вам нужна помощь в управлении отправками с помощью этого API, используйте следующие веб-ресурсы.

* Задайте вопрос на наших [форумах](https://social.msdn.microsoft.com/Forums/windowsapps/home?forum=wpsubmit).
* Посетите нашу [страницу поддержки](https://developer.microsoft.com/windows/support) и запросите один из вариантов технической поддержки для панели мониторинга Центра разработки. Если вам будет предложено выбрать тип проблемы и категорию, выберите **Отправка и сертификация приложения** и **Отправка приложения** соответственно.  

## <a name="related-topics"></a>Связанные разделы

* [Получение данных приложения](get-app-data.md)
* [Управление отправками приложений](manage-app-submissions.md)
* [Управление надстройками](manage-add-ons.md)
* [Управление отправками надстроек](manage-add-on-submissions.md)
* [Управление тестовыми пакетами](manage-flights.md)
* [Управление отправками тестового пакета](manage-flight-submissions.md)
