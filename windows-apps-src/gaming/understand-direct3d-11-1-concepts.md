---
title: Важные изменения в Direct3D 11 по сравнению с Direct3D 9
description: В этом разделе представлены общие отличия между DirectX 9 и DirectX 11.
ms.assetid: 35a9e388-b25e-2aac-0534-577b15dae364
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp, игры, directx, direct3d 9, direct3d 11, изменения
ms.localizationpriority: medium
ms.openlocfilehash: e3e3ecfaee8a99522623ee6b021d8e3a2d78ab85
ms.sourcegitcommit: ac7f3422f8d83618f9b6b5615a37f8e5c115b3c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2019
ms.locfileid: "66367546"
---
# <a name="important-changes-from-direct3d-9-to-direct3d-11"></a>Важные изменения в Direct3D 11 по сравнению с Direct3D 9



**Сводка**

-   [Планирование портов DirectX](plan-your-directx-port.md)
-   Важные изменения в Direct3D 11 по сравнению с Direct3D 9
-   [Функция сопоставления](feature-mapping.md)


В этом разделе представлены общие отличия между DirectX 9 и DirectX 11.

Direct3D 11 — это по сути тот же тип API, что и Direct3D 9, а именно виртуализованный интерфейс нижнего уровня для взаимодействия с графическим оборудованием. Он также по-прежнему позволяет выполнять графические операции в разнообразных аппаратных реализациях. Структура графического API изменилась по сравнению с Direct3D 9; идея контекста устройства была расширена. Также был добавлен специальный API для графической инфраструктуры. Ресурсы, хранящиеся на устройстве Direct3D, получили принципиально новый механизм для полиморфизма данных — представление ресурсов.

## <a name="core-api-functions"></a>Базовые функции API


В Direct3D 9, прежде чем использовать интерфейс для взаимодействия с API Direct3D, его приходилось создавать. В играх UWP с использованием Direct3D 11 вы вызываете статическую функцию [**D3D11CreateDevice**](https://docs.microsoft.com/windows/desktop/api/d3d11/nf-d3d11-d3d11createdevice) для создания устройства и контекста устройства.

## <a name="devices-and-device-context"></a>Устройства и контекст устройства


Устройство Direct3D 11 представляет собой виртуализованный графический адаптер. Оно используется для создания ресурсов в видеопамяти, например для отправки текстур графическому процессору (GPU), создания представлений на основе ресурсов текстуры и цепочек буферов и для создания дискретизаторов текстур. Полный перечень способов использования интерфейса устройства Direct3D 11 приведен в разделах [**ID3D11Device**](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11device) и [**ID3D11Device1**](https://docs.microsoft.com/windows/desktop/api/d3d11_1/nn-d3d11_1-id3d11device1).

Контекст устройства Direct3D 11 используется для настройки состояния конвейера и создания команд отрисовки. Например, цепочка отрисовки Direct3D 11 использует контекст устройства для настройки цепочки отрисовки и рисования сцены (см. ниже). Контекст устройства применяется для доступа к видеопамяти (сопоставления), которую используют ресурсы устройства Direct3D, а также для обновления данных подресурсов, например данных буфера констант. Полный перечень способов использования контекста устройства Direct3D 11 приведен в разделах [**ID3D11DeviceContext**](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11devicecontext) и [**ID3D11DeviceContext1**](https://docs.microsoft.com/windows/desktop/api/d3d11_1/nn-d3d11_1-id3d11devicecontext1). Обратите внимание, что большинство наших образцов используют мгновенный контекст для обработки напрямую на устройстве, но Direct3D 11 также поддерживает и отложенные контексты устройств, которые применяются преимущественно для многопоточности.

Чтобы получить маркер устройства и маркер контекста устройства, в Direct3D 11 вызывается [**D3D11CreateDevice**](https://docs.microsoft.com/windows/desktop/api/d3d11/nf-d3d11-d3d11createdevice). В этом методе также запрашивается определенный набор аппаратных функций и извлекаются сведения об уровнях компонентов Direct3D, которые поддерживает графический адаптер. Дополнительные сведения об устройствах, контекстах устройств и потоковой модели см. в разделе [Вводные сведения об устройстве в Direct3D 11](https://docs.microsoft.com/windows/desktop/direct3d11/overviews-direct3d-11-devices-intro).

## <a name="device-infrastructure-frame-buffers-and-render-target-views"></a>Инфраструктура устройства, буферы кадров и представления однобуферной прорисовки


В Direct3D 11 для настройки адаптера устройств и конфигурации оборудования применяется API DirectX Graphics Infrastructure (DXGI) с использованием COM-интерфейсов [**IDXGIAdapter**](https://docs.microsoft.com/windows/desktop/api/dxgi/nn-dxgi-idxgiadapter) и [**IDXGIDevice1**](https://docs.microsoft.com/windows/desktop/api/dxgi1_2/nn-dxgi1_2-idxgidevice2). Буферы и другие ресурсы окон (видимые и закадровые) создаются и настраиваются при помощи определенных интерфейсов DXGI. Реализация шаблона фабрики [**IDXGIFactory2**](https://docs.microsoft.com/windows/desktop/api/dxgi1_2/nn-dxgi1_2-idxgifactory2) получает ресурсы DXGI, такие как буфер кадров. Поскольку DXGI принадлежит цепочка буферов, интерфейс DXGI используется для представления кадров на экране. Дополнительные сведения об этом см. в [**IDXGISwapChain1**](https://docs.microsoft.com/windows/desktop/api/dxgi1_2/nn-dxgi1_2-idxgiswapchain1).

Используйте [**IDXGIFactory2**](https://docs.microsoft.com/windows/desktop/api/dxgi1_2/nn-dxgi1_2-idxgifactory2) для создания цепочки буферов, совместимой с вашей игрой. Необходимо создать цепочку буферов не для HWND, а для основного окна или для композиции (взаимодействие с XAML).

## <a name="device-resources-and-resource-views"></a>Ресурсы устройств и представления ресурсов


Direct3D 11 поддерживает дополнительный уровень полиморфизма для ресурсов видеопамяти — для представлений. По сути там, где раньше был один объект Direct3D 9 для текстуры, теперь есть два объекта: ресурс текстуры, где хранятся данные, и представление ресурсов, которое определяет способ использования представления для отрисовки. Представление на основе ресурса позволяет использовать ресурс для определенной цели. Например, ресурс двухмерной текстуры создается в форме [**ID3D11Texture2D**](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11texture2d), затем на его основе создается представление ресурсов шейдера ([**ID3D11ShaderResourceView**](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11shaderresourceview)), и его можно использовать как текстуру в шейдере. Представление однобуферной прорисовки ([**ID3D11RenderTargetView**](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11rendertargetview)) можно также создать на основе того же ресурса двухмерной текстуры и использовать его как поверхность рисования. В другом примере те же пиксельные данные представлены в двух разных форматах пикселей с использованием двух отдельных представлений на основе одного ресурса текстуры.

Основной ресурс необходимо создать со свойствами, совместимыми с типом представлений, которые будут созданы из него. Например если [ **ID3D11RenderTargetView** ](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11rendertargetview) применяется к рабочей области, которые отображаются создается с [ **D3D11\_ПРИВЯЗАТЬ\_ОТРИСОВКИ\_ Целевой объект** ](https://docs.microsoft.com/windows/desktop/api/d3d11/ne-d3d11-d3d11_bind_flag) флаг. Области также должна иметь формат DXGI поверхности, совместимый с подготовки к просмотру (см. в разделе [ **DXGI\_ФОРМАТ**](https://docs.microsoft.com/windows/desktop/api/dxgiformat/ne-dxgiformat-dxgi_format)).

Большинство ресурсов, которые вы используете для отрисовки, унаследованы от интерфейса [**ID3D11Resource**](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11resource), в свою очередь унаследованного от [**ID3D11DeviceChild**](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11devicechild). Буферы вершин, буферы индексов, буферы констант и шейдеры — все это ресурсы Direct3D 11. Входные макеты и состояния дискретизатора унаследованы напрямую от [**ID3D11DeviceChild**](https://docs.microsoft.com/windows/desktop/api/d3d11/nn-d3d11-id3d11devicechild).

Представления ресурсов используют DXGI\_ФОРМАТА значение перечисления, указывающее формат пикселей. Не каждый D3DFMT поддерживается в качестве DXGI\_ФОРМАТ. Например, имеется формат RGB не 24 разряда в DXGI, которая эквивалентна D3DFMT\_R8G8B8. Существует также не BGR эквивалентов в каждом формате RGB (DXGI\_ФОРМАТ\_R10G10B10A2\_UNORM эквивалентно D3DFMT\_A2B10G10R10, но нет прямого эквивалента D3DFMT\_A2R10G10B10). Во время сборки следует преобразовать содержимое в этих устаревших форматах в поддерживаемые форматы. Для полного списка DXGI форматов см. в разделе [ **DXGI\_ФОРМАТ** ](https://docs.microsoft.com/windows/desktop/api/dxgiformat/ne-dxgiformat-dxgi_format) перечисления.

Ресурсы устройств Direct3D (и представления ресурсов) создаются до обработки сцены. Контексты устройств используются для настройки цепочки отрисовки, как описано ниже.

## <a name="device-context-and-the-rendering-chain"></a>Контекст устройства и цепочка отрисовки


В Direct3D 9 и Direct3D 10.x был единственный объект устройства Direct3D, который управлял созданием ресурсов, состоянием и рисованием. В Direct3D 11 интерфейс устройства Direct3D также управляет созданием ресурсов, но для управления состоянием и операциями рисования используется контекст устройства Direct3D. Вот пример использования контекста устройства (интерфейса [**ID3D11DeviceContext1**](https://docs.microsoft.com/windows/desktop/api/d3d11_1/nn-d3d11_1-id3d11devicecontext1)) для настройки цепочки отрисовки:

-   Настройка и очистка представлений однобуферной прорисовки (и представления трафарета глубины)
-   Настройка буфера вершин, буфера индексов и входного макета для этапа сборщика входных данных (этапа IA)
-   Привязка вершинного и обычного построителей текстуры к конвейеру
-   Привязка буферов констант к шейдерам
-   Привязка представлений текстуры и дискретизаторов к построителю текстуры
-   Рисование сцены

Когда вызван один из методов [**ID3D11DeviceContext::Draw**](https://docs.microsoft.com/windows/desktop/api/d3d11/nf-d3d11-id3d11devicecontext-draw), рисуется сцена в представлении однобуферной прорисовки. По завершении рисования адаптер DXGI используется для представления законченного кадра вызовом [**IDXGISwapChain1::Present1**](https://docs.microsoft.com/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1).

## <a name="state-management"></a>Управление состоянием


В Direct3D 9 для управления параметрами состояния использовался большой набор отдельных переключателей, которые настраивались с помощью методов SetRenderState, SetSamplerState и SetTextureStageState. Поскольку Direct3D 11 не поддерживает устаревший конвейер с фиксированной функцией, метод SetTextureStageState заменен написанием построителей текстуры (PS). Не существует эквивалента блоку состояний Direct3D 9. В Direct3D 11 для управления состоянием используются 4 вида объектов состояния, что упрощает группировку состояний отрисовки.

Например, вместо SetRenderState с D3DRS\_ZENABLE, создании DepthStencilState объекта с данным и других связанных состояние параметров и использовать его для изменения состояния во время подготовки к просмотру.

При переносе приложений Direct3D 9 в объекты состояния учитывайте, что различные комбинации состояний представлены в виде неизменяемых объектов состояния. Их следует создать один раз и многократно использовать, пока они остаются действительными.

## <a name="direct3d-feature-levels"></a>Уровни функций Direct3D 


В Direct3D появился новый механизм определения аппаратной поддержки — уровни функций. Благодаря уровням функций становится проще узнать о возможностях графического адаптера, поскольку можно запросить четко определенный набор функций GPU. Например, 9\_1 функция уровня реализует функциональные возможности, предоставляемые видеоадаптеры Direct3D 9, включая шейдера модели 2.x. С момента 9\_1 самый низкий уровень компонента, предполагается, что все устройства, для поддержки вершинный построитель текстуры и текстуры, которые были же этапы, поддерживаемого моделью программируемый построитель текстуры Direct3D 9.

Ваша игра будет использовать [**D3D11CreateDevice**](https://docs.microsoft.com/windows/desktop/api/d3d11/nf-d3d11-d3d11createdevice) для создания устройства и контекста устройства Direct3D. Вызывая эту функцию, вы предоставляете список уровней функций, которые поддерживает ваша игра. На основе этого списка функция вернет самый высокий поддерживаемый уровень функций. Например, если игры можно использовать BC4/BC5 текстур (функция оборудования DirectX 10), следует включить по крайней мере 9\_1 и 10\_0 в список поддерживаемых функциональных уровней. Если игра работает на оборудовании DirectX 9 и текстуры BC4/BC5 не может использоваться, затем [ **D3D11CreateDevice** ](https://docs.microsoft.com/windows/desktop/api/d3d11/nf-d3d11-d3d11createdevice) вернет 9\_1. Затем ваша игра может переключиться на другой формат текстур (и более мелкие текстуры).

Если вы решили расширить игру Direct3D 9, добавив поддержку более высоких уровней функций Direct3D, лучше сначала закончить перенос существующего графического кода Direct3D 9. После переноса игры в Direct3D 11 будет проще добавить дополнительные пути отрисовки с более сложной графикой.

Подробное объяснение поддержки уровней функций см. в разделе [Уровни функций Direct3D](https://docs.microsoft.com/windows/desktop/direct3d11/overviews-direct3d-11-devices-downlevel-intro). Полный перечень функций Direct3D 11 см. в разделах [Функции Direct3D 11](https://docs.microsoft.com/windows/desktop/direct3d11/direct3d-11-features) и [Функции Direct3D 11.1](https://docs.microsoft.com/windows/desktop/direct3d11/direct3d-11-1-features).

## <a name="feature-levels-and-the-programmable-pipeline"></a>Уровни функций и программируемый конвейер


С момента появления Direct3D 9 оборудование непрерывно совершенствовалось, и в программируемый графический конвейер было добавлено несколько новых дополнительных этапов. Набор параметров для графического конвейера зависит от уровня функций Direct3D. Уровень функций 10.0 включает этап геометрического построителя текстуры с дополнительным потоковым выводом для многопроходной отрисовки на GPU. Уровень 11\_0 включать шейдера поверхности и шейдер доменов для использования с тесселяции оборудования. Уровень 11\_0 также включает в себя полную поддержку для шейдеров DirectCompute, хотя функциональные уровни, 10.x включают только поддержку ограниченную форму DirectCompute.

Все шейдеры написаны на языке HLSL с использованием профиля шейдеров, соответствующего уровню функций Direct3D. Профили шейдера совместимы вверх, чтобы шейдер HLSL, компилируется с помощью vs\_4\_0\_уровень\_9\_1 или ps\_4\_0\_уровень\_9\_1 будет работать на всех устройствах. Шейдера профили не являются совместимыми. для этого нижнего уровня, поэтому компиляция шейдера с помощью vs\_4\_1 будет работать только на функциональном уровне 10\_1, 11\_0 или 11\_1 устройства.

В Direct3D 9 для управления константами шейдеров использовался общий массив с методами SetVertexShaderConstant и SetPixelShaderConstant. Direct3D 11 использует буферы констант, которые представляют собой ресурсы, аналогичные буферу вершин или буферу индексов. Буферы констант эффективно обновляются благодаря своей структуре. Вам не нужно размещать все константы шейдера в одном глобальном массиве. Вместо этого вы объединяете константы в логические группы и управляете ими при помощи одного или нескольких буферов констант. При переносе игры Direct3D 9 в Direct3D 11 запланируйте такую организацию буферов констант, чтобы можно было обновлять их соответствующим образом. Например, сгруппируйте константы шейдера, которые не обновляются с каждым кадром, в отдельный буфер констант. Тогда вам не придется постоянно отправлять эти данные графическому адаптеру вместе с более динамическими константами шейдера.

> **Примечание**    приложения наиболее Direct3D 9 интенсивно использовала построителей текстур, но иногда смешанный использовать устаревшее поведение фиксированными функциями. Обратите внимание, что Direct3D 11 использует только программируемую модель шейдеров. Устаревшие компоненты Direct3D 9 с фиксированными функциями использовать не рекомендуется.

 

 

 




