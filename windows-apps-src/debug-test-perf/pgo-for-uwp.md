---
title: Выполнение профильной оптимизации (PGO) в приложениях универсальной платформы Windows (UWP)
ms.localizationpriority: medium
ms.openlocfilehash: 1d7321f0ef49c12ac4506fb72fab937fde77f740
ms.sourcegitcommit: b5c9c18e70625ab770946b8243f3465ee1013184
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/29/2018
ms.locfileid: "7989201"
---
# <a name="running-profile-guided-optimization-on-universal-windows-platform-apps"></a>Выполнение профильной оптимизации в приложениях универсальной платформы Windows 
 
Этот раздел содержит пошаговые инструкции по выполнению профильной оптимизации в приложениях универсальной платформы Windows (UWP). Не все действия, доступные для классических приложений win32, доступны для приложений UWP, поэтому наша цель— пояснить процедуру интеграции PGO, чтобы упростить оптимизацию и сделать ее более доступной для разработчиков приложений UWP.

Ниже приведена базовая пошаговая инструкция по применению PGO к шаблону приложения DirectX 11 (UWP) по умолчанию с помощью Обновления 3 Visual Studio 2015.
 
Снимки экрана, которые используются в этом руководстве, взяты из следующего нового проекта: ![диалоговое окно "Создать проект"](images/pgo-001.png)

Чтобы применить PGO к шаблону приложения DirectX 11, выполните следующие действия:

1. Задайте для своей конфигурации решения значение **Выпуск** или выберите конфигурацию решения, в которой вы создаете оптимизированный код для этого выпуска. Теоретически можно запустить PGO в отладочной сборке, однако использовать PGO для оптимизации сборки, которая не была оптимизирована никак иначе, нецелесообразно. 
 
 ![Окно App1](images/pgo-002.png)
 
2. В свойствах проекта (**Свойства** > **C/C++** > **Оптимизация**) убедитесь, что сборка выполняется с флагом /GL для параметра **Оптимизация всей программы** (возможно, в вашей конфигурации этот флаг уже установлен).

 ![Оптимизация всей программы](images/pgo-003.png)

3. Перейдите в свойства компоновщика (**Свойства** > **Компоновщик** > **Оптимизация**) и задайте для свойства **Создание кода во время компоновки** значение **Профильная оптимизация— инструмент (LTCG:PGInstrument)**.
 
 ![Создание кода во время компоновки](images/pgo-004.png)

4. Выберите **Собрать решение**, а затем выберите **Развернуть решение**. 

 ![Диалоговое окно "Новый проект"](images/pgo-005.png)
 
 Чтобы убедиться, что все сработало правильно, нужно проверить, что в выходном расположении сборки создан PGD-файл. В этом примере это означало, что вместе с выходным компонентом сборки был создан следующий файл:
 
 `C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1.pgd`

 По умолчанию PGD-файл будет иметь то же имя, что и ваш исполняемый файл. Можно также изменить имя создаваемого PGD-файла, изменив параметр компоновщика **База данных для оптимизации с помощью профиля**. 
 
5. Перейдите в каталог двоичных файлов VC Visual Studio (по умолчанию это `C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin`). Для исполняемых файлов x86 копируйте `pgort140.dll`; для исполняемых файлов x64 копируйте версию x64 из библиотеки `amd64\pgort140.dll`. Вставьте соответствующую версию `pgort140.dll` в корень развернутого пакета. Для данного примера этот путь выглядит так:

 `C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\AppX\`

 Этот шаг является необходимым, поскольку приложения UWP могут загружать только библиотеки, которые существуют в их пакете.

 ![Диалоговое окно "Новый проект"](images/pgo-006.png)
 
6. Запустите приложение из меню "Пуск" или меню **Отладка** в Visual Studio (с параметром **Запуск без отладки**). 

 ![Диалоговое окно "Новый проект"](images/pgo-007.png)
 
7. Выполняемая в настоящее время сборка является инструментируемой; она создает данные PGO. На данном этапе необходимо запустить приложение для некоторых самых распространенных сценариев, которые планируется оптимизировать. После прогона предполагаемых сценариев программой найдите инструмент pgosweep.exe, расположенный в той же папке, что и соответствующая версия `pgort140.dll`. Кроме того, в командной строке Visual Studio (x86/x64) Native Tools соответствующая версия уже будет записана в пути. Для сбора данных PGO выполните следующую команду, пока приложение работает, чтобы создать PGC-файл, который будет содержать данные профилирования.
 
  `pgosweep.exe <executable name> <output file>` 
 
  Кроме того, можно обратиться к справке pgosweep.exe (`pgosweep.exe /help`) для просмотра других необязательных аргументов для управления способом сбора данных PGO.
 
  Имеет смысл вывести PGC-файлы в расположение сборки, где находится PGD-файл, и назвать файлы `<PGDName>!<RunIdentifier>.pgc`. Например, это означало следующее:
 
  ```
  pgosweep.exe App1.exe “C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1!1.pgc”
  ```
 
  Получаемые в дальнейшем файлы можно было бы называть `App1!CoreScenario.pgc`, `App1!UseCase5.pgc` ит.д. Если PGC-файлы называются таким образом и помещаются в папку вывод сборки вместе с PGD-файлом, их слияние будет выполнено автоматически при связывании в шаге 9.
 
8. НЕОБЯЗАТЕЛЬНО. По умолчанию все PGC-файлы, которые были названы в соответствии с инструкцией в шаге 7 и помещены рядом с этим файлом PGD, будут объединены при связывании и будут иметь равный вес, однако вы сможете более эффективно контролировать определение веса определенных запусков. Для этого необходимо использовать инструмент **pgomgr.exe**, который находится в той же папке, где впервые был обнаружен экземпляр `pgort140.dll`. Например, чтобы объединить `CoreScenario`, запускаемый с тройным по сравнению с другими запусками приоритетом, можно использовать следующую команду:
 
 ```
 pgomgr.exe -merge:3 “C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1!CoreScenario.pgc” “C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1.pgd”
 ```
 
9. После того как вы создали один или несколько PGC-файлов и поместили их вместе со своим PGD-файлом или выполнили их слияние вручную (шаг 8), можно использовать компоновщик для создания окончательной оптимизированной сборки. Вернитесь в свойства компоновщика (**Свойства** > **Компоновщик** > **Оптимизация**) и задайте для свойства **Создание кода во время компоновки** значение **Профильная оптимизация— оптимизация (LTCG:PGOptimize)**. После этого убедитесь, что **База данных для оптимизации с помощью профиля** указывает на PGD-файл, который вы намеревались использовать (если вы не изменили это значение, все должно быть в порядке).

 ![Диалоговое окно "Новый проект"](images/pgo-009.png)
 
10. Когда проект создан, компоновщик вызовет файл pgomgr.exe, чтобы объединить в PGD-файл любые файлы `<PGDName>!*.pgc` с весом по умолчанию 1, а получившееся приложение будет оптимизировано на основе данных профилирования.

## <a name="see-also"></a>См. также
- [Производительность](performance-and-xaml-ui.md)

 

