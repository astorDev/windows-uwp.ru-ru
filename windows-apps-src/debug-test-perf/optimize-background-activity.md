---
author: PatrickFarley
ms.assetid: 24351dad-2ee3-462a-ae78-2752bb3374c2
title: "Использование функции экономии заряда аккумулятора"
description: "Создавайте приложения UWP, которые взаимодействуют с системой с целью повышения эффективности энергопотребления фоновых задач."
ms.author: pafarley
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: windows 10, uwp
ms.openlocfilehash: 045dfeb4696a4854b114d88da2a2cbb75d621a58
ms.sourcegitcommit: 909d859a0f11981a8d1beac0da35f779786a6889
translationtype: HT
---
# <a name="optimize-background-activity"></a>Оптимизация фоновой активности

Универсальные приложения для Windows должны демонстрировать стабильную производительность на всех семействах устройств. На устройствах с аккумулятором энергопотребление является ключевым фактором, влияющим на удобство взаимодействия пользователя с вашим приложением. Все пользователи хотят, чтобы уровня заряда устройства хватало на целый день, однако для этого требуется эффективная работа всех программ, установленных на устройстве, включая вашу. 

Поведение фоновых задач, несомненно, является основным фактором, определяющим энергозатратность приложения. Фоновая задача— это любая программная активность, зарегистрированная в системе для выполнения без открытого приложения. Дополнительные сведения см. в разделе [Создание и регистрация фоновой задачи вне процесса](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task).

## <a name="background-activity-allowance"></a>Предельный объем фоновой активности

В Windows 10 версии 1607 пользователи могут просматривать использование батареи по приложениям в разделе **Батарея** приложения "Параметры". Здесь отображается список приложений и процент заряда батареи (из объема заряда, использованного с момента последней зарядки), используемый каждым приложением. 

![Использование батареи по приложениям](images/battery-usage-by-app.png)

Для приложений UWP в этом списке пользователи могут частично контролировать обработку фоновой активности в системе. Фоновую активность можно обозначить следующими значениями: "Всегда разрешено", "Управляется Windows" (настройка по умолчанию) или "Никогда не разрешено" (подробнее см. ниже). Используйте значение перечисления **BackgroundAccessStatus**, возвращаемое методом [**BackgroundExecutionManager.RequestAccessAsync()**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.backgroundexecutionmanager.requestaccessasync.aspx), чтобы узнать, каков предельный объем фоновой активности вашего приложения.

![разрешения фоновой задачи](images/background-task-permissions.png)

Из этого следует, что если в вашем приложении не реализовано ответственное управление фоновой активностью, пользователь может запретить любую фоновую активность вашего приложения, что является нежелательным для обеих сторон.

## <a name="work-with-the-battery-saver-feature"></a>Работа с функцией экономии заряда аккумулятора
Экономия заряда аккумулятора — это функция системного уровня, которую пользователи могут настроить в разделе "Параметры". Она выключает любую фоновую активность всех приложений, если уровень заряда опускается ниже определенного пользователем порогового значения, *кроме* фоновой активности приложений, для которых установлено значение "Всегда разрешено".

Если приложение помечено как "Управляется Windows" и вызывается метод **BackgroundExecutionManager.RequestAccessAsync()** для регистрации фоновой активности при включенном режиме экономии заряда, будет возвращено значение **DeniedSubjectToSystemPolicy**. Приложение должно обработать эту ситуацию, уведомив пользователя, что заданные фоновые задачи не будут выполняться до тех пор, пока режим экономии заряда не будет выключен и они не будут повторно зарегистрированы в системе. Если фоновая задача уже зарегистрирована для выполнения и режим экономии заряда включается при запуске этой задачи, задача не будет запущена, а пользователь не получит никакого уведомления. Чтобы уменьшить риск возникновения такой ситуации рекомендуется запрограммировать приложение так, чтобы оно повторно регистрировало фоновые задачи всякий раз при открытии.

В то время как управление фоновой активностью является основным назначением функции экономии заряда батареи, можно внести дополнительные корректировки, которые обеспечат дополнительную экономию энергии при включенном режиме экономии заряда. Проверьте состояние режима экономии заряда из приложения посредством ссылки на свойство [**PowerManager.PowerSavingMode**](https://msdn.microsoft.com/library/windows/apps/windows.phone.system.power.powermanager.powersavingmode.aspx). Это значение перечисления: **PowerSavingMode.Off** или **PowerSavingMode.On**. Если режим экономии заряда включен, приложение может ограничить использование анимаций, остановить запрос расположения или отложить синхронизацию и резервное копирование. 

## <a name="further-optimize-background-tasks"></a>Дополнительная оптимизация фоновых задач
При регистрации фоновых задач можно предпринять следующие дополнительные шаги, чтобы уменьшить расход заряда батареи.

Использование триггера обслуживания. Объект [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.maintenancetrigger.aspx) можно использовать вместо [**SystemTrigger**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.systemtrigger.aspx), чтобы определить время запуска фоновой задачи. Задачи, использующие триггеры обслуживания, будут запускаться только в том случае, если устройство подключено к сети переменного тока. В этом случае они могут выполняться в течение более продолжительного периода. Инструкции см. в разделе [Использование триггера обслуживания](https://msdn.microsoft.com/windows/uwp/launch-resume/use-a-maintenance-trigger).

Использование типа условия системы **BackgroundWorkCostNotHigh**. Условия системы должны выполняться, чтобы можно было запускать фоновые задачи (см. дополнительные сведения в разделе [Задание условий выполнения фоновой задачи](https://msdn.microsoft.com/windows/uwp/launch-resume/set-conditions-for-running-a-background-task)). Трудозатраты фоновой задачи— это измерение, обозначающее *относительную* энергетическую нагрузку выполняемой фоновой задачи. Задача, выполняемая, когда устройство подключено к сети переменного тока, будет помечена как **низкая** (незначительное или нулевое воздействие на заряд батареи). Задача, выполняемая на устройстве, которое питается от аккумулятора, с выключенным экраном, помечена как **высокая**, поскольку подразумевается, что в это время на устройстве наблюдается низкая активность программ, поэтому фоновая задача будет иметь большую относительную стоимость. Задача, выполняемая на устройстве, которое питается от аккумулятора, с *включенным* экраном, помечена как **средняя**, поскольку предполагается, что в системе наблюдается определенная программная активность и фоновая задача несколько увеличит энергопотребление устройства. Условие системы **BackgroundWorkCostNotHigh** просто откладывает возможность выполнения задачи до тех пор, пока не будет включен экран или устройство не подключится к сети переменного тока.

## <a name="test-battery-efficiency"></a>Проверка эффективности аккумулятора

Обязательно проверьте свое приложение на реальных устройствах со сценариями с высоким энергопотреблением. Рекомендуется протестировать приложение на различных устройствах с включенным и выключенным режимом экономии заряда и в средах с разной надежностью сетевого подключения.

## <a name="related-topics"></a>Еще по теме

* [Создание и регистрация внепроцессной фоновой задачи](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task)  
* [Планирование производительности](https://msdn.microsoft.com/windows/uwp/debug-test-perf/planning-and-measuring-performance)  

