---
ms.assetid: 24351dad-2ee3-462a-ae78-2752bb3374c2
title: Оптимизация фоновой активности
description: Создавайте приложения UWP, которые взаимодействуют с системой с целью повышения эффективности энергопотребления фоновых задач.
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: 71a56bc23b4b727d5be2ed35fb77afae03f0689c
ms.sourcegitcommit: 8921a9cc0dd3e5665345ae8eca7ab7aeb83ccc6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2018
ms.locfileid: "8900634"
---
# <a name="optimize-background-activity"></a>Оптимизация фоновой активности

Универсальные приложения для Windows должны демонстрировать стабильную производительность на всех семействах устройств. На устройствах с аккумулятором энергопотребление является ключевым фактором, влияющим на удобство взаимодействия пользователя с вашим приложением. Все пользователи хотят, чтобы уровня заряда устройства хватало на целый день, однако для этого требуется эффективная работа всех программ, установленных на устройстве, включая вашу. 

Поведение фоновых задач, несомненно, является важнейшим фактором, определяющим энергозатратность приложения. Фоновая задача— это любая программная активность, зарегистрированная в системе для выполнения без открытого приложения. Дополнительные сведения см. в разделе [Создание и регистрация фоновой задачи вне процесса](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task).

## <a name="background-activity-permissions"></a>Разрешения фоновой активности

На настольных компьютерах и мобильных устройствах под управлением Windows 10 версии 1607 или выше в разделе "Настройки" > "Аккумулятор" пользователи могут просматривать данные о потреблении ресурсов аккумулятора различными приложениями. Здесь отображается список приложений и процент заряда аккумулятора, использованный каждым приложением (процент от уровня заряда, использованного с момента последней зарядки). Для приложений UWP в этом списке пользователи могут выбрать элементы управления, связанные с фоновой активностью.

![использование аккумулятора каждым приложением](images/battery-usage-by-app.png)

### <a name="background-permissions-on-mobile"></a>Разрешения фоновой активности на мобильных устройствах

На мобильных устройствах для пользователей доступен список переключателей, позволяющих настроить разрешения для фоновых задач приложения. Для фоновой активности можно задать параметры "Всегда разрешено", "Недопустимо" или "Управляется Windows". Последний вариант означает, что фоновая активность приложения регулируется системой в зависимости от различных факторов. 

![Переключатели разрешений фоновой задачи](images/background-task-permissions.png)

### <a name="background-permissions-on-desktop"></a>Разрешения фоновой активности на настольном компьютере

На настольных компьютерах параметр «Управляется Windows» представлен в виде переключателя, который по умолчанию установлен в значение **Вкл.**. Если пользователь изменит значение на **Выкл.**, появится флажок, с помощью которого можно вручную настроить разрешения фоновой активности. Если этот флажок установлен, приложению разрешено выполнять фоновые задачи в любое время. Если флажок снят, фоновая активность отключена.

![разрешения фоновой задачи – включение](images/background-task-permissions-on.png)

![разрешения фоновой задачи – выключение](images/background-task-permissions-off.png)

В приложении можно использовать значение перечисления [**BackgroundAccessStatus**](https://docs.microsoft.com/en-us/uwp/api/windows.applicationmodel.background.backgroundaccessstatus), возвращаемое при вызове метода [**BackgroundExecutionManager.RequestAccessAsync()**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.backgroundexecutionmanager.requestaccessasync.aspx). С помощью этого значения можно определить текущее разрешение фоновой активности приложения.

Из этого следует, что если в вашем приложении не реализовано ответственное управление фоновой активностью, пользователь может запретить любую фоновую активность вашего приложения, что является нежелательным для обеих сторон. Если вашему приложению запрещено работать в фоновом режиме, но для выполнения задачи пользователя требуется фоновая активность, можно уведомить пользователя и направить его в раздел "Параметры". Для этого [запустите приложение "Параметры" ](https://docs.microsoft.com/en-us/windows/uwp/launch-resume/launch-settings-app) с открытым разделом "Фоновые приложения" или "Сведения об использовании аккумулятора".

## <a name="work-with-the-battery-saver-feature"></a>Работа с функцией экономии заряда аккумулятора
Экономия заряда аккумулятора — это функция системного уровня, которую пользователи могут настроить в разделе "Параметры". Она выключает любую фоновую активность всех приложений, если уровень заряда опускается ниже определенного пользователем порогового значения, *кроме* фоновой активности приложений, для которых установлено значение "Всегда разрешено".

Проверьте состояние режима экономии заряда в приложении с помощью ссылки на свойство [**PowerManager.EnergySaverStatus**](https://docs.microsoft.com/en-us/uwp/api/windows.system.power.energysaverstatus). Это значение перечисления: **EnergySaverStatus.Disabled**, **EnergySaverStatus.Off** или **EnergySaverStatus.On**. Если вашему приложению требуется фоновая активность и для него не выбран параметр "Всегда разрешено", приложение должно обрабатывать значение **EnergySaverStatus.On** и уведомлять пользователя о том, что данные фоновые задачи не будут выполняться в режиме экономии заряда. В то время как управление фоновой активностью является основным назначением функции экономии заряда батареи, можно внести дополнительные корректировки, которые обеспечат дополнительную экономию энергии при включенном режиме экономии заряда.  Если режим экономии заряда включен, приложение может ограничить использование анимаций, остановить запрос расположения или отложить синхронизацию и резервное копирование. 

## <a name="further-optimize-background-tasks"></a>Дополнительная оптимизация фоновых задач
При регистрации фоновых задач можно выполнить следующие дополнительные действия, чтобы уменьшить расход заряда аккумулятора.

### <a name="use-a-maintenance-trigger"></a>Использование триггера обслуживания 
Объект [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.maintenancetrigger.aspx) можно использовать вместо [**SystemTrigger**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.systemtrigger.aspx), чтобы определить время запуска фоновой задачи. Задачи, использующие триггеры обслуживания, будут запускаться только в том случае, если устройство подключено к сети переменного тока. В этом случае они могут выполняться в течение более продолжительного периода. Инструкции см. в разделе [Использование триггера обслуживания](https://msdn.microsoft.com/windows/uwp/launch-resume/use-a-maintenance-trigger).

### <a name="use-the-backgroundworkcostnothigh-system-condition-type"></a>Использование условия системы **BackgroundWorkCostNotHigh**
Для выполнения фоновых задач должны соблюдаться условия системы (см. дополнительные сведения в разделе [Указание условий выполнения фоновой задачи](https://msdn.microsoft.com/windows/uwp/launch-resume/set-conditions-for-running-a-background-task)). Трудозатраты фоновой задачи— это измерение, обозначающее *относительную* энергетическую нагрузку выполняемой фоновой задачи. Задача, выполняемая, когда устройство подключено к сети переменного тока, будет помечена как **низкая** (незначительное или нулевое воздействие на заряд батареи). Задача, выполняемая на устройстве, которое питается от аккумулятора, с выключенным экраном, помечена как **высокая**, поскольку подразумевается, что в это время на устройстве наблюдается низкая активность программ, поэтому фоновая задача будет иметь большую относительную стоимость. Задача, выполняемая на устройстве, которое питается от аккумулятора, с *включенным* экраном, помечена как **средняя**, поскольку предполагается, что в системе наблюдается определенная программная активность и фоновая задача несколько увеличит энергопотребление устройства. Условие системы **BackgroundWorkCostNotHigh** просто откладывает возможность выполнения задачи до тех пор, пока не будет включен экран или устройство не подключится к сети переменного тока.

## <a name="test-battery-efficiency"></a>Проверка эффективности аккумулятора

Обязательно проверьте свое приложение на реальных устройствах в сценариях с высоким энергопотреблением. Рекомендуется протестировать приложение на различных устройствах с включенным и выключенным режимом экономии заряда и в средах с разной надежностью сетевого подключения.

## <a name="related-topics"></a>Еще по теме

* [Создание и регистрация внепроцессной фоновой задачи](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task)  
* [Планирование производительности](https://msdn.microsoft.com/windows/uwp/debug-test-perf/planning-and-measuring-performance)  

