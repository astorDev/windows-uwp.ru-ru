---
author: Karl-Bridge-Microsoft
pm-contact: miguelrb
design-contact: kimsea
dev-contact: niallm
doc-status: Published
ms.openlocfilehash: 010663320b4011d853c53bc4121f86a14bfbfe0c
ms.sourcegitcommit: a2908889b3566882c7494dc81fa9ece7d1d19580
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2017
---
# <a name="custom-keyboard-interactions"></a>Настройка взаимодействия с использованием клавиатуры

Создайте полное и согласованное взаимодействие с использованием клавиатуры в своих приложениях UWP и настраиваемых элементах как для опытных пользователей клавиатуры, так и для людей с ограниченными возможностями, выполнив также другие требования к специальным возможностям.

В этом разделе основное внимание уделяется поддержке ввода с клавиатуры с пользовательскими элементами управления для приложений UWP на компьютерах. Однако хорошо разработанное взаимодействие с использованием клавиатуры важно для поддержки средств специальных возможностей, в частности экранного диктора Windows, программными клавиатурами, например сенсорной или экранной.

## <a name="providing-2d-directional-inner-navigation-a-namexyfocuskeyboardnavigation"></a>Обеспечение двухмерной внутренней навигации <a name="xyfocuskeyboardnavigation">

Используйте свойство **XYFocusKeyboardNavigation** для поддержки двухмерной внутренней навигации настраиваемых элементов и групп элементов управления с помощью клавиатуры (клавиш со стрелками), игрового контроллера Xbox (крестовины и кнопок левого джойстика) и пульта дистанционного управления Xbox (крестовины).

**ПРИМЕЧАНИЕ.** Имеется в виду внутренняя область навигации элемента или группы элементов управления, например *область направления*.

**XYFocusKeyboardNavigation** имеет значение типа **XYFocusKeyboardNavigationMode** с возможными значениями **Auto** (по умолчанию), **Enabled** или **Disabled**.

Это свойство не влияет на навигацию по вкладкам и затрагивает только внутреннюю навигацию дочерних элементов внутри элемента или группы элементов управления. Дочерние элементы области направления не следует включать в навигацию по вкладкам.

### <a name="default-behavior"></a>Поведение по умолчанию

Поведение направленной навигации основывается на наследственности элемента или иерархии наследования. Если все родительские элементы находятся в режиме по умолчанию или для них задано значение **Auto**, поведение направленной навигации не поддерживается для клавиатуры (геймпад и пульт ДУ всегда поддерживают направленную навигацию, если явно не задано значение **Disabled**).

### <a name="custom-behavior"></a>Настройка поведения

Установка для этого свойства значения **Enabled** добавляет в элемент управления поддержку внутренней навигации 2D (с помощью клавиш со стрелками на клавиатуре) по каждому UIElement внутри такого элемента.

При использовании клавиш со стрелками навигация ограничивается областью направления (при нажатии клавиши табуляции фокус перемещается на следующий фокусируемый элемент вне области направления).

**ПРИМЕЧАНИЕ.** Это правило не применяется при использовании геймпада или пульта ДУ— навигация продолжается за пределами области направления и переходит на следующий фокусируемый элемент управления.

Это свойство влияет только на внутреннюю навигацию с помощью клавиш со стрелками и не влияет на навигацию с помощью клавиши табуляции. Все элементы управления поддерживают ожидаемую иерархию в последовательности табуляции.

На следующем рисунке показаны три кнопки (A, B и C) внутри области направления и четвертая кнопка (D) за ее пределами.

![область направления](images/keyboard/directional-area.png)

*Клавиши со стрелками перемещают фокус между кнопками A, B и C, но не D*

В следующем примере кода показано, как влияет на навигацию включение **XYFocusKeyboardNavigation**. На предыдущем изображении фокус первоначально находится в позиции А, а клавиша табуляции циклично перемещает его по всем элементам управления (A -&gt; B -&gt; C -&gt; D и снова А), тогда как клавиши со стрелками действуют только в пределах области направления.

```XAML
<StackPanel Orientation="Horizontal">
      <StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation="Enabled">
            <Button Content="A" />
            <Button Content="B" />
            <Button Content="C" />
      </StackPanel>
      <Button Content="D" />
</StackPanel>
```

#### <a name="override-directional-navigation"></a>Переопределение направленной навигации

Используйте свойства XYFocusRight, XYFocusLeft, XYFocusTop или XYFocusDown, чтобы переопределить поведение навигации по умолчанию.

Здесь показано то же изображение, что и в предыдущем примере: с тремя кнопками (A, B и C) внутри области направления и четвертой кнопкой (D) за ее пределами.

![область направления](images/keyboard/directional-area.png)

*Клавиши со стрелками перемещают фокус между кнопками A, B и C, а затем D*

В этом примере кода показано, как переопределить поведение навигации по умолчанию для клавиши со стрелкой вправо, обеспечив переход за пределы области направления. Обратите внимание, что с помощью клавиши со стрелкой влево нельзя вернуть фокус в область направления.

```XAML
<StackPanel Orientation="Horizontal">
      <StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation="Enabled">
            <Button Content="A" />
            <Button Content="B" />
            <Button Content="C" XYFocusRight="{x:Bind ButtonD}" />
      </StackPanel>
      <Button Content="D" x:Name="ButtonD"/>
</StackPanel>
```

Дополнительные сведения см. в пункте [Стратегии навигации XYFocus](#set-the-tab-navigation-behavior) далее в этом разделе.

#### <a name="restrict-navigation-with-disabled"></a>Ограничение навигации с помощью значения Disabled

Задайте для **XYFocusKeyboardNavigation** значение **Disabled**, чтобы ограничить навигацию с помощью стрелок областью направления.

**ПРИМЕЧАНИЕ.** Настройка этого свойства не влияет на навигацию с помощью клавиатуры в самом элементе управления, а влияет только на его дочерние элементы.

В следующем примере кода в родительском элементе StackPanel для параметра **XYFocusKeyboardNavigation** установлено значение **Enabled**, а в дочернем элементе C для параметра **XYFocusKeyboardNavigation** установлено значение **Disabled**. Навигация с помощью клавиш со стрелками отключена только для дочерних элементов C.

```XAML
<StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation="Enabled">
        <Button Content="A" />
        <Button Content="B" />
        <Button Content="C" XYFocusKeyboardNavigation="Disabled" >
            ...
        </Button>
</StackPanel>
```

#### <a name="use-nested-directional-areas"></a>Использование вложенных областей направления

Может быть несколько уровней вложенных областей направления. Если во всех родительских элементах для параметра **XYFocusKeyboardNavigation** установлено значение **Enabled**, границы области при навигации с помощью клавиш со стрелками игнорируются.

На рисунке показаны три кнопки (A, B и C) внутри вложенной области направления и четвертая кнопка (D) за ее пределами.

![вложенная область направления](images/keyboard/nested-directional-area.png)

*Клавиши со стрелками перемещают фокус между кнопками A, B и C, но не D*

В этом примере кода продемонстрировано, как указать, что вложенные области направления поддерживают навигацию с помощью клавиш со стрелками через границы области.

```XAML
<StackPanel Orientation="Horizontal">
        <StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation ="Enabled">
            <StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation ="Enabled">
                <Button Content="A" />
                <Button Content="B" />
            </StackPanel>
            <Button Content="C" />
        </StackPanel>
        <Button Content="D" />
 </StackPanel>
```

На рисунке показаны четыре кнопки (A, B, C и D), при этом A и B находятся внутри вложенной области направления, а C и D— внутри другой области. Так как для параметра **XYFocusKeyboardNavigation** родительского элемента установлено значение **Disabled**, границу каждой вложенной области невозможно пересечь с помощью клавиш со стрелками.

![область без направления](images/keyboard/non-directional-area.png)

*Клавиши со стрелками могут перемещать фокус между кнопками A и B, а также C и D, но не между областями*

В этом примере кода продемонстрировано, как указать вложенные области направления, которые не поддерживают навигацию с помощью клавиш со стрелками через границы области.

```XAML
<StackPanel Orientation="Horizontal">
  <StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation="Enabled">
    <Button Content="A" />
    <Button Content="B" />
  </StackPanel>
  <StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation="Enabled">
    <Button Content="C" />
    <Button Content="D" />
  </StackPanel>
</StackPanel>
```

Ниже приведен более сложный пример вложенных направления областей, где:

-   Если фокус на кнопке А, можно перейти только к кнопке E (и наоборот), так как граница области без направления делает недостижимыми кнопки B, C и D с помощью клавиш со стрелками
-   Если фокус на кнопке B, перейти можно только к кнопке C (и наоборот), так как кнопка D находится за пределами области направления, а граница области без направления блокирует доступ к кнопкам A и E
-   Если фокус на кнопке D, необходимо использовать клавишу табуляции для перехода между элементами управления, так как навигация с помощью клавиш со стрелками невозможна

![вложенные области без направления](images/keyboard/nested-non-directional-area.png)

*Клавиши со стрелками могут перемещать фокус между кнопками A и Е, а также между B и C, но не между другими областями*

В этом примере кода продемонстрировано, как указать вложенные области направления, которые поддерживают сложную навигацию с помощью клавиш со стрелками через границы области.

```XAML
<StackPanel  Orientation="Horizontal" XYFocusKeyboardNavigation ="Enabled">
  <Button Content="A" />
    <StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation ="Disabled">
      <StackPanel Orientation="Horizontal" XYFocusKeyboardNavigation ="Enabled">
        <Button Content="B" />
        <Button Content="C" />
      </StackPanel>
        <Button Content="D" />
    </StackPanel>
  <Button Content="E" />
</StackPanel>
```

## <a name="set-the-tab-navigation-behavior-a-nametab-navigation"></a>Настройка навигации с использованием клавиши табуляции <a name="tab-navigation">

Свойство UIElement. [TabFocusNavigation](http://msdn.microsoft.com/en-us/library/windows/apps/xaml/Windows.UI.Xaml.Controls.Control.TabNavigation) определяет навигацию с использованием клавиши табуляции для всего дерева объектов (или области направления).

[TabFocusNavigation](http://msdn.microsoft.com/en-us/library/windows/apps/xaml/Windows.UI.Xaml.Controls.Control.TabNavigation) имеет значение типа **TabFocusNavigationMode** с возможными значениями **Once**, **Cycle****или Local** (по умолчанию).

На следующем рисунке, в зависимости от навигации по области направления с помощью клавиши табуляции, фокус перемещается одним из следующих способов:

-   Once: A, B1, C, A
-   Local: A, B1, B2, B3, B4, B5, C, A
-   Cycle: A, B1, B2, B3, B4, B5, B1, B2, B3, B4, B5 (циклично по кнопкам с буквой B)

![навигация с помощью клавиши табуляции](images/keyboard/tab-navigation.png)

*Поведение фокуса на основе режима навигации с помощью кнопки табуляции*

В следующем примере кода продемонстрировано использование TabFocusNavigation в режиме Once.

```XAML
<Button Content="X" Click="OnAClick"/>
<StackPanel Orientation="Horizontal" XYFocusNavigation ="Local"
   TabFocusNavigation ="Local">
   <Button Content="A" Click="OnAClick"/>
   <StackPanel Orientation="Horizontal" TabFocusNavigation ="Once">
        <Button Content="B" Click="OnBClick"/>
        <Button Content="C" Click="OnCClick"/>
        <Button Content="D" Click="OnDClick"/>
   </StackPanel>
   <Button Content="E" Click="OnBClick"/>
</StackPanel>
```

*Навигация с помощью клавиши табуляции при фокусе на X: A, B, E, X*

#### <a name="about-tabfocusnavigation-and-tabindex"></a>Сведения о TabFocusNavigation и TabIndex

Свойство UIElement.TabFocusNavigation имеет такое же поведение, как и свойство Control.TabNavigation, включая принцип работы с TabIndex.

Когда для элемента управления не указано TabIndex, платформа назначает ему значение индекса выше текущего наибольшего значения (и самый низкий приоритет). При выборе первого элемента визуального дерева устраняется неясность. Платформа выстраивает порядок перехода по клавише табуляции для каждой области. Дочерние элементы элемента управления считаются областью, и если у одного из них есть свои дочерние элементы, они считаются другой областью.

На следующем рисунке, в зависимости от навигации с помощью клавиши табуляции по области направления и порядку перехода между элементами по клавише табуляции фокус перемещается одним из следующих способов:

-   Once: A, B3, C, A.
-   Local: A, B3, B4, B5, B1, B2, C, A.
-   Cycle: A, B3, B4, B5, B1, B2, B3, B4, B5, B1, B2 (циклично по кнопкам с буквой B)

![порядок перехода по клавише табуляции](images/keyboard/tab-index.png)

*Поведение фокуса на основе режима навигации по клавише табуляции и порядок перехода по нажатию этой клавиши*

Обратите внимание, как область направления считается областью охвата и как фокус перемещается сначала на элемент управления с наивысшим приоритетом сначала: В3. На самом деле существует две области: одна для A, области направления, и C. И другая для области направления. Так как область направления— это не TabStop, платформа переключает область для поиска наилучшего варианта, а затем рекурсивно через все дочерние элементы.
