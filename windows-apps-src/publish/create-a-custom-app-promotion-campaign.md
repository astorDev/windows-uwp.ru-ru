---
author: shawjohn
Description: "Помимо создания рекламной кампании для вашего приложения, которая будет работать в приложениях для Windows, вы также можете продвигать свое приложение по другим каналам."
title: "Создание пользовательской кампании по продвижению приложения."
ms.assetid: 7C9BF73E-B811-4FC7-B1DD-4A0C2E17E95D
ms.author: johnshaw
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: "windows 10, uwp, пользовательский, приложение, продвижение, кампания"
ms.openlocfilehash: 1e56b1df4b5501ded5db799c3ad67f97c0e1cfcd
ms.sourcegitcommit: 909d859a0f11981a8d1beac0da35f779786a6889
translationtype: HT
---
# <a name="create-a-custom-app-promotion-campaign"></a>Создание пользовательской кампании по продвижению приложения.

Помимо создания [рекламной кампании для вашего приложения](create-an-ad-campaign-for-your-app.md), которая будет работать в приложениях для Windows, вы также можете продвигать свое приложение по другим каналам. Например, вы можете продвигать свое приложение, используя стороннего поставщика услуг по маркетингу приложений или публиковать ссылки на ваше приложение на сайтах социальных сетей. Эти действия называются *пользовательскими кампаниями*.

Если вы используете пользовательские кампании для вашего приложения, вы можете отслеживать относительную производительность каждой кампании, создав разные URL-адреса приложения Магазина Windows для каждой пользовательской кампании, где каждый URL-адрес содержит собственный идентификатор кампании. Когда пользователь Windows10 щелкает URL-адрес, содержащий идентификатор кампании, Майкрософт связывает это нажатие с соответствующей пользовательской кампанией и предоставляет вам эти данные.

Существует два основных типа данных, связанных с пользовательскими кампаниями: просмотры страниц вашего приложения и *конверсии*. Конверсия — это приобретение приложения, к которому привело нажатие пользователем страницы Магазина Windows для вашего приложения с URL-адресом, продвигаемым через пользовательскую кампанию. Дополнительные сведения о конверсиях см. в подразделе [Общие сведения о том, какие приобретения считаются конверсиями](#understanding-how-app-acquisitions-qualify-as-conversions) далее в этом разделе.

Вы можете получить данные об эффективности пользовательской кампании для вашего приложения следующими способами:

* Вы можете просматривать данные о представлениях и конверсиях страницы для вашего приложения или надстройки в [отчете о каналах и преобразованиях](channels-and-conversions-report.md) на панели мониторинга Центра разработки.
* Если ваше приложение является приложением универсальной платформы Windows (UWP), для него можно применять API в пакете Windows SDK, позволяющий программно получать идентификатор пользовательской кампании, которая привела к конверсии.

> **Важно!**&nbsp;&nbsp;Эти данные будут отслеживаться только для пользователей Windows 10. Пользователи, использующие другие операционные системы, могут по-прежнему переходить по ссылке на страницу с описанием вашего приложения, но данные об этих действиях пользователя не будут включены.

## <a name="example-custom-campaign-scenario"></a>Примерный сценарий пользовательской кампании

Представим разработчика игр, который только что создал новую игру и хотел бы продвигать ее среди пользователей своих текущих игр. Она публикует объявление о выходе новой игры на своей странице в Facebook и указывает ссылку на страницу Магазина Windows, где находится эта игра. Многие из пользователей, играющих в ее игры, также читают ее в Twitter, поэтому она также публикует объявление в Twitter, указывая ссылку на страницу Магазина Windows с игрой.

Чтобы отслеживать успех каждого из этих каналов продвижений, разработчик создает два варианта URL-адрес для страниц Магазина Windows с игрой.

* URL-адрес, опубликованный на ее странице в Facebook, включает идентификатор пользовательской кампании `my-facebook-campaign`.
* URL-адрес, который она публикует в Twitter, включает идентификатор пользовательской кампании `my-twitter-campaign`.

Ее читатели в Facebook и Twitter щелкают URL-ссылки, а Майкрософт отслеживает каждый щелчок и сопоставляет его с соответствующей пользовательской кампанией. Далее соответствующие приобретения игры и любые покупки надстроек сопоставляются с пользовательской кампанией и регистрируются как конверсии.

<span id="conversions" />
## <a name="understanding-how-app-acquisitions-qualify-as-conversions"></a>Общие сведения о том, какие приобретения считаются конверсиями

*Конверсия* — это приобретение приложения, к которому привело нажатие пользователем страницы Магазина Windows для вашего приложения с URL-адресом, продвигаемым через пользовательскую кампанию. Есть разные сценарии определения конверсии в [отчете о каналах и конверсиях](channels-and-conversions-report.md) на информационной панели Центра разработки и для [программного получения идентификатора кампании](#programmatically).

### <a name="qualifying-conversions-for-the-dashboard-report"></a>Правила подсчета конверсий для отчета информационной панели

Перечисленные ниже сценарии считаются конверсией в [отчете о каналах и конверсиях](channels-and-conversions-report.md).

* Пользователь *с актуальной учетной записью Майкрософт (или без нее)* щелкает URL-адрес приложения, содержащий идентификатор пользовательской кампании, и перенаправляется на страницу Магазина Windows для соответствующего приложения. Тот же пользователь приобретет приложение в течение 24 часов после первого щелчка URL-адреса Магазин Windows с идентификатором пользовательской кампании.

* Если клиент приобретает приложение на другом компьютере или устройстве, отличном от того, на котором он щелкнул URL-адрес Магазина Windows с идентификатором пользовательской кампании, конверсия будет учитываться, только если у клиента есть учетная запись Майкрософт.

> **Примечание.**&nbsp;&nbsp;Для приобретений приложения, которые считаются конверсиями в пользовательской кампании, все покупки надстроек из этого приложения также считаются конверсиями в этой же пользовательской кампании.

### <a name="qualifying-conversions-for-programmatically-retrieving-the-campaign-id"></a>Правила подсчета конверсий для программного получения идентификатора кампании

Чтобы установка считалась конверсией при программном получении идентификатора кампании, связанного с приложением, должны выполняться следующие условия:

* На устройстве под управлением **Windows 10 версии 1607 или выше**: клиент *с актуальной учетной записью Майкрософт или без таковой* щелкает URL-адрес приложения, содержащий идентификатор пользовательской кампании, с дальнейшим перенаправлением на страницу магазина Windows для вашего приложения. Пользователь приобретает приложение во время просмотра страницы Магазина Windows после щелчка URL-адреса.

* На устройстве под управлением **Windows 10 версии 1511 или более ранней**: клиент *с актуальной учетной записью Майкрософт или без таковой* щелкает URL-адрес приложения, содержащий идентификатор пользовательской кампании, и перенаправляется на страницу магазина Windows для вашего приложения. Пользователь приобретает приложение во время просмотра страницы Магазина Windows после щелчка URL-адреса. В этих версиях Windows 10 пользователю необходимо иметь актуальную учетную запись Майкрософт для приобретения, чтобы установка считалась конверсией при программном получении идентификатора кампании.

>**Примечание.**&nbsp;&nbsp;Если пользователь покидает страницу и затем возвращается на нее (на том же компьютере или устройстве или на другом компьютере или устройстве, если они имеют учетную запись Майкрософт) в течение 24 часов и приобретает приложение, это считается конверсией в [отчете "Каналы и конверсии"](channels-and-conversions-report.md). Однако это не будет считаться конверсией при программном получении идентификатора кампании.

## <a name="embed-a-custom-campaign-id-to-your-apps-windows-store-page-url"></a>Встраивание идентификатора пользовательской кампании в URL-адрес страницы Магазина Windows с вашим приложением

Чтобы создать URL-адрес страницы Магазина Windows для вашего приложения с идентификатором пользовательской кампании, выполните следующие действия:

1.  Создайте строку идентификатора для вашей пользовательской кампании. Эта строка может содержать до 100 символов, хотя мы рекомендуем определять короткие идентификаторы кампании, которые легко распознать.

  >**Примечание.**&nbsp;&nbsp;Строка с идентификатором кампании может быть видна другим разработчикам в отчете "Каналы и конверсии". Это может произойти, когда пользователь щелкает ваш идентификатор кампании для входа в Магазин, но в результате покупает приложение другого разработчика в ходе того же сеанса. Несмотря на то что в этом случае имя идентификатора вашей кампании может быть видно другому разработчику, он увидит только, сколько конверсий их собственного приложения произошло после нажатия идентификатора вашей кампании. Они не увидят никаких данных о том, сколько пользователей приобрели ваше приложение, нажав идентификатор кампании.

2.  Получите URL-адрес страницы приложения в Магазине Windows в формате HTML или протокола.

    * Используйте формат HTTP, если необходимо, чтобы пользователь переходил на страницу приложения в Магазине Windows с помощью браузера (если установлено приложение Магазина Windows, этот URL-адрес также открывает в Магазине Windows страницу с описанием вашего приложения). Этот URL-адрес имеет формат **`https://www.microsoft.com/store/apps/*your app name*/*your app ID*`**. Например, URL-адрес HTTP для Skype— `https://www.microsoft.com/store/apps/skype/9wzdncrfj364`. URL-адрес в формате HTML доступен на странице [**Удостоверение приложения** информационной панели Центра разработки](link-to-your-app.md). Обратите внимание, что URL-адреса в формате HTTP можно использовать для перехода в Магазин Windows с помощью браузера на компьютерах и планшетах под управлением Windows7 и более поздних версий и на телефонах под управлением WindowsPhone 8 и более поздних версий.

    * Используйте формат протокола, если вы продвигаете свое приложение из других приложений для Windows, работающих на устройстве или компьютере с установленным приложением Магазина Windows, и хотите, чтобы пользователи открывали страницу вашего приложения в приложении магазина Windows. Этот URL-адрес имеет формат **`ms-windows-store://pdp/?PRODUCTID=*your app id*`**. Например, URL-адрес протокола в Skype— `ms-windows-store://pdp/?PRODUCTID=9wzdncrfj364`.

3.  Добавляйте следующую строку в конец URL-адреса для вашего приложения:

    * Для URL-адреса в формате HTTP добавьте строку **`?cid=*my custom campaign ID*`**. Например, если Skype предоставляет идентификатор кампании со значением **custom\_campaign**, новый URL-адрес в формате HTTP, включая идентификатор кампании, будет следующим: `https://www.microsoft.com/store/apps/skype/9wzdncrfj364?cid=custom\_campaign`.

    * Для URL-адресов в формате протокола добавьте строку **`&cid=*my custom campaign ID*`**. Например, если Skype предоставляет идентификатор кампании со значением **custom\_campaign**, новый URL-адрес в формате протокола, включая идентификатор кампании, будет следующим: `ms-windows-store://pdp/?PRODUCTID=9wzdncrfj364&cid=custom\_campaign`.

<span id="programmatically" />
## <a name="programmatically-retrieve-the-custom-campaign-id-for-an-app"></a>Программное получение идентификатора пользовательской кампании для приложения

Если ваше приложение является приложением UWP, вы можете программно получить идентификатор пользовательской кампании, связанный с вашим приложением, используя API в пакете Windows SDK. Эти API позволяют использовать многие сценарии аналитики и монетизации. Например, вы можете узнать, получил ли текущий пользователь ваше приложение, найдя его через кампанию в Facebook, а затем настроить соответствующим образом взаимодействие с пользователем в своем приложении. Кроме того, если вы используете стороннего поставщика услуг маркетинга приложений, вы можете предоставить ему эти данные.

Эти API возвратят строку идентификатора кампании, только если пользователь щелкнет ваш URL-адрес со встроенным идентификатором кампании, будет перенаправлен на страницу Магазина Windows для вашего приложения, а затем приобретет ваше приложение, не закрывая этой страницы. Если пользователь покидает страницу, а позже возвращается на нее и приобретает приложение, это не будет [считаться конверсией](#conversions) при использовании API.

Вы можете использовать разные API в зависимости от версии Windows 10, для которой предназначено ваше приложение:

* Windows 10 версии 1607 или выше: используйте класс [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) в пространстве имен **Windows.Services.Store**. При использовании этого API вы можете получить идентификаторы пользовательской кампании для любых [соответствующих приобретений](#conversions) независимо от наличия у пользователя актуальной учетной записи Майкрософт.
* Windows 10 версии 1511 или более ранних версий: используйте класс [**CurrentApp**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.currentapp.aspx) в пространстве имен **Windows.ApplicationModel.Store**. При использовании этого API вы можете получить идентификаторы пользовательской кампании для [соответствующих приобретений](#conversions) только при наличии у пользователя актуальной учетной записи Майкрософт.

>**Примечание.**&nbsp;&nbsp;Хотя пространство имен **Windows.ApplicationModel.Store** доступно во всех версиях Windows10, рекомендуется использовать API в пространстве имен **Windows.Services.Store**, если ваше приложение предназначено для Windows10 версии 1607 или выше. Дополнительные сведения о различиях между этими пространствами имен см. в разделе [Покупки из приложения и пробные версии](../monetize/in-app-purchases-and-trials.md#choose-namespace). В следующем примере кода показано, как структурировать код для использования обоих API в одном проекте.

### <a name="code-example"></a>Пример кода

В следующем примере кода показано, как получить идентификатор пользовательской кампании. В этом примере используются оба набора API в пространствах имен **Windows.Services.Store** и **Windows.ApplicationModel.Store**, используя [адаптивный код версии](../debug-test-perf/version-adaptive-code.md). При выполнении описанного далее процесса ваш код может выполняться в Windows10 любой версии. Чтобы использовать этот код, целевая версия ОС вашего проекта должна быть **Windows10 Anniversary Edition (10.0; сборка 14394)** или более поздней версии, хотя минимальная версия ОС может быть более ранней.

``` csharp
// This example assumes the code file has using statements for
// System.Linq, System.Threading.Tasks, Windows.Data.Json,
// and Windows.Services.Store.
public async Task<string> GetCampaignId()
{
    // Use APIs in the Windows.Services.Store namespace if they are available
    // (the app is running on a device with Windows 10, version 1607, or later).
    if (Windows.Foundation.Metadata.ApiInformation.IsTypePresent(
         "Windows.Services.Store.StoreContext"))
    {
        StoreContext context = StoreContext.GetDefault();

        // Try to get the campaign ID for users with a recognized Microsoft account.
        StoreProductResult result = await context.GetStoreProductForCurrentAppAsync();
        if (result.Product != null)
        {
            StoreSku sku = result.Product.Skus.FirstOrDefault(s => s.IsInUserCollection);

            if (sku != null)
            {
                return sku.CollectionData.CampaignId;
            }
        }

        // Try to get the campaign ID from the license data for users without a
        // recognized Microsoft account.
        StoreAppLicense license = await context.GetAppLicenseAsync();
        JsonObject json = JsonObject.Parse(license.ExtendedJsonData);
        if (json.ContainsKey("customPolicyField1"))
        {
            return json["customPolicyField1"].GetString();
        }

        // No campaign ID was found.
        return String.Empty;
    }
    // Fall back to using APIs in the Windows.ApplicationModel.Store namespace instead
    // (the app is running on a device with Windows 10, version 1577, or earlier).
    else
    {
#if DEBUG
        return await Windows.ApplicationModel.Store.CurrentAppSimulator.GetAppPurchaseCampaignIdAsync();
#else
        return await Windows.ApplicationModel.Store.CurrentApp.GetAppPurchaseCampaignIdAsync() ;
#endif
    }
}
```

Этот код выполняет указанные ниже функции.

1. Во-первых, он проверяет, доступен ли класс [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) в пространстве имен **Windows.Services.Store** на текущем устройстве (это означает, что устройство работает под управлением Windows 10 версии 1607 или выше). Если это так, код использует данный класс.

2. Затем он пытается получить идентификатор пользовательской кампании для случая, когда у текущего пользователя есть актуальная учетная запись Майкрософт. Для этого код получает объект [**StoreSku**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreSku), представляющий текущий SKU приложения, а затем получает доступ к свойству [**CampaignId**](https://docs.microsoft.com/uwp/api/windows.services.store.storecollectiondata#Windows_Services_Store_StoreCollectionData_CampaignId), чтобы получить идентификатор кампании, если он доступен.

2. Код пытается получить идентификатор кампании для случая, когда у текущего пользователя нет актуальной учетной записи Майкрософт. В этом случае идентификатор кампании внедрен в лицензию приложения. Код извлекает лицензию с помощью метода [**GetAppLicenseAsync**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext#Windows_Services_Store_StoreContext_GetAppLicenseAsync) и затем анализирует содержимое JSON лицензии, чтобы получить значение ключа с именем *customPolicyField1*. Это значение содержит идентификатор кампании.

3. Если класс [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) в пространстве имен **Windows.Services.Store** недоступен, код возвращается к использованию метода [**GetAppPurchaseCampaignIdAsync**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.currentapp.getapppurchasecampaignidasync.aspx) в пространстве имен **Windows.ApplicationModel.Store** для получения идентификатора пользовательской кампании (это пространство имен доступно во всех версиях Windows 10, включая 1511 и более ранние). Обратите внимание, что при использовании этого метода вы можете получить идентификаторы пользовательских кампаний для [соответствующих приобретений](#conversions) только при наличии у пользователя актуальной учетной записи Майкрософт.

  >**Примечание.**&nbsp;&nbsp;**Пространство имен Windows.ApplicationModel.Store** содержит [**CurrentAppSimulator**](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentappsimulator), специальный класс, имитирующий операции Магазина для тестирования кода перед отправкой приложения в Магазин. Этот класс получает данные из [локального файла с именем Windows.StoreProxy.xml](../monetize/in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md#using-the-windowsstoreproxyxml-file-with-currentappsimulator). В предыдущем примере кода показано, как включить использование **CurrentApp** и **CurrentAppSimulator** в отладку и не отлаживать код в проекте. Чтобы проверить этот код в среде отладки, добавьте элемент **AppPurchaseCampaignId** в файл WindowsStoreProxy.xml на компьютере разработчика, как показано в следующем примере. При запуске приложения метод [**GetAppPurchaseCampaignIdAsync**](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentappsimulator#Windows_ApplicationModel_Store_CurrentAppSimulator_GetAppPurchaseCampaignIdAsync) всегда будет возвращать это значение.

  ``` xml
  <CurrentApp>
      ...
      <AppPurchaseCampaignId>your custom campaign ID</AppPurchaseCampaignId>
  </CurrentApp>
  ```

  >**Примечание.**&nbsp;&nbsp;Пространство имен **Windows.Services.Store** не предоставляет класс, который можно использовать для имитации лицензионных сведений во время тестирования. Вместо этого необходимо опубликовать приложение в Магазине и скачать его на свое устройство разработки, чтобы использовать его лицензию для тестирования. Подробнее см. в разделе [Покупки из приложения и пробные версии](../monetize/in-app-purchases-and-trials.md#testing).

## <a name="test-your-custom-campaign"></a>Проверка вашей пользовательской кампании

Перед продвижением URL-адреса пользовательской кампании рекомендуем проверить пользовательскую кампанию, выполнив следующие действия:

1.  Выполните вход в свою учетную запись Майкрософт на компьютере или устройстве, используемом для проверки.
2.  Щелкните URL-адрес пользовательской кампании. Убедитесь, что Магазин Windows правильно загружает страницу вашего приложения, затем закройте приложение Магазина Windows или страницу браузера.
3.  Щелкните URL-адрес несколько раз, закрывая приложение Магазина Windows или страницу браузера после каждого посещения страницы вашего приложения. Во время одного из посещений страницы вашего приложения приобретите приложение для создания конверсии. Посчитайте общее количество щелчков URL-адреса.
4. Проверьте, появляются ли ожидаемые представления страницы и конверсии в [отчете "Каналы и конверсии"](channels-and-conversions-report.md), и протестируйте код вашего приложения, чтобы узнать, успешно ли он получает идентификатор кампании.
