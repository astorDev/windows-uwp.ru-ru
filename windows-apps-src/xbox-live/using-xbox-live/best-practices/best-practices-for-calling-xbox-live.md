---
title: Рекомендации по вызову Xbox Live
description: Дополнительные сведения о рекомендации по вызову API-интерфейсы Live Xbox.
ms.assetid: f4c7156b-7736-41e5-9b3d-e87cc8dd2531
ms.date: 04/04/2017
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10 для настольных ПК, xbox, советы и рекомендации
ms.localizationpriority: medium
ms.openlocfilehash: 55e05ef7de2e2981f9f5af86623a8d8413ce2c99
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57613709"
---
# <a name="best-practices-for-calling-xbox-live"></a>Рекомендации по вызову Xbox Live

Службы Xbox Live, которые могут вызываться из два основных способа: с помощью API службы Xbox (XSAPI) или прямой вызов конечные точки REST. Независимо от того, как код вызывает Xbox Live важно иметь правильное шаблонов вызова и логика повторных попыток.

Чтобы понять, как для записи правильной повторной логики, необходимо знать о двух типах конечных точек REST - **идемпотентными** и **неидемпотентные**. Мы обсудим каждый из них ниже
 
## <a name="non-idempotent-endpoints"></a>Конечные точки не идемпотентными

Методы HTTP, которые имеют побочные эффекты при повторять вызовы, считаются **неидемпотентные**. Это означает, что если истекает время ожидания сети клиента были для вызова конечной точки, это не безопасно повторить попытку метод, так как ресурс были обновлены, но сети не смог уведомить вызывающий объект, что она выполнена успешно. При возникновении ошибки, а не повторять клиент должен сначала запрос, чтобы увидеть, если вызов был успешным. Только в том случае, если вызов не был успешным затем следует его повторить.

В API службы Xbox некоторые интерфейсы API, внутренне помечаются как вызов конечных точек не являющихся идемпотентными. Это означает, что при возникновении сбоя при вызове этих конечных точек API-интерфейсы не повторяет автоматическое конечной точки.

Полный список интерфейсов API, не являющихся идемпотентными являются:

* game\_server\_platform\_service::allocate\_cluster()
<br>
* игры\_server\_платформы\_service::allocate\_кластера\_inline()
<br>
* игры\_server\_платформы\_service::allocate\_сеанса\_узел()
<br>
* matchmaking\_service::create\_match\_ticket()
<br>
* многопользовательские\_service::write\_session()
<br>
* многопользовательские\_service::write\_сеанса\_по\_handle()
<br>
* multiplayer\_service::send\_invites()
<br>
* reputation\_service::submit\_batch\_reputation\_feedback()
<br>
* reputation\_service::submit\_reputation\_feedback()
 

## <a name="idempotent-methods"></a>Методы идемпотентными

**Идемпотентными** методов HTTP с другой стороны не оставляйте побочные эффекты. В свою очередь, это означает, что они безопасны для повтора. В API службы Xbox все методы идемпотентными повторная автоматическая попытка добавления при определенных условиях.

Полный список идемпотентными API-интерфейсы являются все API-интерфейсы, не перечисленные выше, не являющихся идемпотентными.


## <a name="retry-logic-best-practices"></a>Рекомендации по логику повторных попыток

Для вызовов идемпотентными эти условия должны быть повторная автоматическая попытка добавления:

* Все сетевые ошибки
* 401: Недостаточно прав
* 408: requestTimeout
* 429: Слишком много запросов
* 500: Внутренняя ошибка
* 502: Неверный шлюз
* 503: ServiceUnavailable
* 504: GatewayTimeout


На UWP, 401: Нет доступа — специальной обработки приложением. Это означает, что маркер проверки подлинности Xbox Live срок действия истек, поэтому API службы Xbox вызовы ОС, чтобы обновить токен и затем выполняет как одна попытка повтора.

Когда выполняется повторная попытка, рекомендуется не вызвать службу, пока не будет достигнуто время заголовок «Retry-After». XSAPI теперь реализует этой рекомендации. Если для любого API был возвращен код ошибки HTTP и заголовок «Retry-After», дополнительные вызовы к этому же API, до времени Retry-After немедленно возвращаются с исходную ошибку без обращения в службу.

При повторе вызов, рекомендуется проводить стратегию экспоненциальной отсрочки с случайных дрожание распределить нагрузку на службу. XSAPI начинается с задержки по умолчанию для 2 секунды, который контролируется с помощью xbox\_live\_контекст\_settings::set\_http\_повторите\_delay(). Это означает по умолчанию каждого повтора делает экспоненциальная 2, 4, 8, секунд и т.д. и его jitters задержку между текущему и следующему отсрочки значение на основе времени отклика для дальнейшего распределения out нагрузки во множестве устройств, попытки повтора.

Заголовки должны находиться в элемент управления, как долго тратить повторная попытка вызова. С помощью XSAPI, разработчики имеют прямое управление с помощью функции xbox\_live\_контекст\_settings::set\_http\_время ожидания\_window(). По умолчанию это имеет значение 20 секунд. Установка значения 0 секунд эффективно отключает логику повторных попыток. XSAPI теперь автоматически меняет внутренней таймаут HTTP, на сколько времени левой остается равным в http основе\_время ожидания\_window(). Внутреннего контроля времени ожидания HTTP сколько операционная система тратит выполнения сетевой операции HTTP, до ее прерывания. Вызов не нужно повторять, если только не остается менее 5 секунд в http\_время ожидания\_window(), чтобы предоставить достаточно времени для завершения вызова. Это правило не применяется в первый вызов, поэтому задание http\_время ожидания\_window() 0 приемлемо и приведет к за один вызов. Эта логика действует так, http\_время ожидания\_window() является гораздо более детерминированным, если вызов API будет возвращен. Если был возвращен заголовок «Retry-After», не reties будут выполняться до, после достижения времени «Retry-After». Если время «Retry-After» после http\_время ожидания\_window(), после чего вызывается возврата в конце http\_время ожидания\_window().


## <a name="error-handling"></a>Обработка ошибок

Заголовок разработчики должны **всегда** использовать правильной обработки ошибок для **каждые** вызов службы, нужно убедиться, что они правильная обработка неудачных ответов.
 
Существует много реальных условий, которые могут привести запрос к Xbox Live для возврата коды ошибок, таких как

1.  Сеть недоступна. Например устройство потеряло 4G, потеряно Wi-Fi или сети, вышли из строя.
2.  Слишком большой нагрузки на службы нагрузке (503)
3.  Произошел сбой в службе (500)
4.  Слишком много запросов там, где отправляются в службу (429)
5.  Конфликт операции (412) записи. Например другой проигрыватель в многопользовательской сначала отправленные изменения
6.  Пользователь, запрещенным или не имеет разрешения
7.  Пользователь автоматический масштабирование

Обработчик ошибок важно убедиться, что игра работает правильно, в этих условиях.

XSAPI имеет два типа шаблонов обработки ошибок. Одним из шаблонов, при использовании API-интерфейсы WinRT из C + +/ CX, C\#, или Javascript и еще один шаблон, при использовании новых интерфейсов API C++. Все сведения об оптимальных методах обработки ошибок см. на странице doc Xbox Live, «Обработка ошибок», видео, который охватывает это, см. в статье речь в [ *видео 2015 Xfest* ](https://developer.xboxlive.com/en-us/platform/documentlibrary/events/Pages/Xfest2015.aspx) вызывается *XSAPI: C++, исключения не!*


## <a name="best-calling-patterns"></a>Лучшие шаблоны вызывающего

### <a name="usebatching-requests"></a>Использование пакетной обработки запросов

Некоторые конечные точки поддерживают пакетной обработки или объединения набора запросов в один вызов. Например в службе Xbox Live профиля вы можете запросить профиль для одного пользователя или набор профилей пользователей. Поэтому если вам требуется набор пользователей профили пользователей, было бы крайне неэффективным для вызова конечной точки или API, один за раз для каждого профиля пользователя. Каждый вызов добавляет массу системных издержек проверки подлинности. Поэтому вместо этого передайте всех пользователей, необходимо, сведения о за один раз для API, конечная точка может обработать все профили пользователей в то же время и вернуть один ответ.

### <a name="use-the-real-time-activity-rta-service-instead-of-polling"></a>Использовать службу реальном времени действия возврата вместо опроса

Другой отличной рекомендацией является используйте вместо этого периодически опрашивает службу реальном времени действия возврата. Эта служба предоставляет подключение websocket, которое отправляет уведомление клиентам при изменении целевых ресурсов в службе. Служба возврата предоставляет уведомления о изменениях присутствия, изменения статистики, изменения документа многопользовательской и изменений в социальных сетях связи. Знать, какова интересуют сведения клиента, клиент должен сначала подписаться на элемент через websocket. Это позволяет избежать опроса служба обнаружения изменений, поскольку сообщат точно в том случае, когда изменяется элемент.

XSAPI предоставляет интерфейсы API, которые клиенты могут использовать подписаться возврата службы как набор. Каждый из этих API имеют соответствующие \* \_изменить\_обработчик API-интерфейсы, работающему в функции обратного вызова, который будет вызываться при изменении элемента.

* наличие\_service::subscribe\_для\_устройства\_присутствия\_изменить
<br>
* наличие\_service::subscribe\_для\_title\_присутствия\_изменить
<br>
* пользователь\_статистики\_service::subscribe\_для\_статистики\_изменить
<br>
* Социальные\_service::subscribe\_для\_социальных сетей\_связь\_изменить<br>
 

## <a name="use-xbox-live-client-side-managers"></a>Использовать Xbox Live диспетчеры на стороне клиента

Новое в XSAPI теперь у нас есть набор диспетчеров, которые действуют как кэш и состояние машины, которые выполняют все большим количеством поднятия для определенных сценариев.


### <a name="social-manager"></a>Диспетчер социальные сети

Социальные сети выполняет всю тяжелую вокруг списки друзей и профили. Он сохранит ваши друзья список, их профили и их данные о присутствии в актуальном состоянии с помощью службы возврата. Диспетчер предоставляет синхронных API, который является очень игрового ядра понятное. Его интерфейсы API можно вызвать игры часто, как он поддерживает кэш в памяти актуальная информация от службы. Дополнительные сведения см. на Xbox Live странице документации «Introduction to социальных сетей Manager»

### <a name="multiplayer-manager"></a>Диспетчер многопользовательского режима

Для управления многопользовательской многопользовательскую Manager — это высокопроизводительное решение для традиционных многопользовательских игр. API диспетчера многопользовательскую включает проигрывателя списка и управления сеансами, обрабатывает игр приглашения, соединение выполняется, подбор игроков и подключается к существующего решения по сети. Он выполняет всю тяжелую, связанных с реализацией традиционной многопользовательские потоков. Дополнительные сведения см. в разделе «Introduction to многопользовательскую Manager» страницы документации Xbox Live


## <a name="throttling-fine-grained-rate-limiting"></a>Регулирование (ограничение нормально точные скорости)

Службы Xbox Live имеют регулирование для предотвращения ситуаций любой одного устройства из размещение чрезмерной нагрузки на службу. Важно знать, когда был отрегулирован название. Чтобы узнать, если название был отрегулирован несколькими способами:


### <a name="monitor-for-http-status-code-429"></a>Монитор для кода состояния HTTP 429

Можно использовать приложение Fiddler и посмотреть, если возвращается код состояния HTTP 429. Ответ JSON, будет содержать подробные сведения о том, как был отрегулирован конечной точки. Например:

```json
{
  "version":1,
  "currentRequests":13,
  "maxRequests":10,
  "periodInSeconds":120,
  "limitType":"Rate"
}
```

Если вы используете XSAPI, интерфейсы API возвращают http\_состояние\_429\_слишком\_многих\_запрашивает ошибки и задать сообщение об ошибке, быть подробные сведения о том, как был отрегулирован API.

### <a name="debug-asserts"></a>Отладка утверждений

При использовании XSAPI, в том случае, если вызов регулируется в изолированной среде разработки, и его с помощью отладочной сборки заголовка, будет утверждать для немедленно сообщите ему о том, что произошла регулирования. Это позволяет избежать случайного отсутствует ошибки 429 регулирования из-за неправильно написанный код. Если вы хотите отключить эти утверждения, чтобы продолжить работу без исправления фрагменты кода, можно вызывать этот API:


> xboxLiveContext -&gt;settings() -&gt;отключить\_утверждает\_для\_xbox\_live\_регулирования\_в\_разработки\_ "песочница" (xbox\_live\_контекст\_регулирования\_setting::this\_кода\_должен\_для\_быть\_изменить\_для\_избежать\_регулирования);

но Обратите внимание, что этот API не помешает название из регулируется. Название по-прежнему будут регулироваться. Это просто отключает утверждения в "песочницах" разработки при использовании отладочную сборку. 

### <a name="xbox-live-trace-analyzer-tool"></a>Xbox Live трассировки анализатор

Другой вариант — записать трассировку вызовов Xbox Live, а затем анализировать этой трассировки с помощью [Xbox Live трассировки анализатор.](https://docs.microsoft.com/windows/uwp/xbox-live/tools/analyze-service-calls)

Чтобы записать трассировку, можно либо использовать Fiddler для записи. Файл SAZ или с помощью встроенных событий из XSAPI. Дополнительные сведения о том, как использовать Включение трассировки в XSAPI см. в разделе «Анализ вызовы к службам Live Xbox» страница документации по Xbox Live. Получив трассировки, Xbox Live трассировки анализаторе средство выдаст предупреждение при обнаружении регулирование вызовов.

## <a name="is-xbox-live-up"></a>Xbox Live?

Xbox Live — это совокупность микрослужб, которые предоставляют функции, Xbox Live, такие как профиль, друзей и присутствия, статистики, списки лидеров, достижения, многопользовательской и подбор игроков. Нет одного сервера или конечной точки, который определяет, если запущена Xbox Live. Если один сервер выйдет из строя, во многом зависят от остальная часть микрослужб Xbox Live и будет работать.

При временном сбое одной службы, важно знать, если этот вызов службы является критически важным для игры. Попробуйте предоставить достаточную степень удобства работы, несмотря на наличие периодически возникающие сетевые или проблемы со службой. К примеру Если наличие служб возвращает ошибки, вызов, скорее всего, не является критически важна для игры. Поэтому просто сообщит пользователю последние известные наличие вместо reporting, Xbox Live не работает.

Модель согласованности итоговой согласованности следует также Xbox Live. Это означает, что если выполняются нет новых обновлений, что со временем все запросы для этого ресурса будет отображать последнее значение обновленный. По сути, это означает, что распространяет короткий период, местоположения информации, устаревших данных.
