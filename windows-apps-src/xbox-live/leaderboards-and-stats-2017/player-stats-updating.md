---
title: Обновление статистики 2017
description: Сведения об обновлении статистики Xbox Live player с помощью Stats 2017.
ms.assetid: 019723e9-4c36-4059-9377-4a191c8b8775
ms.date: 08/24/2018
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10, xbox, один, проигрыватель статистики, Статистика 2017 г.
ms.localizationpriority: medium
ms.openlocfilehash: d5b37c008e6aa719b641321c5e5a1c3360b20786
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57631829"
---
# <a name="updating-stats-2017"></a>Обновление статистики 2017

Обновление статистики, отправляя последнее значение для Xbox Live службы с помощью `StatsManager` интерфейсы API, который будет рассмотрен ниже.

Само название для отслеживания статистики проигрывателя, и вызывать `StatsManager` обновить их соответствующим образом.  `StatsManager` будет буфер все изменения и очистить их к службе периодически.  Название можно также вручную очистить.

> [!NOTE]
> Слишком часто не выполнить сброс статистики.  В противном случае заголовок вашей будет ограничена.  Мы рекомендуем записать не более одного раза каждые 5 минут.

### <a name="multiple-devices"></a>Несколько устройств

Это возможно для проигрывателя для воспроизведения название на нескольких устройствах.  В этом случае необходимо приложить определенные усилия для синхронизации действий.

Например, если игрок есть 15 headshots на игровой приставке Xbox дома.  Позже они получили 10 дополнительные headshots на игровой приставке Xbox дома с друзьями.  Необходимо отправить на втором stat значение 25.  Но вам придется нет возможности узнать об этом без каким-либо образом синхронизации эти сведения.

Это можно сделать несколькими способами:

1. Store их с помощью [подключенные хранилища](../storage-platform/connected-storage/connected-storage-technical-overview.md).  Обычно используется подключение хранилища для каждого пользователя сохранять данные.  Эти данные постоянно синхронизируются на различных устройствах для данного пользователя.
2. Используйте веб-службы для поддержания статистики синхронизации, если вы еще не создан для выполнения задач auxillary названия.

### <a name="offline"></a>Вне сети

Как упоминалось выше, название отвечает для отслеживания статистики проигрывателя и, следовательно, responsbile поддерживали автономные сценарии. 

### <a name="examples"></a>Примеры

Мы рассмотрим пример, чтобы связать эти концепции вместе.

Распространенные stat в гоночную игру — Знакомство с функциями времени.  Обычно меньше, тем лучше для эти статистические данные.  Поэтому необходимо создать stat и связанного списка лидеров, где снизить лучше.  Другими словами это "список лидеров" будут отсортированы в порядке возрастания.

Название будет хранить список раз lap пользователя во время сеанса воспроизведения.  Статистика Manager обновит только в том случае, если у него есть время lap, ниже, чем предыдущие бесперебойно.

Вы можете отслеживать бесперебойно предыдущих в один из следующих способов:
1. От сохранения файлов с помощью подключения хранилища.
2. Собственные веб-службы.

Служба будет заменять значение stat независимо от того, что.  Поэтому даже если пришлось обновлять со временем lap, больше, чем предыдущие максимуме, затем бесперебойно предыдущих будут перезаписаны.

Поэтому убедитесь в заголовок вашей, что только отправке соответствующими значениями stat зависимости от сценария игровой процесс.  В некоторых случаях более низкие значения, возможно, лучше, в других выше может быть лучше, или что-то другое полностью.

## <a name="programming-guide"></a>Руководство по программированию

Обычно является последовательность по использованию статистики:

1. Инициализировать `StatsManager` API, передавая локального пользователя.
1. Как пользователь играет через название, обновить stat значения, с помощью `set_stat` функции.
1. Эти обновления stat будет периодически записаны на диск и запись Xbox Live.  Можно также сделать это вручную.

### <a name="initialization"></a>Инициализация

Вы вызываете `StatsManager` с локального пользователя для инициализации API введите необходимые сведения.

Пример см. ниже

```cpp
std::shared_ptr<stats_manager> statsManager = stats_manager::get_singleton_instance();
statsManager->add_local_user(user);
statsManager->do_work();  // returns stat_event_type::local_user_added
```

```csharp
Microsoft.Xbox.Services.Statistics.Manager.StatisticManager statManager = StatisticManager.SingletonInstance;
statManager.AddLocalUser(user);
statEvent = statManager.DoWork();
```

### <a name="writing-stats"></a>Создание статистики

Запись статистики с помощью `stats_manager::set_stat` семейству функций.  Существует три варианта этой функции для каждого типа данных:

* `set_stat_number` для значений с плавающей запятой.
* `set_stat_integer` для целых чисел.
* `set_stat_string` для строк.

При вызове этих stat обновления кэшируются локально на устройстве.  Периодически они будут сброшены Xbox Live.

Вы можете вручную очистить stats через `stats_manager::request_flush_to_service` API.  Обратите внимание на то, что если вы вызываете эту функцию слишком часто, вы будете ограничена частота.  Это не означает, что stat никогда не будет обновлено.  Это просто означает, что обновление будет происходить истечения времени ожидания.

```cpp
statsManager->set_stat_integer(user, L"numHeadshots", 20);
statsManager->request_flush_to_service(user); // requests flush to service, performs a do_work
statsManager->do_work();  // applies the stat changes, returns stat_update_complete after flush to service
```

```csharp
statManager.SetStatisticIntegerData(user, statName, (long)statValue);
statManager.RequestFlushToService(user);
statManager.DoWork();
```

#### <a name="example"></a>Пример

Предположим, что у вас есть кораблей первого лица.  Во время совпадение, могут накапливаться следующие статистики:

| Имя статистики | Формат |
|-----------|--------|
| Лучшие Kills за раунд | целое число |
| Время существования Kills | целое число |
| Время существования смерти | целое число |
| Время существования Kill/смерти отношение | Номер |

Как игрок проходит совпадение, вы увеличивает *приводит к завершению каждого Round*, *завершает время существования* и *время существования смерти* локально.

В конце совпадения выполните следующее:
1. Сравните, приводит к завершению, как в функции round, с предыдущей бесперебойно.  Если значение больше, обновите `StatsManager`.
2. Обновления с новыми значениями их приводит к завершению время жизни и смерти и `StatsManager`.
3. Расчета Kills/смерть и обновления `StatsManager`

Обратите внимание на то, что 1 и 2, необходимо знать их предыдущие значения stat.  В разделах выше рекомендации о получении их.

Любой из эти статистические данные могут быть связаны с списка лидеров, в котором будет рассказано в следующей статье.

### <a name="flushing-stats"></a>Сброс статистики

Можно вручную очистить статистику с помощью `stats_manager::request_flush_to_service`.  Вы можете это сделать, если требуется отобразить список лидеров.

Например, если имеется список лидеров для `Lifetime Kills` в приведенном выше примере, следует убедиться, что stat обновлений, соответствующий этой stat было записано на сервере перед отображением списка лидеров.  Таким образом, списки лидеров отражает ход выполнения последней игрока.

### <a name="cleanup"></a>Очистка
При закрытии заголовок, удалите пользователя из диспетчера stats. В результате будут удалены последние stat значения к службе.

```cpp
statsManager->remove_local_user(user);
statsManager->do_work();  // applies the stat changes, returns local_user_removed after flush to service
```

```csharp
statManager.RemoveLocalUser(user);
statManager.DoWork();
```
