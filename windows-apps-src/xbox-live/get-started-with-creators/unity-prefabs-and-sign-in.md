---
title: XBL в Unity Prefabs и входа в систему
description: Рассматриваются prefabs социальных сетей и примеры сценариев для социальные сервисы в Xbox Live
ms.date: 01/24/2018
ms.topic: get-started-article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10, xbox, один, unity
ms.openlocfilehash: a893858dac11fa848c2601df2c1bd6292b72ac6d
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57660039"
---
# <a name="unity-prefabs-and-scripted-sign-in"></a>Unity Prefabs и сценариев входа в систему

В этой статье поможет выполнить добавление Xbox Live вход в проекты Unity. Существует два способа, можно добиться входа в систему, если вы скачали [подключаемый модуль Unity Live Xbox](https://github.com/Microsoft/xbox-live-unity-plugin). Можно использовать prefabs, содержащихся в подключаемый модуль или использовать скрипты и включенным библиотекам для сценария Xbox Live войти в свои собственные пользовательские объекты Gameobject.

> [!IMPORTANT]
> Эта статья относится к версии подключаемого модуля до обновления, внесенного в мае 2018 года (выпуска 1804). Если вы установили Xbox Live подключаемый модуль после указанного периода, или еще не загружен возможно более новой версии, как вход выполняется существенно отличается. Помимо этого вы обнаружите, что снимки экрана в этот подключаемый модуль не совпадают с самой последней версии. Вместо этого обратитесь к [статьи для обновленных prefab входа в систему](playerauthentication-prefab-sign-in.md) производительны [статьи с подробным описанием обновленные методы для создания сценариев входа в систему](sign-in-manager.md).

## <a name="before-you-begin"></a>Перед началом работы

Прежде чем вы приступите к добавлению Xbox Live социальные сервисы игру Unity существуют приведены действия, которые необходимо завершить перед погружением в тему. Во-первых, убедитесь, что вы скачали и интегрированных [подключаемый модуль Xbox Live Unity](https://github.com/Microsoft/xbox-live-unity-plugin). Во-вторых, вы непременно захотите иметь заголовок вашей защищены и опубликованным с помощью [Центр разработчиков Microsoft](https://developer.microsoft.com/en-us/games/uwp). Чтение [создать новый заголовок Xbox Live Creators Program](../get-started-with-creators/create-and-test-a-new-creators-title.md) инструкции по публикации название.
Наконец, считывание [Настройка Xbox Live в Unity](../get-started-with-creators/configure-xbox-live-in-unity.md) Unity среда настроена правильно, и настроить название для использования службы Xbox Live. После правильной настройки проекта Unity, это время на изучение средств, используемых в заголовок вашей Xbox Live включена, а также два основных способа, можно реализовать Xbox Live в Unity: prefabs и сценариев.

## <a name="prefabs"></a>Prefabs

Unity имеет тип prefab активов, который позволяет хранить объект GameObject, дополненный компоненты и свойства. Prefab действует как шаблон, из которого можно создать новые экземпляры объектов в сцене Unity.
[Дополнительные сведения о prefabs из веб-сайт Unity](https://unity3d.com/learn/tutorials/topics/interface-essentials/prefabs-concept-usage).

Подключаемый модуль Xbox Live Unity предоставляет несколько prefabs, которые можно использовать в проекте для применения функции Xbox Live. Prefabs, описанные в этой статье, позволит вам выполнить вход, [добавить поддержку нескольких пользователей](../get-started-with-creators/add-multi-user-support.md) заголовок, или Показать список друзей в Xbox Live знакового профилю. Можно найти эти и другие prefabs под **проекта** вкладку пути: **Ресурсы > Xbox Live > Prefabs**.

### <a name="the-userprofile-prefab"></a>UserProfile prefab

Первый и самый важный социальных сетей взята **UserProfile** prefab. **UserProfile** prefab имеет все необходимое, чтобы разрешить вход Xbox Live. Это очень важно, так как вы должны войти пользователь перед использованием службы Xbox Live. Prefab содержит кнопку входа и GameObject для представления в систему вошел в проигрывателе, их: тег игрока, Gamerpic и игровые достижения.

> [!NOTE]
> Чтобы использовать любой из других prefabs Xbox Live, необходимо включить **UserProfile** prefab или вызвать API входа вручную.

![UserProfile готового блока в разделе ресурсов и иерархии](../images/unity/unity-userprofile-views.png)

Если развернуть **UserProfile** prefab в **проекта** панели или в **иерархии** после после добавления в сцену, вы увидите, что **UserProfile**  готового блока содержит два объекты Gameobject внутри него. Первый объект **SignInPanel** , содержащее интерфейс кнопку входа. Второй объект — **ProfileInfo** оно будет содержать сведения о пользователе, когда в систему. **UserProfile** prefab — вы будете использовать его для представления информации для любого пользователя, Xbox Live, выполнившего вход локально для заголовка.

### <a name="the-xboxliveuser-prefab"></a>XboxLiveUser prefab

**UserProfile** prefab использует во-вторых, социальных сетей готового блока в его кода, вызываемого **XboxLiveUser**. Используйте этот готового блока не сразу становятся очевидными, так как он не должны быть добавлены к иерархии сцены, как просто могут создаваться в коде. **XboxLiveUser** не имеет визуального представления, он просто содержит сведения, относящиеся к пользователю Xbox Live. Необходимо будет экземпляр **XboxLiveUser** для каждого экземпляра **UserProfile**. Это важно, когда [Добавление поддержки нескольких пользователей](../get-started-with-creators/add-multi-user-support.md) для заголовка. В дополнение к информацией о пользователе после входа в систему этот prefab также является оболочкой для код, используемый для входа в систему пользователю Xbox Live.

## <a name="sign-in-with-the-userprofile-prefab"></a>Вход в систему с UserProfile prefab

Чтобы упростить некоторые задачи разработки существует prefabs подключаемый модуль Xbox Live Unity. Чтобы включить Xbox Live вход для своего проекта Unity, просто необходимо будет использовать **UserProfile** и **XboxLiveServices** prefabs вместе с Unity **EventSystem**.

Сначала перетащите **UserProfile** prefab сцены. В идеале **UserProfile** должны размещаться на экране начального меню вашего проекта.

![Перетащите userprofile иерархии](../images/unity/drag-userprofile.gif)

В дополнение к **UserProfile** готового блока, также необходимо будет убедитесь, что **XboxLiveServices** prefab присутствует по крайней мере сцены первого проекта.
**XboxLiveServices** prefab позволяет переключать ли определенные prefabs запишет данные для отладки. Это полезно для проверки на поведение prefab.

![Поиск xboxliveservices prefab](../images/unity/check-for-xboxliveservices.gif)

Наконец **UserProfile** также требуется **EventSystem** работать правильно. Это можно сделать, щелкнув правой кнопкой мыши на сцене входа в систему, затем щелкнув через **GameObject--> пользовательского интерфейса--> EventSystem**.

![Добавление событий системы](../images/unity/add_event_system.gif)

При вводе в режим воспроизведения, служба автоматически входа пользователей. В Unity Xbox Live SDK моделируются вызовы к службе Xbox Live и отправляет обратно фиктивными данными для работы с. Чтобы просмотреть динамические данные, необходимо будет сборку проекта, как приложение универсальной платформы Windows и запустите его из Visual Studio. См. в разделе [Настройка Xbox Live в Unity](../get-started-with-creators/configure-xbox-live-in-unity.md) Дополнительные сведения. При вводе режим игры в Unity, prefab заполняются с фиктивными данными, которые будут имитировать сведения, например: тег игрока, Gamerpic и игровые достижения проигрывателя. Это сведения, которые должны отображаться по **UserProfile** prefab.

Успешного входа в систему будет выглядеть следующим образом: ![успешно userprofile play](../images/unity/correct-user-profile-play.gif)

Если вы не настроили проект для подключения к Xbox Live должным образом в режим воспроизведения будет отключить кнопку входа в систему и вывести сообщение об ошибке.

Ниже приведен пример сбоя входа из-за плохой конфигурации приложения Xbox Live.
![не удалось воспроизвести userprofile](../images/unity/flawed-user-profile-play.gif)

## <a name="scripting-sign-in"></a>Сценарии входа в систему

Теперь, когда вы знаете, как использовать **UserProfile** prefab лучше рассмотрим основной сценарий, который определяет функциональность готового блока. Если взглянуть на **UserProfile** в **инспектор** вы увидите, что у него есть **UserProfile.cs** скрипт, подключенные к ней. Этот скрипт содержит все необходимое для входа пользователей и загрузки данные профиля, который вы хотите отобразить на вход. Тем не менее вместо просмотра всего готового блока (которая может обновляться с течением времени) мы собираемся рассмотрим несколько примеры строк кода, чтобы понять, что требуется для входа в систему пользователю Xbox Live.

### <a name="the-xboxliveuser-class"></a>Класс XboxLiveUser

Вызовы, необходимые для входа в систему пользователь упаковываются в `XboxLiveUserInfo` класса. В **UserProfile.cs** сценарий, вы увидите, что является экземпляром `XboxLiveUserInfo` класс с именем `XboxLiveUser`. Мы будем использовать то же имя переменной в нашем примере кода. `XboxLiveUserInfo` Класс содержит экземпляр `XboxLiveUser` класс с именем `User` как один из своих переменных-членов. `XboxLiveUser` Класс содержит функции входа в систему, необходимо войти в систему `XboxLiveUser`. Используется экземпляр `XboxLiveUser` класс `User` для входа в систему пользователям, также как получить сведения, описывающие их и их: тег игрока, Gamerpic и игровые достижения. Для этого необходимо инициализировать экземпляр `XboxLiveUserInfo` класса и используйте полученный `XboxLiveUserInfo.User` до вызова входа в систему.

### <a name="initialize-the-xboxliveuser"></a>Инициализировать XboxLiveUser

Инициализация Xbox Live пользователя является первым шагом перед их фактически подписывания в Xbox Live. Это делается очень просто в коде с помощью `XboxLiveUserInfo.Initialize()` функции.
В нашем примере мы используем `XboxLiveUser` переменной-члена как наш `XboxLiveUserInfo` экземпляра и инициализации, используемый для входа в систему.

```csharp
    void ButtonClickTask()
    {
        this.StartCoroutine(this.InitializeXboxLiveUser());
    }

    public IEnumerator InitializeXboxLiveUserAndCallSignIn()
    {
        // Disable the sign-in button
        SignInButton.interactable = false;

        this.XboxLiveUser.Initialize();

        //Wait until the Xbox User has been initialized to call SignInAsync()
        yield return new WaitUntil(() => this.XboxLiveUser != null && this.XboxLiveUser.User != null);
        this.StartCoroutine(this.SignInAsync());
    }
```

Просмотрев этот пример кода вы увидите, что `XboxLiveUserInfo.Initialize()` функция вызывается в ответ на нажатие кнопки. Полный **UserProfile.cs** prefab сценарий содержит код, позволяющий для автоматического входа в систему где `XboxLiveUserInfo.Initialize()` вызывается без участия.
`XboxLiveUserInfo.Initialize()` Функция создаст новый `XboxLiveUserInfo.User` которых было вызывать функции входа в систему, содержащиеся в `XboxLiveUserInfo.User` класса.

### <a name="call-sign-in"></a>Вызов входа

После инициализации XboxLiveUser пора до вызова входа в систему. В **UserProfile.cs** входа называется `SignInAsync()` функции UserProfile.cs. В предыдущем примере кода мы просто дождаться `XboxLiveUser` инициализации перед вызовом `SignInAsync()` функции.

> [!NOTE]
> Это необходимо для ожидания `XboxLiveUser` инициализации перед вызовом входа в систему, так как `XboxLiveUser` содержит `XboxLiveUser.User` свойство, которое используется для вызова входа в систему.

В **UserProfile.cs** `SignInAsync()` функция содержит две функции входа в систему, которые могут использоваться для входа пользователя. `XboxLiveUser.User.SignInSilentlyAsync()` и `XboxLiveUser.User.SignInAsync()` имеются функции, которые входа пользователя. `SignInAsync()` Функция представляет собой хороший пример того, как использовать эти функции соответствующим образом. В следующем образце кода показан один соответствующий метод для вызова функций два входа:

```csharp
SignInStatus signInStatus;
TaskYieldInstruction<SignInResult> signInSilentlyTask = this.XboxLiveUser.User.SignInSilentlyAsync().AsCoroutine();
yield return signInSilentlyTask;

signInStatus = signInSilentlyTask.Result.Status;
if (signInSilentlyTask.Result.Status != SignInStatus.Success)
{
    TaskYieldInstruction<SignInResult> signInTask = this.XboxLiveUser.User.SignInAsync().AsCoroutine();
    yield return signInTask;

    signInStatus = signInTask.Result.Status;
}
```

В этом примере результаты вызовов входа хранятся в переменной `signInStatus`. Это позволяет нам проверить ли вход в систему прошел успешно, и действовать соответствующим образом. В этом примере функция сначала пытается войти без уведомления и затем автоматический вход при сбое функции вызывает обычного входа в функции. После успешного вызова одной из функций входа в систему, что будет входа пользователя. Теперь вы можете использовать `XboxLiveUser.User` для получения и отображения сведений о пользователе в системе. Взгляните на `LoadProfileInfo()` работать в **UserProfile.cs** пример демонстрирует использование `XboxLiveUser.User` для отображения сведений о вошедшего пользователя.

## <a name="build-and-test-sign-in"></a>Сборка и тестирование входа

При выполнении название в редакторе, вы увидите фиктивными данными, при попытке использовать функции Xbox Live. Чтобы войти с использованием реальных профиля и протестировать функции Xbox Live в заголовок вашей, необходимо создать решение универсальной платформы Windows и запустите его в Visual Studio.  Можно построить проект UWP в Unity, выполнив следующие действия:

1. Откройте **параметры построения** окно, выбрав **файл** > **параметры построения**.
2. Добавьте все автоматически, которые вы хотите включить в построение в разделе **построения кадром** раздел.
3. Переключиться в режим **универсальной платформы Windows** , выбрав **универсальной платформы Windows** под **платформы** и щелкнув **переключить платформу**.
4. Задайте **SDK** для **10.0.15063.0** или более поздней версии.
5. Чтобы включить отладку проверку сценариев **Unity C# проекты**.
6. Нажмите кнопку **построения** и указать расположение проекта.

После завершения сборки Unity будет создан новый файл решения универсальной платформы Windows, которые потребуются для выполнения в Visual Studio:

1. В указанной папке откройте  **&lt;имя_проекта&gt;.sln** в Visual Studio.
2. На панели инструментов в верхней части, выберите **x64** и развертывание в **локальный компьютер**.

Если вы включили **отладки скриптов** при построении решения универсальной платформы Windows из Unity, затем скрипты будут находиться по **сборки-CSharp (универсальной Windows)** проекта.

> [!NOTE]
> Прежде чем использовать сборки Visual Studio для тестирования игры с реальными данными, выполните [этот контрольный список](test-visual-studio-build.md) для обеспечения название будут иметь возможность доступа к службе Xbox Live.

## <a name="troubleshooting"></a>Поиск и устранение неисправностей

Если у вас возникли проблемы со входом в Xbox Live переключитесь на чтение [Устранение неполадок Xbox Live входа](../using-xbox-live/troubleshooting/troubleshooting-sign-in.md).
