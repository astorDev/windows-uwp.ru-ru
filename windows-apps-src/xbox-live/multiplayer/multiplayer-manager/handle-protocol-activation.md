---
title: Обработка активации протокола
description: Узнайте, как использовать диспетчер многопользовательской, Xbox Live для активации протокола.
ms.assetid: e514bcb8-4302-4eeb-8c5b-176e23f3929f
ms.date: 04/04/2017
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10, xbox, один, многопользовательские manager, протокол активации
ms.localizationpriority: medium
ms.openlocfilehash: 0b5dead742e18bbf5f3e9c271109352ae48e8fef
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57655839"
---
# <a name="handle-protocol-activation"></a>Обработка активации протокола

Система автоматически начинает игры в ответ на другое действие, обычно когда проигрыватель принимает игр приглашение от другой проигрыватель при активации протокола.

Название можно получить протокол включен посредством следующих способов:

* Если пользователь принимает игр приглашения
* Когда пользователь выбирает «Присоединить Game» из gamercard игрока.

Этот сценарий описывается, как обрабатывать активации протокола при запуске название и включите основной и игры (если он существует).

Блок-схема процесса здесь можно увидеть: [Блок-схема: дескриптор протокола активации проигрывателя](mpm-flowcharts/mpm-on-protocol-activation.md).

| Метод | Событие, возникающее |
| -----|----------------|
| `multiplayer_manager::join_lobby(IProtocolActivatedEventArgs^ args, User^)` | `join_lobby_completed_event` |
| `multiplayer_lobby_session::set_local_member_connection_address()` | `local_member_connection_address_write_completed ` |
| `multiplayer_lobby_session::set_local_member_properties()` | `member_property_changed` |

Когда проигрыватель примет игр приглашения или присоединяет игры друга через gamercard игрока, игра запускается на устройстве с помощью протокола активации. Один раз игры начинается, многопользовательские Manager может использовать аргументы события активирован протокол для присоединения к основной. При необходимости Если вы еще не добавили локальных пользователей через `lobby_session()::add_local_user()`, можно передать в список пользователей с помощью `join_lobby()` API. Если не Добавить приглашенного пользователя, или в том случае, если сообщение invite был для другого пользователя, от пользователя, который был добавлен, `join_lobby()` будут завершаться сбоем, предоставив `invited_xbox_user_id()` , приглашение было отправлено как часть `join_lobby_completed_event_args`.

После присоединения к выходу, корпорация Майкрософт рекомендует настроить адреса подключения локального элемента, а также любые пользовательские свойства для элемента. Можно также задать узла через `set_synchronized_host` если она не существует.

И, наконец диспетчер многопользовательскую автоматическое соединения пользователя в игры сеанс, если игра уже выполняется и имеется достаточно места для приглашенного пользователя. Заголовок будет уведомлен через `join_game_completed` события, предоставляя соответствующий код ошибки и сообщение.

**Пример:**

```cpp
auto result = mpInstance().join_lobby(IProtocolActivatedEventArgs^ args, users);
if (result.err())
{
  // handle error
}

string_t connectionAddress = L"1.1.1.1";
mpInstance->lobby_session()->set_local_member_connection_address(
    xboxLiveContext->user(),
    connectionAddress);
```

Ошибка/успех обрабатывается с помощью `join_lobby_completed` событий

**Функции, выполняемые диспетчером многопользовательскую**

* Регистрация возврата & многопользовательские подписок
* Основной веб-трансляции
 * Существующий основной состояние очистки
 * Присоединение всех местных работодателей как активный
 * Отправка SDA
 * Свойства набора элементов
* Регистрация для события изменения сеанса
* Основной сеанса в качестве активного сеанса
* Веб-трансляции игры (если существует)
 * Использует передачи дескриптора
