---
title: С помощью Координирующему SmartMatch
description: Узнайте, как использовать Xbox Live SmartMatch для сопоставления исполнителей в игры.
ms.assetid: 10b6413e-51d9-4fec-9110-5e258d291040
ms.date: 04/04/2017
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10, xbox one, многопользовательские, координирующему, smartmatch
ms.localizationpriority: medium
ms.openlocfilehash: 89f33768efcd649987866fd0798c222aa97f7ff8
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57592099"
---
# <a name="using-smartmatch-matchmaking"></a>С помощью Координирующему SmartMatch

Блок-схеме ниже показан процесс координирующему SmartMatch.

![](../../images/multiplayer/Multiplayer_2015_SmartMatch_Matchmaking.png)

## <a name="creating-a-match-ticket-session-and-a-match-ticket"></a>Создание билета сеанса соответствия и билет соответствия

Прежде чем начать подбор игроков, координирующему «scout» устанавливает соответствие билет сеанса для представления группы людей, которые хотите ввести координирующему друг с другом. Все пользователи в этой группе join сеанса при помощи **метод MultiplayerSession.Join (String, Boolean, Boolean)**.

После создания и заполнения с помощью проигрывателей билет сеанса, заголовок отправляет сеанса в службу поддержки знакомства с помощью **MatchmakingService.CreateMatchTicketAsync метод**. Этот метод создает билет совпадение, представляющее билет сеанса и обновляет поле /servers/matchmaking/properties/system/status во время сеанса запрос в службу «поиск». Дополнительные сведения см. в разделе [как: Создайте запрос в службу соответствия](multiplayer-how-tos.md).

Ответ от метода создания билета совпадение является **CreateMatchTicketResponse класс** объекта. Ответ содержит идентификатор билета совпадение, GUID, который может использоваться можно использовать для отмены подбор игроков, удалив билета. Ответ также содержит среднее время ожидания для hopper, который может использоваться обозначить ожидания пользователей.


## <a name="setting-matchmaking-attributes-on-the-session-and-players"></a>Установив атрибуты Координирующему сеанса и игроков

При отправке сеанс для партнеров, заголовок можно задать атрибуты, используемые службой координирующему для группировки сеанса с помощью других сеансов. Атрибуты могут быть заданы на уровне запрос в службу или на уровне каждого члена.


### <a name="setting-matchmaking-attributes-at-the-match-ticket-level"></a>Задание атрибутов подбор игроков на уровне соответствия билета

Заголовок отправляет атрибутов на уровне билет совпадения в *ticketAttributesJson* параметр **MatchmakingService.CreateMatchTicketAsync** метод. Атрибуты, указанные на уровне билета переопределения те же атрибуты, указанное на уровне для члена.


### <a name="setting-matchmaking-attributes-at-the-per-member-level"></a>Задание атрибутов подбор игроков на уровне для члена

Заголовок указывает атрибуты для члена на каждом члене в рамках сеанса билет совпадения. Они устанавливаются с помощью вызова **MultiplayerSession.SetCurrentUserMemberCustomPropertyJson метод**, используя имя свойства «matchAttrs». Этот вызов помещает атрибуты в /members/ {index} / свойства/пользовательские/matchAttrs поле на каждый игрок в рамках сеанса билета.

Процесс координирующему «выравнивает» для члена каждой в один атрибут билета на уровне, на основе метода flatten, указанный для этого атрибута в конфигурацию hopper Xbox Live. Это можно настроить на [XDP](https://xdp.xboxlive.com) или [центра партнеров](https://partner.microsoft.com/dashboard).


## <a name="making-the-match"></a>Что делает совпадение

Билет сеанса и соответствие билет настроить совпадения службы координирующему представленный билет сеанса с других сеансов билет, представляющий другие группы и создает или определяет сеанс целевой совпадение. Служба также создает резервирования для соответствующих игроков в нужном сеансе и затем помечает сеансы билет, как сопоставить. MPSD уведомляет заголовок этого изменения в запрос в службу сеанс.

Теперь заголовок необходимо затем выполните действия для инициализации сеанса целевой объект, чтобы подтвердить, что достаточно игроков отображаются и качество обслуживания (QoS) проверки, чтобы убедиться, что они могут подключаться друг к другу успешно выполнить. При сбое инициализации и/или QoS заголовок помечает билет сеанса для повторной отправки для партнеров таким образом, можно найти другую группу. Дополнительные сведения о процессах, см. в разделе [инициализации сеанса целевым и качество обслуживания](smartmatch-matchmaking.md).

Во время действия совпадение вносятся следующие изменения в объекты JSON для сеанса:

-   поле /Servers/matchmaking/Properties/System/Status, равным «найти»
-   /Servers/matchmaking/Properties/System/targetSessionRef поле "значение" целевой объект сеанса
-   /Members/ {index} / свойства/пользовательские/matchAttrs поля для каждого сеанса билет скопированы /members/ {index} / константы/пользовательские/matchmakingResult/playerAttrs поля
-   Для каждого игрока билета атрибуты скопированы из поля ticketAttributes в билете соответствия /members/ {index} / константы/пользовательские/matchmakingResult/ticketAttrs поля


## <a name="maintaining-the-match-ticket"></a>Поддержание соответствия билета

Подбор игроков служба использует моментальный снимок билет сеанса во время создания билета совпадение для сеанса. Таким образом Если любой игроков join или билет сеанса, заголовок необходимо использовать службу подбор игроков удаления и повторного создания билета совпадения.


## <a name="reusing-the-game-session-as-a-match-ticket-session"></a>Повторное использование игр сеанса билет сеанса соответствия

| Важно.                                                                                                                                                                                                                       |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Важно понимать, что два сеанса с *preserveSession* набор всегда не будет сопоставлять друг с другом, так как они не могут сочетаться. Подбор игроков поток, используемый для наименования следует учесть этот факт. |

Заголовок можно повторно использовать существующий сеанс игр билет сеанса совпадение найти больше игроков, чтобы присоединить игры, в которой уже выполняется. Для этого заголовка необходимо создать билет совпадение, вызвав **CreateMatchTicketAsync** с *preserveSession* параметру присвоить **PreserveSessionMode.Always** . Подбор игроков службы, затем, гарантирует, что существующего сеанса, используемый для билета сохраняется на протяжении всего процесса подбор игроков и становится целевой объект сеанса.


## <a name="deleting-the-match-ticket"></a>Удаление билет соответствия

Для удаления билет совпадение, вызовы title **MatchmakingService.DeleteMatchTicketAsync метод**. Удаление билета:

1.  Останавливает координирующему для пользователей в сеансе билета.
2.  Обновления поле /servers/matchmaking/properties/system/status билета сеанса «отменено».


## <a name="performing-matchmaking-for-games-using-xbox-live-compute"></a>Выполнение Координирующему для игры с помощью Xbox Live вычислений

Ниже приведены основные действия, выполняемые для получения matchmade пользователя в игру на основе вычислений Xbox Live. Аналогично потока следует применять для игр, размещенные в сторонних производителей.
1.  Scout создает билет сеанса для представления в группу. Этот сеанс содержит список потенциальных распределенных центрах обработки данных, в конфигурации сеанса в /constants/system/measurementServerAddresses. Он поставляется в шаблоне сеанса Если статический список центра обработки данных или от клиента, записываются во время создания сеанса после получения его из вычислений Xbox Live. Этот сеанс содержит также gsiSetId gameVariantId и maxAllowedPlayers значения в объекте targetSessionConstants/пользовательские/gameServerPlatform.
2.  Все остальные клиенты в группе подключиться к сеансу билета.
3.  Все члены группы загрузки measurementServerAddresses значения из объекта /constants/system билет сеанса, проверьте связь с их с помощью API платформы и отправить упорядоченный список предпочтительных центров обработки данных в сеанс, как определено в /members/ {index} /Properties/System/serverMeasurements.

| Примечание.                                                                                                                                                                                                                                                                                                     |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Заголовок можно задать и получить значения measurementServerAddresses из сеанса с помощью **MultiplayerSession.SetMeasurementServerAddresses** метод и  **Свойство MultiplayerSessionConstants.MeasurementServerAddressesJson**. |

4.  Вызовы scout **CreateMatchTicketAsync**, передавая ссылку билет сеанса.

| Примечание.                                                                                                                                                                                                         |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Если билет сеанса объекты имеют несовпадающие константы, метод create запрос в службу может завершиться ошибкой. Этого можно избежать, добавив ОБЯЗАТЕЛЬНЫМ правило hopper, чтобы запретить сопоставление с игроками, которые имеют несовпадающие константы. |

Если **MatchTicketDetailsResponse.PreserveSession свойство** устанавливается никогда, служба координирующему копирует измерения сервера из каждого элемента в внутреннее представление билета. Он объединяет измерения server членов билета в коллекцию измерений один сервер для билета, хранящихся во внутреннее представление билета как атрибут «специальный» билета.

Если **MatchTicketDetailsResponse.PreserveSession** задан всегда, server, измерения не используются. Вместо этого службы координирующему /properties/system/matchmaking/serverConnectionString значение копируется для сеанса в внутреннее представление билета, как коллекция serverMeasurements размером 1 с задержкой в ноль.

5.  Служба координирующему соответствует билет сеанса с другими пользователями, представляющим собой другие группы, отключение сервера измерения коллекций в учетной записи. Она пытается сопоставить группы с другими группами, имеющими же центрах обработки данных, настоятельно рекомендуется.
6.  После обнаружения сопоставленной группы координирующему служба создает или определяет сеанс целевой и добавляет все игроки из сеансов билетов, которые сопоставляются друг с другом. Служба записывает измерения последний сервер плоский соответствующие группы в /properties/system/serverConnectionStringCandidates. Записывает значения первоначального сервера для каждого элемента, добавленные в нужном сеансе /members/ {index} / константы/system/matchmakingResult/serverMeasurements.
7.  Все клиенты инициализации на целевой объект сеанса, как описано выше. Тем не менее так как клиенты будут подключаться к вычислений Xbox Live, они не выполняют QoS друг с другом для подтверждения подключения.
8.  Некоторые или все вызовы клиентов **GameServerPlatformService.AllocateClusterAsync метод**. Первый из них активирует выделения, пока остальные пользователи увидят сообщение только подтверждения. Метод получает конечный сеанс из MPSD и выбирает центра обработки данных, на основании параметров центра обработки данных в нужном сеансе, а также нагрузки и других вычислений Xbox Live без специальных знаний.
9.  Воспроизведение всех клиентов.


## <a name="see-also"></a>См. также

[Операции времени выполнения SmartMatch](smartmatch-matchmaking.md)

[Подбор игроков SmartMatch](smartmatch-matchmaking.md)

**Пространство имен Microsoft.Xbox.Services.Matchmaking**

**Пространство имен Microsoft.Xbox.Services.Multiplayer**
