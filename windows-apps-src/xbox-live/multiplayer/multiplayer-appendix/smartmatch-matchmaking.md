---
title: Поиск сочетаний с помощью SmartMatch
description: Сведения о службе координирующему Xbox Live SmartMatch для сопоставления игроков в игры.
ms.assetid: ba0c1ecb-e928-4e86-9162-8cb456b697ff
ms.date: 04/04/2017
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10, xbox one, многопользовательские, координирующему, smartmatch
ms.localizationpriority: medium
ms.openlocfilehash: 6bc5f15e6fdb7d2f393daef8d21c134579610a9b
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57647299"
---
# <a name="smartmatch-matchmaking"></a>Поиск сочетаний с помощью SmartMatch

В этой статье содержатся следующие разделы
* Общие сведения о SmartMatch
* Операции времени выполнения SmartMatch
* Настройка SmartMatch названия
* Определение правил группы во время настройки SmartMatch
* Инициализация сеанса целевой и качество обслуживания

## <a name="introduction-to-smartmatch"></a>Общие сведения о SmartMatch

XSAPI предоставляет службу, подбор игроков, именуемую SmartMatch, упакованный в [API диспетчера многопользовательскую](../multiplayer-manager/multiplayer-manager-api-overview.md).  Расширенное использование API, см. в **MatchmakingService класс**, но если у вас есть сценарий подбор игроков, не можно реализовать с помощью диспетчера многопользовательскую, оставьте отзыв для нас через ваш DAM.  Независимо от того, какие API, который используется применяется концепций в этой статье.

Подбор игроков SmartMatch группирует игроков на основе сведений о пользователе и запрос координирующему для пользователей, которые хотят играть друг с другом. Подбор игроков на основе сервера, то есть пользователи предоставлять запрос к службе, а позже уведомляются при обнаружении совпадения. При создании заголовок для Xbox One, как описано в разделе, можно использовать SmartMatch [с помощью Координирующему SmartMatch](using-smartmatch-matchmaking.md). Кроме того, как описано в разделе можно свою собственную службу координирующему [с помощью свою собственную службу координирующему](https://developer.microsoft.com/en-us/games/xbox/docs/xboxlive/xbox-live-partners/multiplayer-and-networking/using-your-own-matchmaking-service). Обратите внимание, что для доступа к этой ссылки требуется наличие [центра партнеров](https://partner.microsoft.com/dashboard) учетной записи, которая включается для разработки приложений Xbox Live.

### <a name="about-smartmatch"></a>О SmartMatch

Подбор игроков служба тесно сотрудничает с MPSD для упрощения подбор игроков. Он позволяет легко сделать подбор игроков в фоновом режиме, например, при воспроизведении одиночном заголовки в заголовок.

Отдельных пользователей или групп, нужно ввести координирующему создания билета сеанса совпадения, а затем запроса службы подбор игроков, чтобы найти другие игроки, с которым будет выполняться настройка совпадение. Это приводит к созданию временного «match билета», размещенные в службе подбор игроков в течение заданного времени.

Подбор игроков служба решает сеансы играть друг с другом на основе конфигурации, статистические данные, хранящиеся для каждого игрока и никаких дополнительных сведений, предоставленных во время запроса на соответствие. Служба затем создает сеанс целевой match, содержащий сопоставления и уведомляет пользователей названия соответствие всех игроков.

Когда конечный сеанс будет готов, заголовки выполнения проверки качества обслуживания, чтобы убедиться, что группа может играть друг с другом и затем начать воспроизведение, если все это хорошо. Во время качества обслуживания на уровне процесса и matchmade игры заголовки поддерживать актуальность в MPSD состояние сеанса и им получать уведомления из MPSD об изменениях в сеанс. Такие изменения включают пользователей ожидается и будет и изменяет арбитру сеанса.


### <a name="match-ticket-session"></a>Совпадение билет сеанса

Билет сеанса соответствия представляет клиентов для проигрывателей, которые хотят внести совпадение. Он будет создан на основе, над игрой, или на группу незнакомых людей, которые находятся в основной вместе или другими признаками конкретного заголовка игроков. В некоторых случаях билет сеанса может быть игр сеанс уже выполняется, который ищет больше игроков.


### <a name="match-ticket"></a>Соответствует билета

Отправка билет сеанса координирующему приводит к созданию билет совпадение, отслеживает попытки подбор игроков. Атрибуты в билете, например, игры карты или уровень, вместе с атрибутами игроков в сеансе билет, используются для определения соответствия.
#### <a name="hoppers"></a>Hoppers

Hoppers являются логические местах, где собираются билеты совпадение. Могут быть сопоставлены только билеты в том же hopper. Заголовок может иметь несколько hoppers. Например заголовок может создать один hopper, для какой проигрывателя навык – это элемент, наиболее важные для сопоставления. Он может использовать другой hopper, в которой игроки являются только найдено совпадение, если они приобрели же загружаемое содержимое.


#### <a name="hopper-rules"></a>Hopper правила

Hopper правила обеспечивают определения условий, которые координирующему служба использует для принятии решения о игроков, чтобы сгруппировать. Существует два типа правил:   НЕОБХОДИМО правила--имеют должны быть выполнены для билетов совпадение считается совместимы.
-   СЛЕДУЕТ правила — билет совпадение, соответствующих правилу предпочтительнее, чем второй нет.

В каждой из этих категорий существует несколько типов правил. Дополнительные сведения см. сведения о конфигурации среды выполнения операции в **операций среды выполнения SmartMatch**.


### <a name="match-target-session"></a>Совпадение целевой объект сеанса

После обнаружения сопоставленной группы, служба создает сеанс целевой соответствия и резервирует окружение для всех игроков из сеансов билет, которые сопоставляются друг с другом.


## <a name="smartmatch-runtime-operations"></a>Операции времени выполнения SmartMatch



| Примечание.                                                                                                                                  |
|----------------------------------------------------------------------------------------------------------------------------------------------------|
| Сведения об использовании SmartMatch подбор игроков в заголовок вашей см. в разделе [с помощью Координирующему SmartMatch](using-smartmatch-matchmaking.md). |


### <a name="creating-a-match-ticket-session-and-a-match-ticket"></a>Создание билета сеанса соответствия и билет соответствия

Клиента, в качестве партнеров «scout» устанавливает соответствие билет сеанса для представления нескольких игроков, которые хотят введите подбор игроков. Всех игроков в этой группе подключиться к сеансу, используя метод MultiplayerSession.Join. После сеанса заполняется игроков, заголовок отправляет сеанса в службу поддержки знакомства, используя метод MatchmakingService.CreateMatchTicketAsync, который создает билет совпадение, представляющий сеанс.

| Примечание.                                                                                                                                                        |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Служба SmartMatch обновляет поле /servers/matchmaking/properties/system/status в сеансе запрос в службу «Поиск» во время операции CreateMatchTicketAsync. |

Ответ от метода создания билета совпадение является объектом CreateMatchTicketResponse. Этот ответ содержит идентификатор билета совпадение, GUID, который может использоваться для отмены подбор игроков, удалив билета. Кроме того среднее время ожидания для hopper включается в ответ для использования в формировании ожиданий проигрывателя.

| Примечание.                                                                                                                                                                                                                                                                                                                                 |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Если нет игр stat данных, необходимо сохранить, рекомендуется использовать что заголовки PreserveSessionMode.Never значение, при вызове CreateMatchTicketAsync. С помощью PreserveSessionMode.Never позволяет быстрее подбор игроков и избавляет от необходимости иметь параметры пользовательского интерфейса для размещения игры, в отличие от поиска в игре. |


### <a name="setting-matchmaking-attributes-on-the-session-and-players"></a>Установив атрибуты Координирующему сеанса и игроков

При отправке билет сеанса, задает заголовок сеанса и проигрывателя атрибуты, которые координирующему служба использует для группировки сеанса с помощью других сеансов. Атрибуты могут быть заданы на уровне запрос в службу или на уровне каждого члена.


### <a name="setting-matchmaking-attributes-at-the-match-ticket-level"></a>Задание атрибутов подбор игроков на уровне соответствия билета

Заголовок отправляет атрибутов на уровне билет совпадение в параметре ticketAttributesJson MatchmakingService.CreateMatchTicketAsync метода. Атрибуты, указанные на уровне билета переопределения те же атрибуты, указанное на уровне для члена.


#### <a name="setting-matchmaking-attributes-at-the-per-member-level"></a>Задание атрибутов подбор игроков на уровне для члена

Заголовок указывает атрибуты для члена на каждом члене в рамках сеанса билет совпадения. Они устанавливаются с помощью метода MultiplayerSession.SetCurrentUserMemberCustomPropertyJson, используя имя свойства «matchAttrs». Этот вызов помещает атрибуты в /members/ {index} / свойства/пользовательские/matchAttrs поле на каждый игрок в рамках сеанса билета.

Процесс координирующему «выравнивает» каждого каждого элемента в один атрибут билета на уровне, на основе метода flatten, указанный для этого атрибута в Xbox Live конфигурации пользовательского интерфейса для hopper. Это можно настроить на [XDP](https://xdp.xboxlive.com) или [центра партнеров](https://partner.microsoft.com/dashboard).


### <a name="making-the-match"></a>Что делает совпадение

Билет сеанса и соответствие билет настроить совпадения службы координирующему представленный билет сеанса с других сеансов билет, представляющий другие группы и создает или определяет сеанс целевой совпадение. Служба также создает резервирования для соответствующих игроков в нужном сеансе и затем помечает сеансы билет, как сопоставить. Затем MPSD уведомляет заголовок этого изменения в запрос в службу сеанс.

Теперь заголовок необходимо инициализировать нужном сеансе чтобы подтвердить, что достаточно игроков отображаются и выполните качество обслуживания (QoS) проверки, чтобы убедиться, что они могут подключаться друг к другу успешно. При сбое инициализации и/или QoS заголовок помечает билет сеанса на повторную координирующему так, что можно найти другую группу. Дополнительные сведения об этом процессе см. в разделе **инициализации сеанса целевым и качество обслуживания**.

Во время действия совпадение вносятся следующие изменения в объекты JSON для сеанса:

-   поле /Servers/matchmaking/Properties/System/Status значение «найти».
-   поле /Servers/matchmaking/Properties/System/targetSessionRef установлено на нужном сеансе.
-   /Members/ {index} / свойства/пользовательские/matchAttrs поля для каждого сеанса билет копируются члены / {индекс} / константы/пользовательские/matchmakingResult/playerAttrs поля.
-   Для каждого игрока билета атрибуты скопированы из поля ticketAttributes в билете соответствия /members/ {index} / константы/пользовательские/matchmakingResult/ticketAttrs поля.


### <a name="maintaining-the-match-ticket"></a>Поддержание соответствия билета

Подбор игроков служба использует моментальный снимок билет сеанса во время создания билета совпадение для сеанса. Таким образом Если любой игроков join или билет сеанса, заголовок необходимо использовать службу подбор игроков удаления и повторного создания билета совпадения.


### <a name="filling-spots-in-an-in-progress-game-session"></a>Заполнение точек в сеансе выполняется игр

Заголовок можно повторно использовать существующий сеанс игр билет сеанса совпадение найти больше игроков, чтобы присоединиться к игры, в которой уже выполняется, или заполнения игр сеанса после завершения цикла и некоторые проигрыватели, в левом. Этот процесс называется «задним числом».

Один из способов выполнения задним числом — создать билет совпадения, будет «preserve» сеанса выполняется путем вызова **MatchmakingService.CreateMatchTicketAsync метод** с параметром preserveSession установлено значение PreserveSessionMode.Always. Подбор игроков службы гарантирует, что существующий сеанс, сохраняются на протяжении всего процесса подбор игроков и становится итоговый сеанса.

Существуют потенциальные недостатки этого шаблона, так как два сеанса с preserveSession всегда не будет сопоставлять друг с другом, так как они не могут сочетаться. Это может привести к очень медленно задним числом партнеров. Чтобы избежать этого сценария, заголовок следует использовать только PreserveSessionMode.Always Если требуется сохранение состояния игры. Неуспешн задайте PreserveSessionMode.Never и перенести в новый targetSession игроков, при обнаружении совпадения.


### <a name="deleting-the-match-ticket"></a>Удаление билет соответствия

Для удаления билета совпадение заголовок вызывает **MatchmakingService.DeleteMatchTicketAsync метод**. При удалении билет службы партнеров:

1.  Останавливает координирующему для пользователей в сеансе билета.
2.  Обновления поле /servers/matchmaking/properties/system/status билета сеанса «отменено».


### <a name="matchmaking-for-games-using-xbox-live-compute"></a>Подбор игроков для игр с помощью Xbox Live вычислений

В следующем примере показано координирующему высокого уровня, с помощью службы Live вычислений. Аналогичный подход можно применить к играм, размещенные в сторонних ресурсов.

1.  Клиент «scout» создает билет сеанса для представления в группу. Этот сеанс содержит список потенциальных распределенных центрах обработки данных, в конфигурации сеанса в /constants/system/measurementServerAddresses. Он поступает из либо шаблона сеанса, если в списке центра обработки данных является статическим, или от клиента во время создания сеанса после их получения из службы Live вычислений. Этот сеанс содержит также gsiSetId gameVariantId и maxAllowedPlayers значения в объекте targetSessionConstants/пользовательские/gameServerPlatform.
2.  Все остальные клиенты в группе подключиться к сеансу билета.
3.  Все члены группы скачайте measurementServerAddresses значения из объекта /constants/system билет сеанса. Каждый член каждого пакетами с помощью API платформы и затем отправить упорядоченный список центров обработки данных на предпочтительный для сеанса, как определено в /members/ {index} / свойства/system/serverMeasurements.

| Примечание.                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Заголовок можно задать и получить значения measurementServerAddresses из сеанса с помощью **метод MultiplayerSession.SetMeasurementServerAddresses** и  **Свойство MultiplayerSessionConstants.MeasurementServerAddressesJson**. |

4.  Клиент вызывает «scout» **MatchmakingService.CreateMatchTicketAsync метод**, передавая ссылку билет сеанса.

| Примечание.                                                                                                                                                                                                  |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Если билет сеанса объекты имеют несовпадающие константы, может произойти сбой метода CreateMatchTicket. Этого можно избежать, добавив ОБЯЗАТЕЛЬНЫМ правило hopper и запретить сопоставление игроков с несоответствием константами. |

5.  Если **MatchTicketDetailsResponse.PreserveSession свойство** устанавливается никогда, служба координирующему копирует измерения сервера из каждого элемента в внутреннее представление билета перед выравниванием собранные их в одну коллекцию для билета и хранятся в виде атрибута «специальный» билета.
6.  Если **MatchTicketDetailsResponse.PreserveSession свойство** имеет значение всегда, на сервер, измерения не используются. Вместо этого службы координирующему /properties/system/matchmaking/serverConnectionString значение копируется для сеанса в внутреннее представление билета, как коллекция serverMeasurements размером 1 с задержкой в ноль.
7.  Служба координирующему соответствует билет сеанса с другими пользователями, представляющим собой другие группы, отключение сервера измерения коллекций в учетной записи. Она пытается сопоставить группы с другими группами, имеющими же центрах обработки данных, настоятельно рекомендуется.
8.  После обнаружения сопоставленной группы координирующему служба создает или определяет сеанс целевой и добавляет все игроки из сеансов билетов, которые сопоставляются друг с другом. Служба записывает измерения последний сервер плоский соответствующие группы в /properties/system/serverConnectionStringCandidates. Записывается исходный сервер измерения для каждого нового члена в нужном сеансе /members/ {index} / константы/system/matchmakingResult/serverMeasurements.
9.  Все клиенты инициализации на целевой объект сеанса, как описано выше. Тем не менее так как клиенты будут подключаться к Live вычислений, они не выполняют QoS друг с другом для подтверждения подключения.
10. Некоторые или все вызовы клиентов **GameServerPlatformService.AllocateClusterAsync метод**. Первый из них активирует выделения, пока остальные получение только подтверждения. Метод получает конечный сеанс из MPSD и выбирает dataceter, на основании параметров центра обработки данных в нужном сеансе, а также нагрузки и других динамической вычислений без специальных знаний.
11. Воспроизведение всех клиентов.

## <a name="configuring-smartmatch-for-your-title"></a>Настройка SmartMatch названия


### <a name="configuration-of-smartmatch-matchmaking-runtime-operations"></a>Конфигурация Координирующему SmartMatch операций среды выполнения

Все Настройка координирующему SmartMatch осуществляется через [портале разработчиков Xbox (XDP)](https://xdp.xboxlive.com) или [центра партнеров](https://partner.microsoft.com/dashboard). Конфигурация использует ServiceConfiguration -&gt;многопользовательскую & Координирующему раздел для заголовка.


#### <a name="matchmaking-session-template-configuration"></a>Конфигурация шаблона сеанса подбор игроков

Как уже говорилось в [Координирующему SmartMatch](/windows/uwp/xbox-live/multiplayer/multiplayer-appendix/smartmatch-matchmaking), существует два типа сеанса, относящиеся к подбор игроков, соответствие билет сеанса и нужном сеансе совпадения. По сути билет сеанса — входные данные в службу поддержки знакомства, во время сеанса целевой выходные данные. При настройке сеанса шаблоны, следует создать шаблон для каждого типа сессии.

Билет сеанса можно использовать специальный шаблон. Кроме того можно повторно использовать шаблон для сеанса основной или другой сеанс, который не предназначен для использования для игры.

| Важно.                                                                                      |
|-------------------------------------------------------------------------------------------------------------|
| Запрос в службу сеанс не включены проверки качества обслуживания и не должен быть помечен с помощью функции «игровой процесс». |

Целевой объект сеанса необходимо использовать шаблон, который предназначен для matchmade игры. Он должен иметь параметры, которые включает проверку качества обслуживания между одноранговыми узлами, до начала выполнения игры, должен быть помечен с помощью функции «игровой процесс».

Конфигурации пользовательского интерфейса для XDP или центра партнеров можно сопоставить один или несколько hoppers каждого содержащего правила, которые определяют, как сеансы, сопоставляются друг с другом, в этом hopper каждого сеанса. Дополнительные сведения см. в разделе основную конфигурацию Hopper подбор игроков.


#### <a name="basic-hopper-configuration-for-matchmaking"></a>Основные Hopper конфигурацию для партнеров

В этом разделе определяет поля, используемые для настройки основных hopper поля. После этой конфигурации необходимо настроить правила hopper, как описано в конфигурации правила Hopper.

![](../../images/multiplayer/session_template_hopper_edit.png)


###### <a name="name"></a>Имя

Имя hopper, который используется при отправке сеанс для партнеров. Это имя должно соответствовать значение, переданное в качестве параметра **CreateMatchTicketAsync** метод во время создания билета на совпадение.


###### <a name="minmax-group-size"></a>Размер группы Min/Max

Группы проигрыватель, который должен быть создан из сеансов в hopper минимального и максимального размеров. Службы координирующему пытается создать группу сопоставленная, максимально увеличив, вплоть до группы максимального размера. Тем не менее создайте соответствующие группу, если его можно собрать достаточно проигрывателей для соответствия размеру группы.


###### <a name="should-rule-expansion-cycles"></a>Следует правила расширения циклов

Для следует правило, подбор игроков попытается увеличить пространство поиска и понизить правила предоставленный подбор игроков со временем, если успешных совпадений не найдено. Этот процесс выполняется через несколько циклов, как указанного с помощью поля следует циклов правила расширения. После последнего цикла расширения правила следует удаляются таким образом, чтобы они больше не помешать билеты сопоставления. Тем не менее они по-прежнему используются для определения оптимального совпадения в том случае, если доступны несколько билеты. Только количество и типы качества обслуживания будут развернуты, прежде чем они будут удалены. См. также правила конфигурации Hopper в этом разделе.

Увеличение значения параметра должны правило Explansion циклов параметр предоставляет больше циклов для следует правила расширения, но также увеличивает длительность подбор игроков. Значение по умолчанию — 3, который обычно достаточно для большинства конфигураций.

| Важно.                                                                                                                                                                        |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Расширения циклов промежутки времени фиксированное время 5 секунд. После последнего цикла расширения все правила «Должно» больше не учитываются в течение попытки подбор игроков. |

##### <a name="ranked-hopper"></a>Hopper ранжирующими значениями
Обычно SmartMatch будет препятствовать заблокированных игроков соответствует. Если ранг Hopper установлен, эта логика пропускается, чтобы предотвратить использование этой системы во избежание игрокам большего мастерства игроков.

#### <a name="configuration-of-hopper-rules"></a>Параметры правил Hopper

В этом разделе определяет поля, используемые для настройки правил для hopper.

###### <a name="common-rule-fields"></a>Общие правила поля

Поля, определенные в этом разделе являются общими для всех правил hopper.

**Имя правила**

Понятное имя, отображаемое для правила для целей конфигурации.

**Тип правила**

Тип правила. Параметры являются ОБЯЗАТЕЛЬНЫМИ и следует. Необходимо ли правила должны быть удовлетворены для успешной подбор игроков. ДОЛЖЕН правила можно ли нестрогой или удаления, чтобы найти совпадение. Дополнительные сведения об этом процессе см. конфигурации следует расширения правил.


**Тип данных**

Тип данных атрибута правила подбор игроков. Возможные значения:   Номер. Укажите простой 32-разрядное числовое значение.
-   Строка. Укажите строку длиной до 128 символов Юникода.
-   Коллекция. Укажите массив строк. Используйте это значение для определения загружаемому содержимому (DLC), игра от членства или ролей предпочтения для игроков.
-   Качество обслуживания. Укажите пользовательский тип данных для включения задержки данных QoS в подбор игроков. Только одно правило должно быть использовано для hopper подбор игроков.

| Примечание. |
|----------|
| Обратитесь к своему менеджеру разработчика, если это ограничение не является проблематичным для заголовка. |

-   Общее значение. Укажите тип пользовательских данных, который суммирует значения отправленного подбор игроков. Это значение можно использовать, чтобы убедиться, что полученная сумма находится в пределах определенного диапазона или точное значение.
-   Команда. Укажите пользовательский тип данных для команд игроков, включенные в запросы подбор игроков. Это значение можно использовать чтобы не разбивать игроков в билет совпадение между несколькими командами.


###### <a name="data-type-specific-rule-fields"></a>Правила определенного типа полей данных

В этом разделе определяет поля, используемые для определения правил, которые применяются к некоторым типам данных, но не для других пользователей. Пользовательский Интерфейс будет Уточнено, какие данные типы применяются в конкретных правилах.

**Разрешить подстановочные знаки**

Значение, указывающее, если атрибут можно опустить в билете совпадения. Если он опущен, билет становится совместим с любой билет, независимо от значения этого атрибута.


**Источник атрибута**

Источник значения типа данных. Ниже приведены возможные источники.
- Предоставленный заголовок. Значение отправляется в билете совпадения.
-   Stat экземпляра пользователя. Значение данных автоматически извлекается из службы UserStatistics.


**Имя атрибута**

Имя источника значение атрибута. Это имя свойства в билете соответствия или имя пользователя статистики.


**Значение по умолчанию**

Значение по умолчанию для типа данных, если значение не указан или для этого запроса подбор игроков. Значение по умолчанию применяется не в том случае, если поле Разрешить подстановочные знаки, и значение не указано.


**Вес**

Важность правила. Чтобы указать, какие правила, назначаются приоритеты, во время расширения подбор игроков и правила можно использовать вес. Значение веса должно быть положительным и значение по умолчанию — 1.


**FLATTEN-метод**

Номер только для типов данных. Значение, указывающее, каким образом несколько значений объединяются для удовлетворения совпадение. Применяется к несколько значений для разных игроков в билете совпадение и между несколькими билеты. Возможными значениями являются:
-  Min и Max. Используйте минимальное или максимальное значение из нескольких значений из разных совпадение билетов.
-   Среднее значение. Используйте среднее значение из нескольких значений из разных совпадение билетов.


**Max Diff**

Номер только для типов данных. Максимальный числовой приемлемый двух сравниваемых значений, чтобы соответствовать правилу. Для следует правило, это значение является отправной точкой для правила расширения.


**Операция задания**

Коллекции только к типам данных. Операция, которую необходимо выполнить сопоставление группы из набора значений. Возможными параметрами являются:
- Пересечение. Соответствует двух коллекциях, основанных на объем пересечения между ними. Этот параметр приводит к коллекции схожие или идентичные значения.
-   Разница. Соответствует двух коллекциях, основанных на объем различие между ними.
-   Предпочтения для роли. Соответствует коллекций на основе параметров для роли проигрывателя в игровых режимов на основе ролей.


**Пересечение целевой объект**

Часть конфигурации задайте операции. Пересечение минимальной или максимальной разницы для двух коллекций, прежде чем они сопоставляются.


**Топология сети**

Качество только тип данных службы. Топология сети, который используется для качества обслуживания. Допустимые значения — одноранговая сеть, одноранговый узел для узла и клиент-сервер.


**Максимальная задержка/масштабирование максимум**  
Качество только тип данных службы. Максимальная задержка для успешных партнеров в указанной сетевой топологии. Это значение рассматривается как значение масштабирования (в отличие от требуется задержка) когда с помощью между клиентом и сервером качества обслуживания следует правила.


| Примечание.                                                                                                                                                           |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Кроме того правила по умолчанию репутации также применяются к hopper. Эти правила нельзя удалить и гарантирующие правильную обработку репутацию во время подбор игроков. |


**Разрешить ожидание ролей**

Введите только данные настроек роли в коллекции. Указывает, если совпадение службы содержит билет координирующему для заполнения всех доступных ролей.


###### <a name="expansion-delta"></a>Дельта расширения

Значение, указывающее, сколько смягчить отправленного правило для каждого поколения расширения. Расширения дельта применяется в дополнение к значению Max инструмента сравнения. Дополнительные сведения см. Пример 1 (расширение правило).

Дельта расширения также можно расширить несколько числовые значения на разных скоростях. Это не можно реализовать с помощью расширения цикла параметр конфигурации, так как он применяется ко всем правилам. Вместо этого подходом является использование расширения десятичных значений, например, 0,4. Расширение возникает только при достижении нового целое число со знаком, позволяющий скорость различные расширения, даже для одинаковое количество циклов расширения.


###### <a name="qos-expansion-peer-to-peer-peer-to-host"></a>Расширения QoS (Peer-to-Peer, ведущего узла одноранговой сети)
Качества расширения типа службы для игр однорангового узла нельзя настроить разностные расширения. Вместо этого следует использовать одну из следующих стратегий расширения.

<table>

<tr>

<tr>
<td>
<b>1. MaxLatency < 256.</b><p/><p/>

Расширения выполняется на MaxLatency * расширения цикла.<p/>
Например если начальное значение 200, то используется 200 первый цикл, 400 в второго цикла и так далее.
</td>
</tr>

<tr>
<td>
<b>2. MaxLatency > или равна 256</b><p/><p/>

Расширения линейно масштабируется от 50 MaxLatency - 256.<p/>
Например если начальное значение 556, значение линейно масштабируется от 50 до 300 на число циклов. То есть если были выбраны шесть циклов, то значения будет 50, 100, 150, 200, 250 и 300. Если выбрать пять циклов, значения будет 50, 112.5, 175, 237.5 и 300.
</td>
</tr>

</tr>
</table>

##### <a name="qos-expansion-client-server"></a>Расширения QoS (клиент сервер)
При использовании выделенные серверы, расширения основан на относительный предпочтений. Только наиболее предпочтительное количество серверов будет считаться в начале расширения циклов. Со временем другие, менее основные серверы будут использоваться. Чтобы обеспечить соответствующие расширения, мы требуем аналогичную MaxLatency, вызывается масштабирование максимальное значение. Это масштабирование максимальное по-прежнему задается наибольшее время приемлемым ping, тем не менее, это значение дает относительный масштаб для другой сервер времени проверки связи, предоставляемые проигрывателя, а не является обязательным требованием для времени проверки связи. Обратите внимание на то, что может намеренного исключения серверов с помощью времени проверки связи неприемлемо, удалив их из списка в запросе.

#### <a name="example-1-rule-expansion"></a>Пример 1 (правила расширения)

Уровень используется для партнеров и проигрыватели сопоставляются слабо, исходя их уровни отображается «близость». Проигрыватели с минимальными различие между их уровни являются предпочтительными.

-   Правилом уровня проигрывателя
-   Тип правила: СЛЕДУЕТ
-   Тип данных: Номер
-   Max инструмента сравнения: 1
-   Дельта расширения: 2
-   FLATTEN-метод: Среднее

По умолчанию требуется различие между уровнями проигрывателя 1 или менее. Если соответствие найдено в это различие, сопоставляются игроков. При обнаружении совпадений начальное значение уровня проигрывателя разворачивается по 2 для каждой итерации (три итерации по умолчанию). Этот сценарий в поведении координирующему результаты для проигрывателя на уровне 20, как показано в следующей таблице.

| Шаг                    | Значение уровня для потенциальных кандидатов соответствия | Действующие уровня расстояние для успешного сопоставления |
|-----|
| Начальный отправлено значение | 19-21                                      | 1                                             |
| Цикл расширения 1       | 17-23                                      | 3                                             |
| Цикл расширения 2       | 15-25                                      | 5                                             |
| Цикл расширения 3       | 13-27                                      | 7                                             |

Как по-прежнему циклов расширения, без изменения значения Max Diff увеличивает эффективный уровня расстояние для успешного сопоставления. Устанавливается, только значение уровня проигрывателя.


#### <a name="example-2-collection-rule"></a>Пример 2 (правило сбора)

Игра освобождает три вида DLC, доступные для игроков. Это координирующему правило применяется к координирующему игры «DLC», а игрок должен принадлежать по крайней мере один DLC быть matchmade с другими пользователями.

-   Правило DLC проигрывателя
-   Тип правила: НЕОБХОДИМО
-   Тип данных: Коллекция
-   Операция задания: Пересечение
-   Пересечение целевой объект: 1

Проигрыватели оценить их DLCs и отправки значений, приведенных в следующей таблице, в их соответствия билетов.

| Примечание.                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| В следующей таблице значение коллекции указывает владельца центре загрузки Майкрософт. Он равен 1, если DLC доступен для проигрывателя и 0 Если это не так. |

| Проигрыватель   | Значение коллекции | Соответствие игроков | Примечание.           |
|----------|------------------|----------------------|----------------|
| Проигрыватель 1 | { "1", "1", "1"} | 3                    | Является владельцем всех DLCs  |
| Проигрыватель 2 | { "0", "0", "0"} | Нет                 | Владеет не DLC    |
| Проигрыватель 3 | { "1", "0", "0"} | 1                    | Владеет первый DLC |

Если пересечение целевой объект в примере имеет значение 2, проигрыватели 1 и 3 не будут возвращены, поскольку пересечение между ними является только 1.

#### <a name="example-3-avoid-previous-players"></a>Пример 3 (Избегайте предыдущих players)
Как избежать игры с проигрывателем недавно воспроизводимые предпочтительно заголовок.
* Тип правила: НЕОБХОДИМО
* Тип данных: Коллекция
* Операция задания: Различие
* Пересечение целевой объект: 0

## <a name="defining-team-rules-during-smartmatch-configuration"></a>Определение правил группы во время настройки SmartMatch

### <a name="configuring-team-rules"></a>Настройка правил группы

Чтобы настроить правила группы, начните с создания на вашей платформе выбранной конфигурации (XDP или центра партнеров). Заполните нужные игры ожидает, что для создания на основе билетов, в этом hopper размеры team. Например если игры ожидает 4v4, следует создать две записи, ожидается максимальным размером 4 и другое имя. Минимум численность рабочей группы также — используйте эту игру можно воспроизвести с помощью меньшего числа игроков в команде. В противном случае минимального и максимального должно быть то же значение.


#### <a name="using-team-rules"></a>С помощью правил группы

После настройки правил командного билеты в hopper будет запрещено сопоставления Если никак не подходить их группы команд без вызывает разбиение. Правило будет записывать получающееся выделение team конечный сеанс, в разделе члены/константы/пользовательские/matchmakingresult/initialTeam. Обратите внимание, что это просто предлагаемые выделения--заголовок может оказаться изменять игроки могут создать высококачественные игры, позволять по-прежнему билеты разделения на разные команды.

Если билет создается для игры, в которой выполняется, правило группы будет указать дополнительные данные. Предположим, например, что 8 игроков в игру, когда два игроков перетаскивания 4v4 или отключены. Заголовок необходимо для заполнения этих пустот пустым, но его нельзя передвинуть команды во время игры.

Пытается заполнить игры в процессе выполнения, представляются билеты с PreserveSession поле, значение «всегда». В подобных случаях, поскольку команды уже были выделены проигрыватели, заголовок необходимо указать текущего выделения team, поэтому совпадение будет знать, сколько пробелов в каждой команде. Для предоставления имен групп каждого игрока включен, каждый игрок записывает их имя команды в игры сеанс, в списке членов/me/свойства/system/группы. Это поле является JArray.

После указанных выше свойств записываются в сеанс игр, один проигрыватель создает билет для сеанса, при попытке найти больше игроков. При билет будет выполнен, совпадение будет снова отправьте письмо команде предлагаемые любой игроков, вступившие в члены/константы/пользовательские/matchmakingresult/initialTeam


###### <a name="preferring-even-teams"></a>Предпочтение даже команд

Кроме того соответствует выполняется с помощью команды наибольшее сначала. Это означает, что в гипотетической 4v4 Hopper, у билетов 4 игроков, будет считаться сначала, пока остаются не используются билеты 4. Затем продолжите билеты 3, извлечение одноэлементных экземпляров, так как они должны и т. д. Таким образом билеты одинаковый размер обычно воспроизводится друг от друга, если они присутствуют и не предотвращено в соответствии с другими правилами. Обратите внимание на то, что в этом случае довольно сильная приоритет правил командного другие правила. Например предположим, что у вас есть ограниченный совокупности, состоящий из один билет размера 4 с высокой skill(A) один билет размера 4 с низкой skill(B) и четыре билеты объемом 1 с высокой skill(C-F). Правило Team приведет к сопоставления предпочитают A и B сопоставления, в отличие от A, C, D, E и F.


###### <a name="should-variant"></a>Следует Variant

Необходимо правило предотвращает билет, разделение во всех поколениях, а также обеспечивает сортировку, даже команды prefer. Следует правило идентичен до последнего поколения--после, могут быть разбиты билеты, несмотря на то, что даже команд prefer Сортировка по-прежнему будет всегда активной.

## <a name="target-session-initialization-and-qos"></a>Инициализация сеанса целевой и качество обслуживания

Группы игроков сопоставлен в нужном сеансе SmartMatch подбор игроков, как описано в разделе [Координирующему SmartMatch](/windows/uwp/xbox-live/multiplayer/multiplayer-appendix/smartmatch-matchmaking). Заголовок необходимо выполнить действия, чтобы убедиться, что достаточно игроков присоединения также можно успешно подключиться к друг с другом при необходимости. Этот процесс известен как целевой инициализация сеанса.

Для игр с помощью топологии сети peer-to-peer это важная часть инициализации сеанса, целевым является измерение качества обслуживания и оценки. Связанные с ней операции: измерение задержки и пропускной способности между консолей Xbox One (или между консолями и серверов) и вычисления итоговых измерений, чтобы определить, подходит ли сетевое подключение между узлами.

Следующий блок-схеме описывается реализация инициализацию нужном сеансе и качества обслуживания на уровне операций.

![](../../images/multiplayer/Multiplayer_2015_Matchmaking_QoS.png)

### <a name="managed-initialization"></a>Управляемая инициализация

MPSD поддерживает функцию, называемую «инициализации управляемых» через который он координирует целевой процесс инициализации сеанса для клиентов, участвующих в сеансе. MPSD автоматически отслеживает этапы инициализации и связанного времени ожидания для сеанса и определяет связь между клиентами при необходимости. Управляемая инициализация представленного **MultiplayerManagedInitialization класс**.

| Примечание.                                                                                                                  |
|------------------------------------------------------------------------------------------------------------------------------------|
| Настоятельно рекомендуется для заголовка с помощью координирующему SmartMatch вступили преимуществами MPSD управляемых инициализации компонента. |


#### <a name="managed-initialization-episodes-and-stages"></a>Управляемая инициализация эпизоды и этапов

Целевой сеанс проходит управляемая инициализация в любое время, подбор игроков добавляет новый игроков в сеанс. SmartMatch добавляет элементы сеанса в качестве пользовательской зарезервировано, это означает, что каждый член занимает слот, но еще не присоединенный сеанса. Каждая группа новые проигрыватели активирует новый эпизод инициализации.

После завершения инициализации каждого игрока успеха или сбоя процесса. Игрок, в который выполняется успешно при инициализации воспроизведения в нужном сеансе. Необходимо повторно отправить проигрыватель, который завершается ошибкой для партнеров для сопоставления в другом сеансе. Для случаев, где сеанс передается подбор игроков с *preserveSession* параметр значение Always, предварительно существующие участники сеанса не пройти проверку подлинности, инициализации, как предполагается MPSD, их необходимо правильно настроить.

Каждый эпизод управляемая инициализация состоит из этих этапов:

-   Присоединение--члены сеанса записи сами сеанса для перемещения состояния пользователей из зарезервированный в Active и отправьте основные данные, такие как адрес безопасные устройства.
-   Измерения — для топологий на основе однорангового узла, сеанса члены измерения качества обслуживания друг с другом и передать результаты в сеанс.
-   Оценки--MPSD оценивает результаты последних двух этапов и определяет ли сеанс и/или члены успешно инициализированы.

Код заголовка работает для сеанса, чтобы перемещаться по фаз присоединения и измерения каждого пользователя (и, следовательно, сеанс). Он затем можно начать воспроизведение или вернуться к координирующему после этап оценки окончился успехом или неудачей.


### <a name="configuring-the-target-session-for-initialization"></a>Настройка целевой сеанс для инициализации

Заголовок можно настроить процесс управляемая инициализация, использование констант в нужном сеансе выполняется инициализация. Эти константы настраиваются в разделе /constants/system в шаблоне сеанса с версией 107, версия рекомендуемый шаблон. Два типа параметров конфигурации можно сделать: параметры, определяющие управляемая инициализация процесс в целом и параметры, определяющие требования к качеству обслуживания. См. в разделе [MPSD сеанса шаблоны](multiplayer-session-directory.md) примеры шаблонов сеанса для распространенных сценариев title.

| Примечание.                                                                                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------------|
| Если требования к качеству обслуживания не определены в целевую конфигурацию инициализации сеанса на этапе измерения во время инициализации пропускается. |


#### <a name="configuring-managed-initialization-as-a-whole"></a>Настройка управляемых инициализации в целом

Ниже приведены поля, чтобы задать для управления общей управляемая инициализация. Они являются частью объекта /constants/system/memberInitialization:
- joinTimeout. Указывает время ожидания MPSD для каждого элемента присоединить, после начала серии инициализации. Значение по умолчанию — 10 секунд.
-   measurementTimeout. Указывает время ожидания MPSD для каждого элемента отправить результаты измерений качества обслуживания, после начала измерения рабочей области. Значение по умолчанию — 30000 секунд.
-   membersNeededToStart. Указывает количество элементов, которые должны быть успешно завершены при инициализации для первого сеанса инициализации для успешного выполнения. По умолчанию — 1.

| Примечание.                                              |
|----------------------------------------------------------------|
| Если этот порог не выполняется, все члены ошибкой инициализации. |


#### <a name="configuring-qos-requirements"></a>Настройка требования к качеству обслуживания

QoS нужна только во время инициализации, если заголовок использует топологию peer-to-peer или ведущего узла одноранговой сети. Каждая топология сопоставляет топологии постоянная, в разделе /constants/system /.
###### <a name="configuring-qos-requirements-for-peer-to-peer-topology"></a>Настройка требования к качеству обслуживания для топологии Peer-to-peer

| Примечание.                                                                                                                                                                                         |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Очень редко названий параметров QoS требование peer-to-peer топологии. Эти параметры являются очень строгие и вызвать проблемы для игроков с помощью преобразования strict сетевых адресов (NAT). |

Требования к качеству Обслуживания топологии Peer-to-peer задаются в объекте peerToPeerRequirements. Каждый клиент должен иметь возможность подключаться ко всем другим клиентам. Объект имеет следующие необходимые поля:
-   latencyMaximum. Указывает максимальную задержку между двумя клиентами.
-   bandwidthMinimum. Указывает минимальную пропускную способность между двумя клиентами.


###### <a name="configuring-qos-requirements-for-peer-to-host-topology"></a>Настройка требования к качеству обслуживания для топологии ведущего узла одноранговой сети

В объекте peerToHostRequirements устанавливаются требования к качеству Обслуживания топологии ведущего узла одноранговой сети. Каждый клиент должен иметь возможность подключиться к одному узлу common. Если настроен этот объект и инициализация прошла успешно, MPSD создаст исходный список клиентов, которые являются потенциальных узлов, известный как «кандидатов узлов». Ниже приведены поля, чтобы задать.
-   latencyMaximum. Указывает максимальную задержку между каждым узлом и узлом.
-   bandwidthDownMinimum. Указывает минимальную пропускную способность подчиненных между каждым узлом и узлом.
-   bandwidthUpMinimum. Указывает минимальную пропускную способность вышестоящих между каждым узлом и узлом.
-   hostSelectionMetric. Определяет метрику, используемую для выбора узла.

## <a name="see-also"></a>См. также

[Шаблоны MPSD сеанса](multiplayer-session-directory.md)

[Операции времени выполнения SmartMatch](/windows/uwp/xbox-live/multiplayer/multiplayer-appendix/smartmatch-matchmaking)
