---
title: Сведения о многопользовательской
description: Узнайте подробные сведения о многопользовательской сеансы, Xbox Live.
ms.assetid: 5aeae339-4a97-45f4-b0e7-e669c994f249
ms.date: 04/04/2017
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10 для настольных ПК, xbox, один многопользовательские 2015 г., сеанс, mpsd
ms.localizationpriority: medium
ms.openlocfilehash: 3eb92af2d478fa41150f375dd19ef347d2b6f2e9
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57616089"
---
# <a name="mpsd-session-details"></a>Сведения о сеансе MPSD

В данной статье содержатся следующие разделы:
* Общие сведения о сеансе
* Возможности сеанса
* Размер сеанса
* Состояние сеанса пользователя
* Видимость и Joinability
* Время ожидания сеанса
* Несколько вошедших пользователей на одной консоли
* Управление жизненным циклом процесса
* Очистка неактивных сеансов
* Арбитр сеанса

## <a name="session-overview"></a>Общие сведения о сеансе

Сеанс каталог сеанса многопользовательскую (MPSD) имеет имя сеанса и определяется как экземпляр шаблона сеанса, который представляет собой документ JSON, который предоставляет параметры по умолчанию для сеанса. Шаблон является частью конфигурации службы с помощью идентификатора конфигурации службы (SCID), который представляет собой идентификатор GUID. Этот шаблон можно найти на [портале разработчиков Xbox (XDP)](https://xdp.xboxlive.com) и [центра партнеров](https://partner.microsoft.com/dashboard). Конфигурации службы: ориентированные на разработчиков ресурсы, используемые для приема данных, управления и политики безопасности. Когда сеанс осуществляется через MPSD, основная авторизация выполняется по конфигурации службы в соответствии с политиками доступа, значение определяется разработчиком через XDP или центра партнеров. Вторичного доступа, такие как проверка членства сеанса, проверок на уровне сеанса при загрузке сеанса после авторизации доступа к конфигурации службы.

В этом разделе предполагается, что шаблон использует версию контракта 107, который имеет версию, используемую текущей MPSD для Xbox One. Если определены шаблоны на основе версии контракта 105 (идентична 104), необходимо изменить их для поддержки версии 107. Инструкции см. в разделе [проблемы при миграции общих 2015 многопользовательскую](common-issues-when-adapting-multiplayer.md).

| Важно.                                                                                                                                                                                                                                                      |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Функциональные возможности, устанавливаемое с помощью шаблона нельзя изменить при помощи операции записи для MPSD. Чтобы изменить значения, необходимо создать и отправить новый шаблон с необходимые изменения. Все элементы, которые не были заданы с помощью шаблона можно изменить с помощью операций записи для MPSD. |

### <a name="session-reference"></a>Справочник по сеанса

Каждый сеанс MPSD однозначно ссылается ссылку сеанса, представленных в многопользовательской API WinRT, **MultiplayerSessionReference класс**. Ссылка на сеанс содержит эти строковые значения:

-   Идентификатор конфигурации службы (SCID)
-   Имя шаблона сеанса
-   Имя сеанса

Ссылка на сеанс сопоставляет URI для идентификации сеансов, как показано ниже. В следующем примере сопоставления, «authority» — sessiondirectory.xboxlive.com.

```HTTP
https://{authority}/serviceconfigs/{service-config-id}/sessiontemplates/{session-template-name}/sessions/{session-name}
```

### <a name="elements-of-a-session"></a>Элементы сеанса

Каждая серия презентаций включает групп элементов, которые применяют изменения и правил безопасности, которые зависят от элемента сеанса, а также сведения по обслуживанию только для чтения (метаданные). В этом разделе описывает группы сеанса элементы, включенные в JSON-файлов для настройки сеанса и в JSON-файл для шаблона, который выбран.

| Примечание.                                                                                                                                                   |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| При использовании WinRT оболочки для реализации HTTP/REST, сеанса и шаблон необходимо определить объекты JSON, которые точно отражают функциональность WinRT. |

Внутри каждой из групп элементов есть два внутренних объектов:

-   Системные объекты, эти объекты имеют статическую схему, принудительно интерпретируется MPSD. Они проверяются и слияние. Поскольку MPSD определяет и знает, что они означают, он может работать с ними. Полное определение каждого из системных объектов, см. в статье ссылки для **класс MultiplayerSession** и ссылки для **идентификаторы URI каталог сеанса**.
-   Пользовательские объекты, эти объекты являются необязательными и не имеющие схемы. Они используются для хранения метаданных, касающиеся игры. Так как MPSD не удается интерпретировать эти данные, не производится операция. Игры или сохраненные данные должны храниться в хранилище под управлением title (TMS). Дополнительные сведения о TMS, см. в разделе **хранения-Title Xbox Live**.

Ниже приведен пример пользовательского объекта JSON:
```JSON
    "custom": {
      "myField1": true,
      "myField2": "string",
      "myField3": 5.5,
      "myField4": { "myObject": null },
      "myField5": [ "my", "array" ]
    }
```

#### <a name="session-constants"></a>Константы сеанса

Константы сеанса задаются только во время создания, создателем или с помощью шаблона сеанса. Объект /constants/system используется для определения констант для многопользовательской системы, как известно, через MPSD. Представленный WinRT программы-оболочки, связанный с данным объектом **MultiplayerSessionConstants класс**.

Объект /constants/system можно определить количество элементов, включая возможности, объект метрики, managedInitialization (версия контракта шаблона 104/105) или memberInitialization (версия контракта 107) объект, peerToPeerRequirements Объект, объект peerToHostRequirements и measurementsServerAddresses объект.


#### <a name="session-properties"></a>Свойства сеанса

Используйте объект /properties/system для определения свойства сеанса для MPSD. Оболочка WinRT, связанного с данным объектом **MultiplayerSessionProperties класс**. Свойства сеанса доступно для записи, участниками сеанса в любое время. Примеры свойств сеанса в формате JSON: joinRestriction, initializationSucceeded и объект подбор игроков. Пример использования этого элемента группы, см. в разделе [инициализации сеанса целевым и качество обслуживания](smartmatch-matchmaking.md).


#### <a name="member-constants"></a>Член константы

Укажите элемент констант во время соединения для каждого члена сеанса. Объект JSON является /members/ {index} / константы/system. Класс-оболочка WinRT, представляющие участника сеанса — **MultiplayerSessionMember класс**.


## <a name="member-properties"></a>Свойства элементов

Свойства элемента доступны для записи только участником сеанса. Они задаются в /members/ {index} / свойства/системным объектом и отразить элементы **MultiplayerSessionMember класс**. Пример.

```
    {
      // These flags control the member status and "activeTitle", and are mutually exclusive (it's an error to set both to true).
      // For each, false is the same as not present. The default status is "inactive", i.e. neither present.
      "ready": true,
      "active": false,

      // Base-64 blob, or not present. Empty string is the same as not present.
      "secureDeviceAddress": "ryY=",

      // During member initialization, if any members in the list fail, this member will also fail.
      // Can't be set on large sessions.
      "initializationGroup": [ 5 ],

      // List of the groups I'm in and the encounters I just had.
      // An encounter is a brief interaction with a group. When an encounter is reported, it counts as retroactively joining the group 30 seconds ago and just now leaving.
      // Group names use the session name validation rules (e.g. case-insensitive).
      // On large sessions, groups are used to report who played with who (rather than just session membership). Members
      // that are active in at least one group together at the same time are counted as playing together.
      // Empty lists are the same as no value specified.
      // The set of encounters is a point-in-time property, so it's immediately consumed and will never appear on a response.
      "groups": [ "team-buzz", "posse.99" ],
      "encounters": [ "CoffeeShop-757093D8-E41F-49D0-BB13-17A49B20C6B9" ],

      // Optional list of role preferences the player has specified for role-based game modes.
      // All role names have to match across all members in the session. Role weights are
      // defined from 0-100.
      "RolePreference": { "medic": 75, "sniper": 25, "assault": 50, "support": 100 },

      // QoS measurements by lower-case device token.
      // Like all fields, "measurements" must be updated as a whole. It should be set once when measurement is complete, not incrementally.
      // Metrics can be omitted if they weren't successfully measured, i.e. the peer is unreachable.
      // If a "measurements" object is set, it can't contain an entry for the member's own address.
      "measurements": {
        "e69c43a8": {
          "bandwidthDown": 19342,  // Kilobits per second
          "bandwidthUp": 944,  // Kilobits per second
          "custom": { }
        }

      // QoS measurements by game-server connection string. Like all fields, "serverMeasurements" must be updated as a whole, so it should be set once when measurement is complete.
      // If empty, it means that none of the measurements completed within the "serverMeasurementTimeout".
      "serverMeasurements": {
        "server farm a": {
          "latency": 233  // Milliseconds
        }
      },

      // Subscriptions for shoulder taps on session changes. The "profile" indicates which session changes to tap as well as other properties of the registration like the min time between taps.
      // The subscription is named with a title-generated GUID that is also sent back with the tap as a context ID.
      // Subscriptions can be added and removed individually, without affecting other subscriptions in the "subscriptions" object.
      // To remove a subscription, set its context ID to null.
      // (Like the "ready" and "active" flags, the "subscriptions" data is copied out and maintained internally, so the normal replace-all rule on system fields doesn't apply to "subscriptions".)
      // Can't be set on large sessions.
      "subscriptions": {
        "961dc162-3a8c-4982-b58b-0347ed086bc9": {
          "profile": "party",  // Or "matchmaking", "initialization", "roster", "queuehost", or "queue"
          "onBehalfOfTitleId": "3948320593",  // Optional decimal title ID of the registered channel.  If not set the title ID is taken from the token.
        },
        "709fef70-4638-4b94-905b-24cb02706eb5": null
      }
    }
```

#### <a name="server-elements"></a>Элементы сервера

Серверы являются сторонних пользователей, добавленных или были приглашены в сеанс. Связанные объекты JSON, /servers/ {server-name} / константы/система и /servers/ {server-name} / свойства/system. Эти объекты доступны для записи только серверами.

| Примечание.                                                         |
|---------------------------------------------------------------------------|
| В настоящее время не используется /servers/ {server-name} / константы/системным объектом. |


### <a name="session-configuration"></a>Конфигурация сеанса

Существует два способа управления конфигурации сеансов:

-   Используйте шаблоны сеансов, принимаемых через XDP или центра партнеров.
-   Используйте вызовы многопользовательскую и подбор игроков WinRT API или REST API. Вы по-прежнему необходимо использовать шаблон, но шаблон не должен содержать значения, которые вы хотите настроить. Обратите внимание на то, что название не может переопределить константы, уже задано в шаблоне.

Для определения самого сеанса предоставляется отдельный документ JSON. Кроме того разработчик должен реализовать все функциональные возможности программы-оболочки WinRT, необходимые для определенного заголовка. Содержимое документов JSON и любой код оболочки WinRT точно должны отражать друг с другом и должны отражать последней версией контракта шаблона.

Схема для сеанса включено управление версиями с версией сеанса (основной номер версии), а также изменения протокола (дополнительный номер версии). Версии будут объединены в заголовке X-Xbl-контракт-Version как «100 \* основных + младшая». Например заголовок версии 1.7 включает следующий заголовок при каждом запросе REST, при условии, что последней версии шаблона контракта 107: X-Xbl контракт Version: 107.

| Примечание.                                                                                              |
|----------------------------------------------------------------------------------------------------------------|
| Большинство заголовков (с помощью XSAPI) рекомендуется использовать версию контракта 105 и версия шаблона сеанса 107. |


### <a name="session-templates"></a>Шаблоны сеансов

Каждый шаблон сеанса — это документ JSON, частью конфигурации службы, который определяет платформу для создания сеанса и предоставляет константы для нового сеанса. Дополнительные сведения см. в разделе [MPSD сеанса шаблоны](../service-configuration/session-templates.md).

## <a name="session-capabilities"></a>Возможности сеанса

Возможности — это константы в сеансе MPSD настройки поведения, которое MPSD применяется к этому сеансу. Чаще всего используются для задания возможностей в шаблоне сеанса XDP и центра партнеров. Они устанавливаются в объекте /constants/system/capabilities. При необходимости нет возможности использовать возможности пустой объект.

| Примечание.                                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------|
| Заголовки практически никогда не изменить или получить доступ к возможностям сеанса, с помощью многопользовательские API WinRT или координирующему WinRT API. |

Представлены возможности сеанса **MultiplayerSessionCapabilities класс**. Они являются логические значения, указывающие сеанса, которые может поддерживать:

-   Подключение
-   Игры
-   Размер большого объема
-   Подключения, необходимые для активных участников

**MultiplayerSessionConstants класс** определяет следующие свойства, относящиеся к возможности сеанса:

-   **CapabilitiesConnectivity**
-   **CapabilitiesGameplay**
-   **CapabilitiesLarge**

| Примечание.                                                                                                   |
|---------------------------------------------------------------------------------------------------------------------|
| Если заголовок определяет возможность динамического сеанса, соответствующему свойству присваивается значение true, если для сеанса константы. |

## <a name="session-size"></a>Размер сеанса

Размер сеанса MPSD определяется количество элементов в этом сеансе.


### <a name="maximum-session-size"></a>Максимального размера сеанса

Максимальный размер сеанса — это максимальное число сеансов члены, которые оно может учитывать. Он представлен **MultiplayerSessionConstants.MaxMembersInSession свойство**. Максимальный элемент размер задается в объекте /constants/system.

Размер максимальное число сеансов между 1 и 100 членов сеанса, а значение по умолчанию 100, если не задать при создании. Если требуемый размер более чем 100, сеанс называется «крупный» сеанса и задается особым образом.

Установка максимального размера для сеанса может привести к open слот, будут выводиться в виде полной во время определенных отключиться сценариев. Например если игрок будет отключен в результате сбоя сети или электропитания, задержка не отразится немедленно в сеансе. Элемент имеет значение в неактивное состояние, используя средство обнаружения отключения, описанные в [обработка уведомлений MPSD изменение и отключение обнаружения](multiplayer-session-directory.md).

В отличие от этого одноранговой ячейки, которая использует периодический сигнал для обнаружения разрыв часто поддерживает отключение через два-три и это может создать слот player немедленно. Тем не менее данный арбитр невозможно удалить других участников.

### <a name="large-sessions"></a>Большой сеансов

Большие MPSD сеанс может иметь до 1000 элементов, но он имеет некоторые функции сеанс отключен, такие как получение списка всех элементов. Представленный сеанса largeness **MultiplayerSessionCapabilities.Large свойство**. Это свойство имеет значение true для обозначения больших сеанса и «крупный» возможность указывается в объекте /constants/system/capabilities. 

## <a name="session-user-states"></a>Состояние сеанса пользователя



MPSD определяет состояние пользователя в качестве состояния пользователя, который был добавлен к сеансу. Возможные состояния определены по **MultiplayerSessionStatus перечисления**. Он также считается со статусом «доступно» перед добавлением к сеансу.

**MultiplayerSession.SetCurrentUserStatus метод** может использоваться для изменения состояния сеанса пользователя. Это изменение можно сделать для ОСТАЛЬНОЙ системой параметр /members/ {index} / свойства/правильно в документе JSON игр сеанса.


### <a name="reserved-user-state"></a>Зарезервированные пользовательской среды

Пользователь переходит в состояние зарезервированные пользователя при арбитр выбрал пользователь для заполнения одного из открытых слотов в рамках сеанса. В этом состоянии пользователь еще не официально принял приглашение к сеансу или объединить сеанса, чтобы начать подключение с коллегами.


### <a name="active-user-state"></a>Активное состояние пользователя

Когда пользователь входит в активном состоянии, заголовок должен быть присоединен к сеанса от имени пользователя и пользователь активно участвует в сеансе. Этот пользователь продолжает работу в этом состоянии до тех пор, пока он воспроизводится игры.

Заголовок первого запуска, оно должно проверить, чтобы увидеть, если пользователь уже является членом всех сеансов, как правило, проверяя состояние сеанса. Если пользователь входит в сеанс, заголовок можно перейти сразу к игры и установить все участвующие локальных членов для пользовательской активной.

Пользователь должен оставаться в активном состоянии при воспроизведении в сеансе. Если пользователь покидает сеанса через пользовательский Интерфейс в игре, пользователю следует удалить из сеанса с **MultiplayerSession.Leave метод**. Если пользователь является только временно сейчас из игры, как при ограниченном название, заголовок следует сохранить пользователя в активном состоянии в течение приемлемого времени. Он подходит для изменения состояния пользователя неактивно, если пользователь не был возвращен после заголовка заданного периода времени.


### <a name="inactive-user-state"></a>Неактивное состояние пользователя

В неактивное состояние пользователь не участвует в настоящее время с игрой, но по-прежнему имеет сохраненные слот в сеансе. Другими словами пользователь «не активно».

Это консоли пользователя, который отвечает за задание этого состояния пользователей неактивно в сеансе. Арбитр не может выполнить это действие. Ниже перечислены ситуации, в которых пользователь переходит в неактивное состояние:

-   Заголовок получает событие приостановка.
-   Пользователь был неактивным (нет ответа входных данных или контроллера) в течение заданного времени, задаваемый заголовок. Мы рекомендуем использовать две минуты для конкурентоспособности многопользовательскую.
-   Заголовок был в режиме ограниченного для более чем за две минуты, или период, определенный заголовок. Этот период времени ожидания ограниченного режима является ожидаемое количество времени, для которого пользователь может быть от заголовка с помощью связанных приложений или другие возможности, относящиеся к заголовку.
-   Пользователь был некорректно отключен от сеанса. См. в разделе [MPSD изменить обработка уведомлений и отключить обнаружение](multiplayer-session-directory.md).

Если запускается заголовок и состояние пользователя для члена конкретного сеанса установлено неактивный, заголовок было приостановлено, или пользователь был неактивным в течение слишком долго в сеансе. Поскольку заголовок запустить еще раз, значение, указывающее является пользователь хочет продолжить игр сеанса, к которой он принадлежит. Если состояние пользователя активен при запуске title, такая ситуация, вероятно, из-за отключения сети или другой сценарий, где заголовок не удалось задать пользователя неактивный до прерывания. В обоих случаях заголовок вашей следует повторных попыток возобновления соединения пользователя с игрой и других пользователей, чтобы продолжить воспроизведение или удалить пользователя из сеанса.

### <a name="user-state-when-the-session-is-over"></a>Состояние пользователя при сеанс через

Для сеанса установлено по, игры не поддерживается. Заголовок должен разрешить всем пользователям удалить себя, используя **MultiplayerSession.Leave метод**. Действия сеанса, связанные с пользователями, автоматически очищается, когда они покидают сеанса.

## <a name="visibility-and-joinability"></a>Видимость и Joinability

Доступ к сеансу управляется на уровне MPSD два параметра: видимости сеанса и joinability сеанса. Видимость и joinability рекомендации в этом разделе, применимы для наиболее распространенных сценариев title. Заголовки должны соответствовать эти параметры, если это возможно, и использовать логику в заголовок для определения окончательного, заслуживающих доверия, о том, является ли новый исполнитель это означает, что в сеанс.


### <a name="session-visibility"></a>Видимость сеанса

Видимость сеанса представлен константа, которая устанавливается во время создания сеанса. Он обычно определяется в шаблоне сеанса и определяет прочитаны каждого типа пользователей и доступ на запись к сеансу. Возможные значения для обеспечения видимости сеанса определяются **MultiplayerSessionVisibility перечисления**. Настройки, разрешенные для константы видимость в JSON-файл, open, видимым и закрытый.


#### <a name="recommended-game-session-visibility-open"></a>Рекомендуется видимость игр сеанса: открыть

Открытые сеансы игры не требуют резервирования проигрывателя, которые упрощает процесс приглашения. Арбитр не резервирует исполнителей в MPSD после отправки приглашения, но отслеживается только приглашенным игроков локально. Таким образом проигрыватели можно немедленно подключиться к арбитр и определяет, следует присоединиться к сеансу, отклоняются или должна ожидать (если поддерживаются ожидания игроков). Арбитр получает все права и отвечает и указывает, что новый член оставаться в или выйти из сеанса.

С помощью видимости открытый сеанс игры требуется приглашенного проигрывателя, чтобы запустить заголовок и подключить к арбитр до окончательного решения были внесены. Это допустимо для отображения сообщения об ошибке для пользователя, если сеанс — полный или если приглашение было отклонено.

Чтобы установить подключение арбитру, по адресу безопасные устройства является обязательным. **MultiplayerSessionProperties.HostDeviceToken свойство** чтобы узнать, какой элемент сеанса используется арбитр текущего сеанса надежную и безопасную которой адрес устройства, приглашенный проигрыватель следует использовать для подключения.

### <a name="session-joinability"></a>Joinability сеанса

Joinability сеанса определяет, какие типы пользователей можно присоединиться к сеансу. Он может быть задана динамически во время сеанса. Ниже приведены возможные значения для joinability сеанса.

-   Нет (по умолчанию) — нет ограничений на кто может подключиться к сеансу.
-   Локальный--только локальные пользователи могут подключиться к сеансу.
-   А затем — только для локальных пользователей и пользователей, которые выполняются другими участниками сеанса можно подключиться к сеансу без резервирования.

Арбитр сеанса можно создать закрытый сеанс через параметр joinability. Делая joinability локальным или последующей ограничивает доступ к сеансу и делает его закрытого.

Кроме того данный арбитр должен хранить список сеанса joinability таким образом, чтобы старые сеанса приглашает можно отклонить, на уровне узла, при необходимости. К примеру Если любой приглашенного проигрыватели не поступили присоединиться к сеансу, пока сеанс, который уже заполнен, арбитр можно указать присоединяемый игроков, что сеанс был заблокирован, и им нужно выйти из сеанса автоматически.

## <a name="session-timeouts"></a>Время ожидания сеанса

Сеансы можно изменить, таймеров и других внешних событий. Время ожидания сеанса определить периоды, для которых члены сеанса может оставаться в определенных состояниях, прежде чем они автоматически сделана неактивной или удален из сеанса. MPSD также поддерживает время ожидания для управления жизненным циклом сеанса.

| Примечание.                                                                                                                                                                                                                                                           |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Параметры времени ожидания, внесенные в /constants/system/timeouts или в рамках управляемая инициализация объекта, для версии контракта шаблона 104/105. 107 или более поздней версии параметры задаются по отдельности в/константы/системе или в рамках управляемая инициализация объекта. |

По истечении срока действия таймера MPSD автоматически обновление сеанса и уведомление арбитр в данный момент времени о любых изменениях. Состояния сеанса и время ожидания обновляются только непосредственно перед чтением или отправляется запрос на запись. Немедленное обновление обеспечивает наиболее актуальные данные, возвращенные.

| Примечание.                                                                                                          |
|----------------------------------------------------------------------------------------------------------------------------|
| Время ожидания сеанса не помещаются в стек, и только один применяется для перехода между состояниями для каждого элемента сеанса на обновление. |


### <a name="currently-defined-timeouts"></a>В настоящее время определены времени ожидания

В этом разделе описывается временем ожидания, которое в настоящее время определяются MPSD. Все время ожидания указанный в миллисекундах. Значение 0 допускается и указывает нулевым временем ожидания. Считается, бесконечное время ожидания и не имеет значения. Так как время ожидания по имеют значения по умолчанию, следует явно указать значение null для бесконечное время ожидания.
#### <a name="evaluationtimeout"></a>evaluationTimeout

Это время ожидания указывает количество времени для участником сеанса, чтобы сделать и загрузите решение оценки. Если решение не получено, решение считается сбоя. Это время ожидания помещается в объекте управляемая инициализация.


#### <a name="inactiveremovaltimeout"></a>inactiveRemovalTimeout

Это время ожидания задается для члена сеанса, который подключения к сеансу, но в настоящее время не участвует в игре. Элемент удаляется из сеанса через 2 часа, по умолчанию.

| Примечание.                                                                      |
|----------------------------------------------------------------------------------------|
| Это время ожидания обозначается неактивные время ожидания для версии контракта шаблона 104/105. |

Во многих случаях рекомендуется задать неактивные времени ожидания 0, приводит к любому пользователю, который присваивается неактивное состояние, немедленно удаляются из сеанса и соответствующие слоты для очистки. Такое поведение желательно для наиболее конкурентные многопользовательских игр, поэтому, если пользователь прошли неактивных или достигнут неактивном состоянии, нового игрока могут добавляться быстро. Для кооперативного или другие подходы к разработке многопользовательских может потребоваться название, чтобы разрешить пользователям больше времени для повторного подключения, если они отключены или не участвует в заголовок для периодов времени. Обратите внимание на то, что не единое решение подходит для всех сценариев разработки.

#### <a name="jointimeout"></a>joinTimeout

Это время ожидания указывает количество миллисекунд, чтобы присоединиться к сеансу, доступные пользователю. Резервирование пользователей, которые не удалось присоединиться к удаляются. Это время ожидания помещается в объекте управляемая инициализация.


#### <a name="measurementtimeout"></a>measurementTimeout

Это время ожидания указывает период бездействия сеанса член имеет для отправки измерений. Член, не удалось передать измерения помечен с указанием причины, из «timeout». Это время ожидания помещается в объекте управляемая инициализация.

| Примечание.                                                                                                                                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Во время подбор игроков применяется 45 секунд времени ожидания для измерения качества обслуживания. Корпорация Майкрософт рекомендует использование измерения времени ожидания, которое меньше или равно 30 секундам во время подбор игроков. |


#### <a name="readyremovaltimeout"></a>readyRemovalTimeout

Это время ожидания задается для участника сеанса, в который должен быть присоединен к сеансу и пытается получить в игру. Обычно это означает, что оболочка присоединен пользователя от имени заголовка и запуске заголовок. Элемент удаляется из сеанса и поместить в неактивное состояние после 3 минуты, по умолчанию.

| Примечание.                                                          |
|----------------------------------------------------------------------------|
| Это время ожидания указывает время ожидания готовности для версия контракта 104/105. |


#### <a name="reservedremovaltimeout"></a>reservedRemovalTimeout

Это время ожидания задается для участника сеанса, в который был добавлен к сеансу другим пользователем, но еще не присоединенный сеанса. Резервирование удаляется, а элемент считается неактивным, истечения времени ожидания. Значение по умолчанию — 30 секунд.

| Примечание.                                                             |
|-------------------------------------------------------------------------------|
| Это время ожидания назначается зарезервированный время ожидания для версии контракта 104/105. |


#### <a name="sessionemptytimeout"></a>sessionEmptyTimeout

Это время ожидания указывает время в миллисекундах, после сеанса становится пустым при его удалении. По умолчанию используется значение 0.

| Примечание.                                                                 |
|-----------------------------------------------------------------------------------|
| Это время ожидания указывает время ожидания sessionEmpty версия контракта 104/105. |


### <a name="session-timeout-example"></a>Пример времени ожидания сеанса

1.  Четыре игрока запуска сеанса.
2.  Два игрока, A и B, будут отключены из-за сбоя питания. Их состояние в игре остается активной.
3.  Другие два игрока, C и D, закройте надлежащим образом при использовании **MultiplayerSession.Leave метод**.
4.  Сеанс остается открытым, с помощью проигрывателей A и B отключен, но по-прежнему в активном состоянии.
5.  Через несколько дней, проигрыватель объект возвращает и начинает игру.
6.  Проигрыватель A игра проверяет для сеансов, которые A является членом (выполняет чтение) и находит потерянный сеанс из несколько дней назад.
7.  Сеанс выполняет проверку наличия с двумя игроками, которые будут по-прежнему в сеансе (A и B).
    1.  Поскольку проигрыватель A запускает заголовок, проверка присутствия для проигрывателя A завершится успешно и активное состояние игрока в соответствие остается изменений.
    2.  B игрок не запущена заголовок. Таким образом проверка присутствия для проигрывателя B завершается ошибкой и служба устанавливает состояние проигрывателя B неактивный. На этом этапе начинается неактивные время ожидания для проигрывателя.

8.  Проигрыватель объект выходит из сеанса надлежащим образом при использовании **оставьте** метод.
9.  Неактивные тайм-аута для проигрывателя B, который удаляется из сеанса, в следующем чтения или записи кем-либо.
10. Теперь сеанс содержит нулевые члены и удаляется из службы.

Если неактивные время ожидания для сеанса примере имеет значение 0, B проигрывателя завершались сразу после проверки наличия на шаге 7a и, возможно, удаляется в процессе записи сеанса. В этом случае закрывается сеанс без необходимости дополнительной считывается или записи в сеанс.


## <a name="multiple-signed-in-users-on-a-single-console"></a>Несколько вошедших пользователей на одной консоли


Когда нескольким пользователям войти в в одной консоли, ее некоторые пользователи могут быть в сеансе игр, тогда как другие пользователи не в сеансе или не активированы в заголовок текущей. Игры приглашения можно также получать и принят для нескольких пользователей, влияющие на членстве игр сеанса. Заголовок необходимо учесть следующие правильно обрабатывать все сценарии членства сеанса.

В типичном случае новый проигрыватель выполняет вход, становится активным в игре и должен быть добавлен к существующему сеансу игр. Как при создании нового сеанса игры, заголовок следует добавлять только пользователь при необходимости во время игры.

С помощью нескольких вошедших пользователей одного или нескольких пользователей можно также получать приглашения к другому сеансу игр. Для обработки таких ситуаций конкретных никак не обязательно заголовки. Состояния и член события сеанса уведомить заголовок по обновлениям игр членства сеансов и пользователей.

Для обработки нескольких вошедших пользователей для онлайн-сеансу, подписывается заголовок для плечо, сможет узнать касается для всех пользователей с помощью отдельных **XboxLiveContext класс** объекта для каждого пользователя. Использует заголовок **MultiplayerSession.ChangeNumber свойство** для определения конкретного изменения в сеансе и игнорировать повторяющиеся плечо, сможет узнать касается его.


## <a name="process-lifecycle-management"></a>Управление жизненным циклом процесса


Так же, как заголовок не многопользовательскую с названием в многопользовательской могут столкнуться с title приостановку и прекращение работы события жизненного цикла процесса. Арбитр сеанса таким образом следует периодически сохранить состояние сеанса. В случае, если данный арбитр приостанавливается, заголовок следует установить миграцию arbiter и сохранить состояния игры, соответствующим образом, чтобы новый арбитр можно восстановить состояние сеанса. Становится возможным для полной многопользовательской будет приостановлена и возобновлена в дальнейшем, до тех пор, пока сеанс действителен в MPSD. Только один назначенный однорангового узла обычно игр, необходимо обновить глобальные состояния игры.


### <a name="storage-of-game-metadata"></a>Хранилище метаданных игр

Заголовок хранит метаданные игры в сеансе MPSD. Игры метаданные — это сведения, необходимые для отображения данных сеанса и включить заголовок для поиска и присоединиться к сеансу, игр. Заголовок хранит метаданные, относящиеся к проигрывателя в разделе пользовательских свойств для сеанса члена, например, цвет проигрывателя оружия проигрывателе для сеанса и т. д. Метаданные для всего сеанса, к примеру, текущего объекта map, хранится в разделе глобальных свойств пользовательского сеанса MPSD.


### <a name="storage-of-game-state"></a>Хранилище состояния игры

Состояния игры хранится в хранилище под управлением title (TMS), с помощью **название службы хранилища**. Хранилище с помощью этого расположения позволяет заголовок миграцию arbiter, не опасаясь разрешение. См. в разделе [миграции арбитр](migrating-an-arbiter.md).

| Примечание.                                                                                                               |
|---------------------------------------------------------------------------------------------------------------------------------|
| Заголовок не следует пытаться сохранить состояния игры TMS чаще, чем каждые 5 минут, если оно приостановлено. |

## <a name="cleanup-of-inactive-sessions"></a>Очистка неактивных сеансов

Если sessionEmptyTimeout имеет значение 0, сеанс MPSD автоматически удаляется при последней проигрыватель оставляет сеанс. Узнайте, как не содержащие игроков после сбоя или отключения неиспользуемых сеансам, см. в разделе [обработка уведомлений MPSD изменение и отключение обнаружения.](multiplayer-session-directory.md). Неправильной обработки неиспользуемых сеансы после сбоя или отключения может вызвать проблемы, когда заголовок запрашивает сеансы для проигрывателя.

Для очистки неактивных сеансов рекомендуется иметь запрос названия всех сеансов для конкретного пользователя путем вызова **MultiplayerService.GetSessionsAsync метод** и затем оценивая сеансы. При обнаружении устаревших сеанс вызывает заголовок **MultiplayerSession.Leave метод** для всех локальных игроков в сеансе. Этот вызов в конечном счете удаляет число элементов, 0 и очищает сеансы.

## <a name="session-arbiter"></a>Арбитр сеанса


Некоторые многопользовательские методы должны вызываться только одним клиентом в рамках сеанса игры. Этот клиент является одним из консолей, участвующих в сеансе, называется арбитр или узла. Если хотя бы один член сеанса в игре, сеанс должен иметь арбитра для отслеживания соединений в процессе выполнения.


### <a name="setting-the-arbiter"></a>Параметр арбитр

При создании сеанса, клиент назначает арбитр одной консоли. См. в разделе [как: Задайте арбитра для сеанса MPSD](multiplayer-how-tos.md).


### <a name="saving-session-state"></a>Сохранение состояния сеанса

Как уже говорилось в **управление жизненным циклом процесса**, арбитр следует периодически сохранения состояния сеанса. Новый арбитр должен иметь возможность восстановить состояние сеанса в случае миграцию arbiter, заголовок. Дополнительные сведения см. в разделе [миграции арбитр](multiplayer-how-tos.md).


### <a name="managing-game-session-members-and-joins-in-progress"></a>Управление элементами игры сеансов и соединений в ход выполнения

Наиболее важной ролью арбитр сеанс — для управления пользователями, поступающих на игры сеанс воспроизведения. Это включает в себя обработку игр приглашения, уведомление игроков ожидания и работа с игроками, которые выхода из игры.


#### <a name="receiving-notifications"></a>Получение уведомлений

Арбитр должен прослушивать для новых игроков, которым требуется присоединиться к сеансу, игры с **RealTimeActivityService.MultiplayerSessionChanged событий**.


#### <a name="finding-players-to-fill-empty-game-session-slots"></a>Поиск проигрывателей для заполнения слотов пустой сеанс игр

Арбитр находит проигрывателей для заполнения слотов пустой сеанс игры с одной из этих операций:   Если заголовок вашей использует сеанс основной или другой механизм для источников данных позволяют соединения отложенной, найти члены нового сеанса с помощью этого механизма.
-   Создание другого сеанса билет совпадения.

См. также [как: Заливка слотов открытый сеанс во время Координирующему](multiplayer-how-tos.md).


#### <a name="handling-invited-session-members"></a>Обработка пригласить членов сеанса

Арбитр необходимо отслеживать элементы приглашенного сеанса и применить минимальный интервал между приглашения для одного пользователя. См. также [как: Отправлять приглашения игр](multiplayer-how-tos.md).
