---
title: Каталог многопользовательской
description: Дополнительные сведения о каталоге Xbox Live многопользовательской (MPSD).
ms.assetid: a9b029ea-4cc1-485a-8253-e1c74184f35e
ms.date: 04/04/2017
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10, xbox, один, mpsd, многопользовательской каталога.
ms.localizationpriority: medium
ms.openlocfilehash: 1681fe59533ebaf0db197efb95ca46b828846f5d
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57662549"
---
# <a name="multiplayer-session-directory-mpsd"></a>Каталог сеансов многопользовательской игры (MPSD)

В данной статье содержатся следующие разделы:

* Общие сведения о MPSD
* MPSD изменить обработка уведомлений и отключить обнаружение
* Дескрипторы MPSD сеансов
* Синхронизацию обновлений сеанса
* Вызов MPSD
* Шаблоны MPSD сеанса
* Обозреватель многопользовательской

## <a name="session-overview"></a>Общие сведения о сеансе

### <a name="what-is-mpsd"></a>Что такое MPSD?

Directory многопользовательской (MPSD) — это служба, работающие в облаке Xbox Live, которая централизует метаданными многопользовательской системы между клиентами. Он помещается в оболочку **MultiplayerService класс**.

MPSD позволяет заголовки для совместного использования основные сведения, необходимые для подключения группы пользователей. Он гарантирует, что функции сеанса синхронизированных и согласованность. Он согласовывает работу с оболочки и консоли операционной системы в отправка и принятие приглашения и, соединяемой с помощью карточке игроков.


### <a name="mpsd-sessions"></a>Сеансы MPSD

Представленный в сеансе MPSD **MultiplayerSession класс** как сценарии, в котором один или несколько пользователей используют игры. Сеанс сохраняется по MPSD как надежный документ JSON, размещенные в облаке Xbox Live. В частности сеанс MPSD имеет следующие характеристики:   Создается и управляется заголовки.

-   Имеет уникальный URI. Дополнительные сведения см. в разделе **идентификаторы URI каталог сеанса**.
-   Обеспечивает подключение между пользователями, называемых участниками сеанса.
-   Хранит данные, полезные для включения игры воспроизвести, например, атрибуты для члена, настройки игры, начальная загрузка сведения и сведения о сервере игр.

MPSD поддерживает несколько вариантов сеанса для использования при настройке поддержки многопользовательских игр. Каждый сеанс содержит идентификаторы пользователей Xbox игроков (XUIDs) и защиты данных адрес сопоставления устройств.

-   Сеанс игр, используемая в качестве шаблона для игры. Игры сеанса может быть peer-to-peer, ведущего узла одноранговой сети, одноранговых сервер или сочетание этих типов.
-   Билет сеанса, вспомогательный сеанса, используемым для отслеживания состояния соответствия во время подбор игроков. Он также часто является основной сеанса и иногда может быть игр сеанса. См. в разделе [Координирующему SmartMatch](smartmatch-matchmaking.md).
-   Целевой объект сеанса, вспомогательный сеанса, созданные во время координирующему для представления соответствующих игры. Это занятие длится почти всегда также игр. См. в разделе [Координирующему SmartMatch](smartmatch-matchmaking.md).
-   Основной сеанс, вспомогательный сеанса, используемым для размещения приглашенного игроками, которые ожидают присоединиться к сеансу игр. Много книг создать основную сеанса и сеанс игр. Дополнительные сведения см. в разделе **управление игроков в заголовок вашей**.

## <a name="mpsd-change-notification-handling-and-disconnect-detection"></a>MPSD изменить обработка уведомлений и отключить обнаружение

MPSD позволяет клиентам подключаться к нему с помощью службы веб-сокета активности в реальном времени. Соединение используется для следующего.

-   Отправить уведомления краткое (плечо, сможет узнать касания) при происходят изменения сеанса, в зависимости от подписки на события с названия запуска.
-   Обнаружение отключения пользователя.
-   Задать пользователей как неактивные и впоследствии удалить их из на основе сеанса при отключении обнаружения.


### <a name="making-user-connections"></a>Настройка подключений пользователей

Библиотека XSAPI управляет соединением между клиентом и MPSD. Сначала вызывает title **MultiplayerService.EnableMultiplayerSubscriptions метод**. Этот метод указывает XSAPI клиент планирует использовать соединение активности в реальном времени для многопользовательской целей. Затем, в том случае, если заголовок выполняет его первый вызов **метод MultiplayerService.WriteSessionAsync** или **MultiplayerService.WriteSessionByHandleAsync метод**, с текущим пользователем, задайте в активную состояние подключения создается и привязываем ее к MPSD.

| Примечание.                                                                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|
| Чтобы включить уведомления о сеансе и выявлять отключения сеанса шаблон содержит connectionRequiredForActiveMembers присвоено значение true. |

| Примечание.                                                                                                                                                                                                                                                                                                                            |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| В прежних версиях XSAPI, вызывается заголовки **RealTimeActivityService.ConnectAsync метод** для создания подключения к службе активности в реальном времени. Для многопользовательскую 2015 этот метод не выполняет никаких действий и создания подключения по требованию. |

### <a name="subscribing-for-session-changes"></a>Подписка для изменения сеанса

MPSD использует «плечо, сможет узнать отвод» как это упрощенное уведомление об изменении нечто интересное. Заголовок следует извлекать измененного ресурса для определения характера изменений. С подписками включена, можно подписаться заголовок для касается плечо, сможет узнать об изменениях сеанса с помощью вызова **MultiplayerSession.SetSessionChangeSubscription метод**. См. в разделе [как: Подпишитесь на уведомления об изменении сеанса MPSD](multiplayer-how-tos.md).


### <a name="handling-shoulder-taps"></a>Обработка плечо, сможет узнать касается

При изменении сеанса совпадает с подпиской title для этого сеанса, MPSD уведомляет заголовок с помощью **RealTimeActivityService.MultiplayerSessionChanged событий**. Заголовок должен получить сеанс и сравнить полученная версия сеанса связи с предыдущей кэшированного представления и реагировать соответствующим образом.


### <a name="handling-notifications-of-connection-state-changes"></a>Обработка уведомлений об изменениях состояния подключения

Заголовок может также получать уведомления об изменениях в работоспособности соединения MPSD. Два события указывают, эти изменения: ** событий RealTimeActivityService.MultiplayerSubscriptionsLost **--инициируется при потере соединения title для MPSD, с помощью службы активности в реальном времени. При возникновении этого события, заголовок следует выключить многопользовательскую.
-   ** Событие RealTimeActivityService.ConnectionStateChanged ** — активированных после временной замены в работоспособности title подключение к службе активности в реальном времени. Заголовок не требуется предпринимать никаких действий при получении этого события, но его можно использовать событие для диагностики.


### <a name="disconnecting-clients"></a>С отключением клиентов

Клиенты названия отключиться от MPSD, когда заголовок отключает уведомления с помощью вызова **RealTimeActivityService.DisableMultiplayerSubscriptions метод**. Вскоре после этого вызова **MultiplayerSubscriptionsLost** порождается, указывающее, что клиент отключился от MPSD.

| Примечание.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| В более ранних версиях многопользовательской называется заголовки ** метод RealTimeActivityService.Disconnect ** для отключения от службы активности в реальном времени. Многопользовательскую 2015 этот метод не выполняет никаких действий. Отключение происходит автоматически после **DisableMultiplayerSubscriptions** вызывается, если нет пользователей из подключение веб-сокета, к примеру, на наличие подписки на службу активности в реальном времени. |


### <a name="disconnect-detection"></a>Отключение обнаружения

Использует MPSD его отключить возможность обнаружения, чтобы быстро узнать, когда пользователь отключает некорректно. Ненормальные disconnect могут возникнуть при сбое сети игрока, или при аварийном завершении заголовок. MPSD изменяет состояние отключенных игрока с "Активно" неактивный и уведомляет другие члены сеанса изменения соответствующим образом, на основе подписок членов в сеанс.

## <a name="mpsd-handles-to-sessions"></a>Дескрипторы MPSD сеансов

Дескриптор сеанса MPSD является абстрактным и неизменяемый к сеансу, который также может содержать дополнительные типизированных данных. Это похоже на дескриптор файла. Все дескрипторы иметь дескриптор идентификатор (GUID) и полный сеанса ссылку, состоящий из конфигурации службы идентификатор (SCID), шаблон сеанса и имя сеанса. Не удается обновить дескриптор, но его можно создать, прочитать и удалить.

| Примечание.                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| Дескриптор может указывать на сеансе, который не существует. Создание дескриптора, используя имя несуществующего сеанса не вызывает новый сеанс должен быть создан. |


### <a name="handle-types"></a>Типы дескрипторов

Многопользовательскую 2015 поддерживает типы дескрипторов, описанные в этом разделе.

#### <a name="invite-handle"></a>Пригласить дескриптор

Дескриптор приглашение представляет приглашение определенным пользователем (пригласить). Данные определенного типа включают лицо источника, целевого пользователя и контекст строка, описывающая приглашение, например, отдельный режим игры.

Дескриптор приглашение предоставляет доступ на чтение и запись к открытый сеанс. Если сеанс закрывается, дескриптор предоставляет доступ только для чтения сеанса.

| Примечание.                                                |
|------------------------------------------------------------------|
| MPSD можно создать приглашение, даже если сеанс полный или закрытое. |


#### <a name="activity-handle"></a>Дескриптор действия

Дескриптор действия указывает на действия пользователя в данный момент. Действие пользователя, представленного **MultiplayerActivityDetails класс**.

| Примечание.                                                                                                                                                                                                                      |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Дескриптор действия могут также быть явно удалены, но только для наименования-владельца для конкретного пользователя. Это делается с помощью **MultiplayerService.ClearActivityAsync метод**. |


### <a name="creating-an-invite-handle"></a>Создание дескриптора приглашения

Для создания дескриптора приглашения, а вызовы title **MultiplayerService.SendInvitesAsync метод**. Метод приглашение будет отправлено указанных пользователей в виде пользовательского интерфейса всплывающее уведомление, в которую получателей может принять приглашение.


### <a name="creating-an-activity-handle"></a>Создание дескриптора действия

Для создания дескриптора действия, а вызовы title **MultiplayerService.SetActivityAsync метод**. MPSD задает новый идентификатор дескриптора как действие связанный элемент сеанса. В случае предыдущего связанного действия MPSD удаляет соответствующий дескриптор. Когда активным участником становится неактивным или оставляет сеанс, MPSD удаляет дескриптор связанного действия.


### <a name="using-handles"></a>Использование дескрипторов

Заголовок использует маркеры, когда пользователь принимает приглашение (приглашение дескриптор) и пользователь присоединяется к друга текущего действия (действие дескриптор). В обоих случаях необходимо заголовка:

1.  Получите идентификатор дескриптора из названия параметров активации.
2.  Создайте локальный объект сеанса MPSD и присоедините его как активный.
3.  Запись сеанса, передавая соответствующий дескриптор.

## <a name="synchronization-of-session-updates"></a>Синхронизацию обновлений сеанса

Поскольку сеанс — это общий ресурс, создается или обновляется каким-либо из его членов, не существует потенциально конфликтующие записи. Это может вызвать непредвиденные результаты, к примеру, один заголовок можно непреднамеренно перезаписать изменения, внесенные программой другое название. В MPSD подход к устранению этих конфликтов — поддерживают оптимистичный параллелизм и шаблон чтения, изменения и записи.

Синхронизация обновлений сеанса с MPSD используйте два шаблона соответствующей реализации высокого уровня:

-   Арбитр обновляет общей части сеанса. Если ваша реализация включает в себя единый арбитр, можно избежать с помощью синхронизированные обновления для большинства операций записи. Заголовок можно избежать синхронизации (1) обновление, которое арбитр общей части сеанса, если они связаны с связи класса arbiter удостоверения и (2) любое обновление, которое заголовок в область элементов в рамках сеанса.

| Примечание.                                                                                                                                                                                                                                                                                                                                              |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Несмотря на то, что выше типы обновлений не требуется синхронизация, по-прежнему важно синхронизировать все обновления для ** MultiplayerSessionProperties.HostDeviceToken свойство **. Это свойство используется для обмена данными удостоверения класса arbiter, например, в ходе миграции класса arbiter. |

-   Все клиенты обновляют общей части сеанса. В этом случае необходимо синхронизировать все обновления в общей части сеанса. Тем не менее заголовки можно также создавать свои собственные области члена без синхронизации.


### <a name="session-update-synchronization-using-the-multiplayer-winrt-api"></a>С помощью многопользовательские WinRT API синхронизации обновления сеанса

Следующими методами WinRT API многопользовательские реализации оптимистичной параллельной обработки:

-   **Метод MultiplayerService.WriteSessionAsync**
-   **Метод MultiplayerService.WriteSessionByHandleAsync**
-   **Метод MultiplayerService.TryWriteSessionAsync**
-   **Метод MultiplayerService.TryWriteSessionByHandleAsync**

Каждый метод write принимает **MultiplayerSessionWriteMode перечисления** значение. Передача значения SynchronizedUpdate использует оптимистичный параллелизм для обновления.

Другие значения в перечислении устранения потенциальных конфликтов при первоначальном создании сеанса. Каждая операция записи в часть MPSD сеанс, который потенциально может записываться в другое название необходимо использовать синхронизированного обновления. Однако не все операции записи должны быть защищены.

Если заголовок вашей пытается выполнить запись объекта локального сеанса с помощью одного из методов записи сеанса MPSD и получает код состояния HTTP/412, его следует обновить локальную копию, выполнив **метод MultiplayerService.GetCurrentSessionAsync**вызов для получения последней версии сервера перед повторной попыткой записи сеанса. В противном случае документ локальный сеанс по-прежнему содержать неверные данные, и вызовы для записи сеанса проблема не устранена.

| Примечание.                                                                                                                                                                                  |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Если заголовок с помощью одного из **TryWrite\***  методы, обновленные сеанса возвращается в случае с кодом состояния HTTP/412. Это позволяет избежать необходимости вызывать **GetCurrentSessionAsync**. |

Когда заголовок вызывает один из методов записи сеанса, обновленная версия сеанса может быть возвращен. В противном случае заголовок следует переключиться в его локальную копию этой новой версии в потокобезопасным способом.


### <a name="session-update-synchronization-using-the-multiplayer-rest-api"></a>С помощью API REST многопользовательские синхронизации обновления сеанса

MPSD поддерживает оптимистичный параллелизм в обновления сеанса с помощью функции REST с помощью заголовка HTTP «if-match», с параметрами ETag и модель, чтения, изменения и записи. ETag, переданный запрос записи должен быть тем, который возвращает MPSD с предыдущим запросом на чтение.

## <a name="calling-mpsd"></a>Вызов MPSD

Для заголовка для доступа к MPSD для использования в многопользовательской системе и подбор игроков двумя способами:
-   Рекомендуется использовать. Используйте многопользовательские API WinRT, который содержит классы, которые действуют как оболочки для RESTful функциональные возможности. См. в разделе **пространства имен Microsoft.Xbox.Services.Multiplayer**. Для партнеров SmartMatch используйте координирующему WinRT API, представленный **пространства имен Microsoft.Xbox.Services.Matchmaking**.
-   Используйте прямой стандартный HTTP-вызовов многопользовательскую и подбор игроков REST API, включенных в **Xbox Live Services RESTful Reference**. Применимые идентификаторы URI описаны в **идентификаторы URI каталог сеанса** (для многопользовательскую) и **идентификаторы URI Координирующему** (для партнеров). Связанные объекты JSON описаны в **ссылку на объект JavaScript Object Notation (JSON)**.


### <a name="using-the-multiplayer-winrt-api-to-call-mpsd"></a>С помощью многопользовательские WinRT API для вызова MPSD

Для вызова MPSD рекомендуется использовать многопользовательские API WinRT и координирующему WinRT API.

| Примечание.                                                                                             |
|---------------------------------------------------------------------------------------------------------------|
| Примеры XDK написаны с использованием многопользовательскую и API-интерфейсы WinRT подбор игроков и другие элементы XSAPI. |

Использование кода программы-оболочки для базовой функции REST позволяет более традиционного подхода на использование методов API на стороне клиента без необходимости обрабатывать HTTP-трафик для каждого вызова. Двоичный файл и источник для XSAPI входят в состав XDK. Можно использовать двоичный файл напрямую, или измените источник и включить ее в заголовок вашей, при необходимости.


### <a name="using-the-multiplayer-rest-api-to-interact-with-mpsd"></a>Использование многопользовательскую REST API для взаимодействия с MPSD

Заголовок или его службе, можно использовать стандартный HTTP-вызовов многопользовательские REST API и подбор игроков REST API. При использовании функции REST напрямую, вызывающая сторона проблемы удалите, PUT, POST и получить вызовов к каталогу сеансов идентификаторы URI для большинства действий. На запрос PUT текст запроса добавляются в существующий сеанс. Если нет существующего сеанса, в тексте запроса используется для создания нового сеанса, наряду с шаблоном сеанса, хранящихся на [портале разработчиков Xbox (XDP)](https://xdp.xboxlive.com) или [центра партнеров](https://partner.microsoft.com/dashboard). Все поля являются необязательными, и должен быть указан только изменения. Таким образом {} является допустимым запросом PUT с нуля «дельты».

Чтобы выполнить гипотетические запрос PUT, возвращающий результат слияния без влияния на официальную копию сеанса для сервера, после добавления строки запроса «? nocommit = true» для запроса PUT.

Запросы и отклики для многопользовательскую и методы REST API координирующему — это документы JSON. Для многопользовательской структуры запроса, см. в разделе **MultiplayerSessionRequest (JSON)**. Структуру связанного ответа показан в **MultiplayerSession (JSON)**. Структура ответного обрамляет элементы сеанса в виде связанного списка и заполняет другие свойства только для чтения, сеанса и его членов.


### <a name="querying-for-sessions-and-session-templates-rest"></a>Запросы для сеансов и шаблоны сеансов (REST)

Свои заголовки можно запрашивать сведения о сеансе уровнях шаблона сеанса и конфигурацию службы. В этом разделе рассматриваются запросы, использующие многопользовательские REST API.


#### <a name="query-for-basic-session-information"></a>Запрос информации базовый сеанс

Можно настроить запросы базовые функции сеанса и сведения, с помощью каталога сеансов и подбор игроков идентификаторы URI. Результат запроса — это массив JSON, ссылки, с некоторыми данными сеанса встроенными сеанса. По умолчанию запрос получает до 100 сеансов отличным от private.

| Примечание.                                                          |
|----------------------------------------------------------------------------|
| Каждый запрос должен включать фильтр ключевых слов, фильтр XUID или оба. |


#### <a name="query-for-session-templates"></a>Запрос для сеанса шаблонов

Чтобы получить список шаблонов сеанса SCID, а также сведения о шаблоне конкретного сеанса, используйте метод GET для одного из следующих URI:
-   **/serviceconfigs/{scid}/sessiontemplates**
-   **/serviceconfigs/{scid}/sessiontemplates/{sessionTemplateName}**


#### <a name="query-for-session-state"></a>Запрос для состояния сеанса

Чтобы запросить состояние сеанса, используйте метод GET для одного из таких URI:
-   **/serviceconfigs/ {scid} / сеансов**
-   **/serviceconfigs/{scid}/sessiontemplates/{sessionTemplateName}/sessions**

## <a name="multiplayer-session-explorer"></a>Обозреватель многопользовательской

Многопользовательскую сеанса обозревателя — это средство, встроенные в MPSD для просмотра сеансов, шаблоны сеансов, а также строки локализации. Средство предназначено только для того, который будет использоваться для разработки "песочницы".


### <a name="accessing-multiplayer-session-explorer"></a>Доступ к многопользовательской Explorer

| Примечание.                                                                                                      |
|------------------------------------------------------------------------------------------------------------------------|
| Чтобы использовать средство, необходимо войти. Просмотр веб-страниц ограничено сеансов, имеющих пользователя вошедшего в систему в качестве члена. |

Для доступа к обозревателю сеанса многопользовательскую, откройте Internet Explorer на Xbox One, нажмите клавишу **представление** и ввести <https://sessiondirectory.xboxlive.com/debug> в **адрес** поля.

| Примечание.                                                                                                                                                                                |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| При попытке доступа к средству в изолированной среде розничной ТОРГОВЛИ, вы получите код состояния HTTP/404. Дополнительные сведения об этом коде, см. в разделе [коды состояния сеанса многопользовательскую](multiplayer-session-status-codes.md). |


### <a name="using-multiplayer-session-explorer"></a>С помощью обозревателя многопользовательской


#### <a name="open-the-main-page"></a>Откройте главной страницы

1.  Доступ к главной странице средства. В «песочнице» отображаются контекст безопасности (пользователя, вошедшего в систему и "песочницы") и список кодов (SCIDs) конфигурации службы.
2.  Нажмите клавишу **меню** кнопку, чтобы закрепить эту страницу на домашнюю страницу, чтобы не нужно каждый раз вводить URI.


#### <a name="display-available-sessions-and-templates"></a>Отображение доступных сеансов и шаблоны

1.  Щелкните SCID в средстве, чтобы отобразить список сеансов в этой SCID, членом которой является вошедшего в систему пользователя.
2.  На этой же странице можно щелкнуть SCID и отобразить шаблоны сеансов и строки локализации в конфигурацию службы для SCID. Эти элементы полученные через [XDP](https://xdp.xboxlive.com) или [центра партнеров](https://partner.microsoft.com/dashboard).


#### <a name="display-the-full-contents-of-a-session"></a>Отобразить все содержимое сеанса

В обозревателе многопользовательскую сеанс щелкните имя сеанса, чтобы отобразить все содержимое соответствующего сеанса.

Сеанс, как обозначено MPSD могут отличаться от ответа на стандартный метод GET для URI сеанса по нескольким причинам:

-   Вызов GET может использоваться более старой версии контракта в заголовке X-Xbl-контракт-Version. Обозреватель сеанса всегда отображает сеанс, используя самую последнюю версию контракта.
-   При запросе сеанса обычно через GET, преобразований и побочные эффекты можно запустить, например, истекло время ожидания. Сеанс Explorer отображает моментальный снимок сеанса, так как оно хранится, выполняя все логики, преобразования или побочные эффекты.
-   Так как поле объекта JSON nextTimer вычисляется в то же время, как побочных эффектов, он отсутствует на MPSD сеансов.

## <a name="see-also"></a>См. также

[Общие сведения о сеансе](mpsd-session-details.md)

[Коды состояния многопользовательской](multiplayer-session-status-codes.md)

[Инструкции: Обновление многопользовательской](multiplayer-how-tos.md)

[Инструкции: Веб-трансляции MPSD от активации заголовка](multiplayer-how-tos.md)

[Инструкции: Подпишитесь на уведомления об изменении сеанса MPSD](multiplayer-how-tos.md)

[Подбор игроков SmartMatch](smartmatch-matchmaking.md)