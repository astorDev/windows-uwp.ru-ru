---
title: С помощью XIM (C#)
description: Сведения об использовании Xbox интегрированной многопользовательскую (XIM) с C#.
ms.date: 04/24/2018
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10, встроенная многопользовательскую xbox
ms.localizationpriority: medium
ms.openlocfilehash: 92ac7b9897b57de42fa56126b477f4db5b9b74dd
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57619439"
---
# <a name="using-xim-c"></a>С помощью XIM (C#)

> [!div class="op_single_selector" title1="Language"]
> - [C++](using-xim.md)
> - [C#](using-xim-cs.md)

Это краткое Пошаговое руководство по использованию элемента XIM C# API. Разработчики игр, желающих получить доступ через C++ XIM увидите [использование XIM (C++)](using-xim.md).
- [С помощью XIM (C#)](#using-xim-c)
    - [Предварительные требования](#prerequisites)
    - [Инициализация и запуск](#initialization-and-startup)
    - [Асинхронные операции и обработки изменений состояния](#asynchronous-operations-and-processing-state-changes)
    - [Базовая обработка IXimPlayer](#basic-iximplayer-handling)
    - [Включение друзей присоединить и приглашение их](#enabling-friends-to-join-and-inviting-them)
    - [Основные подбор игроков и переход к другой сети XIM с другими пользователями](#basic-matchmaking-and-moving-to-another-xim-network-with-others)
    - [Отключение правила преобразования сетевых адресов партнеров для целей отладки](#disabling-matchmaking-nat-rule-for-debugging-purposes)
    - [Оставив XIM сети, а также удаление](#leaving-a-xim-network-and-cleaning-up)
    - [Отправка и получение сообщений](#sending-and-receiving-messages)
    - [Оценка качества передачу данных](#assessing-data-pathway-quality)
    - [Совместное использование данных с помощью проигрывателя пользовательских свойств](#sharing-data-using-player-custom-properties)
    - [Совместное использование данных с помощью пользовательского свойства сети](#sharing-data-using-network-custom-properties)
    - [Подбор игроков с помощью навыков проигрывателя](#matchmaking-using-per-player-skill)
    - [Подбор игроков с помощью роли проигрывателя](#matchmaking-using-per-player-role)
    - [Как работает XIM с командами проигрывателя](#how-xim-works-with-player-teams)
    - [Работа с разговора](#working-with-chat)
    - [Отключение звука игроков](#muting-players)
    - [Настройка целевых объектов чата с помощью команды проигрывателя](#configuring-chat-targets-using-player-teams)
    - [Заполнение автоматическую фоновую проигрывателя слотов (координирующему «задним числом»)](#automatic-background-filling-of-player-slots-backfill-matchmaking)
    - [Запрос присоединяемая сетей](#querying-joinable-networks)

## <a name="prerequisites"></a>Предварительные условия

Прежде чем приступить к созданию кода с помощью XIM, существует два предварительных требования.

1. Необходимо настроить AppXManifest приложения со standard многопользовательские сетевыми возможностями и вам нужно настроить сетевой части манифеста для объявления шаблонов шаблон, используемый XIM трафик.

    Возможности AppXManifest и манифесты сети описаны более подробно в соответствующих подразделах документации платформы; Типичный XIM определенного XML-Документы, вставьте предоставляется [конфигурации проекта XIM](xim-manifest.md).

1. Необходимо иметь два компонента удостоверение сведений о приложении:

    * Идентификатор назначенного заголовок Xbox Live.
    * Идентификатор конфигурации службы, предоставляемые как часть подготовки приложения для доступа к службе Xbox Live.

    См. в разделе к представителю корпорации Майкрософт Дополнительные сведения о получении их. Эти части информации будет использоваться во время инициализации.

## <a name="initialization-and-startup"></a>Инициализация и запуск

Вы начали взаимодействовать с библиотекой путем инициализации свойства статического класса XIM строкой Xbox Live ID конфигурации службы и Идентификационный номер, название. Если вы также используете API службы Xbox, может оказаться удобным получить информацию из `Microsoft.Xbox.Services.XboxLiveAppConfiguration`. В следующем примере предполагается, что значения уже находятся в переменных «myServiceConfigurationId» и «myTitleId» соответственно:

```cs
XboxIntegratedMultiplayer.ServiceConfigurationId = myServiceConfigurationId;
XboxIntegratedMultiplayer.TitleId = myTitleId;
```

После инициализации приложения должны получить строки идентификатор пользователя Xbox для всех пользователей в настоящее время на локальном устройстве, которые будут участвовать и передать их в `XboxIntegratedMultiplayer.SetIntendedLocalXboxUserIds()` вызова. В следующем примере кода предполагается, что один пользователь нажал кнопки контроллера выражения намерения для воспроизведения и строку идентификатора пользователя Xbox, связанные с пользователем уже были получены в переменную «myXuid»:

```cs
XboxIntegratedMultiplayer.SetIntendedLocalXboxUserIds(new List<string>() { myXuid });
```

Вызов `XboxIntegratedMultiplayer.SetIntendedLocalXboxUserIds()` немедленно устанавливает значение идентификаторы пользователей Xbox, связанные с локальных пользователей, которые должны быть добавлены к XIM сети. Этот список идентификаторов пользователей Xbox, которая будет использоваться во всех операциях сети в будущем до изменения списка с помощью другого вызова `XboxIntegratedMultiplayer.SetIntendedLocalXboxUserIds()`.

В случае, когда сеть не XIM вообще еще не создана прежде всего для перемещения сети XIM для получения этого процесса запуска. Если пользователя еще нет определенной сети XIM помните, мы рекомендуем чтобы просто переместить в новую, пустую сети. Это позволяет друзей пользователя войти в сеть как своего рода «основной», из которого они могут работать совместно друг с другом для выбора их далее многопользовательские действий (таких, как ввод подбор игроков).

Ниже приведен пример того, как переместить только локальных пользователей, ранее добавлены с классом `XboxIntegratedMultiplayer.SetIntendedLocalXboxUserIds()` сетью пустой XIM с местом для игроков до 8 общее:

```cs
XboxIntegratedMultiplayer.MovetoNewNetwork(8, XimPlayersToMove.BringOnlyLocalPlayers);
```

Вызов `XboxIntegratedMultiplayer.MovetoNewNetwork()` инициирует асинхронную операцию перемещения, завершается, регулярно, разработчикам обрабатывал для событие изменения состояния.

## <a name="asynchronous-operations-and-processing-state-changes"></a>Асинхронные операции и обработки изменений состояния

Сердцем XIM является приложения регулярных частые вызовы `XboxIntegratedMultiplayer.GetStateChanges()` метод. Этот метод является как XIM уведомляется о том, что приложение будет готово для обработки обновлений многопользовательской состояние, и как XIM предоставляет эти обновления, возвращая `XimStateChangeCollection` объект, содержащий все обновления в очереди. `XboxIntegratedMultiplayer.GetStateChanges()` позволяет быстро работать таким образом, что каждый кадр графики может быть вызвана в цикле отрисовки пользовательского интерфейса. Это обеспечивает удобное место для получения всех изменений в очереди, не беспокоясь о непредсказуемость времени сети и уровня сложности многопоточных обратного вызова. XIM API фактически оптимизирован для этого шаблона, один поток. Это гарантирует, что его состояние останется неизменным при `XimStateChangeCollection` время обработки объекта и еще не был удален.

`XimStateChangeCollection` — Это коллекция `IXimStateChange` объектов.
Приложения должны:

1. Перебор массива.
1. Проверьте `IXimStateChange` для его более конкретный тип.
1. Приведение `IXimStateChange` типа в соответствующий более подробные типа.
1. Обрабатывать обновления соответствующим образом.

После завершения со всеми `IXimStateChange` объектов в настоящее время недоступно, этот массив должны быть переданы обратно XIM, чтобы освободить ресурсы путем вызова `XimStateChangeCollection.Dispose()`. `using` Инструкции рекомендуется, чтобы ресурсы будут гарантированно будет удален после обработки. Например:

```cs
using (var stateChanges = XboxIntegratedMultiplayer.GetStateChanges())
{
    foreach (var stateChange in stateChanges)
    {
        switch (stateChange.Type)
        {
            case XimStateChangeType.PlayerJoined:
                HandlePlayerJoined((XimPlayerJoinedStateChange)stateChange);
                break;

            case XimStateChangeType.PlayerLeft:
                HandlePlayerLeft((XimPlayerLeftStateChange)stateChange);
                break;

            ...
        }
    }
}
```

Теперь, когда у вас есть цикл базовую обработку, можно обрабатывать изменения состояния, связанные с начального `XboxIntegratedMultiplayer.MoveToNewNetwork()` операции. Каждая операция перемещения XIM сети будет начинаться с `XimMoveToNetworkStartingStateChange`. Если по какой-либо причине происходит сбой перемещения, то приложение будет предоставляться `XimNetworkExitedStateChange`, который является распространенная ошибка, механизм для асинхронной ошибки, предотвращает перемещение к сети XIM или отключение от текущей сети XIM обработки. В противном случае перемещения завершится с `XimMoveToNetworkSucceededStateChange` после того как все состояния завершена и всех игроков были успешно добавлены к сети XIM.

Когда пользователь не имеет привилегий платформы для воспроизведения с другими пользователями в многопользовательской, XIM отправляет на устройство, попытка создания или подключения к сети XIM `XimNetworkExitedStateChange` с указанием причины `UserMultiplayerRestricted`. Это происходит, когда значение любой из локальных пользователей с `XboxIntegratedMultiplayer.SetIntendedLocalXboxUserIds()` имеют ограничение многопользовательские Xbox Live. Информируя пользователя о проблеме обработки соответствующим образом.

## <a name="basic-iximplayer-handling"></a>Базовая обработка IXimPlayer

При условии, что в примере перемещения одного локального пользователя к новой сети XIM прошло успешно, приложение будет предоставляться `XimPlayerJoinedStateChange` локальной `XimLocalPlayer` объекта. Этот объект будет действительным до соответствующего `XimPlayerLeftStateChange` предоставляются и возвращаться через `XimStateChangeCollection.Dispose()`. Приложения всегда будет предоставляться `XimPlayerLeftStateChange` для каждого `XimPlayerJoinedStateChange`.

Также можно получить список всех `IXimPlayer` объектов в XIM сети в любое время с помощью `XboxIntegratedMultiplayer.GetPlayers()`.

`IXimPlayer` Объект имеет множество полезных свойств и методов, таких как `IXimPlayer.Gamertag()` для получения текущей строки Xbox Live: тег игрока, связанного с проигрывателя в целях отображения. Если `IXimPlayer` является локальным для устройства, то IXimPlayer.Local возвратит значение true. Локальный `IXimPlayer` может быть приведен к `XimLocalPlayer`, который имеет дополнительные методы, которые доступны только для локального игроков.

Само собой наиболее важные состояние для игроков не общих сведений, которые XIM знает, но что хочет отслеживать конкретного приложения. Поскольку собственные конструкции для этого сведения об отслеживании скорее всего, нужно будет связать `IXimPlayer` объекта собственный объект конструкция проигрывателя, таким образом, чтобы в любое время отчеты XIM `IXimPlayer`, можно быстро получить состояние без выполнения выполняет поиск, задав нестандартный проигрыватель объект контекста. В следующем примере предполагается, находится объект, содержащий закрытого состояния в переменной «myPlayerStateObject» и вновь добавленная `IXimPlayer` объект находится в переменной «newXimPlayer»:

```cs
newXimPlayer.CustomPlayerContext = myPlayerStateObject;
```

Это сохраняет указанный объект с объектом проигрывателя локально (никогда не передается по сети для удаленных устройств где память не будет допустимым). Затем можно всегда вернуться объекта путем получения пользовательского контекста и преобразования его в объект, как в следующем примере:

```cs
myPlayerStateObject = (MyPlayerState)(newXimPlayer.CustomPlayerContext);
```

Этот контекст пользовательского проигрывателя можно изменить в любое время.

## <a name="enabling-friends-to-join-and-inviting-them"></a>Включение друзей присоединить и приглашение их

Для обеспечения конфиденциальности и безопасности всех сетей заново XIM автоматически настраиваются по умолчанию был только присоединяемая локального проигрывателями и именно в приложение, чтобы явно разрешить другим пользователям, когда он будет готов. В следующем примере показано, как использовать `XboxIntegratedMultiplayer.NetworkConfiguration` для получения текущей конфигурации сети и обновления с помощью joinability `XboxIntegratedMultiplayer.SetNetworkConfiguration()` начинается, позволяя новым локальным пользователям, чтобы присоединить как проигрыватели, а также других пользователей, приглашенных или, которые " » (Xbox Live социальных сетей отношение) за которым следует исполнителей уже в сети XIM:

```cs
XimNetworkConfiguration currentConfiguration = new XimNetworkConfiguration(XboxIntegratedMultiplayer.NetworkConfiguration);
currentConfiguration.AllowedPlayerJoins = XimAllowedPlayerJoins.Local | XimAllowedPlayerJoins.Invited | XimAllowedPlayerJoins.Followed;
XboxIntegratedMultiplayer.SetNetworkConfiguration(currentConfiguration);
```

`XboxIntegratedMultiplayer.SetNetworkConfiguration()` асинхронно выполняет. После завершения предыдущего вызова образец кода `XimNetworkConfigurationChangedStateChange` предоставляется для оповещения приложения об изменении joinability значение по умолчанию `XimAllowedPlayerJoins.None`. Затем можно выполнять запросы новое значение, установив значение `XboxIntegratedMultiplayer.NetworkConfiguration.AllowedPlayerJoins`.

`XboxIntegratedMultiplayer.NetworkConfiguration.AllowedPlayerJoins` можно проверить, пока устройство находится в сети XIM для определения joinability сети.

Один из проигрывателей локального следует хотите отправить приглашения для удаленных пользователей, для присоединения к этой сети XIM, приложение может вызвать `XimLocalPlayer.ShowInviteUI()` для запуска системы приглашение пользовательского интерфейса. Здесь локальный пользователь может выбрать людей, которым требуется пригласить и отправить приглашения.

```cs
XimLocalPlayer.ShowInviteUI();
```

После выполнения Приведенная выше инструкция приглашение системы пользовательского интерфейса будет отображаться. Как только пользователь отправленных приглашений (или в противном случае закрытия пользовательского интерфейса), `xim_show_invite_ui_completed_state_change` будет предоставляться. Кроме того, приложение может отправлять приглашения, которым напрямую с помощью `XimLocalPlayer.InviteUsers()` не открывая приглашение системы пользовательского интерфейса.

В любом случае удаленного пользователи получат приглашение сообщений общего доступа к Xbox Live, везде, где они вошли в систему и может принимать. Это приведет к запуску приложения на этих устройствах, если оно еще не запущено, и «активировать протокол» его с аргументами события, которые могут использоваться для перемещения к этой же сети XIM.

См. в разделе документации по платформе Дополнительные сведения об активации протокола сам.

В следующем примере показано, как вызов `XboxIntegratedMultiplayer.ExtractProtocolActivationInformation()` определяет, применимо к XIM ли аргументы события. Предполагается, что полученные необработанную строку URI из `Windows.ApplicationModel.Activation.ProtocolActivatedEventArgs` переменной «uriString»:

```cs
XimProtocolActivationInformation protocolActivationInformation;
XboxIntegratedMultiplayer.ExtractProtocolActivationInformation(uriString, out protocolActivationInformation);
if (protocolActivationInformation != null)
{
    // It is a XIM activation.
}
```

Если это активации XIM, то необходимо обеспечить локального пользователя, определенного в свойстве «LocalXboxUserId» `XimProtocolActivationInformation` объект выполнил вход и среди пользователей, указанных для `XboxIntegratedMultiplayer.SetIntendedLocalXboxUserIds()`. Затем можно инициировать переход к указанной сети XIM вызовом `XboxIntegratedMultiplayer.MoveToNetworkUsingProtocolActivatedEventArgs()` используя ту же строку URI. Например:

```cs
XboxIntegratedMultiplayer.MoveToNetworkUsingProtocolActivatedEventArgs(uriString);
```

Также Обратите внимание, что удаленные пользователи «и» можно перейти к карточная локального пользователя в пользовательский Интерфейс системы и инициировать попытки соединения сами без приглашения (при условии, что вам предоставлены такие соединения проигрывателя, как показано выше). Это действие также будет протокола активации приложения так же, как приглашения сделать обрабатываются таким же образом.

Перемещение к XIM сети, используя протокол активации идентична переход на новую сеть XIM, как показано в [инициализации и запуска](#initialization-and-startup). Единственное отличие заключается в, если переход выполнен успешно, перемещение устройства будет предоставляться проигрывателя локальных и удаленных `XimPlayerJoinedStateChange` объекты, представляющие применимо игроков. Естественно, исходное устройство, которая уже была размещена в сети XIM не перемещение, но будет см. в разделе добавить пользователей на новое устройство как проигрыватели через дополнительные `XimPlayerJoinedStateChange` объектов.

После игроков на различных устройствах в сети XIM соединяются друг с другом, их можно инициировать многопользовательских сценариях, автоматически обмениваться данными по голоса и текста и отправки сообщений конкретного приложения.

## <a name="basic-matchmaking-and-moving-to-another-xim-network-with-others"></a>Основные подбор игроков и переход к другой сети XIM с другими пользователями

Далее можно развернуть сетевые возможности для группой друзей, переместив игроков к XIM сети, которая также имеет совсем. Незнакомцам являются соперниками из по всему миру, переносятся вместе с помощью службы Xbox Live подбор игроков на основе их интересов основе.

Простым способом для запуска основных партнеров с XIM является вызовом `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()` на одном из устройств с заполненного `MatchmakingConfiguration` объекта, используя игроков из текущей сети XIM вместе с ним.

Следующий пример запускает перемещения с помощью конфигурации подбор игроков, для поиска для сопоставления команд нет Приходите и вы всего 8 игроков. Если 8 общее проигрыватели не найден, система может по-прежнему соответствовать игроков 2 – 7 друг с другом. В этом примере используется константу приложения определенные тип uint, с именем MYGAMEMODE_DEATHMATCH, представляющее режим игры для фильтрации за пределами класса. Подбор игроков XIM будут соответствовать этой сети только с другими пользователями, указав же значение и переводит вдоль всех социально присоединенных игроков текущей сети XIM при предоставлении второй параметр `XimPlayersToMove.BringExistingSocialPlayers` для `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()`:

```cs
var matchmakingConfiguration = new XimMatchmakingConfiguration();
matchmakingConfiguration.TeamConfiguration.TeamCount = 1;
matchmakingConfiguration.TeamConfiguration.MinPlayerCountPerTeam = 2;
matchmakingConfiguration.TeamConfiguration.MaxPlayerCountPerTeam = 8;
matchmakingConfiguration.CustomGameMode = MYGAMEMODE_DEATHMATCH;
XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking(matchmakingConfiguration, XimPlayersToMove.BringExistingSocialPlayers);
```

Как и более ранних перемещений, это позволит обеспечить первоначальный `MoveToNetworkStartingStateChange` на всех устройствах и `MoveToNetworkSucceededStateChange` после успешного завершения перемещения. Так как это перемещение из одной XIM сети в другую, отличие в том, уже существуют `IXimPlayer` объекты добавлены для локальных и удаленных пользователей, и они останутся для всех игроков, переходим к новой сети XIM друг с другом. Чат и данных взаимодействия между проигрыватели будут продолжать работать без перерыва, подбор игроков во время выполнения.

Подбор игроков может занять длительное время в зависимости от количества потенциальных игроков в пуле подбор игроков, которые вызвали также `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()`.

Объект `XimMatchmakingProgressUpdatedStateChange` будет предоставляться периодически во время выполнения операции, чтобы сохранить вас и ваших пользователей в курсе текущего состояния. Если найдено совпадение, дополнительных исполнителей добавляются к сети XIM со стандартными `PlayerJoinedStateChange` и завершения перемещения.

После завершения многопользовательской работы вместе с данным набором игроков «matchmade», можно повторить процесс для перемещения в другую сеть XIM с другого цикла подбор игроков. Вы увидите каждого игрока, соединены с помощью предварительного `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()` предоставляют операции `PlayerLeftStateChange` указывает, что их `IXimPlayer` объекты больше не находятся в одной и той же сети XIM.

Если при попытке запустить снова, используя координирующему `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()`, указать `XimPlayersToMove.BringExistingSocialPlayers`, проигрыватели, в которых соединены с помощью точек входа социальных сетей (`XboxIntegratedMultiplayer.MoveToNetworkUsingProtocolActivatedEventArgs()` или `xXboxIntegratedMultiplayer.MoveToNetworkUsingJoinableXboxUserId`) останется время новый подбор игроков. Кроме того, указав `XimPlayersToMove.BringOnlyLocalPlayers` приведет к отключению социально подключенных удаленных игроков, оставляя местных работодателей оставаться. В обоих случаях другой набор незнакомцам будут добавляться, после выполнения второй операции перемещения.

Также вы можете выбрать для перемещения проигрыватели не matchmade (или просто работодателей) в совершенно новую сеть XIM при выборе следующего действия configuration/многопользовательскую подбор игроков.

В следующем примере показано, как бы вызвать устройства `XboxIntegratedMultiplayer.MoveToNewNetwork()` XIM сети с максимальным размером 8 игроков, но на этот раз, используя существующие социально присоединенных игроков также:

```cs
XboxIntegratedMultiplayer.MovetoNewNetwork(8, XimPlayersToMove.BringExistingSocialPlayers);
```

Объект `MoveToNetworkStartingStateChange` и `MoveToNetworkSucceededStateChange` будет предоставляться для всех участвующих устройств, вместе с `PlayerLeftStateChange` для matchmade, в который были оставлять. На этих устройствах, он увидит аналогично `PlayerLeftStateChange` для каждого игрока, выходит за пределы сети.

Вы можете продолжить перемещение из сети XIM сети XIM образом выше описано, как много раз, при необходимости.

Для повышения производительности службы Xbox Live не будет пытаться соответствующие группам игроков на устройствах, которые, скорее всего иметь возможность установить все прямые подключения peer-to-peer. Если вы разрабатываете в сетевой среде, которая неправильно настроен для поддержки стандартных Xbox Live многопользовательской, переход на новую сеть, с помощью операции координирующему может по-прежнему бесконечно без успешного сопоставления, даже в том случае, если вы не уверены, что у вас есть достаточно игроки критерию подбор игроков, — это все перемещение и использующие устройства в одной и той же локальной среде. Не забудьте выполнить тест многопользовательские подключения в параметрах сети приложения области и Xbox и выполните его рекомендаций в том случае, если он выводит трудности, особенно в отношении «Strict» NAT.

## <a name="disabling-matchmaking-nat-rule-for-debugging-purposes"></a>Отключение правила преобразования сетевых адресов партнеров для целей отладки

Если администратор сети не может вносить изменения необходимой среды для поддержки элемента XIM правила преобразования сетевых адресов, можно разблокировать вашей подбор игроков, испытания Xbox One пакеты средств разработки, настроив XIM, чтобы разрешать сопоставление устройств «Strict NAT» без хотя бы один «открыть Устройство NAT». Это делается, поместив в файл с именем «xim_disable_matchmaking_nat_rule» (содержимое не имеет значения) в корневом каталоге диска «нуля title» на все консоли Xbox One. Пример для этого рекомендуется, выполнив следующую команду из командной строки XDK перед запуском приложения, заменив заполнитель «{console_name_or_ip_address}» для каждой из консолей соответствующим образом:

```bat
echo.>%TEMP%\emptyfile.txt
copy %TEMP%\emptyfile.txt \\{console_name_or_ip_address}\TitleScratch\xim_disable_matchmaking_nat_rule
del %TEMP%\emptyfile.txt
```

> [!NOTE]
> Этот способ разработки в данный момент доступна только для приложений Xbox One монопольных ресурсов и не поддерживается для универсальных приложений Windows. Также Обратите внимание, что консолей, при использовании этого параметра никогда не будет совпадать с устройствами, которые не имеют этот файл присутствует, вне зависимости от сетевой среды, поэтому не забудьте добавлять и удалять файл везде.

## <a name="leaving-a-xim-network-and-cleaning-up"></a>Оставив XIM сети, а также удаление

Когда закончите локальных пользователей участие в XIM сети, часто они будут просто вернуться к новой сети XIM, позволяющий локальные пользователи приглашает и «за» пользователей, чтобы присоединить ее, поэтому они могут по-прежнему координирование работы с друзьями, чтобы найти следующее действие. Но если пользователь полностью выполняется с помощью всех возможностей многопользовательской, то приложение может потребоваться начать, оставляя XIM полностью сети и возвращения к состоянию, как если бы только `XboxIntegratedMultiplayer.SetIntendedLocalXboxUserIds` бы вызывалась. Это делается с помощью `XboxIntegratedMultiplayer.LeaveNetwork()` метод:

```cs
 XboxIntegratedMultiplayer.LeaveNetwork();
```

Этот метод начинает процесс асинхронно отключение от других участников корректно. Это приведет к удаленных устройств должны быть предоставлены `PlayerLeftStateChange` для каждого локального игрока, который отключен. Локальное устройство будет также будет предоставлен `PlayerLeftStateChange` для каждого игрока локальные и удаленные, который был отключен. Когда все операции завершились, окончательную `NetworkExitedStateChange` будет предоставляться.

Вызов `XboxIntegratedMultiplayer.LeaveNetwork()` и ожидание `NetworkExitedStateChange` для выхода из XIM сети корректно всегда настоятельно рекомендуется при `NetworkExitedStateChange` уже не было предоставлено.

## <a name="sending-and-receiving-messages"></a>Отправка и получение сообщений

XIM и его базовые компоненты выполняют все утомительно установления безопасные каналы связи через Интернет, поэтому не нужно беспокоиться о проблемах подключения или возможность вам гарантирован охват игроков некоторых, но не все. При возникновении проблем с подключением фундаментальные peer-to-peer, перемещение к сети XIM не удастся.

Когда формируется и подтверждено с помощью сети XIM `XimMoveToNetworkSucceededStateChange`, все экземпляры приложения для всех присоединенных устройств, обязательно быть в курсе каждого `IXimPlayer` подключен к сети XIM и позволяет отправлять сообщения на любой из них.

Продемонстрируем, как отправлять сообщения по сети XIM. В следующем примере предполагается, что переменная «sendingPlayer» является объект допустимый локальный проигрывателя. В примере используется "sendingPlayer'' s метод `SendDataToOtherPlayers()` для отправки структуру сообщения, который был скопирован в «msgBuffer» для всех игроков (локальное или удаленное) в сети XIM. Обратите внимание на то, что она ведет к всех игроков, так как список определенных игроков не был передан в метод:

```cs
SendingPlayer.SendDataToOtherPlayers(msgBuffer, null, XimSendType.GuaranteedAndSequential);
```

Будет предоставлен всем получателям сообщения `XimPlayertoPlayerDataReceivedStateChange` , включает в себя копирование данных, как и `IXimPlayer` объекта, отправившего его и список `IXimPlayer` объекты, которые локально его получение.

Само собой последовательные гарантированной доставки удобно, но он также может быть неэффективным отправки, поскольку XIM необходимо передавать или откладывать сообщения, если пакеты не будут удалены или disordered Интернета. Убедитесь, что рекомендуется использовать другие типы отправки сообщений, что приложение может выдержать потери или необходимости прибывают неупорядоченно. Так как данные сообщения поступают с удаленного компьютера, рекомендуется имеют четко определенные форматы данных, например упаковке нескольких байтовых значений в определенной байтовом («порядка следования байтов»). Приложение также следует проверить данные перед его обработкой.

XIM обеспечивает безопасность на уровне сети, поэтому нет необходимости для дополнительных схем шифрования или подписи. Тем не менее мы рекомендуем всегда использовать «защиты в глубину» в том случае, чтобы защититься от случайного ошибки и иметь возможность обрабатывать различные версии вашего приложения протокола сосуществование корректно (во время разработки, обновления содержимого, и т.д.). Подключения к Интернету пользователей может быть ограничена и постоянно меняющиеся ресурсы. Настоятельно рекомендуется использовать форматы данных эффективно сообщения и использования схем, которые отправляют каждый кадр пользовательского интерфейса.

## <a name="assessing-data-pathway-quality"></a>Оценка качества передачу данных

Дополнительные сведения о текущем качестве передачу данных между двумя игроками, проверяя `XimPlayer.NetworkPathInformation` свойство. Дополнительные сведения о качестве текущий путь между двумя игроками, проверяя `XimPlayer.NetworkPathInformation` свойство. Это свойство содержит предполагаемое кругового задержки и количество сообщений, по-прежнему поставлены в очередь локально для передачи в случае соединение не поддерживает передачи большего объема данных для этого момента.

Если вы видите, что очереди при резервном копировании для определенного «IXimPlayer», следует уменьшить скорость, с которой вы передаете данные.

`NetworkPathInformation.RoundTripLatency` Поле представляет задержку базовой сети и оценка задержки XIM элемента без постановки в очередь. Действующие задержка увеличивается как `XimNetworkPathInformation.SendQueueSizeInMessages` роста и XIM работает в очереди.

Выберите разумным точки для начала регулирования вызовы `SendDataToOtherPlayers` на основе использования и требования к игры. Каждое сообщение в очереди отправки представляет увеличение задержки действующие сети.

Значение, близкое к XIM максимальный предел (в настоящее время 3500 сообщения) слишком велико для большинства игр и скорее всего представляет несколько секунд данных, ожидающих отправки в зависимости от скорости вызова `SendDataToOtherPlayers` и как каждого полезных данных. Вместо этого выберите число, которое учитывает требования к задержке игры, а также как перебои управления игры `SendDataToOtherPlayers` является шаблон вызова.

## <a name="sharing-data-using-player-custom-properties"></a>Совместное использование данных с помощью проигрывателя пользовательских свойств

Большинство обмена данными приложение произойти с `XimLocalPlayer.SendDataToOtherPlayers()` метод, поскольку она позволяет наиболее полный контроль над пользователями, получившими его, и когда, как он должен иметь дело с потери пакетов и т. д. Однако бывают случаи, когда было бы неплохо игроки смогут совместно использовать состояние basic, редко меняющиеся о себе с другими пользователями с минимальными усилиями. Например каждый игрок возможно предопределенной строка, представляющая символ модель, выбранная перед переключением в многопользовательской, что всех игроков использовать для отображения их представления в игре.

Для данных, не очень часто изменяется о проигрыватель XIM предлагает проигрыватель пользовательских свойств. Эти свойства состоят заданное приложением имя и значение, содержащий пары заканчивающуюся нулем строку, могут применяться к локальной проигрывателя, и каждый раз, когда они изменяются, автоматически переданы на все устройства.

Свойства нового проигрывателя имеют дополнительные внутренней синхронизации ресурсов, чем `XimLocalPlayer.SendDataToOtherPlayers()` метод, поэтому для быстро изменяющихся данных (т. е. положение исполнителя), по-прежнему должны использовать прямой отправки.

Пары ключей и значений пользовательских свойств проигрывателя иметь их текущие значения, автоматические предоставляемых модулю новых устройств, когда эти устройства подключения к сети XIM и см. в разделе добавлены проигрыватель. Значения можно задать путем вызова `XimLocalPlayer.SetPlayerCustomProperty()` с именем и значением строки, как в следующем примере, задает свойство с именем «модель», в которой имеет значение «грубой» на локальном `IXIMPlayer` объекта, на который ссылается переменная «localPlayer»:

```cs
localPlayer.SetPlayerCustomProperty("model","brute");
```

Изменения свойств проигрывателя приведут `XimPlayerCustomPropertiesChangedStateChange` предоставляться ко всем устройствам, сообщите им о для имен свойств, которые были изменены. Значение для заданного имени могут быть получены по любой проигрывателя, локальное или удаленное с `IXIMPlayer.GetPlayerCustomProperty()`. В следующем примере извлекается значение свойства с именем «модели» из `IXIMPlayer` переменная «ximPlayer»:

```cs
string propertyValue = localPlayer.GetPlayerCustomProperty("model");
```

Сохранение нового значения для данного имени свойства заменяют существующие значения. Имя свойства параметра значение указателя строки значения null обрабатываются так же, как строка с пустым значением, который совпадает со значением свойства, не необходимости указана. Имена и значения не интерпретируется XIM, поэтому он остается в приложение для проверки содержимого строки, при необходимости.

Свойства нового проигрывателя всегда сбрасываются при перемещении из одной сети XIM в другой. Тем не менее новые проигрыватели, в которых присоединитесь к сети XIM будут получать текущие значения свойств нового проигрывателя для всех игроков, имеющих некоторый набор.

## <a name="sharing-data-using-network-custom-properties"></a>Совместное использование данных с помощью пользовательского свойства сети

Пользовательские свойства сети предназначены для удобства, синхронизация данных, относящихся к сети XIM, что изменяются не часто. Сети работают пользовательские свойства идентично [пользовательские свойства проигрывателя](#sharing-data-using-player-custom-properties), за исключением того, их можно установить на одноэлементный объект XIM с `XboxIntegratedMultiplayer.SetNetworkCustomProperty()`. В следующем примере задается свойство «сопоставить», «этом репутацию» значение:

```cs
XboxIntegratedMultiplayer.SetNetworkCustomProperty("map", "stronghold");
```

Изменения свойств сети приведут `NetworkCustomPropertiesChanged` предоставляться ко всем устройствам, сообщите им о для имен свойств, которые были изменены. Значение для заданного имени можно получить с помощью `XboxIntegratedMultiplayer.GetNetworkCustomProperty()`, как в следующем примере, который извлекает значение для свойства именованных «карты»:

```cs
string property = XboxIntegratedMultiplayer.GetNetworkCustomProperty("map")
```

Так же, как [пользовательские свойства проигрывателя](#sharing-data-using-player-custom-properties), задав новое значение для данного имени свойства заменит существующие значения. Имя свойства параметра значение указателя строки значения null обрабатываются так же, как строка с пустым значением, который совпадает со значением свойства, не необходимости указана. Имена и значения не интерпретируется XIM, поэтому он остается в приложение для проверки содержимого строки, при необходимости.

Вновь созданные XIM сети всегда начинаются с набор пользовательских свойств не сети. Тем не менее новые проигрыватели, в которых присоединиться к существующей сети XIM получат текущие значения пользовательских свойств сети для этой сети XIM.

## <a name="matchmaking-using-per-player-skill"></a>Подбор игроков с помощью навыков проигрывателя

Сопоставления игроков с помощью заинтересованы в конкретной указанное приложение игрового режима является хорошим базовый. По мере роста пула доступных игроков, следует также сопоставления игроков, основанные на своих личных умений или опыт работы с игры, ветераны игроки могут оценить преимущества задача работоспособное конкурентной борьбы с другими ветеранов хотя новые проигрыватели может увеличиваться по конкурировать друг с другом с аналогичные возможности.

Чтобы сделать это, сначала укажите уровень квалификации для всех локальных игроков в роли-player и навыков структура конфигурации, заданные в вызовах `XimLocalPlayer.SetRolesAndSkillConfiguration()` перед запуском переместиться XIM сети с помощью подбор игроков. Уровень является понятием конкретного приложения и число не интерпретируется XIM, за исключением того, что подбор игроков вначале предпринимается попытка найти игроков с одинаковым значением навыков и периодически расширить поиск с шагом +/-10, чтобы найти другие игроки, объявление навыков значения в диапазоне вокруг навыков. В следующем примере предполагается, что локальный `XimLocalPlayer` объект, которого переменная имеет значение «localPlayer», имеет значение навыков целочисленным конкретного приложения, полученного из локального или Xbox Live хранилища в переменной с именем «playerSkillValue»:

```cs
var config = new XimPlayerRolesAndSkillConfiguration();
config.Skill = playerSkillValue;
localPlayer.SetRolesAndSkillConfiguration(config);
```

После завершения этой операции будет предоставлен всем участникам `XimPlayerRolesAndSkillConfigurationChangedStateChange` , указывающее на это `IXIMPlayer` изменился ее роли проигрыватель или конфигурации навыков. Новое значение можно получить, вызвав `IXIMPlayer.RolesAndSkillConfiguration`. При всех игроков иметь отличное от null координирующему конфигурацию, применяемую, можно переместить XIM сеть, используя подбор игроков со значением true в параметре `RequirePlayerRolesAndSkillConfiguration` поле `XimMatchmakingConfiguration` структуры для `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()`.

В следующем примере заполняется конфигурации координирующему поиск всего 2 – 8 игроков Приходите и вы нет команд. Кроме того в этом примере константу определенные приложения, который имеет тип Uint64 и с именем MYGAMEMODE_DEATHMATCH, представляющее режим игры для фильтрации за пределами класса. Это настраивает подбор игроков в соответствии с исполнителей XIM сети с другими пользователями, указав те же значения, а также требуя настройки координирующему-проигрывателя.

```cs
XimMatchmakingConfiguration matchmakingConfiguration = new XimMatchmakingConfiguration();
matchmakingConfiguration.TeamConfiguration.TeamCount = 1;
matchmakingConfiguration.TeamConfiguration.MinPlayerCountPerTeam = 2;
matchmakingConfiguration.TeamConfiguration.MaxPlayerCountPerTeam = 8;
matchmakingConfiguration.CustomGameMode = MYGAMEMODE_DEATHMATCH;
matchmakingConfiguration.RequirePlayerRolesAndSkillConfiguration = true;
```

Когда эта структура передается `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()`, операции перемещения начнет нормально, если перемещение игроков вызвали `XimLocalPlayer.SetRolesAndSkillConfiguration()` с ненулевой `XimPlayerRolesAndSkillConfiguration` объекта. Если еще не все проигрывателя, а затем координирующему процессы будут приостановлены и все участники будут предоставлены `XimMatchmakingProgressUpdatedStateChange` с `WaitingForPlayerRolesAndSkillConfiguration` значение. Сюда входят проигрыватели, которые впоследствии присоединитесь к сети XIM через ранее отправленных приглашений или другим способом социальных сетей (например, вызов `XboxIntegratedMultiplayer.MoveToNetworkUsingJoinableXboxUserId()`) до завершения подбор игроков. После всех игроков указаны их `XimPlayerRolesAndSkillConfiguration` объектов, подбор игроков будет возобновлена.

Подбор игроков с помощью навыков проигрыватель может быть совмещена с ролью-player координирующему пользователя, как описано в следующем разделе. Если только один требуется, можно указать значение 0 для других. Это из-за наличия всех игроков объявление `XimPlayerRolesAndSkillConfiguration` навыков значение 0 всегда соответствуют друг другу.

Один раз `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()` или любой другой XIM сети переместить операция завершена, всех игроков `XimPlayerRolesAndSkillConfiguration` структуры будет автоматически очищен в пустой указатель (с сопутствующей `XimPlayerRolesAndSkillConfigurationChangedStateChange` уведомлений). Если планируется переместить в другую сеть XIM, с помощью подбор игроков, требуется настройка-player, необходимо вызвать `XimLocalPlayer.SetRolesAndSkillConfiguration()` попытку, используя объект, который содержит самые последние сведения.

## <a name="matchmaking-using-per-player-role"></a>Подбор игроков с помощью роли проигрывателя

Еще одним методом с помощью ролей-player и навыков конфигурации для улучшения работы пользователей координирующему состоит в использовании ролей требуется проигрыватель. Это лучше всего подходит для игр, содержащие доступный для выбора символьных типов, которые поддерживают разные совместной воспроизведения стили. Символы указанного типа, которые не просто alter графическое представление в игре, а, вместо этого alter стиль игровой процесс для проигрывателя. Пользователей может предпочесть играть в качестве конкретной специализации. Тем не менее если игры разработано так, чтобы он не функционально невозможно завершить целей без хотя бы один человек, выполняющие каждой роли, иногда лучше в соответствии с такой игроков, затем сначала чем чтобы соответствовать любой игроков друг с другом требуют наличия согласование стили play друг с другом собранные один раз. Это можно сделать, определив уникальный битовый флаг, представляющее каждую роль в данной игрока `XimPlayerRolesAndSkillConfiguration` структуры.

В следующем примере задается значение роль для конкретного приложения, который типа Byte и с именем MYROLEBITFLAG_HEALER, для локального `XimLocalPlayer` объект, которого указатель является «localPlayer»:

```cs
var config = new XimPlayerRolesAndSkillConfiguration();
config.Roles = MYROLEBITFLAG_HEALER;
localPlayer.SetRolesAndSkillConfiguration(config);
```

После завершения этой операции будет предоставлен всем участникам `XimPlayerRolesAndSkillConfigurationChangedStateChange` , указывающее на это `IXimPlayer` изменился ее роли проигрыватель или конфигурации навыков. Новое значение можно получить, вызвав `IXimPlayer.RolesAndSkillConfiguration`.

Глобальный `XimMatchmakingConfiguration` структуры для `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()` должен иметь все необходимые роли флаги объединяются с помощью побитового или, а значение true для `RequirePlayerRolesAndSkillConfiguration` поля.

Подбор игроков с помощью-player роли также могут сочетаться с координирующему пользователя-player навыков. Если только один требуется, укажите значение 0 для других. Это из-за наличия всех игроков объявление `XimPlayerRolesAndSkillConfiguration` навыков значение 0 всегда соответствуют друг другу; и, если все биты равны нулю в `XimMatchmakingConfiguration.RequiredRoles` поле, то биты не роли необходимы для поиска соответствия.

Один раз `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()` или любой другой XIM сети переместить операция завершена, всех игроков `XimPlayerRolesAndSkillConfiguration` объектов будет автоматически удалено значение null (с сопутствующей `XimPlayerRolesAndSkillConfigurationChangedStateChange` уведомлений). Если планируется переместить в другую сеть XIM, с помощью подбор игроков, требуется настройка-player, необходимо вызвать `XimLocalPlayer.SetRolesAndSkillConfiguration()` попытку, используя объект, который содержит самые последние сведения.

## <a name="how-xim-works-with-player-teams"></a>Как работает XIM с командами проигрывателя

Многопользовательскую игры часто включает в себя игроков, упорядоченные на противоположных команд. XIM делает его легко назначать группам, когда подбор игроков, задав `XimMatchmakingConfiguration.TeamConfiguration`. Следующий пример запускает перемещения с помощью подбор игроков, настроенный для поиска общей сложности состоит из 8 проигрывателей для размещения в двух группах 4 (несмотря на то, что 4 не найден, также допустимы игроков 1 – 3). Кроме того в этом примере константу определенные приложения, который имеет тип целое число без знака и с именем MYGAMEMODE_CAPTURETHEFLAG, представляющее режим игры для фильтрации за пределами класса.  Кроме того конфигурация предназначена для перенести все социально присоединенных игроков текущей XIM сети:

```cs
var matchmakingConfiguration = new XimMatchmakingConfiguration();
matchmakingConfiguration.TeamConfiguration.TeamCount = 2;
matchmakingConfiguration.TeamConfiguration.MinPlayerCountPerTeam = 1;
matchmakingConfiguration.TeamConfiguration.MaxPlayerCountPerTeam = 4;
XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking(matchmakingConfiguration, XimPlayersToMove.BringExistingSocialPlayers);
```

По завершении такого XIM сетевой операции перемещения игроков будет использоваться значение team индекс 1 до {n} соответствующий с группами {n}, запрошено. Значение индекса команды игрока извлекается с помощью `IXIMPlayer.TeamIndex`. При использовании `XimMatchmakingConfiguration.TeamConfiguration` с два или несколько команд, проигрыватели никогда не назначается team индекс нулевое значение при вызове `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()`. Это вступает в противоречие проигрыватели, которые добавляются к сети XIM с другими конфигурации или тип перемещения операции (такие как через протокол активации, полученные в результате принимает приглашение), кто будет всегда иметь нулевой индекс team. Может оказаться полезным, следует считать специальные команды «неназначенные» team индекс 0.

В следующем примере извлекается индекс группы для объекта player XIM, хранящийся в переменной «ximPlayer»:

```cs
byte playerIndex = ximPlayer.TeamIndex;
```

Основной пользовательский интерфейс (не для ограниченной упоминание возможность поведение игроков отрицательное) службы Xbox Live координирующему никогда не будет разбиения игроками, которые при перемещении в сеть XIM друг с другом на разные команды.

Значение индекса команды, изначально назначенный координирующему является только рекомендацией, приложение можно изменить для локального игроков в любое время `XimLocalPlayer.SetTeamIndex()`. Это также может вызываться в XIM сетей, которые не используют подбор игроков. В следующем примере настраивается XIM локального проигрывателя, хранящегося в переменной «ximLocalPlayer» новое значение индекса команды одного:

```cs
ximLocalPlayer.SetTeamIndex(1);
```

Все устройства информируются, что игрок набрал новое значение индекса команды в силе при они предоставляются в `XimPlayerTeamIndexChangedStateChange` для этого исполнителя. Вы можете вызвать `XimLocalPlayer.SetTeamIndex()` в любое время.

Подбор игроков оценивает ролей требуется проигрыватель независимо от групп разработчиков. Поэтому не рекомендуется использовать необходимые роли и группы в качестве критериев конфигурации одновременных подбор игроков, так как команды будет равномерно распределяться по количеству проигрывателя, не ролями выполненное проигрывателя.

## <a name="working-with-chat"></a>Работа с разговора

Среди игроков в сети XIM автоматически включаются связи чата голоса и текста. XIM обрабатывает взаимодействие с голосовой гарнитуры и микрофон оборудования для вас. Приложение не должно делать много для разговора, но у нее одно требование относительно текста: поддержка ввода и отображения. Текстовое поле является обязательным, поскольку даже на платформах или игр жанров, которые Исторически не были использовать широко физическую клавишу клавиатуры, игроки могут настраивать систему для использования преобразования текста в речь вспомогательных технологий. Аналогичным образом отображения текста не требуется, поскольку игроков может настроить систему, чтобы использовать речи в текст.

Если вы хотите условно включить текст механизмы, эти параметры могут быть обнаружены в местных работодателей, обратившись к `XimLocalPlayer.ChatTextToSpeechConversionPreferenceEnabled` и `XimLocalPlayer.ChatSpeechToTextConversionPreferenceEnabled` поля соответственно, и вы можете условно включить механизмы текст. Тем не менее рекомендуется рассмотреть создание текста ввода и отображения параметров, доступных всегда.

`Windows::Xbox::UI::Accessability` Класс Xbox One специально разработан для предоставления простое отображение текста в игре разговора с упором на вспомогательные технологии распознавания речи в текст.

После ввода текста, предоставляемые реальном или виртуальном клавиатуры, передайте строку для `XimLocalPlayer.SendChatText()` метод. В следующем коде показан отправки пример жестко запрограммированные строки из локальной `IXIMPlayer` объекта, на который ссылается переменная «localPlayer»:

```cs
localPlayer.SendChatText(text);
```

Этот текст чата доставляется всех игроков в XIM сети, которая может получать чата связь от исходного локального проигрывателем, что `XimChatTextReceivedStateChange`. Он может синтезирования речи аудио, активна TTS.

Ваше приложение следует создать копию любой текстовой строки полученных и отобразить ее вместе с ваше удостоверение исходного исполнителя в течение требуемого времени (или в окне с прокруткой).

Существуют некоторые практические рекомендации, касающиеся чата. Рекомендуется, что в любом игроков отображаются, особенно в список gamertags, например табло также отображать значки так заметны говоря обратной связи для пользователя. Это делается путем доступа к `IXimPlayer.ChatIndicator` извлекаемого `XboxIntegratedMultiplayer.XimPlayerChatIndicator` представляющее состояние текущего, моментальное чата для этого исполнителя.

В отчете по `IXimPlayer.ChatIndicator` ожидается изменение часто как проигрыватели start и stop разговор, например. Он предназначен для поддержки приложений, запрашивая у каждого кадра пользовательского интерфейса в результате.

> [!NOTE]
> Если локальный пользователь не имеет достаточных привилегий связи из-за их параметры устройства `XimLocalPlayer.ChatIndicator` вернет `XboxIntegratedMultiplayer.XimPlayerChatIndicator` со значением `XIM_PLAYER_CHAT_INDICATOR_PLATFORM_RESTRICTED`. В соответствии с требованиями для платформы ожидается, что приложение отображать иллюстрациях, указывающее, существующие ограничения на платформы голосовой чат или обмена сообщениями и сообщение для пользователя, указывая, проблему. — Один пример сообщения, мы рекомендуем: «К сожалению, вы не можем chat прямо сейчас.»

## <a name="muting-players"></a>Отключение звука игроков

Также рекомендуется использовать для поддержки отключение звука игроков. XIM автоматически обрабатывает системы звук, инициируется пользователями с помощью проигрывателя карты, но приложения должны поддерживать играми временного отключения звука, могут быть выполнены в Интерфейсе игры с помощью `IXimPlayer.ChatMuted` свойство. В следующем примере запускается отключения звука удаленного `IXIMPlayer` объекта указывает переменная «remotePlayer», чтобы слышали не разговора и не чата текст поступает от него:

```cs
remotePlayer.ChatMuted = true;
```

Отключение звука вступает в силу немедленно и не является изменения состояния не XIM, связанные с ней. Его можно изменить значение `IXimPlayer.ChatMuted` значение false. Следующий пример выключает звук удаленной `IXIMPlayer` объекта, на который ссылается переменная «remotePlayer»:

```cs
remotePlayer.ChatMuted = false;
```

Mutes для остаются в силе, пока `IXIMPlayer` существует, в том числе при переходе на новую сеть XIM с проигрывателем. Не сохраняется после ухода проигрывателя и подключится к одному пользователю (как новый `IXIMPlayer` экземпляра).

Проигрыватели обычно запускаются за считанные unmuted состояние. Если приложение хочет запустите проигрыватель в состояние выключения звука по причинам игровой процесс, можно задать `IXIMPlayer.ChatMuted` на `IXIMPlayer` объекта до завершения обработки связанного `PlayerJoinedStateChange`, и XIM гарантирует период времени не будет где голосовая связь звукового сигнала при помощи можно прослушивать проигрыватель.

Автоматическую проверку выключения звука на проигрыватель репутации основе происходит, когда XIM сети соединяет удаленного проигрывателя. Если игрок набрал флаг ухудшают репутацию, проигрыватель автоматически отключен. Отключение звука влияет только на локальное состояние и таким образом будет повторяться, если игрок перемещается между сетями. Выполнить один раз и не повторно вычисляются для автоматической проверки выключения звука на основе репутации, пока `IXIMPlayer` остается допустимым.

## <a name="configuring-chat-targets-using-player-teams"></a>Настройка целевых объектов чата с помощью команды проигрывателя

Как уже говорилось в [как XIM работает с командами проигрывателя](#how-xim-works-with-player-teams) приложение отвечает настоящего документа, истинный смысл совместной работы любой конкретной команде значение индекса. За исключением сравнения на равенство по отношению к целевой конфигурации чата XIM не интерпретировать их. Целевую конфигурацию чата сообщила `XboxIntegratedMultiplayer.ChatTargets` сейчас `XimChatTargets.SameTeamIndexOnly`, то любого заданного проигрыватель будет только exchange чата обмен данными с другим, если они имеют то же значение, о которых сообщает `IXIMPlayer.TeamIndex` (и конфиденциальности / политики позволяют).

Консервативное и поддержки, конкуренция, вновь созданные XIM сети будут автоматически настроены для использования по умолчанию `XimChatTargets.SameTeamIndexOnly`. Тем не менее общаться с vanquished соперниками другой команды, может быть желательно, например, в игре после «основной». Вы можете сообщить о XIM, чтобы разрешить любому пользователю взаимодействовать с твой (где конфиденциальности и политики Разрешить) путем вызова `XboxIntegratedMultiplayer.SetChatTargets()`. Следующий пример приступает к настройке всеми участниками в сети XIM использовать `XimChatTargets.AllPlayers` значение:

```cs
XboxIntegratedMultiplayer.SetChatTargets(XimChatTargets.AllPlayers)
```

Все участники получат сообщение о том, что новый целевой параметр активна, когда они предоставляются в `XimChatTargetsChangedStateChange`.

Как отмечалось ранее, большинство типов для перемещения сети XIM изначально назначит всех игроков нулевое значение индекса команды. Это означает, что конфигурация `XimChatTargets.SameTeamIndexOnly` вероятнее всего, не отличается от `XimChatTargets.AllPlayers` по умолчанию. Однако проигрыватели, в которых переместите XIM сеть, с помощью координирующему будет отличаются team значения индекса, если параметры координирующему `TeamMatchmakingMode` значение объявлено два или несколько рабочих групп. Можно также вызвать `XimLocalPlayer.SetTeamIndex()` в любое время, как показано выше. Если приложение использует значения индекса team ненулевое значение с помощью любого из этих методов, не забудьте управление текущей цели чата, правильную настройку.

## <a name="automatic-background-filling-of-player-slots-backfill-matchmaking"></a>Заполнение автоматическую фоновую проигрывателя слотов (координирующему «задним числом»)

Несопоставимым группам игроков, вызвав `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()` в то же время дает службы Xbox Live координирующему наибольшую гибкость для их объединения в новый, оптимальной сетей XIM быстро. Тем не менее в некоторых сценариях игровой процесс хотите оставить конкретной сети XIM без изменений и matchmake только дополнительные проигрыватели так же, для заполнения проигрывателя свободные слоты. Поддерживает XIM настройку партнеров для работы в автоматическую фоновую, заполняя режиме, или «предоставляемых каталогом», путем вызова `XboxIntegratedMultiplayer.SetNetworkConfiguration()` с `XimNetworkConfiguration` с `XimAllowedPlayerJoins.Matchmade` флаг на его `XimNetworkConfiguration.AllowedPlayerJoins` свойство.

В следующем примере настраивается задним числом партнеров, чтобы найти всего 8 проигрывателей для Приходите и вы нет команд (несмотря на то, что 8 не найден, также допустимы игроков 2 – 7), с помощью констант uint64_t игрового режима конкретного приложения определяется значением MYGAMEMODE_ DEATHMATCH, который будет сопоставлен только с другими пользователями, указав то же самое значение:

```cs
var networkConfiguration = new XimNetworkConfiguration(XboxIntegratedMultiplayer.NetworkConfiguration);
networkConfiguration.AllowedPlayerJoins |= XimAllowedPlayerJoins.Matchmade;
networkConfiguration.TeamConfiguration.TeamCount = 1;
networkConfiguration.TeamConfiguration.MinPlayerCountPerTeam = 2;
networkConfiguration.TeamConfiguration.MaxPlayerCountPerTeam = 8;
networkConfiguration.CustomGameMode = MYGAMEMODE_DEATHMATCH;
XboxIntegratedMultiplayer.SetNetworkConfiguration(networkConfiguration);
```

В результате существующие XIM сети на устройства вызова `XboxIntegratedMultiplayer.MoveToNetworkUsingMatchmaking()` обычным образом. Эти устройства см. в разделе, поведение не изменить. Участников сети XIM предоставляемых каталогом, не будут перемещены, но будет предоставляться `XimNetworkConfigurationChangedStateChange` означающую, что включение задним числом, а также несколько `XimMatchmakingProgressUpdatedStateChange` уведомления, если это применимо. Любой matchmade проигрывателя будут добавляться к XIM сети с помощью обычного `XimPlayerJoinedStateChange`.

По умолчанию задним числом партнеров остается включенной неопределенно долгое время, несмотря на то, что она не будет пытаться добавлять игроков в том случае, если сеть XIM уже содержит максимальное число исполнителей, определяемое `XimNetworkConfiguration.TeamConfiguration` параметр. Предоставляемых каталогом можно отключить, задав `XimNetworkConfiguration.AllowedPlayerJoins` не включая `XimAllowedPlayerJoins.Matchmade`:

```cs
var networkConfiguration = new XimNetworkConfiguration(XboxIntegratedMultiplayer.NetworkConfiguration);
networkConfiguration.AllowedPlayerJoins &= ~XimAllowedPlayerJoins.Matchmade;
XboxIntegratedMultiplayer.SetNetworkConfiguration(networkConfiguration);
```

Соответствующий `XimNetworkConfigurationChangedStateChange` будет предоставляться на всех устройствах, и после завершения данного асинхронного процесса окончательную `XimMatchmakingProgressUpdatedStateChange` будет предоставлен `MatchmakingStatus.None` для обозначения того, что без дальнейшего игроков matchmade будут добавлены к XIM сети.

При включении поддержки задним числом знакомства с `XimNetworkConfiguration.TeamConfiguration` параметр, который объявляет два или несколько команд, все существующие проигрыватели должны иметь допустимые команды индекс между 1 и количество групп. Сюда входят игроками, которые вызвали `XimLocalPlayer.SetTeamIndex()` указать пользовательское значение или кто присоединения с помощью приглашения или через другие социального означает (например, вызов `XboxIntegratedMultiplayer.MoveToNetworkUsingJoinableXboxUserId()`) и были добавлены со значением по умолчанию team индекс 0. Если любой проигрывателя не имеет допустимого командного индекса, а затем координирующему процессы будут приостановлены и все участники будут предоставлены `XimMatchmakingProgressUpdatedStateChange` с `MatchmakingStatus.WaitingForPlayerTeamIndex` значение. После всех игроков заданное или исправить их значения индекса команды с `XimLocalPlayer.SetTeamIndex()`, подбор игроков задним числом будет возобновлена. Дополнительные сведения можно найти в [как XIM работает с командами проигрывателя](#how-xim-works-with-player-teams) настоящего документа.

Аналогично при включении поддержки задним числом знакомства с `XimNetworkConfiguration` структура с `RequirePlayerRolesAndSkillConfiguration` поле задано значение true, а затем всех игроков необходимо указать конфигурацию координирующему отличное от null в проигрыватель. Если еще не все проигрывателя, а затем координирующему процессы будут приостановлены и все участники будут предоставлены `XimMatchmakingProgressUpdatedStateChange` с `XimMatchMakingStatus.WaitingForPlayerRolesAndSkillConfiguration` значение. После всех игроков указаны их `XimPlayerRolesAndSkillConfiguration` объектов, подбор игроков задним числом будет возобновлена. Дополнительные сведения можно найти в [подбор игроков с помощью навыков-player](#matchmaking-using-per-player-skill) и [подбор игроков с помощью роли-player](#matchmaking-using-per-player-role) разделах этого документа.

## <a name="querying-joinable-networks"></a>Запрос присоединяемая сетей

Несмотря на то координирующему это отличный способ быстро соединить игроков, иногда лучше разрешить игроков обнаружение присоединяемая сетей, используя пользовательские критерии поиска и выберите сеть, которым требуется присоединить. Это может быть особенно выгодно, когда игр сеанс может иметь большой набор настраиваемых правил игры и параметры проигрывателя. Чтобы сделать это, существующей сети необходимо сначала внести поддерживает запросы, включив `XimAllowedPlayerJoins.Queried` joinability и настройки параметров сети, доступной другим пользователям за пределами сети посредством вызова `XboxIntegratedMultiplayer.SetNetworkConfiguration()`.

В следующем примере включается `XimAllowedPlayerJoins.Queried` joinability, наборы сетевая конфигурация с конфигурацией группы, которая позволяет всего 1 – 8 игроков вместе в группе 1, постоянное uint64_t игрового режима конкретного приложения, определяется значением GAME_MODE_BRAWL, описание «cat и упаковки-преобразования в Овцы соответствует», констант карты конкретного приложения-uint32_t для индекса определяется значением MAP_KITCHEN и включает spectatorallowed «теги «chatrequired», «простой»,»:

```cs
string[] tags = { "chatrequired", "easy", "spectatorallowed" };
var networkConfiguration = new XimNetworkConfiguration(XboxIntegratedMultiplayer.NetworkConfiguration);
networkConfiguration.AllowedPlayerJoins |= XimAllowedPlayerJoins.Queried;
networkConfiguration.TeamConfiguration.TeamCount = 1;
networkConfiguration.TeamConfiguration.MinPlayerCountPerTeam = 1;
networkConfiguration.TeamConfiguration.MaxPlayerCountPerTeam = 8;
networkConfiguration.CustomGameMode = GAME_MODE_BRAWL;
networkConfiguration.Description = "Cat and sheep's boxing match";
networkConfiguration.MapIndex = MAP_KITCHEN;
networkConfiguration.SetTags(tags);
XboxIntegratedMultiplayer.SetNetworkConfiguration(networkConfiguration);
```

Другие игроки вне сети можно найти путем вызова xim::start_joinable_network_query() с набором фильтров, соответствующих информацию о сети в предыдущем вызове xim::set_network_configuration() сети. В следующем примере запускается запрос присоединяемая сети с помощью параметра фильтра игрового режима, который будет запрашивать только для сетей, использующих игрового режима конкретного приложения, определенные по значению GAME_MODE_BRAWL:

```cs
XimJoinableNetworkQueryFilters queryFilters = new XimJoinableNetworkQueryFilters();
queryFilters.CustomGameModeFilter = GAME_MODE_BRAWL;
XboxIntegratedMultiplayer.StartJoinableNetworkQuery(queryFilters);
```

Вот другой пример, использующий параметр тега фильтры, чтобы запрос для сетей с тегом «простой» и «spectatorallowed» их общедоступной конфигурации поддерживает запросы:

```cs
string[] tagFilters = { "easy", "spectatorallowed" };
XimJoinableNetworkQueryFilters queryFilters = new XimJoinableNetworkQueryFilters();
queryFilters.SetTagFilters(tagFilters);
XboxIntegratedMultiplayer.StartJoinableNetworkQuery(queryFilters);
```

Можно комбинировать параметры другим фильтром. В следующем примере используется параметр фильтра игрового режима и тег фильтровать параметр, чтобы создать запрос для сетей, что оба имеют конкретного приложения игрового режима константа GAME_MODE_BRAWL и тег «простой»:

```cs
string[] tagFilters = { "easy" };
XimJoinableNetworkQueryFilters queryFilters = new XimJoinableNetworkQueryFilters();
queryFilters.CustomGameModeFilter = GAME_MODE_BRAWL;
queryFilters.SetTagFilters(tagFilters);
XboxIntegratedMultiplayer.StartJoinableNetworkQuery(queryFilters);
```

Успешное завершение операции запроса, приложение будет получать xim_start_joinable_network_query_completed_state_change, из которого приложение может получать список сетей, присоединяемая. Приложение будет также постоянно получать `XimJoinableNetworkUpdatedStateChange` для других присоединяемых сетей или любые изменения, которые происходят в возвращаемый список присоединяемая сетей, пока она остановлена вручную или автоматически. Выполняется запрос может быть остановлена вручную, вызвав `XboxIntegratedMultiplayer.StopJoinableNetworkQuery()`. Он останавливается автоматически при вызове `XboxIntegratedMultiplayer.StartJoinableNetworkQuery()` для запуска запроса.

Можно попробовать приложение для подключения к сети в списке присоединяемая сетей путем вызова `XboxIntegratedMultiplayer.MoveToNetworkUsingJoinableNetworkInformation()`. В следующем примере предполагается, что вы пытаетесь подключиться к сети, который ссылается «selectedNetwork», который не защищен с помощью секретного кода (поэтому мы передаем пустую строку для второго параметра):

```cs
XboxIntegratedMultiplayer.MoveToNetworkUsingJoinableNetworkInformation(selectedNetwork, "");
```

При включении сети запроса с `XimNetworkConfiguration.TeamConfiguration` , объявляет два или несколько команд, игроков, присоединенные к путем вызова XboxIntegratedMultiplayer.MoveToNetworkUsingJoinableNetworkInformation() будет иметь значение по умолчанию team индекс 0.

> [!NOTE]
> Если приложение указал несколько локальных пользователей и присоединяется к наличие меньше места, чем количество локальных пользователей в сети, соединение может завершиться успешно. Но только допустимое число локальные пользователи могут подключиться к сети.