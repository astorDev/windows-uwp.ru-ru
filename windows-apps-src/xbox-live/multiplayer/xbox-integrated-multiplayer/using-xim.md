---
title: С помощью XIM (C++)
description: Узнайте, как использовать многопользовательскую интегрированной Xbox (XIM) с C++.
ms.date: 04/24/2018
ms.topic: article
keywords: Xbox live, xbox, игры, xbox, один, встроенная многопользовательскую xbox
ms.localizationpriority: medium
ms.openlocfilehash: 798d1a1bc738cbdc7bb2b3fb34076f0897fc76ff
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57644059"
---
# <a name="using-xim-c"></a>С помощью XIM (C++)

> [!div class="op_single_selector" title1="Language"]
> - [C++](using-xim.md)
> - [C#](using-xim-cs.md)

Это краткое Пошаговое руководство по использованию API XIM в C++. Игр разработчикам, желающим получить доступ к XIM через C# увидите [с помощью XIM (C#)](using-xim-cs.md).

- [С помощью XIM (C++)](#using-xim-c)
    - [Предварительные требования](#prerequisites)
    - [Инициализация и запуск](#initialization-and-startup)
    - [Асинхронные операции и обработки изменений состояния](#asynchronous-operations-and-processing-state-changes)
    - [Обработка объектов игрока XIM](#handling-xim-player-objects)
    - [Включение друзей присоединить и приглашение их](#enabling-friends-to-join-and-inviting-them)
    - [Основные подбор игроков и переход к другой сети XIM с другими пользователями](#basic-matchmaking-and-moving-to-another-xim-network-with-others)
    - [Отключение правила преобразования сетевых адресов партнеров для целей отладки](#disabling-matchmaking-nat-rule-for-debugging-purposes)
    - [Оставив XIM сети, а также удаление](#leaving-a-xim-network-and-cleaning-up)
    - [Отправка и получение сообщений](#sending-and-receiving-messages)
    - [Оценка качества передачу данных](#assessing-data-pathway-quality)
    - [Совместное использование данных с помощью проигрывателя пользовательских свойств](#sharing-data-using-player-custom-properties)
    - [Совместное использование данных с помощью пользовательского свойства сети](#sharing-data-using-network-custom-properties)
    - [Подбор игроков с помощью навыков проигрывателя](#matchmaking-using-per-player-skill)
    - [Подбор игроков с помощью роли проигрывателя](#matchmaking-using-per-player-role)
    - [Как работает XIM с командами проигрывателя](#how-xim-works-with-player-teams)
    - [Работа с разговора](#working-with-chat)
    - [Отключение звука игроков](#muting-players)
    - [Настройка целевых объектов чата с помощью команды проигрывателя](#configuring-chat-targets-using-player-teams)
    - [Заполнение автоматическую фоновую проигрывателя слотов (координирующему «задним числом»)](#automatic-background-filling-of-player-slots-backfill-matchmaking)
    - [Запрос присоединяемая сетей](#querying-joinable-networks)

## <a name="prerequisites"></a>Предварительные условия

Прежде чем приступить к созданию кода с помощью XIM, существует два предварительных требования.

1. Необходимо настроить AppXManifest приложения со standard многопользовательские сетевыми возможностями и вам нужно настроить сетевой части манифеста для объявления шаблонов шаблон, используемый XIM трафик.

    Возможности AppXManifest и манифесты сети описаны более подробно в соответствующих подразделах документации платформы; Типичный XIM определенного XML-Документы, вставьте предоставляется [конфигурации проекта XIM](xim-manifest.md).

1. Необходимо иметь два компонента удостоверение сведений о приложении:

    * Идентификатор назначенного заголовок Xbox Live.
    * Идентификатор конфигурации службы, предоставляемые как часть подготовки приложения для доступа к службе Xbox Live.

    См. в разделе к представителю корпорации Майкрософт Дополнительные сведения о получении их. Эти части информации будет использоваться во время инициализации.

Компиляция XIM требуется, включая основные `XboxIntegratedMultiplayer.h` заголовка. Чтобы связать должным образом, необходимо также включить проект `XboxIntegratedMultiplayerImpl.h` в единице компиляции, по крайней мере один (common предкомпилированного заголовка рекомендуется, так как эти функции заглушки являются небольшим и простым для компилятору создавать как «встроенные»).

Как упоминалось в [XIM Обзор](../xbox-integrated-multiplayer.md), интерфейс XIM не требует проектом, чтобы выбрать между компиляция с использованием C + +/ CX и традиционного C++; он может использоваться с любым. Реализация также не создавать исключения с точки зрения reporting, поэтому их можно использовать без труда из проектов без поддержки исключений, при желании Некритическая ошибка.

## <a name="initialization-and-startup"></a>Инициализация и запуск

Вы начали, взаимодействовать с библиотекой путем инициализации одноэлементного объекта XIM Xbox Live службы конфигурации идентификатор строки и заголовка идентификатор номером. Если вы также используете API службы Xbox, может оказаться удобным получить информацию из `xbox::services::xbox_live_app_config`. В следующем примере предполагается, что значения уже находятся в переменных «myServiceConfigurationId» и «myTitleId» соответственно:

```cpp
xim::singleton_instance().initialize(myServiceConfigurationId, myTitleId);
```

После инициализации приложения должны получить строки идентификатор пользователя Xbox для всех пользователей в настоящее время на локальном устройстве, которые будут участвовать и передать их в `xim::set_intended_local_xbox_user_ids()` вызова. В следующем примере кода предполагается, что один пользователь нажал кнопки контроллера выражения намерения для воспроизведения и строку идентификатора пользователя Xbox, связанные с пользователем уже были получены в переменную «myXuid»:

```cpp
xim::singleton_instance().set_intended_local_xbox_user_ids(1, &myXuid);
```

Вызов `xim::set_intended_local_xbox_user_ids()` немедленно устанавливает значение идентификаторы пользователей Xbox, связанные с локальных пользователей, которые должны быть добавлены к XIM сети. Этот список идентификаторов пользователей Xbox, которая будет использоваться во всех операциях сети в будущем до изменения списка с помощью другого вызова `xim::set_intended_local_xbox_user_ids()`.

В случае, когда сеть не XIM вообще еще не создана прежде всего для перемещения сети XIM для получения этого процесса запуска. Если пользователя еще нет определенной сети XIM помните, мы рекомендуем чтобы просто переместить в новую, пустую сети. Это позволяет друзей пользователя войти в сеть как своего рода «основной», из которого они могут работать совместно друг с другом для выбора их далее многопользовательские действий (таких, как ввод подбор игроков).

Ниже приведен пример того, как переместить только локальных пользователей, ранее добавлены с классом `xim::set_intended_local_xbox_user_ids()` сетью пустой XIM с местом для игроков до 8 общее:

```cpp
xim::singleton_instance().move_to_new_network(8, xim_players_to_move::bring_only_local_players);
```

Вызов `xim::move_to_new_network()` инициирует асинхронную операцию перемещения, завершается, регулярно, разработчикам обрабатывал для событие изменения состояния.

## <a name="asynchronous-operations-and-processing-state-changes"></a>Асинхронные операции и обработки изменений состояния

Сердцем XIM является приложения регулярных частые вызовы `xim::start_processing_state_changes()` и `xim::finish_processing_state_changes()` пару методов. Эти методы являются как XIM уведомляется о том, что приложение будет готово для обработки обновлений многопользовательской состояние, и как XIM предоставляет эти обновления. Они предназначены для выполняются быстро, таким образом, что они могут вызываться каждый кадр графики в цикле отрисовки пользовательского интерфейса. Это обеспечивает удобное место для получения всех изменений в очереди, не беспокоясь о непредсказуемость времени сети и уровня сложности многопоточных обратного вызова. XIM API фактически оптимизирован для этого шаблона, один поток. Это гарантирует, что его состояние останется неизменным за пределами этих двух функций, поэтому его можно использовать напрямую и эффективно.

По этой же причине следует все объекты, возвращаемые XIM API *не* считаться поточно ориентированными. В библиотеке есть внутренняя защиты многопоточности, но будет по-прежнему необходимо реализовать собственную блокировку, если требуется, чтобы в произвольном потоке для доступа к любым значением в XIM. Например, в случае наличия одного потока, подробно `xim::players()` списке, пока другой поток может вызове любой `xim::start_processing_state_changes()` или `xim::finish_processing_state_changes()` и изменения памяти, связанной с этим списком проигрывателя.

При `xim::start_processing_state_changes()` является именем, все обновления в очереди, передаются в массив `xim_state_change` структуры указатели.

Приложения должны:

1. Перебор массива.
1. Проверьте основной структуры, для его более конкретный тип.
1. Приведение типа структуры базового типа в соответствующий подробный обзор.
1. Обрабатывать обновления соответствующим образом.

После завершения со всеми `xim_state_change` структуры в настоящее время недоступно, этот массив должны быть переданы обратно XIM, чтобы освободить ресурсы путем вызова `xim::finish_processing_state_changes()`. Например:

```cpp
uint32_t stateChangeCount;
xim_state_change_array stateChanges;
xim::singleton_instance().start_processing_state_changes(&stateChangeCount, &stateChanges);
for (uint32_t stateChangeIndex = 0; stateChangeIndex < stateChangeCount; stateChangeIndex++)
{
   const xim_state_change * stateChange = stateChanges[stateChangeIndex];
   switch (stateChange->state_change_type)
   {
       case xim_state_change_type::player_joined:
       {
           MyHandlePlayerJoined(static_cast<const xim_player_joined_state_change*>(stateChange));
           break;
        }

       case xim_state_change_type::player_left:
       {
           MyHandlePlayerLeft(static_cast<const xim_player_left_state_change*>(stateChange));
           break;
       }

       ...
    }
 }
 xim::singleton_instance().finish_processing_state_changes(stateChanges);
```

Теперь, когда у вас есть цикл базовую обработку, можно обрабатывать изменения состояния, связанные с начального `xim::move_to_new_network()` операции. Каждая операция перемещения XIM сети будет начинаться с `xim_move_to_network_starting_state_change`. Если по какой-либо причине происходит сбой перемещения, то приложение будет предоставляться `xim_network_exited_state_change`, который является распространенная ошибка, механизм для асинхронной ошибки, предотвращает перемещение к сети XIM или отключение от текущей сети XIM обработки. В противном случае перемещения завершится с `xim_move_to_network_succeeded_state_change` после того как все состояния завершена и всех игроков были успешно добавлены к сети XIM.

Когда пользователь не имеет привилегий платформы для воспроизведения с другими пользователями в многопользовательской, XIM отправляет на устройство, попытка создания или подключения к сети XIM `xim_network_exited_state_change` с указанием причины `xim_network_exit_reason::user_multiplayer_restricted`. Это происходит, когда значение любой из локальных пользователей с `xim::set_intended_local_xbox_user_ids()` имеют ограничение многопользовательские Xbox Live. Приложения Xbox ЭРЫ, с помощью XIM следует вызвать `Store::Product::CheckPrivilegeAsync` в локальном проигрывателях, прежде чем переместить их в сети XIM с набором attemptResolution значение true, или сделать это в ответ на получение `xim_network_exit_reason::user_multiplayer_restricted` отказываться возвращаемого `xim_network_exited_state_change`.

## <a name="handling-xim-player-objects"></a>Обработка объектов игрока XIM

При условии, что в примере перемещения одного локального пользователя к новой сети XIM прошло успешно, приложение будет предоставляться `xim_player_joined_state_change` локальной `xim_player` объекта. Указатель на этот объект будет действительным для до тех пор, пока сам проигрыватель экземпляр является допустимым. Проигрыватель экземпляр становится недействительным при соответствующих `xim_player_left_state_change` для игрок возврата экземпляра через вызов `xim::finish_processing_state_changes()`. Приложения всегда будет предоставляться `xim_player_left_state_change` для каждого `xim_player_joined_state_change`.

Можно также получить массив всех `xim_player` объектов в XIM сети в любое время с помощью `xim::get_players()`.

`xim_player` Объект имеет множество полезных методов, таких как `xim_player::gamertag()` для получения текущей строки Xbox Live: тег игрока, связанного с проигрывателя в целях отображения. Если `xim_player` является локальным для устройства, а затем также выводится значение `xim_player::xim_local` указатель на объект из `xim_player::local()`, который имеет дополнительные методы, которые доступны только для локального игроков.

Само собой наиболее важные состояние для игроков не общих сведений, которые XIM знает, но что хочет отслеживать конкретного приложения. Поскольку собственные конструкции для этого сведения об отслеживании скорее всего, нужно будет связать `xim_player` объекта собственный объект конструкция проигрывателя, таким образом, чтобы в любое время отчеты XIM `xim_player`, можно быстро извлекать состояние без необходимости для заполнения и Поиск указатель контекста нового проигрывателя. В следующем примере предполагается, находится указатель на состояние закрытый в переменной «myPlayerStateObject» и вновь добавленная `xim_player` объект находится в переменной «newXimPlayer»:

```cpp
newXimPlayer->set_custom_player_context(myPlayerStateObject);
```

Это сохраняет значение заданного указателя с объектом проигрывателя локально (никогда не передается по сети для удаленных устройств где память не будет допустимым). Затем можно всегда вернуться объекта путем получения пользовательского контекста и преобразования его в объект, как в следующем примере:

```cpp
myPlayerStateObject = reinterpret_cast<MyPlayerState *>(newXimPlayer->custom_player_context());
```

Можно изменить назначенные Контекстный указатель нестандартный проигрыватель `xim_player` в любое время.

## <a name="enabling-friends-to-join-and-inviting-them"></a>Включение друзей присоединить и приглашение их

Для обеспечения конфиденциальности и безопасности всех сетей заново XIM автоматически настраиваются по умолчанию был только присоединяемая локального проигрывателями и именно в приложение, чтобы явно разрешить другим пользователям, когда он будет готов. В следующем примере показано, как использовать `xim::network_configuration()` для получения текущей конфигурации сети и обновления с помощью joinability `xim::set_network_configuration()` начинается, позволяя новым локальным пользователям, чтобы присоединить как проигрыватели, а также других пользователей, приглашенных или, которые " » (Xbox Live социальных сетей отношение) за которым следует исполнителей уже в сети XIM:

```cpp
xim_network_configuration networkConfiguration = *xim::singleton_instance.network_configuration();
networkConfiguration.allowed_player_joins = xim_allowed_player_joins::local | xim_allowed_player_joins::invited | xim_allowed_player_joins::followed;
xim::singleton_instance().set_network_configuration(&networkConfiguration);
```

`xim::set_network_configuration()` выполняет asynchronoulsy. После завершения предыдущего вызова образец кода `xim_network_configuration_changed_state_change` предоставляется для оповещения приложения об изменении joinability значение по умолчанию `xim_allowed_player_joins::none`. Можно затем можно выполнить запрос для нового значения путем проверки `allowed_player_joins` свойство `xim_network_configuration` возвращаемый `xim::network_configuration()`. 

`allowed_player_joins` Может проверяться при работе устройства в сети XIM для определения joinability сети.

Один из проигрывателей локального следует хотите отправить приглашения для удаленных пользователей, для присоединения к этой сети XIM, приложение может вызвать `xim_player::xim_local::show_invite_ui()` для запуска системы приглашение пользовательского интерфейса. Здесь локальный пользователь может выбрать людей, которым требуется пригласить и отправить приглашения. В следующем примере показано, как это работает и предполагается, что переменная «ximPlayer» указывает на допустимый локальный `xim_player`:

```cpp
ximPlayer->local()->show_invite_ui();
```

После выполнения Приведенная выше инструкция приглашение системы пользовательского интерфейса будет отображаться. Как только пользователь отправленных приглашений (или в противном случае закрытия пользовательского интерфейса), `xim_show_invite_ui_completed_state_change` будут представлены на следующем вызове `xim::start_processing_state_changes()`. Кроме того, приложение может отправлять приглашения, которым напрямую с помощью `xim_player::xim_local::invite_users()` не открывая приглашение системы пользовательского интерфейса.

В любом случае удаленные пользователи будет получать сообщения приглашение Xbox Live, везде, где они подписаны, которые можно принять или отклонить. При принятии активации протокола запустит приложение на этих устройствах, если оно еще не запущено, и протокол активации будет доставлено в приложение с помощью его аргументы события, которые могут использоваться для перемещения к соответствующей сети XIM.

См. в разделе документации по платформе Дополнительные сведения об активации протокола сам.

В следующем примере показано, как вызов `xim::extract_protocol_activation_information()` определяет, применимо к XIM ли аргументы события. Предполагается, что полученные необработанную строку URI из `Windows::ApplicationModel::Activation::ProtocolActivatedEventArgs` переменной «uriString»:

```cpp
xim_protocol_activation_information activationInfo;
bool isXimActivation;
isXimActivation = xim::singleton_instance().extract_protocol_activation_information(uriString, &activationInfo);
```

Если это активации XIM, то необходимо обеспечить локального пользователя, определенного в поле «local_xbox_user_id» заполненную таблицу `xim_protocol_activation_information` структура выполнил вход и среди пользователей, указанных для `xim::set_intended_local_xbox_user_ids()`. Затем можно инициировать переход к указанной сети XIM вызовом `xim::move_to_network_using_protocol_activated_event_args()` используя ту же строку URI. Например:

```cpp
xim::singleton_instance().move_to_network_using_protocol_activated_event_args(uriString);
```

Также Обратите внимание, что удаленные пользователи «и» можно перейти к карточная локального пользователя в пользовательский Интерфейс системы и инициировать попытки соединения сами без приглашения (при условии, что вам предоставлены такие соединения проигрывателя, как показано выше). Это действие также будет протокола активации приложения так же, как приглашения сделать обрабатываются таким же образом.

Перемещение к XIM сети, используя протокол активации идентична переход на новую сеть XIM, как показано в [инициализации и запуска](#initialization-and-startup). Единственное отличие заключается в, если переход выполнен успешно, перемещение устройства будет предоставляться проигрывателя локальных и удаленных `xim_player_joined_state_change` структуры, представляющие все применимые игроков. Естественно, исходное устройство, которая уже была размещена в сети XIM не перемещение, но будет см. в разделе добавить пользователей на новое устройство как проигрыватели через дополнительные `xim_player_joined_state_change` структуры.

После игроков на различных устройствах в сети XIM соединяются друг с другом, их можно инициировать многопользовательских сценариях, автоматически обмениваться данными по голоса и текста и отправки сообщений конкретного приложения.

## <a name="basic-matchmaking-and-moving-to-another-xim-network-with-others"></a>Основные подбор игроков и переход к другой сети XIM с другими пользователями

Далее можно развернуть сетевые возможности для группой друзей, переместив игроков к XIM сети, которая также имеет совсем. Незнакомцам являются соперниками из по всему миру, переносятся вместе с помощью службы Xbox Live подбор игроков на основе их интересов основе.

Простым способом для запуска основных партнеров с XIM является вызовом `xim::move_to_network_using_matchmaking()` на одном из устройств с заполненного `xim_matchmaking_configuration` структуру, используя игроков из текущей сети XIM вместе с ним.

Следующий пример запускает перемещения с помощью конфигурации подбор игроков, для поиска для сопоставления команд нет Приходите и вы всего 8 игроков. Если 8 общее проигрыватели не найден, система может по-прежнему соответствовать игроков 2 – 7 друг с другом. В этом примере используется константу определенные приложения из типа uint64_t, с именем MYGAMEMODE_DEATHMATCH, представляющее режим игры для фильтрации за пределами класса. Подбор игроков XIM будут соответствовать этой сети только с другими пользователями, указав же значение и переводит вдоль всех социально присоединенных игроков текущей сети XIM при предоставлении второй параметр `xim_players_to_move::bring_existing_social_players` для `xim::move_to_network_using_matchmaking()`:

```cpp
xim_matchmaking_configuration matchmakingConfiguration = { 0 };
matchmakingConfiguration.team_configuration.team_count = 1;
matchmakingConfiguration.team_configuration.min_player_count_per_team = 2;
matchmakingConfiguration.team_configuration.max_player_count_per_team = 8;
matchmakingConfiguration.custom_game_mode = MYGAMEMODE_DEATHMATCH;

xim::singleton_instance().move_to_network_using_matchmaking(matchmakingConfiguration, xim_players_to_move::bring_existing_social_players);
```

Как и более ранних перемещений, этот процесс координирующему предоставит начальные `xim_move_to_network_starting_state_change` на всех устройствах и `xim_move_to_network_succeeded_state_change` после успешного завершения перемещения. Так как это перемещение из одной XIM сети в другую, отличие в том, уже существуют `xim_player` объекты добавлены для локальных и удаленных пользователей, и они останутся для всех игроков, переходим к новой сети XIM друг с другом. Чат и данных взаимодействия между проигрыватели будут продолжать работать без перерыва, подбор игроков во время выполнения.

Подбор игроков может занять длительное время в зависимости от количества потенциальных игроков в пуле подбор игроков, которые вызвали также `xim::move_to_network_using_matchmaking()`.

Объект `xim_matchmaking_progress_updated_state_change` будет предоставляться периодически во время выполнения операции, чтобы сохранить вас и ваших пользователей в курсе текущего состояния. Если найдено совпадение, дополнительных исполнителей добавляются к сети XIM со стандартными `xim_player_joined_state_change` и завершения перемещения.

После завершения многопользовательской работы вместе с данным набором игроков «matchmade», можно повторить процесс для перемещения в другую сеть XIM с другого цикла подбор игроков. Вы увидите каждого игрока, соединены с помощью предварительного `xim::move_to_network_using_matchmaking()` предоставляют операции `xim_player_left_state_change` указывает, что их `xim_player` объекты больше не находятся в одной и той же сети XIM.

Если при попытке запустить снова, используя координирующему `xim::move_to_network_using_matchmaking()`, указать `xim_players_to_move::bring_existing_social_players`, проигрыватели, в которых соединены с помощью точек входа социальных сетей (`xim::move_to_network_using_protocol_activated_event_args()` или `xim::move_to_network_using_joinable_xbox_user_id()`) останется время новый подбор игроков. Кроме того, указав `xim_players_to_move::bring_only_local_players` приведет к отключению социально подключенных удаленных игроков, оставляя местных работодателей оставаться. В обоих случаях другой набор незнакомцам будут добавляться, после выполнения второй операции перемещения.

Также вы можете выбрать для перемещения проигрыватели не matchmade (или просто работодателей) в совершенно новую сеть XIM при выборе следующего действия configuration/многопользовательскую подбор игроков. В следующем примере показано, как бы вызвать устройства `xim::move_to_new_network()` XIM сети с максимальным размером 8 игроков, но на этот раз, используя существующие социально присоединенных игроков также:

```cpp
xim::singleton_instance().move_to_new_network(8, xim_players_to_move::bring_existing_social_players);
```

Объект `xim_move_to_network_starting_state_change` и `xim_move_to_network_succeeded_state_change` будет предоставляться для всех участвующих устройств, вместе с `xim_player_left_state_change` matchmade игроки, которые остались позади. На этих устройствах, он увидит аналогично `xim_player_left_state_change` для каждого игрока, выходит за пределы сети.

Вы можете продолжить перемещение из сети XIM сети XIM образом выше описано, как много раз, при необходимости.

Для повышения производительности службы Xbox Live не будет пытаться соответствующие группам игроков на устройствах, которые, скорее всего иметь возможность установить все прямые подключения peer-to-peer. Если вы разрабатываете в сетевой среде, которая неправильно настроен для поддержки стандартных Xbox Live многопользовательской, переход на новую сеть, с помощью операции координирующему может по-прежнему бесконечно без успешного сопоставления, даже в том случае, если вы не уверены, что у вас есть достаточно игроки критерию подбор игроков, — это все перемещение и использующие устройства в одной и той же локальной среде. Не забудьте выполнить тест многопользовательские подключения в параметрах сети приложения области и Xbox и выполните его рекомендаций в том случае, если он выводит трудности, особенно в отношении «Strict» NAT.

## <a name="disabling-matchmaking-nat-rule-for-debugging-purposes"></a>Отключение правила преобразования сетевых адресов партнеров для целей отладки

Если администратор сети не может вносить изменения необходимой среды для поддержки элемента XIM правила преобразования сетевых адресов, можно разблокировать вашей подбор игроков, испытания Xbox One пакеты средств разработки, настроив XIM, чтобы разрешать сопоставление устройств «Strict NAT» без хотя бы один «открыть Устройство NAT». Это делается, поместив в файл с именем «xim_disable_matchmaking_nat_rule» (содержимое не имеет значения) в корневом каталоге диска «нуля title» на все консоли Xbox One. Пример для этого рекомендуется, выполнив следующую команду из командной строки XDK перед запуском приложения, заменив заполнитель «{console_name_or_ip_address}» для каждой из консолей соответствующим образом:

```bat
echo.>%TEMP%\emptyfile.txt
copy %TEMP%\emptyfile.txt \\{console_name_or_ip_address}\TitleScratch\xim_disable_matchmaking_nat_rule
del %TEMP%\emptyfile.txt
```

> [!NOTE]
> Этот способ разработки в данный момент доступна только для приложений Xbox One монопольных ресурсов и не поддерживается для универсальных приложений Windows. Также Обратите внимание, что консолей, при использовании этого параметра никогда не будет совпадать с устройствами, которые не имеют этот файл присутствует, вне зависимости от сетевой среды, поэтому не забудьте добавлять и удалять файл везде.

## <a name="leaving-a-xim-network-and-cleaning-up"></a>Оставив XIM сети, а также удаление

При выполнении локальных пользователей участие в XIM сети, часто они просто будут перемещены в новую сеть XIM, позволяющий локальные пользователи, приглашенные пользователи и «за» пользователям присоединяться к, поэтому они могут по-прежнему координирование работы с друзьями, при поиске следующего действия. Но если пользователь полностью выполняется с помощью всех возможностей многопользовательской, то приложение может потребоваться начать, оставляя XIM полностью сети и возвращения к состоянию, как если бы только `xim::initialize()` и `xim::set_intended_local_xbox_user_ids()` бы вызывалась. Это делается с помощью `xim::leave_network()` метод:

```cpp
xim::singleton_instance().leave_network();
```

Этот метод начинает процесс асинхронно отключение от других участников корректно. Это приведет к удаленных устройств должны быть предоставлены `xim_player_left_state_change` для каждого локального игрока, который отключен. Локальное устройство будет также будет предоставлен `xim_player_left_state_change` для каждого игрока локальные и удаленные, который был отключен. Когда все операции завершились, окончательную `xim_network_exited_state_change` будет предоставляться. Приложение может затем вызвать "xim::cleanup()'' освободить все ресурсы и вернуться в неинициализированном состоянии:

```cpp
xim::singleton_instance().cleanup();
```

Вызов `xim::leave_network()` и ожидание `xim_network_exited_state_change` для выхода из XIM сети корректно всегда настоятельно рекомендуется при `xim_network_exited_state_change` уже не было предоставлено.

Если `xim::cleanup()` вызывается напрямую без `xim::leave_network()` вызывается, то проблем производительности связи для остальных участников возникнет в том случае, так как они будут вынуждены отправляют недоступная сообщения с устройства, которое просто «отображается» вызов `xim::cleanup()`.

## <a name="sending-and-receiving-messages"></a>Отправка и получение сообщений

XIM и его базовые компоненты выполняют все утомительно установления безопасные каналы связи через Интернет, поэтому не нужно беспокоиться о проблемах подключения или возможность вам гарантирован охват игроков некоторых, но не все. При возникновении проблем с подключением фундаментальные peer-to-peer, перемещение к сети XIM не удастся.

Когда формируется и подтверждено с помощью сети XIM `xim_move_to_network_succeeded_state_change`, все экземпляры приложения для всех присоединенных устройств, обязательно быть в курсе каждого `xim_player` подключен к сети XIM и позволяет отправлять сообщения на любой из них.

Продемонстрируем, как отправлять сообщения по сети XIM. В следующем примере предполагается, что переменная «sendingPlayer» является указатель на объект допустимый локальный проигрывателя. вызывает «sendingPlayer» `local()` и вызывает метод `send_data_to_other_players()` для отправки «msgData» структура сообщения для всех игроков (локальные и удаленные) с помощью последовательного гарантированной доставки. Обратите внимание на то, что она ведет к всех игроков, так как список определенных игроков не был передан в метод:

```cpp
sendingPlayer->local()->send_data_to_other_players(sizeof(msgData), &msgData, 0, nullptr, xim_send_type::guaranteed_and_sequential);
```

Сообщения могут доставляться всех игроков с помощью `send_data_to_other_players()` , не передавая массив определенных игроков в метод.

Предоставляются все получатели сообщения `xim_player_to_player_data_received_state_change` , содержат указатель на копию данных, а также указатели на соответствующие xim_player объекта, который отправил и локально его получение.

Само собой последовательные гарантированной доставки удобно, но он также может быть неэффективным отправки, поскольку XIM необходимо передавать или откладывать сообщения, если пакеты не будут удалены или disordered Интернета. Убедитесь, что рекомендуется использовать другие типы отправки сообщений, что приложение может выдержать потери или необходимости прибывают неупорядоченно. Так как данные сообщения поступают с удаленного компьютера, рекомендуется имеют четко определенные форматы данных, например упаковке нескольких байтовых значений в определенной байтовом («порядка следования байтов»). Приложение также следует проверить данные перед его обработкой.

XIM обеспечивает безопасность на уровне сети, поэтому нет необходимости для дополнительных схем шифрования или подписи. Тем не менее мы рекомендуем всегда использовать «защиты в глубину» в том случае, чтобы защититься от случайного ошибки и иметь возможность обрабатывать различные версии вашего приложения протокола сосуществование корректно (во время разработки, обновления содержимого, и т.д.). Подключения к Интернету пользователей может быть ограничена и постоянно меняющиеся ресурсы. Настоятельно рекомендуется использовать форматы данных эффективно сообщения и использования схем, которые отправляют каждый кадр пользовательского интерфейса.

## <a name="assessing-data-pathway-quality"></a>Оценка качества передачу данных

Дополнительные сведения о текущем качестве передачу данных между двумя игроками, вызовите `xim_player::network_path_information()` метод. В следующем примере извлекается указатель на `xim_network_path_information` структуры для `xim_player` указателя, содержащегося в переменной «remotePlayer»:

```cpp
 const xim_network_path_information * networkPathInfo = remotePlayer->network_path_information();
```

Возвращаемой структуры включает в себя задержку кругового пути предполагаемое и количество сообщений, по-прежнему поставлены в очередь локально для передачи в случае соединение не поддерживает передачи большего объема данных для этого момента.

Если вы видите, что очереди при резервном копировании для какого-либо «xim_player», следует уменьшить скорость, с которой вы передаете данные.

`xim_network_path_information::round_trip_latency_in_milliseconds` Поле представляет задержку базовой сети и оценка задержки XIM элемента без постановки в очередь. Действующие задержка увеличивается как `xim_network_path_information::send_queue_size_in_messages` роста и XIM работает в очереди.

Выберите разумным точки для начала регулирования вызовы `send_data_to_other_players` на основе использования и требования к игры. Каждое сообщение в очереди отправки представляет увеличение задержки действующие сети.

Значение, близкое к XIM максимальный предел (в настоящее время 3500 сообщения) слишком велико для большинства игр и скорее всего представляет несколько секунд данных, ожидающих отправки в зависимости от скорости вызова `send_data_to_other_players` и как каждого полезных данных. Вместо этого выберите число, которое учитывает требования к задержке игры, а также как перебои управления игры `send_data_to_other_players` является шаблон вызова.

## <a name="sharing-data-using-player-custom-properties"></a>Совместное использование данных с помощью проигрывателя пользовательских свойств

Большинство обмена данными приложение произойти с `xim_player::xim_local::send_data_to_other_players()` метод, поскольку она позволяет полностью управлять, получает данные, когда они должны получить эти данные и как система обработки системой потери пакетов. Однако бывают случаи, когда было бы неплохо игроки смогут совместно использовать состояние basic, редко меняющиеся о себе с другими пользователями с минимальными усилиями. Например каждый игрок возможно предопределенной строка, представляющая символ модель, выбранная перед переключением в многопользовательской, что всех игроков использовать для отображения их представления в игре.

Для данных, не очень часто изменяется о проигрыватель XIM предлагает проигрыватель пользовательских свойств. Эти свойства состоят заданное приложением имя и значение, содержащий пары заканчивающуюся нулем строку, могут применяться к локальной проигрывателя, и каждый раз, когда они изменяются, автоматически переданы на все устройства.

Свойства нового проигрывателя имеют дополнительные внутренней синхронизации ресурсов, чем `xim_player::xim_local::send_data_to_other_players()` метод, поэтому для быстро изменяющихся данных (т. е. положение исполнителя), по-прежнему должны использовать прямой отправки.

Пары ключей и значений пользовательских свойств проигрывателя иметь их текущие значения, автоматические предоставляемых модулю новых устройств, когда эти устройства подключения к сети XIM и см. в разделе добавлены проигрыватель. Значения можно задать путем вызова `xim_player::xim_local::set_player_custom_property()` со строками имени и значения. В следующем примере задается свойство с именем «модели» должны иметь значения «грубой» на локальном `xim_player` объекта, на который ссылается переменная «localPlayer»:

```cpp
localPlayer->local()->set_player_custom_property(L"model", L"brute");
```

Изменения свойств проигрывателя приведут `xim_player_custom_properties_changed_state_change` предоставляться ко всем устройствам, сообщите им о для имен свойств, которые были изменены. Значение для заданного имени могут быть получены по любой проигрывателя, локальное или удаленное с `xim_player::get_player_custom_property()`. В следующем примере извлекается значение свойства с именем «модели» из `xim_player` переменная «ximPlayer»:

```cpp
PCWSTR modelName = ximPlayer->get_player_custom_property(L"model");
```

Сохранение нового значения для данного имени свойства заменяют существующие значения. Имя свойства параметра значение указателя строки значения null обрабатываются так же, как строка с пустым значением, который совпадает со значением свойства, не необходимости указана. Имена и значения не интерпретируется XIM, поэтому он остается в приложение для проверки содержимого строки, при необходимости.

Свойства нового проигрывателя всегда сбрасываются при перемещении из одной сети XIM в другой. Тем не менее новые проигрыватели, в которых присоединитесь к сети XIM будут получать текущие значения свойств нового проигрывателя для всех игроков, имеющих некоторый набор.

## <a name="sharing-data-using-network-custom-properties"></a>Совместное использование данных с помощью пользовательского свойства сети

Пользовательские свойства сети предназначены для удобства, синхронизация данных, относящихся к сети XIM, что изменяются не часто. Сети работают пользовательские свойства идентично [пользовательские свойства проигрывателя](#sharing-data-using-player-custom-properties), за исключением того, их можно установить на одноэлементный объект XIM с `xim::set_network_custom_property()`. В следующем примере задается свойство «сопоставить», «этом репутацию» значение:

```cpp
xim::singleton_instance().set_network_custom_property(L"map", L"stronghold");
```

Изменения свойств сети приведут `xim_network_custom_properties_changed_state_change` предоставляться ко всем устройствам, сообщите им о для имен свойств, которые были изменены. Значение для заданного имени можно получить с помощью `xim::get_network_custom_property()`, как в следующем примере, который извлекает значение для свойства именованных «карты»:

```cpp
PCWSTR mapName = xim::singleton_instance().get_network_custom_property(L"map");
```

Так же, как [пользовательские свойства проигрывателя](#sharing-data-using-player-custom-properties), задав новое значение для данного имени свойства заменит существующие значения. Имя свойства параметра значение указателя строки значения null обрабатываются так же, как строка с пустым значением, который совпадает со значением свойства, не необходимости указана. Имена и значения не интерпретируется XIM, поэтому он остается в приложение для проверки содержимого строки, при необходимости.

Вновь созданные XIM сети всегда начинаются с набор пользовательских свойств не сети. Тем не менее новые проигрыватели, в которых присоединиться к существующей сети XIM получат текущие значения пользовательских свойств сети для этой сети XIM.

## <a name="matchmaking-using-per-player-skill"></a>Подбор игроков с помощью навыков проигрывателя

Сопоставления игроков с помощью заинтересованы в конкретной указанное приложение игрового режима является хорошим базовый. По мере роста пула доступных игроков, следует также сопоставления игроков, основанные на своих личных умений или опыт работы с игры, ветераны игроки могут оценить преимущества задача работоспособное конкурентной борьбы с другими ветеранов хотя новые проигрыватели может увеличиваться по конкурировать друг с другом с аналогичные возможности.

Чтобы сделать это, сначала укажите уровень квалификации для всех локальных игроков в роли-player и навыков структура конфигурации, заданные в вызовах `xim_player::xim_local::set_roles_and_skill_configuration()` перед запуском переместиться XIM сети с помощью подбор игроков. Уровень является понятием конкретного приложения и число не интерпретируется XIM, за исключением того, что подбор игроков вначале предпринимается попытка найти игроков с одинаковым значением навыков и периодически расширить поиск с шагом +/-10, чтобы найти другие игроки, объявление навыков значения в диапазоне вокруг навыков. В следующем примере предполагается, что локальный `xim_player` объект, которого указатель является «localPlayer», имеет значение навыков связанные uint32_t конкретного приложения, полученного из локального или Xbox Live хранилища в переменной с именем «playerSkillValue»:

```cpp
xim_player_roles_and_skill_configuration playerRolesAndSkillConfiguration = { 0 };
playerRolesAndSkillConfiguration.skill = playerSkillValue;

localPlayer->local()->set_roles_and_skill_configuration(&playerRolesAndSkillConfiguration);
```

После завершения этой операции будет предоставлен всем участникам `xim_player_roles_and_skill_configuration_changed_state_change` , указывающее на это `xim_player` изменился ее роли проигрыватель или конфигурации навыков. Новое значение можно получить, вызвав `xim_player::roles_and_skill_configuration()`. При всех игроков ролей, отличных от null и навыков конфигурацию, применяемую, можно переместить XIM сеть, используя подбор игроков со значением true в параметре `require_player_roles_and_skill_configuration` поле `xim_matchmaking_configuration` структуры для `xim::move_to_network_using_matchmaking()`. В следующем примере заполняется координирующему конфигурацию, которая будет найти в сумме игроков 2 – 8 для Приходите и вы нет команды, с помощью констант uint64_t игрового режима конкретного приложения, определяется значением MYGAMEMODE_DEATHMATCH, который будет сопоставлен только с другими пользователями Указание, что же значение, а это требует ролей-player и навыков настройки:

```cpp
xim_matchmaking_configuration matchmakingConfiguration = { 0 };
matchmakingConfiguration.team_configuration.team_count = 1;
matchmakingConfiguration.team_configuration.min_player_count_per_team = 2;
matchmakingConfiguration.team_configuration.max_player_count_per_team = 8;
matchmakingConfiguration.custom_game_mode = MYGAMEMODE_DEATHMATCH;
matchmakingConfiguration.require_player_roles_and_skill_configuration = true;
```

Когда эта структура передается `xim::move_to_network_using_matchmaking()`, операции перемещения начнет нормально, если перемещение игроков вызвали `xim_player::xim_local::set_roles_and_skill_configuration()` с ненулевой `xim_player_roles_and_skill_configuration` указатель. Если еще не все проигрывателя, а затем координирующему процессы будут приостановлены и все участники будут предоставлены `xim_matchmaking_progress_updated_state_change` с `xim_matchmaking_status::waiting_for_player_roles_and_skill_configuration` значение. Сюда входят проигрыватели, которые впоследствии присоединитесь к сети XIM через ранее отправленных приглашений или другими способами (например, вызов `xim::move_to_network_using_joinable_xbox_user_id()`) до завершения подбор игроков. После всех игроков указаны их `xim_player_roles_and_skill_configuration` структуры, подбор игроков будет возобновлена.

Подбор игроков с помощью навыков проигрыватель может быть совмещена с ролью-player координирующему пользователя, как описано в следующем разделе. Если только один требуется, можно указать значение 0 для других. Это из-за наличия всех игроков объявление `xim_player_roles_and_skill_configuration` навыков значение 0 всегда соответствуют друг другу.

Один раз `xim::move_to_network_using_matchmaking()` или любой другой XIM сети переместить операция завершена, всех игроков `xim_player_roles_and_skill_configuration` структуры будет автоматически очищен в пустой указатель (с сопутствующей `xim_player_roles_and_skill_configuration_changed_state_change` уведомлений). Если планируется переместить в другую сеть XIM, с помощью подбор игроков, требуется настройка-player, необходимо вызвать `xim_player::xim_local::set_roles_and_skill_configuration()` попытку, используя новый указатель структуру, содержащую самые последние сведения.

## <a name="matchmaking-using-per-player-role"></a>Подбор игроков с помощью роли проигрывателя

Еще одним методом с помощью ролей-player и навыков конфигурации для улучшения работы пользователей координирующему состоит в использовании ролей требуется проигрыватель. Это лучше всего подходит для игр, которые предоставляют доступный для выбора символьных типов, которые поддерживают разные координированное play стили; то есть типы, которые не просто alter в игре графическое представление, но управлять взаимодополняющие, эффективные атрибуты, такие как защитных «healers» и закрытия в «melee» "нападающего" и «диапазон», удаленных атак поддержки. Личности пользователей означает, что они лучше играть в качестве конкретной специализации. Но если игры разработано так, чтобы он не функционально невозможно завершить целей без хотя бы один человек, выполняющие каждой роли, иногда лучше в соответствии с такой игроков, чем чтобы соответствовать любой игроков вместе затем сначала требуется согласование один раз для сбора стили Play друг с другом. Это можно сделать, определив уникальный битовый флаг, представляющее каждую роль в данной игрока `xim_player_roles_and_skill_configuration` структуры.

В следующем примере значение роли конкретного приложения MYROLEBITFLAG_HEALER uint8_t для объекта локального xim_player, указатель является «localPlayer»:

```cpp
xim_player_roles_and_skill_configuration playerRolesAndSkillConfiguration = { 0 };
playerRolesAndSkillConfiguration.roles = MYROLEBITFLAG_HEALER;

localPlayer->local()->set_roles_and_skill_configuration(&playerRolesAndSkillConfiguration);
```

После завершения этой операции будет предоставлен всем участникам `xim_player_roles_and_skill_configuration_changed_state_change` , указывающее на это `xim_player` изменила свою конфигурацию роли-проигрывателя. Новое значение можно получить, вызвав `xim_player::roles_and_skill_configuration()`.

Глобальный `xim_matchmaking_configuration` структуры для `xim::move_to_network_using_matchmaking()` следует иметь все необходимые роли флаги в сочетании с помощью побитового или, а значение true для поля require_player_matchmaking_configuration.

В следующем примере заполняется координирующему конфигурацию, которая будет найти всего 3 игроков для команды нет Приходите и вы. Кроме того в этом примере константу определенные приложения, который имеет тип uint64_t и с именем MYGAMEMODE_COOPERATIVE, представляющее режим игры для фильтрации за пределами класса. Кроме того Настройка конфигурации требуются роли-player и конфигурации навык, где по крайней мере один проигрыватель соответствует каждой роли uint8_t конкретного приложения, которые были побитового или было вместе и помещено в конфигурации (MYROLEBITFLAG_HEALER, MYROLEBITFLAG_ MELEE и MYROLEBITFLAG_RANGE):

```cpp
xim_matchmaking_configuration matchmakingConfiguration = { 0 };
matchmakingConfiguration.team_configuration.team_count = 1;
matchmakingConfiguration.team_configuration.min_player_count_per_team = 3;
matchmakingConfiguration.team_configuration.max_player_count_per_team = 3;
matchmakingConfiguration.custom_game_mode = MYGAMEMODE_COOPERATIVE;
matchmakingConfiguration.required_roles = MYROLEBITFLAG_HEALER | MYROLEBITFLAG_MELEE | MYROLEBITFLAG_RANGE;
matchmakingConfiguration.require_player_roles_and_skill_configuration = true;
```

Когда эта структура передается `xim::move_to_network_using_matchmaking()`, операции перемещения начнется, как описано выше.

Подбор игроков с помощью-player роли также могут сочетаться с координирующему пользователя-player навыков. Если только один требуется, укажите значение 0 для других. Это из-за наличия всех игроков объявление `xim_player_roles_and_skill_configuration` навыков значение 0 всегда соответствуют друг другу; и, если все биты равны нулю в `xim_matchmaking_configuration` required_roles поле, то биты не роли необходимы для поиска соответствия.

Один раз `xim::move_to_network_using_matchmaking()` или любой другой XIM сети переместить операция завершена, всех игроков `xim_player_roles_and_skill_configuration` структуры будет автоматически очищен в пустой указатель (с сопутствующей `xim_player_roles_and_skill_configuration_changed_state_change` уведомлений). Если планируется переместить в другую сеть XIM, с помощью подбор игроков, требуется настройка-player, необходимо вызвать `xim_player::xim_local::set_roles_and_skill_configuration()` попытку, используя новый указатель структуру, содержащую самые последние сведения.

## <a name="how-xim-works-with-player-teams"></a>Как работает XIM с командами проигрывателя

Многопользовательскую игры часто включает в себя игроков, упорядоченные на противоположных команд. XIM делает его легко назначать группам, когда подбор игроков, задав `xim_team_configuration`. Следующий пример запускает перемещения с помощью подбор игроков, настроенный для поиска общей сложности состоит из 8 проигрывателей для размещения в двух группах равно 4 (несмотря на то, что 4 не найден, также допустимы игроков 1 – 3), с помощью констант uint64_t игрового режима конкретного приложения определяется значением MYGAMEMODE_CAPTURETHEFLAG, который будет сопоставлен только с другими пользователями, указав то же самое значение и перевод всех игроков социально присоединенного к домену из текущей XIM сети:

```cpp
xim_matchmaking_configuration matchmakingConfiguration = { 0 };
matchmakingConfiguration.team_configuration.team_count = 2;
matchmakingConfiguration.team_configuration.min_player_count_per_team = 1;
matchmakingConfiguration.team_configuration.max_player_count_per_team = 4;
matchmakingConfiguration.custom_game_mode = MYGAMEMODE_CAPTURETHEFLAG;

xim::singleton_instance().move_to_network_using_matchmaking(matchmakingConfiguration, xim_players_to_move::bring_existing_social_players);
```

По завершении такого XIM сетевой операции перемещения игроков будет использоваться значение team индекс 1 до {n} соответствующий с группами {n}, запрошено. Приложение отвечает истинный смысл совместной работы любой конкретной команде значение индекса. Значение индекса команды игрока извлекается с помощью `xim_player::team_index()`. При использовании `xim_team_configuration` с два или несколько команд, проигрыватели никогда не назначается team индекс нулевое значение при вызове `xim::move_to_network_using_matchmaking()`. Это вступает в противоречие проигрыватели, которые добавляются к сети XIM с другими конфигурации или тип перемещения операции (такие как через протокол активации, полученные в результате принимает приглашение), кто будет всегда иметь нулевой индекс team. Может оказаться полезным, следует считать специальные команды «неназначенные» team индекс 0.

В следующем примере извлекается индекс группы для объекта xim_player которого указатель мыши находится в переменной «ximPlayer»:

```cpp
uint8_t playerTeamIndex = ximPlayer->team_index();
```

Основной пользовательский интерфейс (не для ограниченной упоминание возможность поведение игроков отрицательное) службы Xbox Live координирующему никогда не будет разбиения игроками, которые при перемещении в сеть XIM друг с другом на разные команды.

Значение индекса команды, изначально назначенный координирующему является только рекомендацией, приложение можно изменить для локального игроков в любое время `xim_player::xim_local::set_team_index()`. Это также может вызываться в XIM сетей, которые не используют подбор игроков. В следующем примере настраивается проигрыватель указатель «localPlayer», чтобы новое значение индекса команды одного:

```cpp
localPlayer->local()->set_team_index(1);
```

Все устройства информируются, что игрок набрал новое значение индекса команды в силе при они предоставляются в `xim_player_team_index_changed_state_change` для этого исполнителя. Вы можете вызвать `xim_player::xim_local::set_team_index()` в любое время.

Подбор игроков оценивает ролей требуется проигрыватель независимо от групп разработчиков. Поэтому не рекомендуется использовать необходимые роли и группы в качестве критериев конфигурации одновременных подбор игроков, так как команды будет равномерно распределяться по количеству проигрывателя, не ролями выполненное проигрывателя.

## <a name="working-with-chat"></a>Работа с разговора

Среди игроков в сети XIM автоматически включаются связи чата голоса и текста. XIM обрабатывает взаимодействие с голосовой гарнитуры и микрофон оборудования для вас. Приложение не должно делать много для разговора, но у нее одно требование относительно текста: поддержка ввода и отображения. Текстовое поле является обязательным, поскольку даже на платформах или игр жанров, которые Исторически не были использовать широко физическую клавишу клавиатуры, игроки могут настраивать систему для использования преобразования текста в речь вспомогательных технологий. Аналогичным образом отображения текста не требуется, поскольку игроков может настроить систему, чтобы использовать речи в текст.

Эти параметры могут быть обнаружены в местных работодателей путем вызова `xim_player::xim_local::chat_text_to_speech_conversion_preference_enabled()` и `xim_player::xim_local::chat_speech_to_text_conversion_preference_enabled()`, и вы можете условно включить механизмы текст. Тем не менее рекомендуется рассмотреть создание текста ввода и отображения параметров, доступных всегда.

 `Windows::Xbox::UI::Accessability` Класс Xbox One специально разработан для предоставления простое отображение текста в игре разговора с упором на вспомогательные технологии распознавания речи в текст.

После ввода текста, предоставляемые реальном или виртуальном клавиатуры, передайте строку для `xim_player::xim_local::send_chat_text()` метод. В следующем коде показан отправки пример жестко запрограммированные строки из локальной `xim_player` объекта, на который ссылается переменная «localPlayer»:

```cpp
localPlayer->local()->send_chat_text(L"Example chat text");
```

Этот текст чата доставляется всех игроков в XIM сети, которая может получать чата обмен данными из исходного локального проигрывателя. Он может синтезирования речи аудио, и он может быть предоставлен как `xim_chat_text_received_state_change`.

Ваше приложение следует создать копию любой текстовой строки полученных и отобразить ее вместе с ваше удостоверение исходного исполнителя в течение требуемого времени (или в окне с прокруткой).

Существуют некоторые практические рекомендации, касающиеся чата. Рекомендуется, что в любом игроков отображаются, особенно в список gamertags, например табло также отображать значки так заметны говоря обратной связи для пользователя. Это делается путем вызова `xim_player::chat_indicator()` извлекаемого `xim_player_chat_indicator` представляющее состояние текущего, моментальное чата для этого исполнителя. В следующем примере показано получение значения индикатора для `xim_player` объекта, на который ссылается переменная «ximPlayer», чтобы определить значение константы определенный значок, чтобы присвоить переменной «iconToShow»:

```cpp
switch (ximPlayer->chat_indicator())
{
   case xim_player_chat_indicator::silent:
   {
       iconToShow = Icon_InactiveSpeaker;
       break;
   }

   case xim_player_chat_indicator::talking:
   {
       iconToShow = Icon_ActiveSpeaker;
       break;
   }

   case xim_player_chat_indicator::muted:
   {
       iconToShow = Icon_MutedSpeaker;
       break;
   }
   ...
}
```

В отчете по `xim_player::chat_indicator()` ожидается изменение часто как проигрыватели start и stop разговор, например. Он предназначен для поддержки приложений, запрашивая у каждого кадра пользовательского интерфейса в результате.

> [!NOTE]
> Если локальный пользователь не имеет достаточных привилегий связи из-за их параметры устройства `xim_player::chat_indicator()` вернет `xim_player_chat_indicator::platform_restricted`. В соответствии с требованиями для платформы ожидается, что приложение отображать иллюстрациях, указывающее, существующие ограничения на платформы голосовой чат или обмена сообщениями и сообщение для пользователя, указывая, проблему. — Один пример сообщения, мы рекомендуем: «К сожалению, вы не можем chat прямо сейчас.»

## <a name="muting-players"></a>Отключение звука игроков

Также рекомендуется использовать для поддержки отключение звука игроков. XIM автоматически обрабатывает системы звук, инициируется пользователями с помощью проигрывателя карты, но приложения должны поддерживать играми временного отключения звука, могут быть выполнены в Интерфейсе игры с помощью `xim_player::set_chat_muted()` метод. В следующем примере запускается отключения звука удаленного `xim_player` объекта указывает переменная «remotePlayer», чтобы слышали не разговора и не чата текст поступает от него:

```cpp
remotePlayer->set_chat_muted(true);
```

Отключение вступает в силу немедленно и есть не `xim_state_change` связанные с ней. Его можно отменить, вызвав `xim_player::set_chat_muted()` попытку, используя значение false. Следующий пример выключает звук удаленной `xim_player` объекта, на который ссылается переменная «remotePlayer»:

```cpp
remotePlayer->set_chat_muted(false);
```

Mutes для остаются в силе, пока `xim_player` существует, в том числе при переходе на новую сеть XIM с проигрывателем. Не сохраняется после ухода проигрывателя и подключится к одному пользователю (как новый `xim_player` экземпляра).

Проигрыватели обычно запускаются за считанные unmuted состояние. Если приложение хочет запустите проигрыватель в состояние выключения звука по причинам игровой процесс, оно может вызвать `xim_player::set_chat_muted()` на `xim_player` объекта до завершения обработки связанного `xim_player_joined_state_change`, и XIM гарантирует период времени не будет где голосовая связь аудио из проигрывателя можно прослушивать.

Автоматическую проверку выключения звука на проигрыватель репутации основе происходит, когда XIM сети соединяет удаленного проигрывателя. Если игрок набрал флаг ухудшают репутацию, проигрыватель автоматически отключен. Отключение звука влияет только на локальное состояние и таким образом будет повторяться, если игрок перемещается между сетями. Выполнить один раз и не повторно вычисляются для автоматической проверки выключения звука на основе репутации, пока `xim_player` остается допустимым.

## <a name="configuring-chat-targets-using-player-teams"></a>Настройка целевых объектов чата с помощью команды проигрывателя

Как уже говорилось в [как XIM работает с командами проигрывателя](#how-xim-works-with-player-teams) приложение отвечает настоящего документа, истинный смысл совместной работы любой конкретной команде значение индекса. За исключением сравнения на равенство по отношению к целевой конфигурации чата XIM не интерпретировать их. Целевую конфигурацию чата сообщила `xim::chat_targets()` сейчас `xim_chat_targets::same_team_index_only`, то любого заданного проигрыватель будет только exchange чата обмен данными с другим, если они имеют то же значение, о которых сообщает `xim_player::team_index()` (и конфиденциальности / политики позволяют).

Консервативное и поддержки, конкуренция, вновь созданные XIM сети будут автоматически настроены для использования по умолчанию `xim_chat_targets::same_team_index_only`. Тем не менее общаться с vanquished соперниками другой команды, может быть желательно, например, в игре после «основной». Вы можете сообщить о XIM, чтобы разрешить любому пользователю взаимодействовать с твой (где конфиденциальности и политики Разрешить) путем вызова `xim::set_chat_targets()`. Следующий пример приступает к настройке всеми участниками в сети XIM использовать `xim_chat_targets::all_players` значение:

```cpp
xim::singleton_instance().set_chat_targets(xim_chat_targets::all_players);
```

Все участники получат сообщение о том, что новый целевой параметр активна, когда они предоставляются в `xim_chat_targets_changed_state_change`.

Как отмечалось ранее, большинство типов для перемещения сети XIM изначально назначит всех игроков нулевое значение индекса команды. Это означает, что конфигурация `xim_chat_targets::same_team_index_only` вероятнее всего, не отличается от `xim_chat_targets::all_players` по умолчанию. Однако проигрыватели, в которых переместите XIM сеть, с помощью координирующему будет отличаются team значения индекса, если параметры координирующему `xim_team_matchmaking_mode` значение объявлено два или несколько рабочих групп. Можно также вызвать `xim_player::xim_local::set_team_index()` в любое время, как показано выше. Если приложение использует значения индекса team ненулевое значение с помощью любого из этих методов, не забудьте управление текущей цели чата, правильную настройку.

## <a name="automatic-background-filling-of-player-slots-backfill-matchmaking"></a>Заполнение автоматическую фоновую проигрывателя слотов (координирующему «задним числом»)

Несопоставимым группам игроков, вызвав `xim::move_to_network_using_matchmaking()` в то же время дает службы Xbox Live координирующему наибольшую гибкость для их объединения в новый, оптимальной сетей XIM быстро. Тем не менее в некоторых сценариях игровой процесс хотите оставить конкретной сети XIM без изменений и matchmake только дополнительные проигрыватели так же, для заполнения проигрывателя свободные слоты. Поддерживает XIM настройку партнеров для работы в автоматическую фоновую, заполняя режиме, или «предоставляемых каталогом», путем вызова `xim::set_network_configuration()` с `xim_network_configuration` с `xim_allowed_player_joins::matchmade` флаг на его `xim_network_configuration::allowed_player_joins` свойство.

В следующем примере настраивается задним числом партнеров, чтобы найти всего 8 проигрывателей для Приходите и вы нет команд (несмотря на то, что 8 не найден, также допустимы игроков 2 – 7), с помощью констант uint64_t игрового режима конкретного приложения определяется значением MYGAMEMODE_ DEATHMATCH, который будет сопоставлен только с другими пользователями, указав то же самое значение:

```cpp
xim_network_configuration networkConfiguration = *xim::singleton_instance().network_configuration();
networkConfiguration.allowed_player_joins |= xim_allowed_player_joins::matchmade;
networkConfiguration.team_configuration.team_count = 1;
networkConfiguration.team_configuration.min_player_count_per_team = 2;
networkConfiguration.team_configuration.max_player_count_per_team = 8;
networkConfiguration.custom_game_mode = MYGAMEMODE_DEATHMATCH;

xim::singleton_instance().set_network_configuration(&networkConfiguration);
```

В результате существующие XIM сети на устройства вызова `xim::move_to_network_using_matchmaking()` обычным образом. Эти устройства см. в разделе, поведение не изменить. Участников сети XIM предоставляемых каталогом, не будут перемещены, но будет предоставляться `xim_network_configuration_changed_state_change` означающую, что включение задним числом, а также несколько `xim_matchmaking_progress_updated_state_change` уведомления, если это применимо. Любой matchmade проигрывателя будут добавляться к XIM сети с помощью обычного `xim_player_joined_state_change`.

По умолчанию задним числом партнеров остается выполняется бесконечно, несмотря на то, что она не будет пытаться добавить игроков, если сеть XIM уже содержит максимальное число исполнителей, заданного параметром xim_team_configuration. Можно отключить предоставляемых каталогом, параметр xim_allowed_player_joins запрет matchmade. В следующем примере отключается предоставляемых каталогом, сняв флаг xim_allowed_player_joins::matchmade, сохраняя все остальные существующие флаги и параметры конфигурации сети.

```cpp
xim_network_configuration networkConfiguration = *xim::singleton_instance().network_configuration();
networkConfiguration.allowed_player_joins &= ~xim_allowed_player_joins::matchmade;
xim::singleton_instance().set_network_configuration(&networkConfiguration);
```

Соответствующий `xim_network_configuration_changed_state_change` будет предоставляться на всех устройствах, и после завершения данного асинхронного процесса окончательную `xim_matchmaking_progress_updated_state_change` будет предоставлен `xim_matchmaking_status::none` для обозначения того, что без дальнейшего игроков matchmade будут добавлены к XIM сети.

При включении поддержки задним числом знакомства с `xim_team_configuration` параметр, который объявляет два или несколько команд, все существующие проигрыватели должны иметь допустимые команды индекс между 1 и количество групп. Сюда входят игроками, которые вызвали `xim_player::xim_local::set_team_index()` указать пользовательское значение или кто присоединения с помощью приглашения или через другие социального означает (например, вызов `xim::move_to_network_using_joinable_xbox_user_id`) и были добавлены со значением по умолчанию team индекс 0. Если любой проигрывателя не имеет допустимого командного индекса, а затем координирующему процессы будут приостановлены и все участники будут предоставлены `xim_matchmaking_progress_updated_state_change` с `xim_matchmaking_status::waiting_for_player_team_index` значение. После всех игроков заданное или исправить их значения индекса команды с `xim_player::xim_local::set_team_index()`, подбор игроков задним числом будет возобновлена. Дополнительные сведения можно найти в [как XIM работает с командами проигрывателя](#how-xim-works-with-player-teams) настоящего документа.

Аналогично при включении поддержки задним числом знакомства с `xim_network_configuration` структура с `require_player_roles_and_skill_configuration` поле задано значение true для ролей или навыков, а затем всех игроков необходимо указать конфигурацию координирующему отличное от null в проигрыватель. Если еще не все проигрывателя, а затем координирующему процессы будут приостановлены и все участники будут предоставлены `xim_matchmaking_progress_updated_state_change` с `xim_matchmaking_status::waiting_for_player_roles_and_skill_configuration` значение. После всех игроков указаны их `xim_player_roles_and_skill_configuration` структуры, подбор игроков задним числом будет возобновлена. Дополнительные сведения можно найти в [подбор игроков с помощью навыков-player](#matchmaking-using-per-player-skill) и [подбор игроков с помощью роли-player](#matchmaking-using-per-player-role) разделах этого документа.

## <a name="querying-joinable-networks"></a>Запрос присоединяемая сетей

Несмотря на то координирующему это отличный способ быстро соединить игроков, иногда лучше разрешить игроков обнаружение присоединяемая сетей, используя пользовательские критерии поиска и выберите сеть, которым требуется присоединить. Это может быть особенно выгодно, когда игр сеанс может иметь большой набор настраиваемых правил игры и параметры проигрывателя. Чтобы сделать это, существующей сети необходимо сначала внести поддерживает запросы, включив `xim_allowed_player_joins::queried` joinability и настройки параметров сети, доступной другим пользователям за пределами сети посредством вызова `xim::set_network_configuration()`.

В следующем примере включается `xim_allowed_player_joins::queried` joinability, наборы сетевая конфигурация с конфигурацией группы, которая позволяет всего 1 – 8 игроков вместе в группе 1, постоянное uint64_t игрового режима конкретного приложения, определяется значением GAME_MODE_BRAWL, описание «cat и упаковки-преобразования в Овцы соответствует», констант карты конкретного приложения-uint32_t для индекса определяется значением MAP_KITCHEN и включает spectatorallowed «теги «chatrequired», «простой»,»:

```cpp
PCWSTR tags[] = { L"chatrequired", L"easy", L"spectatorallowed" };
xim_network_configuration networkConfiguration = *xim::singleton_instance().network_configuration();
networkConfiguration.allowed_player_joins |= xim_allowed_player_joins::queried;
networkConfiguration.team_configuration.team_count = 1;
networkConfiguration.team_configuration.min_player_count_per_team = 1;
networkConfiguration.team_configuration.max_player_count_per_team = 8;
networkConfiguration.custom_game_mode = GAME_MODE_BRAWL;
networkConfiguration.description = L"cat and sheep's boxing match";
networkConfiguration.map_index = MAP_KITCHEN;
networkConfiguration.tag_count = _countof(tags);
networkConfiguration.tags = tags;

xim::set_network_configuration(&networkConfiguration);
```

Другие игроки вне сети можно найти сети путем вызова `xim::start_joinable_network_query()` с набором фильтров, соответствующих информацию о сети в предыдущем `xim::set_network_configuration()` вызова. В следующем примере запускается запрос присоединяемая сети с помощью параметра фильтра игрового режима, который будет запрашивать только для сетей, использующих игрового режима конкретного приложения, определенные по значению GAME_MODE_BRAWL:

```cpp
xim_joinable_network_query_filters queryFilters = { 0 };
queryFilters.custom_game_mode_filter = GAME_MODE_BRAWL;

xim::start_joinable_network_query(queryFilters);
```

Вот другой пример, использующий параметр тега фильтры, чтобы запрос для сетей с тегом «простой» и «spectatorallowed» их общедоступной конфигурации поддерживает запросы:

```cpp
PCWSTR tagFilters[] = { L"easy", L"spectatorallowed" };
xim_joinable_network_query_filters queryFilters = { 0 };
queryFilters.tag_filter_count = _countof(tagFilters);
queryFilters.tag_filters = tagFilters;

xim::start_joinable_network_query(queryFilters);
```

Можно комбинировать параметры другим фильтром. В следующем примере используется параметр фильтра игрового режима и тег фильтровать параметр, чтобы создать запрос для сетей, что оба имеют конкретного приложения игрового режима константа GAME_MODE_BRAWL и тег «простой»:

```cpp
PCWSTR tagFilters[] = { L"easy" };
xim_joinable_network_query_filters queryFilters = { 0 };
queryFilters.custom_game_mode_filter = GAME_MODE_BRAWL;
queryFilters.tag_filter_count = _countof(tagFilters);
queryFilters.tag_filters = tagFilters;

xim::start_joinable_network_query(queryFilters);
```

Если операция запроса завершается успешно, приложение будет получать `xim_start_joinable_network_query_completed_state_change` из которой приложение может получать список сетей, присоединяемая. Приложение будет также постоянно получать `xim_joinable_network_query_updated_state_change` для других присоединяемых сетей или любые изменения, которые происходят в возвращаемый список присоединяемая сетей, пока она остановлена вручную или автоматически. Выполняется запрос может быть остановлена вручную, вызвав `xim::stop_joinable_network_query()`. Он останавливается автоматически при вызове `xim::start_joinable_network_query()` для запуска запроса.

Можно попробовать приложение для подключения к сети в списке присоединяемая сетей путем вызова `xim::move_to_network_using_joinable_network_information()`. В следующем примере предполагается, вы пытаетесь присоединить `xim_joinable_network_information` указывает указатель «selectedNetwork» не защищено с помощью секретного кода (поэтому мы передаем nullptr значению второго параметра):

```cpp
xim::move_to_network_using_joinable_network_information(selectedNetwork, nullptr);
```

При включении сети запроса с xim_team_configuration, который объявляет два или несколько рабочих групп, присоединенных к игроков, вызвав `xim::move_to_network_using_joinable_network_information()` будет иметь значение по умолчанию team индекс 0.

> [!NOTE]
> Если приложение указал несколько локальных пользователей и присоединяется к наличие меньше места, чем количество локальных пользователей в сети, соединение может завершиться успешно. Но только допустимое число локальные пользователи могут подключиться к сети.