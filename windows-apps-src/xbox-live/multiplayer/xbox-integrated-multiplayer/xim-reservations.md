---
title: XIM-резервному резервирования
description: В этой статье описывается использование встроенной многопользовательскую Xbox (XIM) как решение выделенный чата с помощью резервирования каналу.
ms.assetid: 0ed26d19-defb-414d-a414-c4877bd0ed37
ms.date: 01/28/2018
ms.topic: article
keywords: Xbox live, xbox, игры, универсальной платформы Windows, windows 10, xbox, один, встроенная многопользовательскую xbox, xim, чат
ms.localizationpriority: medium
ms.openlocfilehash: 82b38b8d0d94e4cccf501a101faee0e28a6b43c0
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57660839"
---
# <a name="using-xim-as-a-dedicated-chat-solution-via-out-of-band-reservations"></a>Использование XIM в качестве выделенного решения для чата посредством внеполосных резервирований

Большинство приложений используют XIM для обработки всех аспектов объединения игроков воедино. В конце концов, именно фокус на объединении всех функций, необходимых для комплексной поддержки стандартных многопользовательских сценариев, является причиной, по которой этот механизм называется интегрированным многопользовательским режимом Xbox. Тем не менее некоторые приложения, которые реализуют собственные многопользовательские решения, используя выделенные серверы Интернета, также требуется преимущества установлении надежных низкой задержкой, разговор низкая стоимость peer-to-peer связи. XIM распознает эту потребность и поддерживает режим расширения, который использует преимущества в XIM упрощенный одноранговой связи для расширения управления внешних проигрывателя, происходит за пределами XIM API. Вместо перемещения в сети XIM с помощью социальных сетей означает или подбор игроков, проигрыватели переместить, с помощью «резервирование», гарантированную заполнители для определенных пользователей, которые являются обмен «внешнее» через механизм взаимодействия приложения внешней проигрывателя.

Помимо процесса перемещения XIM сетей, управляемых с помощью резервирования резервному действуют так же, как любой другой XIM сети. Все функции связи работают одинаково. Тем не менее подбор игроков и методы API социальных сетей обнаружения обязательно отключены для XIM сетей, управляемых с помощью резервирования каналу, так как они бы конфликтовать с внешней реализацией приложения. Не удается отправить приглашения от такой XIM сети, например.

>XIM оптимизирована для обеспечения простого решения end-to-end. Таким образом не все сложные топологии или сценариев может быть идеально подходит для резервирования каналу. Если у вас есть вопросы о том, какой или как использовать функции обмена данными в XIM, обратитесь к своему представителю корпорации Майкрософт.

В последующих разделах описано использовать внешнее резервирования в XIM. Из-за относительно небольшое количество отличия от «стандартный» XIM об использовании, описанное в предыдущем разделе является сокращенным некоторого дополнительного обсуждения. Знакомство с [с помощью XIM](using-xim.md) рекомендуется.


## <a name="moving-to-a-new-out-of-band-reservation-xim-network"></a>Переход на новую сеть XIM-резервному резервирования

Чтобы начать использовать внешнее резервирования, один из участников собранных необходимо переместить в новую сеть XIM, созданной в этом режиме. Выделение, какие участвующих однорангового узла вами устройства. Возможно, уже есть концепция игр узла или сервера, который является естественным выбором для запуска процесса, но это не является обязательным. Рекомендуется выбирать устройства, которое сообщает тип доступа «Открыть» сети для достижения получения наименьшего времени установки подключения. См. в разделе `Windows::Networking::XboxLive` документации платформы.

Переход на XIM сети, управляемых с помощью резервирования резервному осуществляется инициализация XIM и объявление предполагаемого локальные идентификаторы пользователей Xbox, как показано в этом руководстве стандартный XIM использования, но вместо вызова метода, например `xim::move_to_new_network()`, вызовите `xim::move_to_network_using_out_of_band_reservation()` с строка NULL резервирования. Например:

```cpp
 xim::singleton_instance().initialize(myServiceConfigurationId, myTitleId);
 xim::singleton_instance().set_intended_local_xbox_user_ids(1, &myXuid);
 xim::singleton_instance().move_to_network_using_out_of_band_reservation(nullptr);
```

Стандартный `xim_move_to_network_starting_state_change`, `xim_player_joined_state_change`, и `xim_move_to_network_succeeded_state_change` затем будет предоставляться со временем во время обработки изменений состояния в стандартной `xim::start_processing_state_changes()` и `xim::finish_processing_state_changes()` цикла. Например:

```cpp
 uint32_t stateChangeCount;
 xim_state_change_array stateChanges;
 xim::singleton_instance().start_processing_state_changes(&stateChangeCount, &stateChanges);
 for (uint32_t stateChangeIndex = 0; stateChangeIndex < stateChangeCount; stateChangeIndex++)
 {
     const xim_state_change * stateChange = stateChanges[stateChangeIndex];
     switch (stateChange->state_change_type)
     {
         case xim_state_change_type::player_joined:
         {
             MyHandlePlayerJoined(static_cast<const xim_player_joined_state_change *>(stateChange));
             break;
         }

         case xim_state_change_type::player_left:
         {
             MyHandlePlayerLeft(static_cast<const xim_player_left_state_change *>(stateChange));*
             break;
         }

         ...
     }
 }
 xim::singleton_instance().finish_processing_state_changes(stateChanges);
```

Когда первое устройство после обработки изменения состояния и бы его player(s) успешно переходит в сети XIM, его необходимо создать резервирования для дополнительных пользователей.

## <a name="adding-players-to-a-xim-network-managed-using-out-of-band-reservations"></a>Добавление в сеть XIM игроков управлять с помощью резервирования каналу

XIM сетей, управляемых с помощью резервирования резервному всегда отчетов значение `xim_allowed_player_joins::out_of_band_reservation` из `xim::allowed_player_joins()` метода; они являетесь закрыты для всех игроков, за исключением тех, с помощью зарезервированных мест для их идентификаторы пользователей Xbox, путем вызова `xim::create_out_of_band_reservation()`. `xim::create_out_of_band_reservation()` принимает массив пользователей, чтобы вы могли создавать такие резервирования для извне собранных игроков, все сразу или меняться со временем. Кроме того пользователи, которые уже имеют игроков, входящих в сеть XIM игнорируются, поэтому вы также можете предоставить дополнительные идентификаторы пользователей Xbox как полная замена набора или по мере изменения разностной наступит удобный. Приведенный ниже предполагается, что у вас уже есть полностью собранных набор идентификаторов пользователей Xbox указателей на строки в массив переменной «xboxUserIds» с «xboxUserIdCount» число элементов:

```cpp
 xim::singleton_instance().create_out_of_band_reservation(xboxUserIdCount, xboxUserIds);
```

Таким образом вы сможете асинхронный процесс создания резервирования для заданных идентификаторов пользователей Xbox. После завершения операции будет предоставлен XIM `xim_create_out_of_band_reservation_completed_state_change` , сообщающий об успехе или неудаче. В случае успешного выполнения строка резервирования станут доступны для вашей системы, можно предоставить эти идентификаторы пользователей Xbox, для операции. Действительны только определенное количество времени резервирования строк, успешно создана. Это время возвращается в `xim_create_out_of_band_reservation_completed_state_change`.

Со строкой допустимое резервирование вашего внешнего механизма «внешнее», используются для сбора игроков за пределами XIM можно использовать для распространения строка для этих перечисления. Например, если вы используете службу каталогов сеанса многопользовательскую (MPSD) Xbox Live, можно написать эту строку как свойство пользовательского сеанса в документе сеанса (Примечание: строка резервирования всегда будет содержать только ограниченный набор символов, которые являются безопасный для использования в формате JSON, не требуя экранирование или кодировка Base64).

После их строки резервирования извлечения других пользователей из общего сеанса свойства документа, их можно начать перемещение XIM сети, использовать ее в качестве параметра `xim::move_to_network_using_out_of_band_reservation()`. В следующем примере предполагается, что строка резервирования извлечения переменной с именем «reservationString».

```cpp
xim::singleton_instance().move_to_network_using_out_of_band_reservation(reservationString);

```

Операции перемещения асинхронно выполняет так же, как для первое устройство, который указан пустой указатель для строки резервирования. Изменений состояния `xim_move_to_network_starting_state_change`, `xim_player_joined_state_change`, и `xim_move_to_network_succeeded_state_change` будет сформирована методом перемещения. Если переход выполнен успешно, будут добавляться локальных и удаленных игроков. Существующие устройства в сети XIM будет предоставляться `xim_player_joined_state_change` для этих новых игроков. На этом этапе среди игроков на различные устройства в этой сети XIM (где конфиденциальности и политики Разрешить) автоматически включена связь чата голоса и текста.

Операции перемещения ошибку из-за строкой недопустимый резервирования, вернет XIM `xim_network_exited_state_change` с указанием причины `xim_network_exit_reason::invalid_reservation`. Это может произойти из-за нескольких причин:

1. Заголовок пытается вызвать `xim::move_to_network_using_out_of_band_reservation()` на удаленном устройстве, прежде чем `xim_create_out_of_band_reservation_completed_state_change` возвращается на устройстве узла
1. Заголовок пытается вызвать `xim::move_to_network_using_out_of_band_reservation()` на удаленном устройстве, после истечения срока действия резервирования.
1. Заголовок пытается вызвать `xim::move_to_network_using_out_of_band_reservation()` на удаленном устройстве несколько раз при вызове только `xim::create_out_of_band_reservation()` после.

Независимо от успешности резервирования используются операции перемещения, которые их используют. Таким образом, после каждой попытки использования узла должен создать новую строку резервирования, вызвав `xim::create_out_of_band_reservation()` еще раз.

## <a name="configuring-chat-targets-in-a-xim-network-managed-using-out-of-band-reservations"></a>Настройка целевых объектов разговора в сети XIM управлять с помощью резервирования каналу

XIM сетей, управляемых с помощью резервирования резервному ведут себя одинаково для традиционных сетей XIM по отношению к связи чата. Для поддержки конкурентоспособности вновь созданные сети XIM сценарии автоматически настраиваются на поддерживают только разговора с другими пользователями, которые являются членами одной группы; то есть настроенное значение сообщил `xim::chat_targets()` по умолчанию является `xim_chat_targets::same_team_index_only`. Это можно изменить, чтобы разрешить любому пользователю взаимодействовать с твой (где конфиденциальности и политики Разрешить) путем вызова `xim::set_chat_targets()`. В следующем примере запускается Настройка всех пользователей в сети XIM использовать `xim_chat_targets::all_players` значение:

```cpp
xim::singleton_instance().set_chat_targets(xim_chat_targets::all_players);
```

Все участники получат сообщение о том, что новый целевой объект параметра в силе при они предоставляются в `xim_chat_targets_changed_state_change`.

Каждый игрок в XIM сетях, управляемых с помощью резервирования out of band будет изначально настроен с одинаковым значением индекса team, нулевое значение. Это означает, что конфигурация `xim_chat_targets::same_team_index_only` неотличим от `xim_chat_targets::all_players` по умолчанию. Тем не менее, можно изменить индекс группы локального игрока в любое время, вызвав `xim_player::xim_local::set_team_index()`. В следующем примере настраивается проигрыватель указатель «localPlayer», чтобы новое значение индекса команды одного:

```cpp
 localPlayer->local()->set_team_index(1);
```

Все устройства информируются, что игрок набрал новое значение индекса команды в силе при они предоставляются xim_player_team_index_changed_state_change для этого исполнителя. Если целевой конфигурации чата xim_chat_targets::same_team_index_only, игроков с этой же новый индекс команды будет начинаться голоса вашим отзывам и предоставляемые чата текст (конфиденциальности и политики в соответствии с правами) из меняющихся проигрывателя и наоборот. Проигрыватели с старого индекса team перестанет обмена такие подключения чата. Если целевой конфигурации чата xim_chat_targets::all_players, затем индекс команды не оказывает влияния на, общаться с кем.

## <a name="removing-players-from-a-xim-network-managed-using-out-of-band-reservations"></a>Удаление игроков из сети XIM управлять с помощью резервирования каналу

Вы управляете список игроков, извне в том случае, при использовании резервирования каналу, поэтому естественным образом может потребоваться удалить из сети XIM игроков. Обычным способом — для приложений использовать тот же узел игры, который использовался для создания сети XIM и последующих резервирований изначально также управлять удаления проигрывателя и выполнить путем вызова `xim::kick_player()`. Удаляет указанный проигрыватель и всех игроков на одном устройстве из XIM сети. В следующем примере предполагается, приложение определило, что он хочет удалить `xim_player` объекта, на который ссылается переменная «playerToRemove»:

```cpp
xim::singleton_instance().kick_player(playerToRemove);
```

Применимые проигрыватель (или игроков) будут предоставлены все необходимые `xim_player_left_state_change` для каждого игрока и `xim_network_exited_state_change` , указывающее, что они были применены из сети. Кроме того, можно вызывать каждый игрок `xim::leave_network()` для выхода из собственных для того же эффекта.

Имейте в виду, что XIM peer-to-peer связи может сделать самостоятельно определять, в любое время, проигрыватель покинул XIM сети из-за сложности среды. Приложения должны быть готовы обрабатывать «незапрошенные» `xim_player_left_state_change` и согласования каких-либо разногласий между XIM состояние и схему управления внешних проигрыватель образом подходит для вашего конкретного приложения.

## <a name="cleaning-up-a-xim-network-managed-using-out-of-band-reservations"></a>Очистка XIM сети управлять с помощью резервирования каналу

Любой проигрыватели, в которых уже еще не был создан из XIM сети и требуется вернуть в состояние, как если бы только xim::initialize() и `xim::set_intended_local_xbox_user_ids()` бы вызывалась, можно начать делать это с помощью `xim::leave_network()` метод:

```cpp
xim::singleton_instance().leave_network();
```

Таким образом вы сможете асинхронно отключение от других участников. Это приведет к удаленных устройств должны быть предоставлены `xim_player_left_state_change` для локального player(s) и локальным устройством будет предоставляться `xim_player_left_state_change` для каждого игрока, локальным или удаленным. Когда все нормальные отключения будет завершено, окончательную `xim_network_exited_state_change` будет предоставляться. Приложение может затем вызвать `xim::cleanup()` освободить все ресурсы и вернуться в неинициализированном состоянии:

```cpp
 xim::singleton_instance().cleanup();
```

Вызов `xim::leave_network()` и ожидание `xim_network_exited_state_change` для выхода из XIM сети корректно всегда настоятельно рекомендуется при `xim_network_exited_state_change` уже не было предоставлено. Вызов `xim::cleanup()` непосредственно может вызвать проблемы производительности взаимодействия для остальных участников во время их приходится время ожидания сообщения на устройство, просто «отображается».
