---
author: stevewhims
Description: Design your app to provide bidirectional text support (BiDi) so that you can combine script from left-to-right (LTR) and right-to-left (RTL) writing systems, which generally contain different types of alphabets.
title: Разработка приложений с поддержкой двунаправленного текста
template: detail.hbs
ms.author: stwhi
ms.date: 11/10/2017
ms.topic: article
keywords: windows 10, uwp, глобализация, локализуемость, локализация, справа налево, слева направо
ms.localizationpriority: medium
ms.openlocfilehash: 24e4c5dfce4aa3e773ab8c334ca732ac5ed53030
ms.sourcegitcommit: 38f06f1714334273d865935d9afb80efffe97a17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2018
ms.locfileid: "6193530"
---
# <a name="design-your-app-for-bidirectional-text"></a>Разработка приложений с поддержкой двунаправленного текста

Проектируйте приложения с поддержкой двунаправленного текста (BiDi), чтобы можно было комбинировать сценарии из систем письменности слева направо (LTR) и справа налево (RTL), которые, как правило, содержат разные типы алфавитов.

К системам письменности справа налево, которые используются, например, на Ближнем Востоке, в Центральной и Южной Азии, а также в Азии, применяются особые проектные требования. Для этих систем письменности необходима поддержка двунаправленного текста (BiDi). Поддержка BiDi означает возможность ввода и отображения текста справа налево (RTL) или слева направо (LTR).

В Windows всего поддерживается девять языков BiDi.
- Два языка с полной локализацией. Арабский и иврит.
- Семь пакетов интерфейса пользователя для развивающихся рынков. Персидский, урду, дари, центральнокурдский, синдхи, панджаби (Пакистан) и уйгурский.

В этом разделе описана философия разработки интерфейса BiDi для Windows и приведены практические примеры, содержащие рекомендации по разработке BiDi.

## <a name="bidi-design-elements"></a>Элементы разработки интерфейса BiDi

При разработке интерфейса BiDi в Windows важно учитывать четыре фактора.

- **Зеркальное отображение пользовательского интерфейса**. Направленность пользовательского интерфейса позволяет представлять содержимое с записью справа налево в естественном виде. Структура пользовательского интерфейса соответствует языкам BiDi.
- **Согласованное взаимодействие пользователя с приложением**. Дизайн выглядит естественно в ориентации справа налево. Все элементы пользовательского интерфейса имеют единое направление разметки и выглядят так, как ожидает пользователь.
- **Оптимизация касания**. Как и в обычном интерфейсе, элементы легкодоступны и дают ощущение естественности при сенсорном взаимодействии.
- **Поддержка смешанного текста**. Поддержка направленности текста позволяет создавать смешанные текстовые сочетания (английский текст, вставленный в текст BiDi, или наоборот).

## <a name="feature-design-overview"></a>Общие сведения о разработке функций

Windows поддерживает четыре аспекта разработки для BiDi. Рассмотрим некоторые основные функции в Windows и контекст, в котором они взаимодействуют с приложением.

### <a name="navigate-in-the-direction-that-feels-natural"></a>Движение в естественном направлении

Windows регулирует направление типографской сетки справа налево, т.е. первая плитка в сетке будет располагаться в верхнем правом углу, а последняя— в нижнем левом. Это совпадает с шаблоном размещения текста справа налево, как в печатных изданиях, таких как книги и журналы, где материал всегда начинается в верхнем правом углу и далее распространяется влево.

![Меню “Пуск” для интерфейса с двунаправленным письмом](images/56283_BIDI_01_startscreen_resized.png)
![Меню “Пуск” для интерфейса с двунаправленным письмом с чудо-кнопками](images/56283_BIDI_02_startscreen_charm_resized.png)

Чтобы сохранить единую направленность пользовательского интерфейса, для содержимого на плитках всегда соблюдается направление справа налево, т.е. имя приложения и логотип располагаются в нижнем правом углу плитки независимо от языка интерфейса приложения.

#### <a name="bidi-tile"></a>Плитка BiDi

![Плитка BiDi](images/56284_BIDI_03_tile_callouts_withKey.png)

#### <a name="english-tile"></a>Англоязычная плитка

![Англоязычная плитка](images/56284_BIDI_03_tile_callouts_en-us.png)

### <a name="get-tile-notifications-that-read-correctly"></a>Получение уведомлений плиток с правильным направлением текста

Плитки поддерживают смешанный текст. Область уведомлений способна настраиваться на выравнивание текста, соответствующее языку уведомления.  Когда приложение отправляет уведомление на арабском языке, иврите или другом языке BiDi, текст выравнивается по правому краю. Когда уведомление приходит на английском языке (или другом языке LTR), оно выравнивается по левому краю.

![Уведомления на плитках](images/56285_BIDI_04_bidirectional_tiles_white.png)

### <a name="a-consistent-easy-to-touch-rtl-user-experience"></a>Цельный и удобный интерфейс пользователя в RTL

Все элементы в интерфейсе Windows соответствуют ориентации RTL. Чудо-кнопки и всплывающие элементы расположены по левому краю экрана, поэтому они не перекрывают результаты поиска и не нарушают оптимизацию сенсорного ввода. До них легко можно дотянуться большим пальцем.

![Снимок экрана BiDi](images/56286_BIDI_05_search_flyout_resized.png)
![Снимок экрана BiDi](images/56286_BIDI_06_print_flyout_resized.png)

![Снимок экрана BiDi](images/56286_BIDI_07_settings_flyout_resized.png)
![Снимок экрана BiDi](images/56286_BIDI_08_app_bars_resized.png)

### <a name="text-input-in-any-direction"></a>Ввод текста в произвольном направлении

В Windows можно использовать экранную сенсорную клавиатуру, более простую и не перегруженную лишними элементами. Для языков BiDi предусмотрена специальная клавиша переключения направления, позволяющая при необходимости изменить направление ввода текста.

![Сенсорная клавиатура для языка BiDi](images/56287_BIDI_09_keyboard_layout_resized.png)

### <a name="use-any-app-in-any-language"></a>Использование любого приложения с любым языком

Установите и используйте ваши любимые приложения на любом языке. Приложения будут выглядеть и функционировать так же, как в версиях Windows без поддержки BiDi. Элементы в приложениях всегда помещаются в соответствующее и заранее известное положение.

![Англоязычное приложение, отображающее содержимое BiDi](images/56288_BIDI_10_english_app_resized.png)

### <a name="display-parentheses-correctly"></a>Правильное отображение скобок

Благодаря внедрению алгоритма расстановки скобок BiDi (BiDi Parenthesis Algorithm — BPA) парные скобки всегда отображаются правильно независимо от языка и способа выравнивания.

#### <a name="incorrect-parentheses"></a>Неправильные скобки

![Приложение BiDi с неправильными скобками](images/56289_BIDI_11_parentheses_resized.png)

#### <a name="correct-parentheses"></a>Правильные скобки

![Приложение BiDi с правильными скобками](images/56289_BIDI_12_parentheses_fixed_resized.png)

### <a name="typography"></a>Оформление текста

В Windows для всех языков BiDi используется интерфейсный шрифт Segoe. Этот шрифт сформирован и масштабирован для интерфейса Windows.

![Интерфейсный шрифт Segoe для языка BiDi](images/56290_BIDI_13_start_screen_segoe.png)
![Интерфейсный шрифт Segoe для языка BiDi](images/56290_BIDI_13_start_screen_segoe_arabic.png)

## <a name="case-study-1-a-bidi-music-app"></a>Практический пример № 1. Музыкальное приложение BiDi

### <a name="overview"></a>Обзор

При разработке мультимедийных приложений приходится решать довольно трудную и интересную задачу, так как элементы управления мультимедиа обычно располагаются слева направо аналогично расположению, принятому в языках без BiDi.

![Элементы управления для мультимедиа, расположенные слева направо](images/56291_BIDI_1415_music_player_layouts_left-withcallouts.png)

![Элементы управления для мультимедиа, расположенные справа налево](images/56291_BIDI_1415_music_player_layouts_right-withcallouts.png)

### <a name="establishing-ui-directionality"></a>Установка направленности пользовательского интерфейса

Соблюдение направленности пользовательского интерфейса справа налево важно, чтобы обеспечить единообразие дизайна для рынков BiDi. В этом контексте добавление элементов, имеющих направленность слева направо, является непростой задачей, поскольку некоторые навигационные элементы, например кнопка "Назад", могут противоречить ориентации аналогичной кнопки для управления аудио.

![Страница звуковых дорожек в музыкальном приложении](images/56292_BIDI_16_app_layout_callouts_resized.png)

Музыкальное приложение сохраняет расположение сетки справа налево. Благодаря этому приложение сохраняет естественность для пользователей, которые осуществляют навигацию по интерфейсу Windows в этом направлении. Направленность заключается не только в том, чтобы основные элементы были упорядочены справа налево, но также в том, чтобы они были правильно выровнены в заголовках разделов.

![Страница альбома в музыкальном приложении](images/56292_BIDI_17_app_layout_callouts_resized.png)

### <a name="text-handling"></a>Обработка текста

Биография исполнителя на приведенном выше снимке экрана выровнена по левому краю, а все остальные текстовые данные, такие как название альбома и дорожек, сохраняют выравнивание по правому краю. Поле с биографией является сравнительно крупным текстовым элементом и будет читаться с трудом, если его выровнять по правому краю, поскольку при чтении крупного фрагмента текста становится трудно следить за строками. В общем случае любой текстовый элемент, который имеет более двух или трех строк, содержащих пять или более слов, может считаться исключением из правила выравнивания и выравниваться в направлении, противоположном общей направленности всего приложения.

Манипуляция выравниванием в рамках приложения может казаться простой, однако часто при этом выявляются некоторые ограничения модулей отрисовки, связанные с расположением нейтральных символов в строках BiDi. Например, следующая строка может отображаться различно в зависимости от выравнивания.

| | Англоязычная строка (LTR) | Строка на иврите (RTL) |
| -------------- | ------------------- | ------------------- |
| **Выравнивание по левому краю** | Hello, World! | בוקר טוב! |
| **Выравнивание по правому краю** | !Hello, World | !בוקר טוב |

Чтобы гарантировать правильное отображение сведений об исполнителе в музыкальном приложении, группа разработчиков отделила параметры разметки текста от выравнивания. Другими словами, сведения об исполнителе во многих случаях могут отображаться с выравниванием по правому краю, но расположение строк основано на настраиваемой фоновой обработке. Фоновая обработка определяет оптимальный параметр направления в зависимости от содержимого строки.

![Страница исполнителя в музыкальном приложении](images/56292_BIDI_18_app_layout_callouts_resized.png)

Например, без настраиваемой обработки расположения строки имя исполнителя "The Contoso Band" будет отображаться как ".The Contoso Band".

### <a name="specialized-string-direction-preprocessing"></a>Специальная предварительная обработка направления строки

Когда приложение запрашивает на наших серверах метаданные мультимедиа, оно выполняет предварительную обработку каждой строки перед отображением ее пользователю. Во время этой предварительной обработки приложение также выполняет преобразование, чтобы устранить противоречивость в направлении текста. Для этого оно проверяет наличие нейтральных символов на концах строки. Помимо этого, если направление текста строки противоположно направлению, заданному в приложении параметрами языка Windows, оно добавляет (иногда в начале) маркеры направления Юникода. Функция преобразования выглядит следующим образом.

```csharp
string NormalizeTextDirection(string data) 
{
    if (data.Length > 0) {
        var lastCharacterDirection = DetectCharacterDirection(data[data.Length - 1]);

        // If the last character has strong directionality (direction is not null), then the text direction for the string is already consistent.
        if (!lastCharacterDirection) {
            // If the last character has no directionality (neutral character, direction is null), then we may need to add a direction marker to
            // ensure that the last character doesn't inherit directionality from the outside context.
            var appTextDirection = GetAppTextDirection(); // checks the <html> element's "dir" attribute.
            var dataTextDirection = DetectStringDirection(data); // Run through the string until a non-neutral character is encountered,
                                                                 // which determines the text direction.

            if (appTextDirection != dataTextDirection) {
                // Add a direction marker only if the data text runs opposite to the directionality of the app as a whole,
                // which would cause the neutral characters at the ends to flip.
                var directionMarkerCharacter =
                    dataTextDirection == TextDirections.RightToLeft ?
                        UnicodeDirectionMarkers.RightToLeftDirectionMarker : // "\u200F"
                        UnicodeDirectionMarkers.LeftToRightDirectionMarker; // "\u200E"

                data += directionMarkerCharacter;

                // Prepend the direction marker if the data text begins with a neutral character.
                var firstCharacterDirection = DetectCharacterDirection(data[0]);
                if (!firstCharacterDirection) {
                    data = directionMarkerCharacter + data;
                }
            }
        }
    }

    return data;
}
```

Добавляемые символы Юникода имеют нулевую длину и не влияют на интервал между строками. Этот код может снизить производительность, так как для определения направления строки требуется просматривать всю строку до тех пор, пока не будет найден символ, не являющийся нейтральным. Каждый символ, проверяемый на нейтральность, сначала сравнивается с несколькими диапазонами Юникода, а это не тривиальная проверка.

## <a name="case-study-2-a-bidi-mail-app"></a>Практический пример #2. Почтовое приложение BiDi

### <a name="overview"></a>Описание

В плане требований к макету пользовательского интерфейса разработка почтового клиента сравнительно проста в реализации. Приложение "Почта", которое поставляется вместе с Windows, имеет зеркальное отражение по умолчанию. С точки зрения обработки текста от почтового приложения требуется более надежное отображение текстовых данных и возможность компоновки разных видов текста для сценариев со смешанным текстом.

### <a name="establishing-ui-directionality"></a>Установка направленности пользовательского интерфейса

Разметка пользовательского интерфейса приложения "Почта" зеркально отражена. Ориентация трех областей изменена таким образом, что область папок расположена у правого края экрана, далее влево располагается область со списком элементов почтовых сообщений, а затем— область отображения сообщения.

![Зеркально отраженное почтовое приложение](images/56293_BIDI_19_icon_realignment_cropped_resized.png)

Дополнительные элементы изменили направление в соответствии с общим потоком пользовательского интерфейса и оптимизацией сенсорного ввода. В число этих элементов входит панель приложения и значки создания сообщения, ответа и удаления сообщения.

![Зеркальное почтовое приложение с панелью приложения](images/56294_BIDI_20_email_orientation_email_resized.png)

### <a name="text-handling"></a>Обработка текста

#### <a name="ui"></a>Пользовательский интерфейс

Текст пользовательского интерфейса обычно выровнен по правому краю. Это относится к области папок и области элементов. Область элементов ограничена двумя текстовыми строками (адрес и заголовок). Это важно для сохранения выравнивания справа налево без введения блока текста, который трудно было бы прочесть, если бы направление содержимого было противоположно направлению потока пользовательского интерфейса.

#### <a name="text-editing"></a>Правка текста

Требования к правке текста нацелены на создание сообщений в обоих направлениях: справа налево и слева направо. Кроме того, необходимо предусмотреть возможность сохранения компоновки сообщения с использованием подходящего формата, например RTF, в котором можно сохранять информацию о направлении.

![Приложение "Почта" с направленностью слева направо](images/56294_BIDI_21_email_orientation_LtR_resized.png)

![Приложение “Почта” с направленностью справа налево](images/56294_BIDI_22_email_orientation_RtL_resized.png)
