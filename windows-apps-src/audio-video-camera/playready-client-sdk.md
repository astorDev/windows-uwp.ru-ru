---
author: eliotcowley
ms.assetid: DD8FFA8C-DFF0-41E3-8F7A-345C5A248FC2
description: "В этой статье описано, как добавить мультимедийное содержимое, защищенное PlayReady, в приложение универсальной платформы Windows (UWP)."
title: PlayReady DRM
ms.author: elcowle
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: windows 10, uwp
translationtype: Human Translation
ms.sourcegitcommit: c6b64cff1bbebc8ba69bc6e03d34b69f85e798fc
ms.openlocfilehash: 161a048a4bfa9479821aec542db17ded8243d231
ms.lasthandoff: 02/07/2017

---

# <a name="playready-drm"></a>PlayReady DRM

\[ Обновлено для приложений UWP в Windows 10. Статьи по Windows 8.x см. в [архиве](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


В данной статье описано, как добавить мультимедийное содержимое, защищенное PlayReady, в приложение универсальной платформы Windows (UWP).

PlayReady DRM позволяет разработчикам создавать приложения UWP, способные предоставлять пользователю содержимое PlayReady, и при этом применять правила доступа, заданные поставщиком содержимого. В данном разделе описаны изменения, внесенные в Microsoft PlayReady DRM для Windows 10. Кроме того, рассказывается, как изменить приложение UWP, защищенное PlayReady, чтобы оно поддерживало изменения, появившиеся в Windows 10, которых не было в Windows 8.1.
 
| Статья                                                                     | Описание                                                                                                                                                                                                                                                                             |
|---------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [Аппаратное управление цифровыми правами (DRM)](hardware-drm.md)                                           | В данной статье рассказывается, как добавить аппаратное управление цифровыми правами (DRM) PlayReady в приложение UWP.                                                                                                                                                                 |
| [Адаптивная потоковая передача с защитой PlayReady](adaptive-streaming-with-playready.md) | В этой статье описывается, как добавить возможности адаптивной потоковой передачи мультимедийного содержимого с защитой Microsoft PlayReady в приложение универсальной платформы Windows (UWP). В настоящее время эта функция поддерживает воспроизведение содержимого Http Live Streaming (HLS) и Dynamic Adaptive Streaming over HTTP (DASH). |

## <a name="whats-new-in-playready-drm"></a>Новые возможности PlayReady DRM

В следующем списке описаны новые функции и изменения, внесенные в PlayReady DRM для Windows 10.

-   Добавлено аппаратное управление цифровыми правами (HWDRM).

    Поддержка аппаратной защиты содержимого обеспечивает безопасное воспроизведение содержимого высокого (HD) и сверхвысокого (UHD) разрешений на нескольких платформах устройств. Материал ключей (включая закрытые ключи, ключи содержимого и любой другой материал ключей, используемый для наследования или разблокировки указанных выше ключей), а также расшифрованные сжатые и несжатые примеры видео защищены с помощью аппаратной системы безопасности. При использовании аппаратного управления цифровыми правами ни одно неизвестное средство включения ("воспроизвести неизвестное" и "воспроизвести неизвестное с уменьшенным разрешением") не имеет значения, так как у конвейера аппаратного управления цифровыми правами всегда имеются сведения о том, какие выходные данные используются. Дополнительную информацию см. в статье [Аппаратное управление цифровыми правами](hardware-drm.md).

-   PlayReady больше не является компонентом платформы appX. Теперь он является встроенным компонентом операционной системы. Пространство имен было изменено с **Microsoft.Media.PlayReadyClient** на [**Windows.Media.Protection.PlayReady**](https://msdn.microsoft.com/library/windows/apps/dn986454).
-   Следующие заголовки, определяющие коды ошибок PlayReady, теперь входят в пакет средств разработки программного обеспечения для Windows: Windows.Media.Protection.PlayReadyErrors.h и Windows.Media.Protection.PlayReadyResults.h.
-   Обеспечивает заблаговременное получение несохраняемых лицензий.

    Предыдущие версии пакета PlayReady DRM не поддерживали заблаговременное получение несохраняемых лицензий. Такая возможность была добавлена в эту версию. Это может уменьшить время, затрачиваемое до отображения первого кадра. Дополнительную информацию см. в статье [Заблаговременное получение несохраняемой лицензии перед воспроизведением](#proactively-acquire-a-non-persistent-license-before-playback).

-   Обеспечивает получение нескольких лицензий в одном сообщении.

    Позволяет клиентскому приложению получать несколько несохраняемых лицензий в одном сообщении на получение лицензий. Это может уменьшить время, затрачиваемое до отображения первого кадра, путем получения лицензий на несколько объектов содержимого в то время, когда пользователь все еще просматривает библиотеку содержимого. Это позволяет устранить задержку на получение лицензии, когда пользователь выбирает содержимое, которое необходимо воспроизвести. Кроме того, это позволяет шифровать звуковые и видеопотоки с помощью различных ключей, включив заголовок содержимого, содержащий несколько идентификаторов ключей. Благодаря этому при запросе лицензии можно получать все лицензии для всех потоков в файле содержимого вместо того, чтобы использовать настраиваемую логику и несколько запросов на лицензии для достижения того же результата.

-   Добавлена поддержка окончания срока действия в режиме реального времени или лицензии с ограниченной продолжительностью.

    Предоставляет возможность настраивать окончание срока действия в режиме реального времени для лицензий и незаметного перехода от лицензии с истекшим сроком действия к другой (допустимой) лицензии в процессе воспроизведения. В сочетании с возможностью получения нескольких лицензий в одном сообщении это позволяет приложению асинхронно получать несколько лицензий с ограниченной продолжительностью, когда пользователь просматривает библиотеку содержимого, и получать лицензию с большей продолжительностью, когда пользователь выберет содержимое, которое необходимо воспроизвести. При этом воспроизведение будет начинаться намного быстрее (так как лицензия уже доступна) и так как к моменту окончания срока действия лицензии с ограниченной продолжительностью приложение уже получит лицензию с большей продолжительностью, воспроизведение будет продолжено без перерывов.

-   Добавлены цепочки несохраняемых лицензий.
-   Добавлена поддержка ограничений по времени (в том числе истечение срока действия, истечение срока действия после первого воспроизведения и истечение срока действия в режиме реального времени) для несохраняемых лицензий.
-   Добавлена поддержка HDCP типа 1 (версия 2.2 в Windows 10).

    Дополнительную информацию см. в разделе [Моменты, которые следует принять во внимание](#things-to-consider).

-   Miracast теперь носит характер неявных выходных данных.
-   Добавлена безопасная остановка.

    Безопасная остановка предоставляет устройству PlayReady средства надежного подтверждения службе потоковой передачи мультимедиа того, что воспроизведение мультимедиа остановлено для указанного содержимого. Благодаря этой возможности службы потоковой передачи мультимедиа могут точно применять ограничения на использование и сообщать о них на различных устройствах для заданной учетной записи.

-   Добавлено разделение лицензирования звука и видео.

    Использование отдельных дорожек не позволяет декодировать видео как звук, обеспечивая более надежную защиту содержимого. Новые стандарты требуют отдельных ключей для аудио- и видеодорожек.

-   Добавлена функция MaxResDecode.

    Эта функция была добавлена для ограничения воспроизведения содержимого до максимального разрешения, даже при наличия ключа с большими возможностями (но не лицензии). Она используется в тех случаях, когда потоки различных размеров кодируются с использованием одного ключа.

Следующие новые интерфейсы, классы и перечисления были добавлены в пакет PlayReady DRM:

-   Интерфейс [**IPlayReadyLicenseAcquisitionServiceRequest**](https://msdn.microsoft.com/library/windows/apps/dn986077)
-   Интерфейс [**IPlayReadyLicenseSession**](https://msdn.microsoft.com/library/windows/apps/dn986080)
-   Интерфейс [**IPlayReadySecureStopServiceRequest**](https://msdn.microsoft.com/library/windows/apps/dn986090)
-   Класс [**PlayReadyLicenseSession**](https://msdn.microsoft.com/library/windows/apps/dn986309)
-   Класс [**PlayReadySecureStopIterable**](https://msdn.microsoft.com/library/windows/apps/dn986371)
-   Класс [**PlayReadySecureStopIterator**](https://msdn.microsoft.com/library/windows/apps/dn986375)
-   Перечислитель [**PlayReadyHardwareDRMFeatures**](https://msdn.microsoft.com/library/windows/apps/dn986265)

Создан новый пример для демонстрации того, как использовать новые компоненты пакета PlayReady DRM. Этот пример можно загрузить по ссылке [http://go.microsoft.com/fwlink/p/?linkid=331670&clcid=0x409](http://go.microsoft.com/fwlink/p/?linkid=331670).

## <a name="things-to-consider"></a>Моменты, которые следует принять во внимание

-   PlayReady DRM теперь поддерживает HDCP типа 1 (поддерживается в HDCP версии 2.1 или более поздней). Лицензии PlayReady содержат политику ограничения типа HDCP, которую должно применить устройство. В Windows 10 эта политика требует использования HDCP 2.2 или более поздней версии. Эту функцию можно включить в лицензии PlayReady Server v3.0 SDK (сервер управляет этой политикой в лицензии, используя GUID ограничения типа HDCP). Дополнительные сведения см. в статье [Правила обеспечения совместимости и надежности для PlayReady](http://www.microsoft.com/playready/licensing/compliance/).
-   Видео в формате Windows Media (также называемом VC-1) не поддерживается аппаратным управлением цифровыми правами DRM (см. статью [Переопределение аппаратного управления цифровыми правами](hardware-drm.md#override-hardware-drm)).
-   Теперь пакет PlayReady DRM поддерживает стандарт сжатия видео High Efficiency Video Coding (HEVC /H.265). Чтобы поддерживать стандарт HEVC, ваше приложение должно использовать содержимое Common Encryption Scheme (CENC) версии 2, которое включает функцию оставления заголовков фрагментов содержимого в очистителе. Дополнительные сведения см. в стандарте ISO/IEC 23001-7 «Информационные технологии. Видеотехнологии MPEG. Часть 7. Общее кодирование в файлах форматов медиа файла на основе ISO» (необходима версия спецификации стандарта ISO/IEC 23001-7:2015 или более новая). Для всего содержимого с аппаратным управлением цифровыми правами корпорация Microsoft рекомендует использовать CENC версии 2. Кроме того, некоторые аппаратные системы управления цифровыми правами поддерживают стандарт HEVC, а другие — нет (см. статью [Переопределение аппаратного управления цифровыми правами](hardware-drm.md#override-hardware-drm)).
-   Чтобы использовать ряд новых функций PlayReady 3.0 (включая, помимо прочего, SL3000 для аппаратных клиентов, получение нескольких несохраняемых лицензий в одном сообщении на получении лицензий и временные ограничения для несохраняемых лицензий), сервер PlayReady должен иметь версию Microsoft PlayReady Server Software Development Kit v3.0.2769 Release или более позднюю.
-   В зависимости от политики защиты выходных данных, указанной в лицензии на содержимое, воспроизведение мультимедиа может не работать для конечных пользователей, если их подключенные выходные устройства не поддерживают указанные выше требования. В таблице ниже перечислен набор возникающих в результате этого стандартных ошибок. Дополнительные сведения см. в статье [Правила обеспечения совместимости и надежности для PlayReady](http://www.microsoft.com/playready/licensing/compliance/).

| Ошибка                                                   | Значение      | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|---------------------------------------------------------|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ERROR\_GRAPHICS\_OPM\_OUTPUT\_DOES\_NOT\_SUPPORT\_HDCP  | 0xC0262513 | Содержащаяся в лицензии политика защиты выходных данных требует от монитора использовать стандарт HDCP, но при этом не удалось использовать этот стандарт.                                                                                                                                                                                                                                                                                                                                                                                              |
| MF\_E\_POLICY\_UNSUPPORTED                              | 0xC00D7159 | Содержащаяся в лицензии политика защиты выходных данных требует от монитора использовать стандарт HDCP Type 1, но при этом не удалось использовать этот стандарт.                                                                                                                                                                                                                                                                                                                                                                                |
| DRM\_E\_TEE\_OUTPUT\_PROTECTION\_REQUIREMENTS\_NOT\_MET | 0x8004CD22 | Ошибка с этим кодом возникает только при использовании аппаратного управления цифровыми правами. Содержащаяся в лицензии политика защиты выходных данных требует от монитора использовать стандарт HDCP или уменьшить фактическое разрешение содержимого, но при этом не удалось ни использовать этот стандарт, ни уменьшить фактическое разрешение содержимого, так как аппаратное управление цифровыми правами не поддерживает функцию уменьшения разрешения содержимого. При использовании программного управления цифровыми правами содержимое воспроизводится. См. статью [Рекомендации по использованию аппаратного управления цифровыми правами](hardware-drm.md#considerations-for-using-hardware-drm). |
| ERROR\_GRAPHICS\_OPM\_NOT\_SUPPORTED                    | 0xc0262500 | Графический драйвер не поддерживает защиту выходных данных. Например, монитор подключен через разъем VGA или не установлен соответствующий графический драйвер для цифрового выхода. В последнем случае обычно устанавливается базовый видеоадаптер (Майкрософт), а для решения проблемы необходимо установить соответствующий графический драйвер.                                                                                                                                                  |

## <a name="output-protection"></a>Защита выходных данных

В следующем разделе описывается поведение при использовании PlayReady DRM для Windows 10 с политиками защиты выходных данных в лицензии PlayReady.

PlayReady DRM поддерживает уровни защиты выходных данных, содержащихся в **спецификации расширяемых прав мультимедиа Microsoft PlayReady**. Этот документ можно найти в пакете документов, который предоставляется с лицензированными продуктами PlayReady.

> [!NOTE]
> Допустимые значения уровней защиты выходных данных, которые могут быть установлены сервером лицензирования, регулируются [правилами соответствия требованиям PlayReady](https://www.microsoft.com/playready/licensing/compliance/).

PlayReady DRM позволяет воспроизводить содержимое с политиками защиты выходных данных только на выходных соединителях, как указано в правилах соответствия требованиям PlayReady. Дополнительные сведения об условиях выходных соединителей, указанных в правилах соответствия требованиям PlayReady, см. в разделе [Заданные условия для правил обеспечения совместимости и надежности PlayReady](https://www.microsoft.com/playready/licensing/compliance/).

Этот раздел посвящен сценариям защиты выходных данных с помощью PlayReady DRM для Windows 10 и аппаратного PlayReady DRM для Windows 10, которое также доступно на некоторых клиентах Windows. При использовании PlayReady HWDRM любая защита выходных данных применяется в реализации Windows TEE (см. [Аппаратное управление цифровыми правами (DRM)](hardware-drm.md)). В результате иногда поведение отличается при использовании программного управления правами PlayReady (SWDRM).

* Поддержка уровня защиты выходных данных (OPL) для несжатого цифрового видео 270: PlayReady HWDRM для Windows 10 не поддерживает ухудшения разрешения и требует применения HDCP. Рекомендуется, чтобы содержимое высокого разрешения для HWDRM имело значение показателя OPL более 270 (хотя это и необязательно). Кроме того, вам необходимо задать ограничение типа HDCP в лицензии (HDCP версии 2.2 или более поздней).
* В отличие от программного управления цифровыми правами (SWDRM) при использовании HWDRM защита выходных данных применяется на всех мониторах, при этом учитываются характеристики монитора с самыми худшими возможностями. Например, если у пользователя подключено два монитора, один из которых поддерживает стандарт HDCP, а другой — нет, и при этом лицензия требует наличия стандарта HDCP, то не удастся воспроизвести содержимое, даже если предполагается воспроизводить его только на мониторе, поддерживающем этот стандарт. При использовании SWDRM можно воспроизводить содержимое при условии, что оно будет отображаться только на мониторе, поддерживающем стандарт HDCP.
* Чтобы аппаратное управление цифровыми правами (HWDRM) гарантированно использовалось в клиенте и обеспечивало защиту, должны быть выполнены указанные ниже условия для ключей содержимого и лицензий.
    * Лицензия, используемая для ключа содержимого видео, должна иметь уровень безопасности как минимум 3000.
    * Аудиоданные необходимо шифровать ключом, отличным от ключа для видеоданных, а лицензия, используемая для аудиоданных, должна иметь уровень безопасности, равный как минимум 2000. Также звук можно оставить незашифрованным.
* Все сценарии SWDRM требуют использования минимального уровня безопасности лицензии PlayReady для ключа аудио- и видеосодержимого, который не больше 2000.

### <a name="output-protection-levels"></a>Уровни защиты выходных данных

В следующей таблице приведены сопоставления между различными уровнями OPL в лицензии PlayReady и способами их применения в PlayReady DRM для Windows 10.

#### <a name="video"></a>Видео

<table>
    <tr>
        <th rowspan="2">OPL</th>
        <th>Сжатое цифровое видео</th>
        <th colspan="2">Несжатое цифровое видео</th>
        <th>Аналоговое ТВ</th>
    </tr>
    <tr>
        <th>Любой</th>
        <th colspan="2">HDMI, DVI, DisplayPort, MHL</th>
        <th>Компонентный, композитный</th>
    </tr>
    <tr>
        <th>100</th>
        <td rowspan="6">Н/Д*</td>
        <td colspan="2">Передает содержимое</td>
        <td>Передает содержимое</td>
    </tr>
    <tr>
        <th>150</th>
        <td colspan="2" rowspan="2">Н/Д*</td>
        <td>Передает содержимое, если используется CGMS-A CopyNever или не удается использовать CGMS-A</td>
    </tr>
    <tr>
        <th>200</th>
        <td>Передает содержимое, если используется CGMS-A CopyNever</td>
    </tr>
    <tr>
        <th>250</th>
        <td colspan="2">Пытается включить HDCP, но передает содержимое независимо от результата</td>
        <td rowspan="5">Н/Д*</td>
    </tr>
    <tr>
        <th>270</th>
        <td>**SWDRM**: пытается включить HDCP. Если не удается включить HDCP, компьютер ограничит эффективное разрешение до 520 000 пикселей на кадр и передаст содержимое</td>
        <td>**HWDRM**: передает содержимое с помощью HDCP. Если не удается включить HDCP, воспроизведение через порты HDMI и DVI запрещено</td>
    </tr>
    <tr>
        <th>300</th>
        <td colspan="2">
            <p>
                **Если НЕ задано ограничение типа HDCP:** передает содержимое с помощью HDCP. Если не удается включить HDCP, воспроизведение через порты HDMI и DVI запрещено.
            </p>
            <p>
                **Если задано ограничение типа HDCP**: передает содержимое с помощью HDCP 2.2, при этом задан тип потока содержимого 1. Если не удается включить HDCP или задать тип потока содержимого 1, воспроизведение через порты HDMI и DVI запрещено.
            </p>
        </td>
    </tr>
    <tr>
        <th>400</th>
        <td rowspan="2">Windows 10 никогда не передает сжатое цифровое видеосодержимое на выходы независимо от последующего значения OPL. Дополнительные сведения о сжатом цифровом видео см. в разделе [Правила соответствия требованиям для продуктов PlayReady](https://www.microsoft.com/playready/licensing/compliance/).</td>
        <td colspan="2" rowspan="2">Н/Д*</td>
    </tr>
    <tr>
        <th>500</th>
    </tr>
</table>
<br/>

\ * Не все значения уровней защиты выходных данных могут быть установлены сервером лицензирования. Дополнительные сведения см. в статье [Правила обеспечения совместимости PlayReady](https://www.microsoft.com/playready/licensing/compliance/).

#### <a name="audio"></a>Звук

<table>
    <tr>
        <th rowspan="2">OPL</th>
        <th>Сжатое цифровое аудио</th>
        <th>Несжатое цифровое аудио</th>
        <th>Аналоговое или USB-аудио</th>
    </tr>
    <tr>
        <th>HDMI, DisplayPort, MHL</th>
        <th>HDMI, DisplayPort, MHL</th>
        <th>Любой</th>
    </tr>
    <tr>
        <th>100</th>
        <td rowspan="3">Передает содержимое</td>
        <td>Передает содержимое</td>
        <td rowspan="5">Передает содержимое</td>
    </tr>
    <tr>
        <th>150</th>
        <td rowspan="4">НЕ передает содержимое</td>
    </tr>
    <tr>
        <th>200</th>
    </tr>
    <tr>
        <th>250</th>
        <td>Передает содержимое, если HDCP включен для HDMI, DisplayPort либо MHL или если включен SCMS и задан режим CopyNever</td>
    </tr>
    <tr>
        <th>300</th>
        <td>Передает содержимое, если HDCP включен для HDMI, DisplayPort или MHL</td>
    </tr>
</table>
<br/>

### <a name="miracast"></a>Miracast

PlayReady DRM позволяет воспроизводить содержимое через выход Miracast, если используется HDCP 2.0 или более поздней версии. Однако в Windows 10 Miracast считается *цифровым* выходом. Подробнее о сценариях Miracast см. в разделе [Правила обеспечения совместимости PlayReady](https://www.microsoft.com/playready/licensing/compliance/). В следующей таблице приведены сопоставления между различными уровнями OPL в лицензии PlayReady и способы их применения для выходов Miracast.

<table>
    <tr>
        <th>OPL</th>
        <th>Сжатое цифровое аудио</th>
        <th>Несжатое цифровое аудио</th>
        <th>Сжатое цифровое видео</th>
        <th>Несжатое цифровое видео</th>
    </tr>
    <tr>
        <th>100</th>
        <td rowspan="4">Передает содержимое, если используется HDCP 2.0 или более поздней версии. Если не удается включить HDCP, содержимое НЕ передается</td>
        <td>Передает содержимое, если используется HDCP 2.0 или более поздней версии. Если не удается включить HDCP, содержимое НЕ передается</td>
        <td rowspan="6">Н/Д*</td>
        <td>Передает содержимое, если используется HDCP 2.0 или более поздней версии. Если не удается включить HDCP, содержимое НЕ передается</td>
    </tr>
    <tr>
        <th>150</th>
        <td rowspan="3">НЕ передает содержимое</td>
        <td rowspan="2">Н/Д*</td>
    </tr>
    <tr>
        <th>200</th>
    </tr>
    <tr>
        <th>250</th>
        <td rowspan="2">Передает содержимое, если используется HDCP 2.0 или более поздней версии. Если не удается включить HDCP, содержимое НЕ передается</td>
    </tr>
    <tr>
        <th>270</th>
        <td colspan="2">Н/Д*</td>
    </tr>
    <tr>
        <th>300</th>
        <td>Передает содержимое, если используется HDCP 2.0 или более поздней версии. Если не удается включить HDCP, содержимое НЕ передается</td>
        <td>НЕ передает содержимое</td>
        <td>
            <p>
                **Если НЕ задано ограничение типа HDCP:** передает содержимое, если используется HDCP 2.0 или более поздней версии. Если не удается включить HDCP, содержимое НЕ передается.
            </p>
            <p>
                **Если задано ограничение типа HDCP**: передает содержимое с помощью HDCP 2.2, при этом задан тип потока содержимого 1. Если не удается включить HDCP или задать тип потока содержимого 1, содержимое НЕ передается.
            </p>        
        </td>
    </tr>
    <tr>
        <th>400</th>
        <td rowspan="2" colspan="2">Н/Д*</td>
        <td rowspan="2">Windows 10 никогда не передает сжатое цифровое видеосодержимое на выходы независимо от последующего значения OPL. Дополнительные сведения о сжатом цифровом видео см. в разделе [Правила соответствия требованиям для продуктов PlayReady](https://www.microsoft.com/playready/licensing/compliance/).</td>
        <td rowspan="2">Н/Д*</td>
    </tr>
    <tr>
        <th>500</th>
    </tr>
</table>
<br/>

\ * Не все значения уровней защиты выходных данных могут быть установлены сервером лицензирования. Дополнительные сведения см. в статье [Правила обеспечения совместимости PlayReady](https://www.microsoft.com/playready/licensing/compliance/).

### <a name="additional-explicit-output-restrictions"></a>Дополнительные явные ограничения вывода

В следующей таблице описывается реализация явных ограничений защиты вывода цифрового видео в PlayReady DRM для Windows 10.

<table>
    <tr>
        <th>Сценарий</th>
        <th>GUID</th>
        <th>Если...</th>
        <th>То...</th>
    </tr>
    <tr>
        <th>Максимальное размер декодирования эффективного разрешения</th>
        <td>9645E831-E01D-4FFF-8342-0A720E3E028F</td>
        <td>Подключенный выход: выход цифрового видео, Miracast, HDMI, DVI и т. д.</td>
        <td>
            <p>
                Передает содержимое со следующими ограничениями:  
            </p>
            <ul>
                <li>(а) ширина кадра должна быть меньше или равна максимальной ширине кадра в пикселях, а высота кадра — меньше или равна максимальной высоте кадра в пикселях;</li>
                <li>(б) высота кадра должна быть меньше или равна максимальной ширине кадра в пикселях, а ширина кадра — меньше или равна максимальной высоте кадра в пикселях.</li>
            </ul>                   
        </td>
    </tr>
    <tr>
        <th>Ограничение типа HDCP</th>
        <td>ABB2C6F1-E663-4625-A945-972D17B231E7</td>
        <td>Подключенный выход: выход цифрового видео, Miracast, HDMI, DVI и т. д.</td>
        <td>Передает содержимое с использованием HDCP 2.2 и типа 1 потока содержимого. Если не удается включить HDCP 2.2 или задать тип потока содержимого 1, содержимое НЕ передается. Также необходимо указать уровень защиты несжатого цифрового видео не меньше 271</td>
    </tr>
</table>
<br/>

В следующей таблице описывается реализация явных ограничений защиты вывода аналогового видео в PlayReady DRM для Windows 10.

<table>
    <tr>
        <th>Сценарий</th>
        <th>GUID</th>
        <th>Если...</th>
        <th colspan="2">То...</th>
    </tr>
    <tr>
        <th>Аналоговый компьютерный монитор</th>
        <td>D783A191-E083-4BAF-B2DA-E69F910B3772</td>
        <td>Подключенный выход: VGA, DVI&ndash;analog и т. д.</td>
        <td>**SWDRM:** компьютер ограничивает эффективное разрешение до 520 000 пикселей на кадр и передает содержимое</td>
        <td>**HWDRM:** НЕ передает содержимое</td>
    </tr>
    <tr>
        <th>Аналоговый компонентный выход</th>
        <td>811C5110-46C8-4C6E-8163-C0482A15D47E</td>
        <td>Подключенный выход: компонентный</td>
        <td>**SWDRM:** компьютер ограничивает эффективное разрешение до 520 000 пикселей на кадр и передает содержимое</td>
        <td>**HWDRM:** НЕ передает содержимое</td>
    </tr>
    <tr>
        <th rowspan="2">Аналоговые ТВ-выходы</th>
        <td>2098DE8D-7DDD-4BAB-96C6-32EBB6FABEA3</td>
        <td>Уровень OPL аналогового ТВ менее 151</td>
        <td colspan="2">Необходимо использовать CGMS-A</td>
    </tr>
    <tr>
        <td>225CD36F-F132-49EF-BA8C-C91EA28E4369</td>
        <td>OPL аналогового ТВ меньше 101, и лицензия не содержит 2098DE8D-7DDD-4BAB-96C6-32EBB6FABEA3</td>
        <td colspan="2">Необходимо попытаться использовать CGMS-A, но содержимое может воспроизводиться независимо от результата</td>
    </tr>
    <tr>
        <th>Автоматическое управление усилением и цветовая полоса</th>
        <td>C3FD11C6-F8B7-4D20-B008-1DB17D61F2DA</td>
        <td>Передача содержимого с разрешением меньше или равным 520 000 пикселям на аналоговый ТВ-выход</td>
        <td colspan="2">Устанавливает AGC только для компонентного видео и режима PAL, если разрешение меньше 520 000 пикселей, и устанавливает AGC и задает данные цветовой полосы для NTSC, если разрешение меньше 520 000 пикселей, согласно таблице 3.5.7.3. в правилах соответствия требованиям</td>
    </tr>
    <tr>
        <th>Только цифровой выход</th>
        <td>760AE755-682A-41E0-B1B3-DCDF836A7306</td>
        <td>Подключен аналоговый выход</td>
        <td colspan="2">Не передает содержимое</td>
    </tr>
</table>
<br/>

> [!NOTE]
> При использовании внешнего модуля адаптера, например "Mini DisplayPort-VGA" для воспроизведения Windows 10 рассматривает выход как выход цифрового видео и не может применять политики для аналогового видео.

В следующей таблице описывается реализация PlayReady DRM для Windows 10, которая допускает воспроизведение в других обстоятельствах.

<table>
    <tr>
        <th>Сценарий</th>
        <th>GUID</th>
        <th>Если...</th>
        <th colspan="2">То...</th>
    </tr>
    <tr>
        <th>Неизвестный выход</th>
        <td>786627D8-C2A6-44BE-8F88-08AE255B01A7</td>
        <td>Если не удается определить выход или OPM с графическим драйвером</td>
        <td>**SWDRM:** передает содержимое</td>
        <td>**HWDRM:** НЕ передает содержимое</td>
    </tr>
    <tr>
        <th>Неизвестный выход с ограничением</th>
        <td>B621D91F-EDCC-4035-8D4B-DC71760D43E9</td>
        <td>Если не удается определить выход или OPM с графическим драйвером</td>
        <td>**SWDRM:** компьютер ограничивает эффективное разрешение до 520 000 пикселей на кадр и передает содержимое</td>
        <td>**HWDRM:** НЕ передает содержимое</td>
    </tr>
</table>
<br/>

## <a name="prerequisites"></a>Необходимые условия

Прежде чем приступить к созданию приложения UWP, защищенного PlayReady, в вашей системе необходимо установить указанное ниже программное обеспечение.

-   Windows 10.
-   Если вы компилируете какие-либо примеры для пакета PlayReady DRM для приложений UWP, необходимо использовать Microsoft Visual Studio 2015 или более поздней версии. Microsoft Visual Studio 2013 можно использовать для компиляции любых примеров из пакета PlayReady DRM для приложений Магазина Windows 8.1.

<!--This is no longer available-->
<!--If you are planning to play back MPEG-2/H.262 content on your app, you must also download and install [Windows 8.1 Media Center Pack](http://go.microsoft.com/fwlink/p/?LinkId=626876).-->

## <a name="playready-windows-store-app-migration-guide"></a>Руководство по переносу приложения PlayReady для Магазина Windows

В данном разделе содержатся сведения о том, как выполнить миграцию существующих приложений PlayReady для Магазина Windows 8.x в Windows 10.

Пространство имен для приложений UWP PlayReady в Windows 10 было изменено с **Microsoft.Media.PlayReadyClient** на [**Windows.Media.Protection.PlayReady**](https://msdn.microsoft.com/library/windows/apps/dn986454). Это означает, что вам необходимо выполнить поиск и заменить в коде старое пространство имен на новое. Вы по-прежнему будете ссылаться на файл winmd. Это часть файла windows.media.winmd в операционной системе Windows 10. Он входит в windows.winmd в качестве части пакета Windows SDK TH. Что касается UWP, то ссылка на него содержится в windows.foundation.univeralappcontract.winmd.

Чтобы воспроизвести содержимое высокого (HD, 1080p) и сверхвысокого (UHD) разрешений, защищенное PlayReady, вам потребуется реализовать аппаратное управление цифровыми правами PlayReady. Сведения о том, как реализовать аппаратное управление цифровыми правами PlayReady, см. в статье [Аппаратное управление цифровыми правами](hardware-drm.md).

Некоторое содержимое не поддерживается аппаратным управлением цифровыми правами. Дополнительные сведения о том, как отключить аппаратное управление цифровыми правами и включить программное управление цифровыми правами, см. в статье [Переопределение аппаратного управления цифровыми правами](hardware-drm.md#override-hardware-drm).

Что касается диспетчера защиты мультимедиа, убедитесь, что для кода заданы следующие настройки.

```cs
var mediaProtectionManager = new Windows.Media.Protection.MediaProtectionManager();

mediaProtectionManager.properties["Windows.Media.Protection.MediaProtectionSystemId"] = 
             '{F4637010-03C3-42CD-B932-B48ADF3A6A54}'
var cpsystems = new Windows.Foundation.Collections.PropertySet();
cpsystems["{F4637010-03C3-42CD-B932-B48ADF3A6A54}"] = 
                "Windows.Media.Protection.PlayReady.PlayReadyWinRTTrustedInput";
mediaProtectionManager.properties["Windows.Media.Protection.MediaProtectionSystemIdMapping"] = cpsystems;

mediaProtectionManager.properties["Windows.Media.Protection.MediaProtectionContainerGuid"] = 
                "{9A04F079-9840-4286-AB92-E65BE0885F95}";
```

## <a name="proactively-acquire-a-non-persistent-license-before-playback"></a>Заблаговременное получение несохраняемой лицензии перед воспроизведением

В данном разделе рассказывается, как заблаговременно получить несохраняемую лицензию перед началом воспроизведения.

В предыдущих версиях пакета PlayReady DRM можно было получать несохраняемые лицензии только во время воспроизведения. В этой версии можно получать несохраняемые лицензии заблаговременно перед началом воспроизведения.

1.  Заранее создайте сеанс воспроизведения, в котором можно сохранить несохраняемую лицензию. Пример:

    ```cs
    var cpsystems = new Windows.Foundation.Collections.PropertySet();       
    cpsystems["{F4637010-03C3-42CD-B932-B48ADF3A6A54}"] = "Windows.Media.Protection.PlayReady.PlayReadyWinRTTrustedInput"; // PlayReady

    var pmpSystemInfo = new Windows.Foundation.Collections.PropertySet();
    pmpSystemInfo["Windows.Media.Protection.MediaProtectionSystemId"] = "{F4637010-03C3-42CD-B932-B48ADF3A6A54}";
    pmpSystemInfo["Windows.Media.Protection.MediaProtectionSystemIdMapping"] = cpsystems;
    var pmpServer = new Windows.Media.Protection.MediaProtectionPMPServer( pmpSystemInfo );
    ```

2.  Свяжите этот сеанс воспроизведения с классом получения лицензии. Пример:

    ```cs
    var licenseSessionProperties = new Windows.Foundation.Collections.PropertySet();
    licenseSessionProperties["Windows.Media.Protection.MediaProtectionPMPServer"] = pmpServer;
    var licenseSession = new Windows.Media.Protection.PlayReady.PlayReadyLicenseSession( licenseSessionProperties );
    ```

3.  Создайте запрос лицензии в службу поддержки. Пример:

    ```cs
    var laSR = licenseSession.CreateLAServiceRequest();
    ```

4.  Выполните получение лицензии с использованием запроса в службу поддержки, созданного в шаге 3. Лицензия будет сохранена в сеансе воспроизведения.
5.  Для воспроизведения источника мультимедиа свяжите с ним сеанс воспроизведения. Например:

    ```cs
    licenseSession.configureMediaProtectionManager( mediaProtectionManager );
    videoPlayer.msSetMediaProtectionManager( mediaProtectionManager );
    ```
    
## <a name="add-secure-stop"></a>Добавление безопасной остановки

В данном разделе рассказывается, как добавить безопасную остановку в приложение UWP.

Безопасная остановка предоставляет устройству PlayReady средства надежного подтверждения службе потоковой передачи мультимедиа того, что воспроизведение мультимедиа остановлено для указанного содержимого. Благодаря этой возможности службы потоковой передачи мультимедиа могут точно применять ограничения на использование и сообщать о них на различных устройствах для заданной учетной записи.

Для отправки запроса на безопасную остановку используются два указанных ниже основных сценария.

-   Когда презентация мультимедиа останавливается по завершении содержимого или когда пользователь остановил ее где-то в середине.
-   Когда неожиданно заканчивается предыдущий сеанс (например, из-за сбоя системы или приложения). При запуске или при завершении работы приложению потребуется сделать запрос на наличие невыполненных сеансов безопасной остановки и отправить запросы, не зависящие от любых других воспроизводящихся мультимедиа.

Пример реализации безопасной остановки см. в файле securestop.cs в примере PlayReady по адресу [http://go.microsoft.com/fwlink/p/?linkid=331670&clcid=0x409](http://go.microsoft.com/fwlink/p/?linkid=331670).

## <a name="use-playready-drm-on-xbox-one"></a>Использование технологии PlayReady DRM на Xbox One

Чтобы использовать технологию управления цифровыми правами PlayReady DRM в приложении UWP на Xbox One, необходимо сначала зарегистрировать учетную запись Центра разработки, которую вы используете для публикации приложения, чтобы авторизовать ее для использования PlayReady. Это можно сделать одним из двух способов:

* Попросить ваше контактное лицо в корпорации Майкрософт запросить для вас разрешение.
* Подать заявку на авторизацию, отправив свою учетную запись в Центре разработки и название компании по адресу [pronxbox@microsoft.com](mailto:pronxbox@microsoft.com).

После получения авторизации вам нужно будет добавить в манифест приложения дополнительный элемент `<DeviceCapability>`. Это необходимо сделать вручную, поскольку в настоящее время в конструкторе манифеста приложения нет соответствующего параметра. Чтобы настроить эту оснастку, выполните указанные ниже действия:

1. Откройте проект в Visual Studio, откройте **Обозреватель решений** и щелкните **Package.appxmanifest** правой кнопкой мыши.
2. Выберите **Открыть с помощью...**, щелкните **Редактор (текстовый) XML** и нажмите кнопку **ОК**.
3. Между тегами `<Capabilities>` добавьте следующий элемент `<DeviceCapability>`:

    ```xml
    <DeviceCapability Name="6a7e5907-885c-4bcb-b40a-073c067bd3d5" />
    ```

4. Сохраните файл.

И наконец, при использовании PlayReady и Xbox One необходимо помнить следующее: в комплектах разработки установлено ограничение по уровню безопасности SL150 (это означает, что они не могут воспроизводить содержимое с уровнем SL2000 или SL3000). Розничные устройства способны воспроизводить содержимое с более высокими уровнями безопасности, но для тестирования приложения на комплекте для разработки нужно использовать содержимое с уровнем SL150. Протестировать такое содержимое можно одним из следующих способов:

* Использовать специально подобранное тестовое содержимое, для которого требуются лицензии SL150.
* Реализовать логику, чтобы только определенные прошедшие проверку подлинности тестовые учетные записи могли получать лицензии SL150 на определенное содержимое.

Используйте тот подход, который лучше всего подходит для вашего продукта.

## <a name="see-also"></a>См. также
- [Воспроизведение мультимедиа](media-playback.md)





