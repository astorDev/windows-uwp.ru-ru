---
ms.assetid: DD8FFA8C-DFF0-41E3-8F7A-345C5A248FC2
description: В данной статье описано, как добавить мультимедийное содержимое, защищенное PlayReady, в приложение универсальной платформы Windows (UWP).
title: DRM PlayReady
---

# DRM PlayReady

\[ Обновлено для приложений UWP в Windows 10. Статьи о Windows 8.x см. в [архиве](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


В данной статье описано, как добавить мультимедийное содержимое, защищенное PlayReady, в приложение универсальной платформы Windows (UWP).

PlayReady DRM позволяет разработчикам создавать приложения UWP, способные предоставлять пользователю содержимое PlayReady, и при этом применять правила доступа, заданные поставщиком содержимого. В данном разделе описаны изменения, внесенные в Microsoft PlayReady DRM для Windows 10. Кроме того, рассказывается, как изменить приложение UWP, защищенное PlayReady, чтобы оно поддерживало изменения, появившиеся в Windows 10, которых не было в Windows 8.1.
 
| Тема                                                                     | Описание                                                                                                                                                                                                                                                                             |
|---------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [Аппаратное управление цифровыми правами (DRM)](hardware-drm.md)                                           | В данной статье рассказывается, как добавить аппаратное управление цифровыми правами (DRM) PlayReady в приложение UWP.                                                                                                                                                                 |
| [Адаптивная потоковая передача с защитой PlayReady](adaptive-streaming-with-playready.md) | В этой статье описывается, как добавить возможности адаптивной потоковой передачи мультимедийного содержимого с защитой Microsoft PlayReady в приложение универсальной платформы Windows (UWP). В настоящее время эта функция поддерживает воспроизведение содержимого Http Live Streaming (HLS) и Dynamic Adaptive Streaming over HTTP (DASH). |

## Новые возможности PlayReady DRM

В следующем списке описаны новые функции и изменения, внесенные в PlayReady DRM для Windows 10.

-   Добавлено аппаратное управление цифровыми правами.

    Поддержка аппаратной защиты содержимого обеспечивает безопасное воспроизведение содержимого высокого (HD) и сверхвысокого (UHD) разрешений на нескольких платформах устройств. Материал ключей (включая закрытые ключи, ключи содержимого и любой другой материал ключей, используемый для наследования или разблокировки указанных выше ключей), а также расшифрованные сжатые и несжатые примеры видео защищены с помощью аппаратной системы безопасности. При использовании аппаратного управления цифровыми правами ни одно неизвестное средство включения ("воспроизвести неизвестное" и "воспроизвести неизвестное с уменьшенным разрешением") не имеет значения, так как у конвейера аппаратного управления цифровыми правами всегда имеются сведения о том, какие выходные данные используются. Дополнительную информацию см. в статье [Аппаратное управление цифровыми правами](hardware-drm.md).

-   PlayReady больше не является компонентом платформы appX. Теперь он является встроенным компонентом операционной системы. Пространство имен было изменено с **Microsoft.Media.PlayReadyClient** на [**Windows.Media.Protection.PlayReady**](https://msdn.microsoft.com/library/windows/apps/dn986454).
-   Следующие заголовки, определяющие коды ошибок PlayReady, теперь входят в пакет средств разработки программного обеспечения для Windows: Windows.Media.Protection.PlayReadyErrors.h и Windows.Media.Protection.PlayReadyResults.h.
-   Обеспечивает заблаговременное получение несохраняемых лицензий.

    Предыдущие версии пакета PlayReady DRM не поддерживали заблаговременное получение несохраняемых лицензий. Такая возможность была добавлена в эту версию. Это может уменьшить время, затрачиваемое до отображения первого кадра. Дополнительную информацию см. в статье [Заблаговременное получение несохраняемой лицензии перед воспроизведением](#proactively_acquire_a_non_persistent_license_before_playback).

-   Обеспечивает получение нескольких лицензий в одном сообщении.

    Позволяет клиентскому приложению получать несколько несохраняемых лицензий в одном сообщении на получение лицензий. Это может уменьшить время, затрачиваемое до отображения первого кадра, путем получения лицензий на несколько объектов содержимого в то время, когда пользователь все еще просматривает библиотеку содержимого. Это позволяет устранить задержку на получение лицензии, когда пользователь выбирает содержимое, которое необходимо воспроизвести. Кроме того, это позволяет шифровать звуковые и видеопотоки с помощью различных ключей, включив заголовок содержимого, содержащий несколько идентификаторов ключей. Благодаря этому при запросе лицензии можно получать все лицензии для всех потоков в файле содержимого вместо того, чтобы использовать настраиваемую логику и несколько запросов на лицензии для достижения того же результата.

-   Добавлена поддержка окончания срока действия в режиме реального времени или лицензии с ограниченной продолжительностью.

    Предоставляет возможность настраивать окончание срока действия в режиме реального времени для лицензий и незаметного перехода от лицензии с истекшим сроком действия к другой (допустимой) лицензии в процессе воспроизведения. В сочетании с возможностью получения нескольких лицензий в одном сообщении это позволяет приложению асинхронно получать несколько лицензий с ограниченной продолжительностью, когда пользователь просматривает библиотеку содержимого, и получать лицензию с большей продолжительностью, когда пользователь выберет содержимое, которое необходимо воспроизвести. При этом воспроизведение будет начинаться намного быстрее (так как лицензия уже доступна) и так как к моменту окончания срока действия лицензии с ограниченной продолжительностью приложение уже получит лицензию с большей продолжительностью, воспроизведение будет продолжено без перерывов.

-   Добавлены цепочки несохраняемых лицензий.
-   Добавлена поддержка ограничений по времени (в том числе истечение срока действия, истечение срока действия после первого воспроизведения и истечение срока действия в режиме реального времени) для несохраняемых лицензий.
-   Добавлена поддержка политики стандарта HDCP Type 1 (версии 2.2).

    Дополнительную информацию см. в разделе [Моменты, которые следует принять во внимание](#things_to_consider).

-   Miracast теперь носит характер неявных выходных данных.
-   Добавлена безопасная остановка.

    Безопасная остановка предоставляет устройству PlayReady средства надежного подтверждения службе потоковой передачи мультимедиа того, что воспроизведение мультимедиа остановлено для указанного содержимого. Благодаря этой возможности службы потоковой передачи мультимедиа могут точно применять ограничения на использование и сообщать о них на различных устройствах для заданной учетной записи.

-   Добавлено разделение лицензирования звука и видео.

    Использование отдельных дорожек не позволяет декодировать видео как звук, обеспечивая более надежную защиту содержимого. Новые стандарты требуют отдельных ключей для аудио- и видеодорожек.

-   Добавлена функция MaxResDecode.

    Эта функция была добавлена для ограничения воспроизведения содержимого до максимального разрешения, даже при наличия ключа с большими возможностями (но не лицензии). Она используется в тех случаях, когда потоки различных размеров кодируются с использованием одного ключа.

Следующие новые интерфейсы, классы и перечисления были добавлены в пакет PlayReady DRM:

-   Интерфейс [**IPlayReadyLicenseAcquisitionServiceRequest**](https://msdn.microsoft.com/library/windows/apps/dn986077)
-   Интерфейс [**IPlayReadyLicenseSession**](https://msdn.microsoft.com/library/windows/apps/dn986080)
-   Интерфейс [**IPlayReadySecureStopServiceRequest**](https://msdn.microsoft.com/library/windows/apps/dn986090)
-   Класс [**PlayReadyLicenseSession**](https://msdn.microsoft.com/library/windows/apps/dn986309)
-   Класс [**PlayReadySecureStopIterable**](https://msdn.microsoft.com/library/windows/apps/dn986371)
-   Класс [**PlayReadySecureStopIterator**](https://msdn.microsoft.com/library/windows/apps/dn986375)
-   Перечислитель [**PlayReadyHardwareDRMFeatures**](https://msdn.microsoft.com/library/windows/apps/dn986265)

Создан новый пример для демонстрации того, как использовать новые компоненты пакета PlayReady DRM. Этот пример можно загрузить по ссылке [http://go.microsoft.com/fwlink/p/?linkid=331670&clcid=0x409](http://go.microsoft.com/fwlink/p/?linkid=331670).

## Моменты, которые необходимо учитывать

-   PlayReady DRM теперь поддерживает стандарт HDCP Type 1 (версии 2.2 или более новой). Лицензии PlayReady содержат политику, которую должно применить устройство. Эту функцию можно включить в лицензии PlayReady Server v3.0 SDK (сервер управляет этой политикой в лицензии, используя **GUID** средства включения воспроизведения). Дополнительные сведения см. в статье [Правила обеспечения совместимости и надежности для PlayReady](http://www.microsoft.com/playready/licensing/compliance/).
-   Видео в формате Windows Media (также называемом VC-1) не поддерживается аппаратным управлением цифровыми правами DRM (см. статью [Переопределение аппаратного управления цифровыми правами](hardware-drm.md#override-hardware-drm)).
-   Теперь пакет PlayReady DRM поддерживает стандарт сжатия видео High Efficiency Video Coding (HEVC /H.265). Чтобы поддерживать стандарт HEVC, ваше приложение должно использовать содержимое Common Encryption Scheme (CENC) версии 2, которое включает функцию оставления заголовков фрагментов содержимого в очистителе. Дополнительные сведения см. в стандарте ISO/IEC 23001-7 «Информационные технологии. Видеотехнологии MPEG. Часть 7. Общее кодирование в файлах форматов медиа файла на основе ISO» (необходима версия спецификации стандарта ISO/IEC 23001-7:2015 или более новая). Для всего содержимого с аппаратным управлением цифровыми правами корпорация Microsoft рекомендует использовать CENC версии 2. Кроме того, некоторые аппаратные системы управления цифровыми правами поддерживают стандарт HEVC, а другие — нет (см. статью [Переопределение аппаратного управления цифровыми правами](hardware-drm.md#override-hardware-drm)).
-   Чтобы использовать ряд новых функций PlayReady 3.0 (включая, помимо прочего, SL3000 для аппаратных клиентов, получение нескольких несохраняемых лицензий в одном сообщении на получении лицензий и временные ограничения для несохраняемых лицензий), сервер PlayReady должен иметь версию Microsoft PlayReady Server Software Development Kit v3.0.2769 Release или более позднюю.
-   В зависимости от политики защиты выходных данных, указанной в лицензии на содержимое, воспроизведение мультимедиа может не работать для конечных пользователей, если их подключенные выходные устройства не поддерживают указанные выше требования. В таблице ниже перечислен набор возникающих в результате этого стандартных ошибок. Дополнительные сведения см. в статье [Правила обеспечения совместимости и надежности для PlayReady](http://www.microsoft.com/playready/licensing/compliance/).

| Ошибка                                                   | Значение      | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|---------------------------------------------------------|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ERROR\_GRAPHICS\_OPM\_OUTPUT\_DOES\_NOT\_SUPPORT\_HDCP  | 0xC0262513 | Содержащаяся в лицензии политика защиты выходных данных требует от монитора использовать стандарт HDCP, но при этом не удалось использовать этот стандарт.                                                                                                                                                                                                                                                                                                                                                                                              |
| MF\_E\_POLICY\_UNSUPPORTED                              | 0xC00D7159 | Содержащаяся в лицензии политика защиты выходных данных требует от монитора использовать стандарт HDCP Type 1, но при этом не удалось использовать этот стандарт.                                                                                                                                                                                                                                                                                                                                                                                |
| DRM\_E\_TEE\_OUTPUT\_PROTECTION\_REQUIREMENTS\_NOT\_MET | 0x8004CD22 | Ошибка с этим кодом возникает только при использовании аппаратного управления цифровыми правами. Содержащаяся в лицензии политика защиты выходных данных требует от монитора использовать стандарт HDCP или уменьшить фактическое разрешение содержимого, но при этом не удалось ни использовать этот стандарт, ни уменьшить фактическое разрешение содержимого, так как аппаратное управление цифровыми правами не поддерживает функцию уменьшения разрешения содержимого. При использовании программного управления цифровыми правами содержимое воспроизводится. См. статью [Рекомендации по использованию аппаратного управления цифровыми правами](hardware-drm.md#considerations-for-using-hardware-drm). |
| ERROR\_GRAPHICS\_OPM\_NOT\_SUPPORTED                    | 0xc0262500 | Графический драйвер не поддерживает защиту выходных данных. Например, монитор подключен через разъем VGA или не установлен соответствующий графический драйвер для цифрового выхода. В последнем случае обычно устанавливается драйвер Базовый видеоадаптер (Microsoft), а для решения проблемы необходимо установить соответствующий графический драйвер.                                                                                                                                                  |

## Необходимые условия

Прежде чем приступить к созданию приложения UWP, защищенного PlayReady, в вашей системе необходимо установить указанное ниже программное обеспечение.

-   Windows 10.
-   Если вы компилируете какие-либо примеры для пакета PlayReady DRM для приложений UWP, необходимо использовать Microsoft Visual Studio 2015 или более поздней версии. Microsoft Visual Studio 2013 можно использовать для компиляции любых примеров из пакета PlayReady DRM для приложений Магазина Windows 8.1.

Если в вашем приложении предполагается воспроизводить содержимое в формате MPEG-2/H.262, необходимо также скачать и установить [пакет Media Center для Windows 8.1](http://go.microsoft.com/fwlink/p/?LinkId=626876).

## Руководство по переносу приложения PlayReady для Магазина Windows

В данном разделе содержатся сведения о том, как выполнить миграцию существующих приложений PlayReady для Магазина Windows 8.x в Windows 10.

Пространство имен для приложений UWP PlayReady в Windows 10 было изменено с **Microsoft.Media.PlayReadyClient** на [**Windows.Media.Protection.PlayReady**](https://msdn.microsoft.com/library/windows/apps/dn986454). Это означает, что вам необходимо выполнить поиск и заменить в коде старое пространство имен на новое. Вы по-прежнему будете ссылаться на файл winmd. Это часть файла windows.media.winmd в операционной системе Windows 10. Он входит в windows.winmd в качестве части пакета Windows SDK TH. Что касается UWP, то ссылка на него содержится в windows.foundation.univeralappcontract.winmd.

Чтобы воспроизвести содержимое высокого (HD, 1080p) и сверхвысокого (UHD) разрешений, защищенное PlayReady, вам потребуется реализовать аппаратное управление цифровыми правами PlayReady. Сведения о том, как реализовать аппаратное управление цифровыми правами PlayReady, см. в статье [Аппаратное управление цифровыми правами](hardware-drm.md).

Некоторое содержимое не поддерживается аппаратным управлением цифровыми правами. Дополнительные сведения о том, как отключить аппаратное управление цифровыми правами и включить программное управление цифровыми правами, см. в статье [Переопределение аппаратного управления цифровыми правами](hardware-drm.md#override-hardware-drm).

Что касается диспетчера защиты мультимедиа, убедитесь, что для кода заданы следующие настройки:

``` syntax
var mediaProtectionManager = new Windows.Media.Protection.MediaProtectionManager();

mediaProtectionManager.properties["Windows.Media.Protection.MediaProtectionSystemId"] = 
             '{F4637010-03C3-42CD-B932-B48ADF3A6A54}'
var cpsystems = new Windows.Foundation.Collections.PropertySet();
cpsystems["{F4637010-03C3-42CD-B932-B48ADF3A6A54}"] = 
                "Windows.Media.Protection.PlayReady.PlayReadyWinRTTrustedInput";
mediaProtectionManager.properties["Windows.Media.Protection.MediaProtectionSystemIdMapping"] = cpsystems;

mediaProtectionManager.properties["Windows.Media.Protection.MediaProtectionContainerGuid"] = 
                "{9A04F079-9840-4286-AB92-E65BE0885F95}";
```

## Заблаговременное получение несохраняемой лицензии перед воспроизведением

В данном разделе рассказывается, как заблаговременно получить несохраняемую лицензию перед началом воспроизведения.

В предыдущих версиях пакета PlayReady DRM можно было получать несохраняемые лицензии только во время воспроизведения. В этой версии можно получать несохраняемые лицензии заблаговременно перед началом воспроизведения.

1.  Заранее создайте сеанс воспроизведения, в котором можно сохранить несохраняемую лицензию. Пример:

    ``` syntax
    var cpsystems = new Windows.Foundation.Collections.PropertySet();       
    cpsystems["{F4637010-03C3-42CD-B932-B48ADF3A6A54}"] = "Windows.Media.Protection.PlayReady.PlayReadyWinRTTrustedInput"; // PlayReady

    var pmpSystemInfo = new Windows.Foundation.Collections.PropertySet();
    pmpSystemInfo["Windows.Media.Protection.MediaProtectionSystemId"] = "{F4637010-03C3-42CD-B932-B48ADF3A6A54}";
    pmpSystemInfo["Windows.Media.Protection.MediaProtectionSystemIdMapping"] = cpsystems;
    var pmpServer = new Windows.Media.Protection.MediaProtectionPMPServer( pmpSystemInfo );
    ```

2.  Свяжите этот сеанс воспроизведения с классом получения лицензии. Пример:

    ``` syntax
    var licenseSessionProperties = new Windows.Foundation.Collections.PropertySet();
    licenseSessionProperties["Windows.Media.Protection.MediaProtectionPMPServer"] = pmpServer;
    var licenseSession = new Windows.Media.Protection.PlayReady.PlayReadyLicenseSession( licenseSessionProperties );
    ```

3.  Создайте запрос лицензии в службу поддержки. Пример:

    ``` syntax
    var laSR = licenseSession.CreateLAServiceRequest();
    ```

4.  Выполните получение лицензии с использованием запроса в службу поддержки, созданного в шаге 3. Лицензия будет сохранена в сеансе воспроизведения.
5.  Для воспроизведения источника мультимедиа свяжите с ним сеанс воспроизведения. Пример:

    ``` syntax
    licenseSession.configureMediaProtectionManager( mediaProtectionManager );
    videoPlayer.msSetMediaProtectionManager( mediaProtectionManager );
    ```
    
## Добавление безопасной остановки

В данном разделе рассказывается, как добавить безопасную остановку в приложение UWP.

Безопасная остановка предоставляет устройству PlayReady средства надежного подтверждения службе потоковой передачи мультимедиа того, что воспроизведение мультимедиа остановлено для указанного содержимого. Благодаря этой возможности службы потоковой передачи мультимедиа могут точно применять ограничения на использование и сообщать о них на различных устройствах для заданной учетной записи.

Для отправки запроса на безопасную остановку используются два указанных ниже основных сценария.

-   Когда презентация мультимедиа останавливается по завершении содержимого или когда пользователь остановил ее где-то в середине.
-   Когда неожиданно заканчивается предыдущий сеанс (например, из-за сбоя системы или приложения). При запуске или при завершении работы приложению потребуется сделать запрос на наличие невыполненных сеансов безопасной остановки и отправить запросы, не зависящие от любых других воспроизводящихся мультимедиа.

Пример реализации безопасной остановки см. в файле securestop.cs в примере PlayReady по адресу [http://go.microsoft.com/fwlink/p/?linkid=331670&clcid=0x409](http://go.microsoft.com/fwlink/p/?linkid=331670).

 

 






<!--HONumber=Mar16_HO1-->


