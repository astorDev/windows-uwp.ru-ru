---
description: Введение в C++/WinRT &mdash; стандартную проекцию языка C++ для API среды выполнения Windows.
title: Введение в C++/WinRT
ms.date: 01/31/2019
ms.topic: article
keywords: Windows 10, UWP, стандартные, c++, cpp, winrt, проекция, введение
ms.localizationpriority: medium
ms.openlocfilehash: 5281049aa9ddec58a97283a2ca6ba5d229a49c4e
ms.sourcegitcommit: 038fe813c73804285d5e74d97864ac1a2fb531f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2019
ms.locfileid: "9042608"
---
# <a name="introduction-to-cwinrt"></a>Введение в C++/WinRT
&nbsp;
> [!VIDEO https://www.youtube.com/embed/nOFNc2uTmGs]

C++/WinRT — это полностью стандартная проекция языка C++17 для API среды выполнения Windows (WinRT), реализованная как библиотека на основе файлов заголовков и предназначенная для предоставления вам первоклассного доступа к современным API-интерфейсам Windows. С помощью C++/WinRT можно создавать и использовать API среды выполнения Windows, используя любой совместимый со стандартами компилятор C++17. В пакет Windows SDK входит среда C++/WinRT, которая впервые появилась в версии 10.0.17134.0 (Windows 10, версия 1803).

C + +/ WinRT — Это рекомендуемая корпорацией Майкрософт замена для [C + +/ CX](/cpp/cppcx/visual-c-language-reference-c-cx?branch=live) языковой проекции и [Библиотеки шаблонов C++ (WRL) среды выполнения Windows](/cpp/windows/windows-runtime-cpp-template-library-wrl?branch=live). Полный список [разделы, посвященные C + +/ WinRT](index.md#topics-about-cwinrt) содержит сведения о том, как взаимодействуя с, так и перенос из C + +/ CX и WRL.

> [!IMPORTANT]
> Два наиболее важных аспектах C + +/ WinRT, которые следует учитывать, описаны в разделах [Поддержка пакетов SDK для C + +/ WinRT](#sdk-support-for-cwinrt) и [Поддержка Visual Studio для C + +/ WinRT, XAML, расширение VSIX и пакет NuGet](intro-to-using-cpp-with-winrt.md#visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package).

## <a name="language-projections"></a>Языковые проекции
Среда выполнения Windows основывается на API-интерфейсах Component Object Model (COM) и предусматривает доступ к ней через *языковые проекции*. Проекция скрывает подробности COM и обеспечивает более естественный подход к программированию на используемом языке.

### <a name="the-cwinrt-language-projection-in-the-windows-uwp-api-reference-content"></a>Языковая проекция C++/WinRT в содержимом справочных материалов по API Windows UWP
При просмотре [API-интерфейсов Windows UWP](https://docs.microsoft.com/uwp/api/) щелкните поле со списком **Язык** в правом верхнем углу и выберите пункт **C++/WinRT**, чтобы просмотреть синтаксические блоки API в том виде, в котором они отражаются в языковой проекции C++/WinRT.

## <a name="sdk-support-for-cwinrt"></a>Поддержка пакетов SDK для C++/WinRT
Начиная с версии 10.0.17134.0 (Windows 10, версия 1803), Windows SDK содержит стандартную библиотеку C++ на основе файлов заголовков для использования основных API-интерфейсов Windows (API среды выполнения Windows и пространства имен Windows). C++/WinRT также поставляется вместе со средством `cppwinrt.exe`, которое может указывать на файл метаданных среды выполнения Windows (`.winmd`) для создания стандартной библиотеки C++ на основе файлов заголовков, которая *проецирует* API-интерфейсы, описанные в метаданных, для использования в коде C++/WinRT. Файлы метаданных среды выполнения Windows (`.winmd`) предоставляют канонический способ описания поверхности API среды выполнения Windows. Если `cppwinrt.exe` указывает на метаданные, вы можете создать библиотеку для использования с любым классом среды выполнения, реализованным в стороннем компоненте среды выполнения Windows или в вашем приложении. Дополнительные сведения см. в разделе [Использование API-интерфейсов в C++/WinRT](consume-apis.md).

С помощью C++/WinRT также можно реализовать собственные классы среды выполнения, используя стандартный язык C++, не прибегая к программированию в стиле COM. Для класса среды выполнения необходимо просто описать типы в IDL-файле, после чего средства `midl.exe` и `cppwinrt.exe` создадут файлы стандартного исходного кода автоматически. Можно также реализовать только интерфейсы на основе базового класса C++/WinRT. Дополнительные сведения см. в разделе [Создание API-интерфейсов в C++/WinRT](author-apis.md).

## <a name="visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package"></a>Поддержка Visual Studio для C + +/ WinRT, XAML, расширение VSIX и пакет NuGet
Для поддержки Visual Studio, помимо Минимальная версия целевого пакета Windows SDK 10.0.17134.0 (Windows 10, версия 1803), вам потребуется Visual Studio 2017 (по крайней мере версия 15,6; рекомендуется версия не младше 15.7), или Visual Studio 2019 г. Если вы еще не установили его, необходимо установить параметр **Инструменты C++ универсальной платформы Windows** из внутри установщика Visual Studio. И, в Windows **Параметры** > **обновление \& безопасности** > **для разработчиков**, выберите параметр **режим разработчика** , а не параметр **Неопубликованные приложения** .

Вам потребуется скачать и установить последнюю версию [C + +/ WinRT Visual Studio расширения (VSIX)](https://aka.ms/cppwinrt/vsix) из [Visual Studio Marketplace](https://marketplace.visualstudio.com/).

- Расширение VSIX предоставляет C + +/ WinRT шаблоны проектов и элементов в Visual Studio, таким образом, вы можете начать работу с помощью C + +/ WinRT разработки.
- Кроме того, он обеспечивает визуализацию встроенной отладки Visual Studio (natvis) C + +/ WinRT проецируемых типов; обеспечивает возможности, аналогичные отладке на C#. Natvis используется автоматически для сборок отладки. Вы можете выбрать сборки выпуска, указав символ WINRT_NATVIS.

Шаблоны проектов Visual Studio для C + +/ WinRT описаны ниже. При создании нового C + +/ WinRT проекта с последней версией расширения VSIX установки нового C + +/ WinRT проекта автоматически устанавливает [пакет Microsoft.Windows.CppWinRT NuGet](https://www.nuget.org/packages/Microsoft.Windows.CppWinRT/). Пакет NuGet **Microsoft.Windows.CppWinRT** предоставляет C + +/ WinRT при сборке поддерживают (свойств и целей MSBuild), что проект переносить с одного компьютера разработчика и агента построения (на котором только пакет NuGet, а не расширения VSIX, устанавливается).

> [!IMPORTANT]
> Если у вас есть проектов, созданных с помощью (или обновлены для работы с) версии расширения VSIX ранее чем 1.0.190128.4, см. раздел [более ранних версий расширения VSIX](#earlier-versions-of-the-vsix-extension). Этот раздел содержит важные сведения о конфигурации проектов, которые необходимо знать, чтобы обновить, чтобы использовать последнюю версию расширения VSIX.

Поскольку C + +/ WinRT использует функции стандарта C ++ 17, необходимо проецировать свойство **C/C++** > **язык** > **Стандартный язык C++** > **ISO C ++ 17 Standard (/ std: c ++ 17)**. Вы также можете установить **Conformance mode: Yes (/permissive-)**, что дополнительно обеспечит соответствие стандартам вашего кода.

Еще одно свойство, о котором следует знать, это **C/C++** > **General** > **Treat Warnings As Errors**. Задайте для него значение **Yes(/WX)** или **No (/WX-)** по вашему желанию. Иногда исходные файлы, созданные инструментом `cppwinrt.exe`, выдают предупреждения до тех пор, пока вы не добавите в них свою реализацию.

С помощью системы задать до, как описано выше, вы сможете создать и создавать или открыть, C + +/ WinRT проекта в Visual Studio и развернуть его.

Кроме того вы можете преобразовать существующий проект вручную установить пакет NuGet **Microsoft.Windows.CppWinRT** . После установки (или обновление до) последнюю версию расширения VSIX, откройте существующий проект в Visual Studio, щелкните **проект** \> **Управление пакетами NuGet …**  \>  **Обзор**, введите или вставьте **Microsoft.Windows.CppWinRT** в поле поиска, выбрать элемент в результатах поиска и нажмите кнопку **установить** для установки пакета для данного проекта. После добавления пакета, вы получите C + +/ WinRT MSBuild поддержка проекта, включая вызов `cppwinrt.exe` средство.

Вы можете задать проект, использующий C + +/ поддержку WinRT MSBuild наличием пакет **Microsoft.Windows.CppWinRT** NuGet установлен в проекте.

Ниже приведены шаблоны проектов Visual Studio, предоставляемые VSIX расширения.

### <a name="windows-console-application-cwinrt"></a>Консольное приложение для Windows (C++/WinRT)
Шаблон проекта для клиентского приложения C++/WinRT для Windows Desktop с пользовательским интерфейсом консоли.

### <a name="blank-app-cwinrt"></a>Пустое приложение (C++/WinRT)
Шаблон проекта для приложения универсальной платформы Windows (UWP), которое имеет пользовательский интерфейс XAML.

Visual Studio предоставляет поддержку компилятора XAML для создания заглушек реализаций и заголовков из файла языка описания интерфейса (IDL) (`.idl`) прилагаемого к каждому файлу разметки XAML. В файл IDL определите все классы локальной среды выполнения, на которые нужно сослаться на XAML-страница вашего приложения, а затем один раз выполните сборку приложения для создания шаблонов реализации в `Generated Files` и заглушек определений типов в `Generated Files\sources`. Затем используйте заглушки определений типов для справки при реализации классов локальной среды выполнения. Мы рекомендуем объявлять каждый класс среды выполнения в своем собственном файле IDL.

Surface поддержки конструктора XAML-Visual Studio для C + +/ WinRT — рядом с четностью с C#. Единственным исключением является вкладку " **события** " окна " **Свойства** ". С помощью проекта C# этой вкладке можно использовать для добавления обработчиков событий; с помощью C + +/ WinRT проекта, этот механизм не существует. Но см. в разделе [Обработка событий с помощью делегатов в C + +/ WinRT](handle-events.md) сведения о том, как добавить обработчики событий в коде.

### <a name="core-app-cwinrt"></a>Приложение основных компонентов (C++/WinRT)
Шаблон проекта для приложения универсальной платформы Windows (UWP), которое не использует XAML.

Вместо этого оно использует заголовок пространства имен C++/WinRT (Windows) для пространства имен Windows.ApplicationModel.Core. После выполнения сборки и запуска щелкните пустое пространство для добавления цветной квадрат; затем щелкните цветной квадрат, чтобы перетащить его.

### <a name="windows-runtime-component-cwinrt"></a>Компонент среды выполнения Windows (C++/WinRT)
Шаблон проекта для компонента; как правило, для использования из универсальной платформы Windows (UWP).

Этот шаблон демонстрирует цепочку инструментов `midl.exe` > `cppwinrt.exe`, где метаданные среды выполнения Windows (`.winmd`) создаются из IDL, а затем из метаданных среды выполнения Windows создаются заглушки реализаций и заголовков.

В файле IDL определите классы среды выполнения в вашем компоненте, их интерфейс по умолчанию и другие интерфейсы, которые они реализуют. Единожды выполните сборку проекта для создания шаблонов реализаций `module.g.cpp` и `module.h.cpp` в `Generated Files` и заглушек определений типов в `Generated Files\sources`. Затем используйте заглушки определений типов для справки при реализации классов среды выполнения в вашем компоненте. Мы рекомендуем объявлять каждый класс среды выполнения в своем собственном файле IDL.

Объедините в пакет собранный двоичный файл компонента среды выполнения Windows и его `.winmd` с использующим их приложением UWP.

## <a name="earlier-versions-of-the-vsix-extension"></a>Более ранних версий расширения VSIX
Мы рекомендуем установить (или обновление) последнюю версию [расширения VSIX](https://aka.ms/cppwinrt/vsix). Он настраивается обновления, по умолчанию. Если это сделать, и у вас есть проектов, созданных с помощью версии расширения VSIX более ранней, чем 1.0.190128.4, а затем в этом разделе содержит важные сведения об обновлении проектов для работы с новой версией. Если вы не обновите, затем по-прежнему пригодятся информация в этом разделе.

Поддерживается в Windows SDK и версий Visual Studio и конфигурации Visual Studio, сведения на [Поддержка Visual Studio для C + +/ WinRT, XAML, расширение VSIX и пакет NuGet](#visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package) приведенном выше разделе относится к более ранних версиях VSIX расширение. Информацией ниже описаны важные отличия относительно поведение и конфигурации проектов ранее созданных с помощью (или обновления для работы с) версии.

### <a name="created-earlier-than-101810022"></a>Созданные ранее, чем 1.0.181002.2
Если проект был создан с версией расширения VSIX более ранней, чем 1.0.181002.2, а затем C + +/ WinRT сборки поддержки был создан в этой версии расширения VSIX. В проекте есть `<CppWinRTEnabled>true</CppWinRTEnabled>` свойство задано в `.vcxproj` файла.

```xml
<Project ...>
    <PropertyGroup Label="Globals">
        <CppWinRTEnabled>true</CppWinRTEnabled>
...
```

Можно обновить свой проект вручную установить пакет NuGet **Microsoft.Windows.CppWinRT** . После установки (или обновление до) последнюю версию расширения VSIX, откройте проект в Visual Studio, щелкните **проект** \> **Управление пакетами NuGet …**  \>  **Обзор**, введите или вставьте **Microsoft.Windows.CppWinRT** в поле поиска, выберите элемент в результатах поиска и нажмите кнопку **установки** установить пакет для вашего проекта.

### <a name="created-with-or-upgraded-to-between-101810022-and-101901283"></a>Создана с помощью (или обновлена до) между 1.0.181002.2 и 1.0.190128.3
Если проект создан с версией расширения VSIX между 1.0.181002.2 и 1.0.190128.3, включительно, затем пакет **Microsoft.Windows.CppWinRT** NuGet был установлен в проекте автоматически с помощью шаблона проекта. Возможно также обновления старых проект, чтобы использовать версию расширения VSIX в этом диапазоне. Если вы выполнили, затем&mdash;момента поддержки сборки также по-прежнему присутствует в версиях расширение VSIX в этом диапазоне&mdash;обновленный проект может содержать или не содержать установлен пакет NuGet **Microsoft.Windows.CppWinRT** .

Чтобы обновить свой проект, следуйте инструкциям в предыдущем разделе и убедитесь, что проект установлен пакет NuGet **Microsoft.Windows.CppWinRT** .

### <a name="invalid-upgrade-configurations"></a>Недопустимый варианты обновления
Используя последние версии расширения VSIX, не подходит для проекта иметь `<CppWinRTEnabled>true</CppWinRTEnabled>` свойства, если у него нет также установить пакет NuGet **Microsoft.Windows.CppWinRT** . Проект с этой конфигурации создает сообщении об ошибке сборки «C + +/ WinRT VSIX больше не предоставляет поддержку сборки проекта.  Добавьте ссылку на проект пакет Microsoft.Windows.CppWinRT Nuget.»

Как упоминалось выше, C + +/ WinRT проекта теперь необходимо иметь установлен пакет NuGet.

Так как `<CppWinRTEnabled>` элемент устарел, можно при необходимости изменить ваше `.vcxproj`и удалить элемент. Это не является обязательным, но это параметр.

## <a name="custom-types-in-the-cwinrt-projection"></a>Пользовательские типы в проекции C++/WinRT
В C + +/ WinRT можно применять стандартные функции языка C++ и [Стандартные типы данных C++ и C + +/ WinRT](std-cpp-data-types.md)&mdash;включая некоторые типы данных стандартной библиотеки C++. Однако вы также получите сведения о некоторых пользовательских типах данных в проекции, и сможете использовать их. Например, мы используем [**winrt::hstring**](/uwp/cpp-ref-for-winrt/hstring) в кратком примере кода в разделе [Начало работы с C++/WinRT](get-started.md).

[**winrt::com_array**](/uwp/cpp-ref-for-winrt/com-array) является еще одним типом, который вы, скорее всего, используете в определенный момент. При этом вы с меньшей вероятностью будете использовать напрямую такие типы, как [**winrt::array_view**](/uwp/cpp-ref-for-winrt/array-view). Вы можете решить не использовать его, чтобы у вас не было кода, требующего изменений, если эквивалентный тип появится в стандартной библиотеке C++.

> [!WARNING]
> Также существуют типы, которые можно обнаружить, если внимательно изучить заголовки пространства имен Windows C++/WinRT. Примером служит **winrt::param::hstring**, но существуют и примеры для коллекции. Они существуют исключительно для оптимизации привязки входных параметров, при этом помогают существенно повысить производительность и обеспечивают поддержку большинства шаблонов вызовов для связанных стандартных типов и контейнеров C++. Эти типы будут использоваться проекцией тогда, когда они будут наиболее эффективны. Они существенно оптимизированы и не предназначены для общего использования. Не применяйте их самостоятельно. Вам также не следует использовать что-либо из пространства имен `winrt::impl`, поскольку это типы реализации, которые могут быть изменены. Вам следует продолжать использовать стандартные типы или типы из [пространства имен winrt](/uwp/cpp-ref-for-winrt/winrt).

## <a name="important-apis"></a>Важные API
* [Структура winrt::hstring](/uwp/cpp-ref-for-winrt/hstring)
* [пространство имен WinRT](/uwp/cpp-ref-for-winrt/winrt)

## <a name="related-topics"></a>Статьи по теме
* [C++/CX](/cpp/cppcx/visual-c-language-reference-c-cx)
* [Расширение C++/WinRT для Visual Studio (VSIX)](https://aka.ms/cppwinrt/vsix)
* [Начало работы с C++/WinRT](get-started.md)
* [Стандартные типы данных C++ и C++/WinRT](std-cpp-data-types.md)
* [Обработка строк в C++/WinRT](strings.md)
* [API WindowsUWP](https://docs.microsoft.com/uwp/api/)
