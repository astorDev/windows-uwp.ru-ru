---
author: stevewhims
description: Введение в C++/WinRT &mdash; стандартную проекцию языка C++ для API среды выполнения Windows.
title: Введение в C++/WinRT
ms.author: stwhi
ms.date: 05/07/2018
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows 10, UWP, стандартные, c++, cpp, winrt, проекция, введение
ms.localizationpriority: medium
ms.openlocfilehash: b22f331c1b39d85baa8a38975aef925576226eaa
ms.sourcegitcommit: 618741673a26bd718962d4b8f859e632879f9d61
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2018
ms.locfileid: "1992090"
---
# <a name="introduction-to-cwinrt"></a>Введение в C++/WinRT
&nbsp;
> [!VIDEO https://www.youtube.com/embed/nOFNc2uTmGs]

C++/WinRT — это полностью стандартная проекция языка C++17 для API среды выполнения Windows (WinRT), реализованная как библиотека на основе файлов заголовков и предназначенная для предоставления вам первоклассного доступа к современным API-интерфейсам Windows. С помощью C++/WinRT можно создавать и использовать API среды выполнения Windows, используя любой совместимый со стандартами компилятор C++17. В пакет Windows SDK входит среда C++/WinRT, которая впервые появилась в версии 10.0.17134.0 (Windows 10, версия 1803).

> [!IMPORTANT]
> Два наиболее важных аспектах C++/ WinRT, которые следует учитывать, описаны в разделах [Поддержка пакетов SDK для C++/WinRT](#sdk-support-for-cwinrt) и [Поддержка Visual Studio для C++/ WinRT и VSIX](#visual-studio-support-for-cwinrt-and-the-vsix).

## <a name="language-projections"></a>Языковые проекции
Среда выполнения Windows основывается на API-интерфейсах Component Object Model (COM) и предусматривает доступ к ней через *языковые проекции*. Проекция скрывает подробности COM и обеспечивает более естественный подход к программированию на используемом языке.

### <a name="the-cwinrt-language-projection-in-the-windows-uwp-api-reference-content"></a>Языковая проекция C++/WinRT в содержимом справочных материалов по API Windows UWP
При просмотре [API-интерфейсов Windows UWP](https://docs.microsoft.com/uwp/api/) щелкните поле со списком **Язык** в правом верхнем углу и выберите пункт **C++/WinRT**, чтобы просмотреть синтаксические блоки API в том виде, в котором они отражаются в языковой проекции C++/WinRT.

## <a name="sdk-support-for-cwinrt"></a>Поддержка пакетов SDK для C++/WinRT
Начиная с версии 10.0.17134.0 (Windows 10, версия 1803), Windows SDK содержит стандартную библиотеку C++ на основе файлов заголовков для использования основных API-интерфейсов Windows (API среды выполнения Windows и пространства имен Windows). C++/WinRT также поставляется вместе со средством `cppwinrt.exe`, которое может указывать на файл метаданных среды выполнения Windows (`.winmd`) для создания стандартной библиотеки C++ на основе файлов заголовков, которая *проецирует* API-интерфейсы, описанные в метаданных, для использования в коде C++/WinRT. Файлы метаданных среды выполнения Windows (`.winmd`) предоставляют канонический способ описания поверхности API среды выполнения Windows. Если `cppwinrt.exe` указывает на метаданные, вы можете создать библиотеку для использования с любым классом среды выполнения, реализованным в стороннем компоненте среды выполнения Windows или в вашем приложении. Дополнительные сведения см. в разделе [Использование API-интерфейсов в C++/WinRT](consume-apis.md).

С помощью C++/WinRT также можно реализовать собственные классы среды выполнения, используя стандартный язык C++, не прибегая к программированию в стиле COM. Для класса среды выполнения необходимо просто описать типы в IDL-файле, после чего средства `midl.exe` и `cppwinrt.exe` создадут файлы стандартного исходного кода автоматически. Можно также реализовать только интерфейсы на основе базового класса C++/WinRT. Дополнительные сведения см. в разделе [Создание API-интерфейсов в C++/WinRT](author-apis.md).

## <a name="visual-studio-support-for-cwinrt-and-the-vsix"></a>Поддержка Visual Studio для C++/WinRT и VSIX
Для шаблонов проектов C++/WinRT в Visual Studio, а также свойств и целей MSBuild C++/WinRT скачайте и установите [расширение Visual Studio (VSIX) C++/WinRT](https://aka.ms/cppwinrt/vsix) из [Visual Studio Marketplace](https://marketplace.visualstudio.com/).

Вам потребуется Visual Studio 2017 (по крайней мере версия 15,6; рекомендуется версия не младше 15.7) и Windows SDK версии 10.0.17134.0 (Windows 10, версия 1803). Затем можно создать новый проект в Visual Studio или преобразовать существующий проект, добавив свойство `<CppWinRTEnabled>true</CppWinRTEnabled>` в его файл `.vcxproj` в разделе Project > PropertyGroup. После добавления этого свойства вы получите поддержку MSBuild C++/WinRT для проекта, включая вызов инструмента `cppwinrt.exe`.

Поскольку C++/ WinRT использует функции стандарта C++17, необходимо проецировать свойство **C/C++** > **Language** > **ISO C++17 Standard (/std:c++17)**. Вы также можете установить **Conformance mode: Yes (/permissive-)**, что дополнительно обеспечит соответствие стандартам вашего кода.

Еще одно свойство, о котором следует знать, это **C/C++** > **General** > **Treat Warnings As Errors**. Задайте для него значение **Yes(/WX)** или **No (/WX-)** по вашему желанию. Иногда исходные файлы, созданные инструментом `cppwinrt.exe`, выдают предупреждения до тех пор, пока вы не добавите в них свою реализацию.

VSIX также поддерживает визуализацию встроенной отладки Visual Studio (natvis) проецированных типов C++/ WinRT, что обеспечивает возможности, аналогичные отладке на C#. Natvis используется автоматически для сборок отладки. Вы можете выбрать сборки выпуска, указав символ WINRT_NATVIS.

Далее приведены шаблоны проектов Visual Studio, предоставляемые VSIX.

### <a name="windows-console-application-cwinrt"></a>Консольное приложение для Windows (C++/WinRT)
Шаблон проекта для клиентского приложения C++/WinRT для Windows Desktop с пользовательским интерфейсом консоли.

### <a name="blank-app-cwinrt"></a>Пустое приложение (C++/WinRT)
Шаблон проекта для приложения универсальной платформы Windows (UWP), которое имеет пользовательский интерфейс XAML.

Visual Studio предоставляет поддержку компилятора XAML для создания заглушек реализаций и заголовков из файла языка описания интерфейса (IDL) (`.idl`) прилагаемого к каждому файлу разметки XAML. В файл IDL определите все классы локальной среды выполнения, на которые нужно сослаться на XAML-страница вашего приложения, а затем один раз выполните сборку приложения для создания шаблонов реализации в `Generated Files` и заглушек определений типов в `Generated Files\sources`. Затем используйте заглушки определений типов для справки при реализации классов локальной среды выполнения. Мы рекомендуем объявлять каждый класс среды выполнения в своем собственном файле IDL.

### <a name="core-app-cwinrt"></a>Приложение основных компонентов (C++/WinRT)
Шаблон проекта для приложения универсальной платформы Windows (UWP), которое не использует XAML.

Вместо этого оно использует заголовок пространства имен C++/WinRT (Windows) для пространства имен Windows.ApplicationModel.Core. После выполнения сборки и запуска щелкните пустое пространство для добавления цветной квадрат; затем щелкните цветной квадрат, чтобы перетащить его.

### <a name="windows-runtime-component-cwinrt"></a>Компонент среды выполнения Windows (C++/WinRT)
Шаблон проекта для компонента; как правило, для использования из универсальной платформы Windows (UWP).

Этот шаблон демонстрирует цепочку инструментов `midl.exe` > `cppwinrt.exe`, где метаданные среды выполнения Windows (`.winmd`) создаются из IDL, а затем из метаданных среды выполнения Windows создаются заглушки реализаций и заголовков.

В файле IDL определите классы среды выполнения в вашем компоненте, их интерфейс по умолчанию и другие интерфейсы, которые они реализуют. Единожды выполните сборку проекта для создания шаблонов реализаций `module.g.cpp` и `module.h.cpp` в `Generated Files` и заглушек определений типов в `Generated Files\sources`. Затем используйте заглушки определений типов для справки при реализации классов среды выполнения в вашем компоненте. Мы рекомендуем объявлять каждый класс среды выполнения в своем собственном файле IDL.

Объедините в пакет собранный двоичный файл компонента среды выполнения Windows и его `.winmd` с использующим их приложением UWP.

## <a name="custom-types-in-the-cwinrt-projection"></a>Пользовательские типы в проекции C++/WinRT
При использовании C++/WinRT можно применять стандартные функции языка C++ и [стандартные типы данных C++ и C++/WinRT](std-cpp-data-types.md), включая некоторые типы данных стандартной библиотеки C++. Однако вы также получите сведения о некоторых пользовательских типах данных в проекции, и сможете использовать их. Например, мы используем [**winrt::hstring**](/uwp/cpp-ref-for-winrt/hstring) в кратком примере кода в разделе [Начало работы с C++/WinRT](get-started.md).

[**winrt::com_array**](/uwp/cpp-ref-for-winrt/com-array) является еще одним типом, который вы, скорее всего, используете в определенный момент. При этом вы с меньшей вероятностью будете использовать напрямую такие типы, как [**winrt::array_view**](/uwp/cpp-ref-for-winrt/array-view). Вы можете решить не использовать его, чтобы у вас не было кода, требующего изменений, если эквивалентный тип появится в стандартной библиотеке C++.

> [!WARNING]
> Также существуют типы, которые можно обнаружить, если внимательно изучить заголовки пространства имен Windows C++/WinRT. Примером служит **winrt::param::hstring**, но существуют и примеры для коллекции. Они существуют исключительно для оптимизации привязки входных параметров, при этом помогают существенно повысить производительность и обеспечивают поддержку большинства шаблонов вызовов для связанных стандартных типов и контейнеров C++. Эти типы будут использоваться проекцией тогда, когда они будут наиболее эффективны. Они существенно оптимизированы и не предназначены для общего использования. Не применяйте их самостоятельно. Вам также не следует использовать что-либо из пространства имен `winrt::impl`, поскольку это типы реализации, которые могут быть изменены. Вам следует продолжать использовать стандартные типы или типы из [пространства имен winrt](/uwp/cpp-ref-for-winrt/winrt).

## <a name="important-apis"></a>Важные API
* [Структура winrt::hstring](/uwp/cpp-ref-for-winrt/hstring)
* [пространство имен WinRT](/uwp/cpp-ref-for-winrt/winrt)

## <a name="related-topics"></a>Статьи по теме
* [C++/CX](/cpp/cppcx/visual-c-language-reference-c-cx)
* [Расширение C++/WinRT для Visual Studio (VSIX)](https://aka.ms/cppwinrt/vsix)
* [Начало работы с C++/WinRT](get-started.md)
* [Стандартные типы данных C++ и C++/WinRT](std-cpp-data-types.md)
* [Обработка строк в C++/WinRT](strings.md)
* [API WindowsUWP](https://docs.microsoft.com/uwp/api/)
