---
description: Введение в C++/WinRT &mdash; стандартную проекцию языка C++ для интерфейсов API среды выполнения Windows.
title: Введение в C++/WinRT
ms.date: 04/18/2019
ms.topic: article
keywords: windows 10, uwp, standard, c++, cpp, winrt, projection, introduction
ms.localizationpriority: medium
ms.openlocfilehash: 87ab033ddd9de92922f043a069b793ca101307d0
ms.sourcegitcommit: 6cc8b231c1b970112d26a7696cc3e907082ef2be
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2019
ms.locfileid: "68308445"
---
# <a name="introduction-to-cwinrt"></a>Введение в C++/WinRT
&nbsp;
> [!VIDEO https://www.youtube.com/embed/X41j_gzSwOY]

&nbsp;
> [!VIDEO https://www.youtube.com/embed/nOFNc2uTmGs]

C++/WinRT — это полностью стандартная проекция языка C++17 для API среды выполнения Windows (WinRT), реализованная как библиотека на основе файлов заголовков и предназначенная для предоставления вам первоклассного доступа к современным интерфейсам API Windows. С помощью C++/WinRT можно создавать и использовать интерфейсы API среды выполнения Windows, используя любой совместимый со стандартами компилятор C++17. В пакет Windows SDK входит среда C++/WinRT, которая впервые появилась в версии 10.0.17134.0 (Windows 10, версия 1803).

C++/WinRT — это рекомендуемая корпорацией Майкрософт замена для проекции языка [C++/CX](/cpp/cppcx/visual-c-language-reference-c-cx?branch=live) и [библиотеки шаблонов C++ для среды выполнения Windows (WRL)](/cpp/windows/windows-runtime-cpp-template-library-wrl?branch=live). Полный список [статей о C++/WinRT](index.md#topics-about-cwinrt) содержит информацию о взаимодействии с C++/CX и WRL и о переносе из них.

> [!IMPORTANT]
> Некоторые наиболее важные аспекты C++/WinRT, которые следует учитывать, описаны в разделах [Поддержка пакетов SDK для C++/WinRT](#sdk-support-for-cwinrt) и [Поддержка Visual Studio для C++/WinRT, XAML, расширения VSIX и пакета NuGet](intro-to-using-cpp-with-winrt.md#visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package).

## <a name="language-projections"></a>Языковые проекции
Среда выполнения Windows основывается на API Component Object Model (COM) и предусматривает доступ к ней через *языковые проекции*. Использование проекции позволяет скрывать подробности COM и обеспечить более естественный подход к программированию на используемом языке.

### <a name="the-cwinrt-language-projection-in-the-windows-uwp-api-reference-content"></a>Языковая проекция C++/WinRT в содержимом справочных материалов по API Windows UWP
При просмотре [API Windows UWP](https://docs.microsoft.com/uwp/api/) щелкните поле со списком **Язык** в правом верхнем углу и выберите пункт **C++/WinRT**, чтобы просмотреть синтаксические блоки API в том виде, в котором они отражаются в языковой проекции C++/WinRT.

## <a name="visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package"></a>Поддержка Visual Studio для C++/WinRT, XAML, расширения VSIX и пакета NuGet
Для поддержки Visual Studio вам потребуется Visual Studio 2019 или Visual Studio 2017 (по крайней мере версия 15.6; рекомендуется версия не ниже 15.7). Внутри установщика Visual Studio вам также необходимо установить (в разделе **Сведения об установке** > **Разработка приложений для универсальной платформы Windows**) параметры **средств универсальной платформы Windows C++ (версии 14x)** , если вы еще этого не сделали. Кроме того, в разделе Windows **Параметры** > **Обновления\&Безопасность** > **Для разработчиков** выберите параметр **Режим разработчика** вместо параметра **Неопубликованные приложения**.

Хотя мы рекомендуем выполнять разработку с последними версиями Visual Studio и Windows SDK, если вы используете версию C++/WinRT, которая поставляется вместе с версией Windows SDK, предшествующей версии 10.0.17763.0 (Windows 10 версии 1809), для упомянутых выше заголовков пространств имен Windows в проекте вам потребуется минимальная целевая версия Windows SDK 10.0.17134.0 (Windows 10 версии 1803).

Вам нужно будет скачать и установить последнюю версию [расширения C++/WinRT для Visual Studio (VSIX)](https://aka.ms/cppwinrt/vsix) из [Visual Studio Marketplace](https://marketplace.visualstudio.com/).

- Расширение VSIX предоставляет шаблоны проектов и элементов C++/WinRT в Visual Studio, чтобы вы могли начать разработку с C++/WinRT.
- Кроме того, расширение также поддерживает визуализацию встроенной отладки Visual Studio (natvis) проецированных типов C++/WinRT, что обеспечивает возможности, аналогичные отладке на C#. Natvis автоматически используется для сборок отладки. Вы можете выбрать сборки выпуска, указав символ WINRT_NATVIS.

Шаблоны проектов Visual Studio для C++/WinRT описаны в следующих разделах. Когда вы создаете проект C++/WinRT с установленной последней версией расширения VSIX, новый проект C++/WinRT автоматически устанавливает [пакет NuGet Microsoft.Windows.CppWinRT](https://www.nuget.org/packages/Microsoft.Windows.CppWinRT/). Пакет NuGet **Microsoft.Windows.CppWinRT** обеспечивает поддержку сборки с C++/WinRT (свойства и цели MSBuild), делая проект переносимым между компьютером для разработки и агентом сборки (на котором установлен только пакет NuGet, а не расширение VSIX).

Кроме того, вы можете преобразовать существующий проект, вручную установив пакет NuGet **Microsoft.Windows.CppWinRT**. После установки (или обновления до) последней версии расширения VSIX откройте существующий проект в Visual Studio и щелкните **Проект** \> **Управление пакетами NuGet…** \> **Обзор**, введите или вставьте **Microsoft.Windows.CppWinRT** в поле поиска, выберите элемент в результатах поиска, а затем нажмите кнопку **Установить**, чтобы установить пакет для этого проекта. После добавления этого пакета вы получите поддержку MSBuild C++/WinRT для проекта, включая вызов инструмента `cppwinrt.exe`.

> [!IMPORTANT]
> Если у вас есть проекты, которые были созданы (или обновлены для работы) с версией расширения VSIX ниже, чем 1.0.190128.4, ознакомьтесь с разделом [Более ранние версии расширения VSIX](#earlier-versions-of-the-vsix-extension). Этот раздел содержит важную информацию о конфигурации проектов, о которой вам необходимо знать, чтобы обновить их для использования последней версии расширения VSIX.

- Так как C++/WinRT использует компоненты стандарта C++17, пакет NuGet устанавливает для свойства проекта **C/C++**  > **Язык** > **Стандарт языка C++**  > **Стандарт ISO C++17 (/std:c++17)** в Visual Studio.
- Он также добавляет параметр компилятора [/bigobj](/cpp/build/reference/bigobj-increase-number-of-sections-in-dot-obj-file).
- Кроме того, с помощью пакета добавляется параметр компилятора [/await](/cpp/build/reference/await-enable-coroutine-support), чтобы включить `co_await`,
- и компилятору XAML дается инструкция выдавать Codegen C++/WinRT.
- Вы также можете установить **Режим совместимости: Да (/permissive-)** , что дополнительно обеспечит соответствие стандартам вашего кода.
- Еще одно свойство, о котором следует знать, — это **C/C++**  > **Общие** > **Обрабатывать предупреждения как ошибки**. Задайте для него значение **Да (/WX)** или **Нет (/WX-)** по вашему желанию. Иногда исходные файлы, созданные инструментом `cppwinrt.exe`, выдают предупреждения до тех пор, пока вы не добавите в них свою реализацию.

Если ваша система настроена, как описано выше, вы сможете создавать или открывать проект C++/WinRT в Visual Studio и развертывать его.

Начиная с версии 2.0, в состав пакета NuGet **Microsoft.Windows.CppWinRT** входит инструмент `cppwinrt.exe`. Вы можете указывать на инструмент `cppwinrt.exe` в файле метаданных среды выполнения Windows (`.winmd`) для создания стандартной библиотеки C++ на основе файлов заголовков, которая *проецирует* API, описанные в метаданных, для использования в коде C++/WinRT. Файлы метаданных среды выполнения Windows (`.winmd`) предоставляют канонический способ описания поверхности API среды выполнения Windows. Если `cppwinrt.exe` указывает на метаданные, вы можете создать библиотеку для использования с любым классом среды выполнения, реализованным в стороннем компоненте среды выполнения Windows или в вашем приложении. Дополнительные сведения см. в статье [Использование API-интерфейсов с помощью C++/WinRT](consume-apis.md).

С помощью C++/WinRT также можно реализовать собственные классы среды выполнения, используя стандартный язык C++, не прибегая к программированию в стиле COM. Для класса среды выполнения необходимо просто описать типы в IDL-файле, после чего средства `midl.exe` и `cppwinrt.exe` автоматически создадут файлы стандартного исходного кода. Можно также реализовать только интерфейсы на основе базового класса C++/WinRT. Дополнительные сведения см. в статье [Создание API-интерфейсов в C++/WinRT](author-apis.md).

Список параметров настройки для средства `cppwinrt.exe`, заданных в разделе свойств проекта, см. в [файле сведений](https://github.com/microsoft/xlang/tree/master/src/package/cppwinrt/nuget/readme.md#customizing) пакета NuGet Microsoft.Windows.CppWinRT.

Вы можете определить проект, который использует поддержку MSBuild C++/WinRT, по наличию пакета NuGet **Microsoft.Windows.CppWinRT**, установленного в проекте.

Далее приведены шаблоны проектов Visual Studio, предоставляемые расширением VSIX.

### <a name="blank-app-cwinrt"></a>Пустое приложение (C++/WinRT)
Шаблон проекта для приложения универсальной платформы Windows (UWP), которое имеет пользовательский интерфейс XAML.

Visual Studio предоставляет поддержку компилятора XAML для создания заглушек реализаций и заголовков из IDL-файла (`.idl`), прилагаемого к каждому файлу разметки XAML. В IDL-файле определите все классы локальной среды выполнения, на которые нужно сослаться на XAML-страницах вашего приложения, а затем один раз выполните сборку проекта для создания шаблонов реализации в `Generated Files` и определений типа заглушки в `Generated Files\sources`. Затем используйте определения типа заглушки для справки при реализации классов локальной среды выполнения. Также см. раздел о [разделении классов среды выполнения на файлы Midl (.idl)](/windows/uwp/cpp-and-winrt-apis/author-apis#factoring-runtime-classes-into-midl-files-idl).

Поддержка области конструирования XAML в Visual Studio 2019 для C++/WinRT соответствует C#. В Visual Studio 2019 вы можете использовать вкладку **События** окна **Свойства**, чтобы добавить обработчики событий в проект C++/WinRT. Вы также можете вручную добавить обработчики событий в код. Дополнительные сведения см. в статье [Обработка событий с помощью делегатов в C++/WinRT](handle-events.md).

### <a name="core-app-cwinrt"></a>Приложение основных компонентов (C++/WinRT)
Шаблон проекта для приложения универсальной платформы Windows (UWP), которое не использует XAML.

Вместо этого оно использует заголовок пространства имен C++/WinRT (Windows) для пространства имен Windows.ApplicationModel.Core. После выполнения сборки и запуска щелкните пустое пространство для добавления цветного квадрата, а затем щелкните цветной квадрат, чтобы перетащить его.

### <a name="windows-console-application-cwinrt"></a>Консольное приложение для Windows (C++/WinRT)
Шаблон проекта для клиентского приложения C++/WinRT для Windows Desktop с пользовательским интерфейсом консоли.

### <a name="windows-desktop-application-cwinrt"></a>Классическое приложение для Windows (C++/WinRT)
Шаблон проекта для клиентского приложения C++/WinRT для Windows Desktop, который отображает [Windows.Foundation.Uri](/uwp/api/windows.foundation.uri) среды выполнения Windows внутри **MessageBox** Win32.

### <a name="windows-runtime-component-cwinrt"></a>Компонент среды выполнения Windows (C++/WinRT)
Шаблон проекта для компонента, как правило, для использования из универсальной платформы Windows (UWP).

Этот шаблон демонстрирует цепочку инструментов `midl.exe` > `cppwinrt.exe`, где метаданные среды выполнения Windows (`.winmd`) создаются из IDL, а затем из метаданных среды выполнения Windows создаются заглушки реализаций и заголовков.

В IDL-файле определите классы среды выполнения в вашем компоненте, их интерфейс по умолчанию и другие интерфейсы, которые они реализуют. Единожды выполните сборку проекта для создания шаблонов реализаций `module.g.cpp` и `module.h.cpp` в `Generated Files` и определений типа заглушек в `Generated Files\sources`. Затем используйте определения типов заглушек для справки при реализации классов среды выполнения в вашем компоненте. Также см. раздел о [разделении классов среды выполнения на файлы Midl (.idl)](/windows/uwp/cpp-and-winrt-apis/author-apis#factoring-runtime-classes-into-midl-files-idl).

Объедините в пакет собранный двоичный файл компонента среды выполнения Windows и его `.winmd` с приложением UWP, которое их использует.

## <a name="earlier-versions-of-the-vsix-extension"></a>Более ранние версии расширения VSIX
Мы рекомендуем установить (или обновить до) последнюю версию [расширения VSIX](https://aka.ms/cppwinrt/vsix). По умолчанию для него настроено самостоятельное обновление. Если вы это сделаете при наличии проектов, созданных с версией расширения VSIX ранее 1.0.190128.4, следует ознакомиться с этим разделом, содержащим важную информацию об обновлении этих проектов для работы с новой версией. Если вы не выполните обновление, вам все равно будет полезно ознакомиться со сведениями в этом разделе.

С точки зрения поддерживаемых пакетов Windows SDK и версий Visual Studio, а также конфигурации Visual Studio информация в приведенном выше разделе [Поддержка Visual Studio для C++/WinRT, XAML, расширения VSIX и пакета NuGet](#visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package) относится к более ранним версиям расширения VSIX. Ниже описываются важные различия в поведении и конфигурации проектов, созданных (или обновленных для работы) с более ранними версиями.

### <a name="created-earlier-than-101810022"></a>Созданные с версией ранее 1.0.181002.2
Если ваш проект был создан с более ранней версией расширения VSIX, чем 1.0.181002.2, в эту версию расширения VSIX была встроена поддержка сборки C++/WinRT. Проект содержит набор свойств `<CppWinRTEnabled>true</CppWinRTEnabled>` в файле `.vcxproj`.

```xml
<Project ...>
    <PropertyGroup Label="Globals">
        <CppWinRTEnabled>true</CppWinRTEnabled>
...
```

Вы можете обновить проект, вручную установив пакет NuGet **Microsoft.Windows.CppWinRT**. После установки (или обновления до) последней версии расширения VSIX откройте проект в Visual Studio и щелкните **Проект** \> **Управление пакетами NuGet...** \> **Обзор**, введите или вставьте **Microsoft.Windows.CppWinRT** в поле поиска, выберите элемент в результатах поиска, а затем нажмите кнопку **Установить**, чтобы установить пакет для проекта.

### <a name="created-with-or-upgraded-to-between-101810022-and-101901283"></a>Созданные с версиями (или обновленные до) 1.0.181002.2–1.0.190128.3
Если проект был создан с версией расширения VSIX между 1.0.181002.2 и 1.0.190128.3 включительно, пакет NuGet **Microsoft.Windows.CppWinRT** был автоматически установлен в проект по шаблону проекта. Кроме того, может также потребоваться обновить более старый проект для использования версии расширения VSIX в этом диапазоне. Если вы это сделали, так как поддержка сборки все еще присутствовала в версиях расширения VSIX в этом диапазоне, в обновленном проекте может быть установлен или не установлен пакет NuGet **Microsoft.Windows.CppWinRT**.

Чтобы обновить проект, следуйте инструкциям в предыдущем разделе и убедитесь, что в проекте установлен пакет NuGet **Microsoft.Windows.CppWinRT**.

### <a name="invalid-upgrade-configurations"></a>Недопустимые конфигурации обновления
В последней версии расширения VSIX для проекта недопустимо иметь свойство `<CppWinRTEnabled>true</CppWinRTEnabled>`, если на нем также не установлен пакет NuGet **Microsoft.Windows.CppWinRT**. Проект с такой конфигурацией выдает сообщение об ошибке сборки: "The C++/WinRT VSIX no longer provides project build support.  Please add a project reference to the Microsoft.Windows.CppWinRT Nuget package." (C++/WinRT VSIX больше не поддерживает сборку проекта. Добавьте ссылку на пакет Nuget Microsoft.Windows.CppWinRT в проекте).

Как упоминалось выше, проект C++/WinRT теперь должен иметь установленный пакет NuGet.

Так как элемент `<CppWinRTEnabled>` устарел, вы можете при необходимости отредактировать параметр `.vcxproj` и удалить элемент. Это не обязательно, но возможно.

Кроме того, если параметр `.vcxproj` содержит `<RequiredBundles>$(RequiredBundles);Microsoft.Windows.CppWinRT</RequiredBundles>`, вы можете удалить его, чтобы можно было выполнить сборку, не устанавливая расширение VSIX C++/WinRT.

## <a name="sdk-support-for-cwinrt"></a>Поддержка пакетов SDK для C++/WinRT
Хотя теперь она присутствует только в целях обеспечения совместимости, начиная с версии 10.0.17134.0 (Windows 10, версия 1803), Windows SDK содержит стандартную библиотеку C++ на основе файлов заголовков для использования основных API-интерфейсов Windows (API среды выполнения Windows и пространства имен Windows). Эти заголовки размещены в папке `%WindowsSdkDir%Include<WindowsTargetPlatformVersion>\cppwinrt\winrt`. Начиная с версии Windows SDK 10.0.17763.0 (Windows 10, версия 1809), эти заголовки создаются в папке *$(GeneratedFilesDir)* проекта.

Опять-таки, в целях обеспечения совместимости пакет Windows SDK также поставляется с инструментом `cppwinrt.exe`. Однако мы рекомендуем вместо этого установить и использовать самую последнюю версию `cppwinrt.exe`, которая включена в пакет NuGet **Microsoft.Windows.CppWinRT**. Этот пакет и `cppwinrt.exe` описаны в разделах выше.

## <a name="custom-types-in-the-cwinrt-projection"></a>Пользовательские типы в проекции C++/WinRT
При использовании C++/WinRT можно применять стандартные функции языка C++ и [стандартные типы данных C++ и C++/WinRT](std-cpp-data-types.md), включая некоторые типы данных стандартной библиотеки C++. Однако вы также получите сведения о некоторых пользовательских типах данных в проекции и сможете использовать их. Например, мы используем [**winrt::hstring**](/uwp/cpp-ref-for-winrt/hstring) в кратком примере кода в разделе [Начало работы с C++/WinRT](get-started.md).

[**winrt::com_array**](/uwp/cpp-ref-for-winrt/com-array) является еще одним типом, который вы, скорее всего, используете в определенный момент. При этом вы с меньшей вероятностью будете использовать напрямую такие типы, как [**winrt::array_view**](/uwp/cpp-ref-for-winrt/array-view). Вы можете решить не использовать его, чтобы у вас не было кода, требующего изменений, если эквивалентный тип появится в стандартной библиотеке C++.

> [!WARNING]
> Кроме того, существуют типы, которые можно обнаружить, если внимательно изучить заголовки пространства имен Windows C++/WinRT. Примером служит **winrt::param::hstring**, но существуют и примеры для коллекции. Они существуют исключительно для оптимизации привязки входных параметров, при этом помогают существенно повысить производительность и обеспечивают поддержку большинства шаблонов вызовов для связанных стандартных типов и контейнеров C++. Эти типы будут использоваться проекцией тогда, когда они будут наиболее эффективны. Они существенно оптимизированы и не предназначены для общего использования. Не применяйте их самостоятельно. Вам также не следует использовать что-либо из пространства имен `winrt::impl`, так как это типы реализации, которые могут быть изменены. Вам следует продолжать использовать стандартные типы или типы из [пространства имен winrt](/uwp/cpp-ref-for-winrt/winrt).
>
> Также см. статью о [передаче параметров в интерфейс ABI](/windows/uwp/cpp-and-winrt-apis/pass-parms-to-abi).

## <a name="important-apis"></a>Важные API
* [Структура winrt::hstring](/uwp/cpp-ref-for-winrt/hstring)
* [Пространство имен WinRT](/uwp/cpp-ref-for-winrt/winrt)

## <a name="related-topics"></a>Статьи по теме
* [C++/CX](/cpp/cppcx/visual-c-language-reference-c-cx)
* [Расширение C++/WinRT для Visual Studio (VSIX)](https://aka.ms/cppwinrt/vsix)
* [Начало работы с C++/WinRT](get-started.md)
* [Стандартные типы данных C++ и C++/WinRT](std-cpp-data-types.md)
* [Обработка строк в C++/WinRT](strings.md)
* [API Windows UWP](https://docs.microsoft.com/uwp/api/)
