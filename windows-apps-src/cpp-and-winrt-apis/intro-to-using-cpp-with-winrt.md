---
description: Введение в C++/WinRT &mdash; стандартную проекцию языка C++ для API среды выполнения Windows.
title: Введение в C++/WinRT
ms.date: 01/31/2019
ms.topic: article
keywords: Windows 10, UWP, стандартные, c++, cpp, winrt, проекция, введение
ms.localizationpriority: medium
ms.openlocfilehash: 883463f291864016ebc32f2d510936452c931366
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57649699"
---
# <a name="introduction-to-cwinrt"></a>Введение в C++/WinRT
&nbsp;
> [!VIDEO https://www.youtube.com/embed/nOFNc2uTmGs]

C++/WinRT — это полностью стандартная проекция языка C++17 для API среды выполнения Windows (WinRT), реализованная как библиотека на основе файлов заголовков и предназначенная для предоставления вам первоклассного доступа к современным API-интерфейсам Windows. С помощью C++/WinRT можно создавать и использовать API среды выполнения Windows, используя любой совместимый со стандартами компилятор C++17. В пакет Windows SDK входит среда C++/WinRT, которая впервые появилась в версии 10.0.17134.0 (Windows 10, версия 1803).

C + +/ WinRT — корпорации Майкрософт рекомендуется на замену для [C + +/ CX](/cpp/cppcx/visual-c-language-reference-c-cx?branch=live) проекции языка и [библиотеки шаблонов C++ (WRL) среды выполнения Windows](/cpp/windows/windows-runtime-cpp-template-library-wrl?branch=live). Полный список [разделы, посвященные C + +/ WinRT](index.md#topics-about-cwinrt) включает в себя сведения о взаимодействии с и перенос приложений из, C + +/ CX и WRL.

> [!IMPORTANT]
> Две наиболее важные моменты C + +/ WinRT, которые следует учитывать описаны в разделах [пакет SDK поддерживает для C + +/ WinRT](#sdk-support-for-cwinrt) и [поддержка Visual Studio для C + +/ WinRT, XAML, расширения VSIX и NuGet пакета](intro-to-using-cpp-with-winrt.md#visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package).

## <a name="language-projections"></a>Языковые проекции
Среда выполнения Windows основывается на API-интерфейсах Component Object Model (COM) и предусматривает доступ к ней через *языковые проекции*. Проекция скрывает подробности COM и обеспечивает более естественный подход к программированию на используемом языке.

### <a name="the-cwinrt-language-projection-in-the-windows-uwp-api-reference-content"></a>Языковая проекция C++/WinRT в содержимом справочных материалов по API Windows UWP
При просмотре [API-интерфейсов Windows UWP](https://docs.microsoft.com/uwp/api/) щелкните поле со списком **Язык** в правом верхнем углу и выберите пункт **C++/WinRT**, чтобы просмотреть синтаксические блоки API в том виде, в котором они отражаются в языковой проекции C++/WinRT.

## <a name="sdk-support-for-cwinrt"></a>Поддержка пакетов SDK для C++/WinRT
Начиная с версии 10.0.17134.0 (Windows 10, версия 1803), Windows SDK содержит стандартную библиотеку C++ на основе файлов заголовков для использования основных API-интерфейсов Windows (API среды выполнения Windows и пространства имен Windows). C++/WinRT также поставляется вместе со средством `cppwinrt.exe`, которое может указывать на файл метаданных среды выполнения Windows (`.winmd`) для создания стандартной библиотеки C++ на основе файлов заголовков, которая *проецирует* API-интерфейсы, описанные в метаданных, для использования в коде C++/WinRT. Файлы метаданных среды выполнения Windows (`.winmd`) предоставляют канонический способ описания поверхности API среды выполнения Windows. Если `cppwinrt.exe` указывает на метаданные, вы можете создать библиотеку для использования с любым классом среды выполнения, реализованным в стороннем компоненте среды выполнения Windows или в вашем приложении. Дополнительные сведения см. в разделе [Использование API-интерфейсов в C++/WinRT](consume-apis.md).

С помощью C++/WinRT также можно реализовать собственные классы среды выполнения, используя стандартный язык C++, не прибегая к программированию в стиле COM. Для класса среды выполнения необходимо просто описать типы в IDL-файле, после чего средства `midl.exe` и `cppwinrt.exe` создадут файлы стандартного исходного кода автоматически. Можно также реализовать только интерфейсы на основе базового класса C++/WinRT. Дополнительные сведения см. в разделе [Создание API-интерфейсов в C++/WinRT](author-apis.md).

## <a name="visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package"></a>Поддержка Visual Studio для C + +/ WinRT, XAML, это расширение VSIX и пакет NuGet
Для поддержки Visual Studio, в дополнение к минимальной версии целевой пакет SDK для Windows 10.0.17134.0 (Windows 10 версии 1803), вам потребуется Visual Studio 2017 (по крайней мере версии 15.6; мы рекомендуем по крайней мере 15.7), или 2019 г. Visual Studio. Если вы еще не установили его, вам потребуется установить **средства C++ универсальной платформы Windows** параметр в Visual Studio Installer. И, в Windows **параметры** > **обновление \& безопасности** > **для разработчиков**, выберите **разработчика режим** параметр, а не **неопубликованные приложения** параметр.

Вам потребуется загрузить и установить последнюю версию [C + +/ WinRT Visual Studio Extension (VSIX)](https://aka.ms/cppwinrt/vsix) из [Visual Studio Marketplace](https://marketplace.visualstudio.com/).

- Расширение VSIX предоставляет вам C + +/ WinRT шаблонов проектов и элементов в Visual Studio, чтобы вы можете начать работу с использованием C + +/ WinRT разработки.
- Кроме того, она предоставляет визуализации отладки машинного кода в Visual Studio (natvis) C + +/ WinRT проецировать типы; Используйте стараемся аналогичную C# отладки. Natvis используется автоматически для сборок отладки. Вы можете выбрать сборки выпуска, указав символ WINRT_NATVIS.

Шаблоны проектов Visual Studio для C + +/ WinRT описаны ниже. При создании нового C + +/ WinRT проекта с последней версией установки расширения VSIX новый C + +/ WinRT проекта автоматически устанавливает [пакет Microsoft.Windows.CppWinRT NuGet](https://www.nuget.org/packages/Microsoft.Windows.CppWinRT/). **Microsoft.Windows.CppWinRT** предоставляет пакет NuGet C + +/ WinRT создавайте поддержкой (свойства MSBuild и целевые объекты), Создание проекта переносимой между компьютер для разработки и агента сборки (на котором только пакет NuGet, и не установлено расширение VSIX,).

> [!IMPORTANT]
> Если у вас есть проекты, которые были созданы с (или обновлены для работы с) версии расширения VSIX ранее чем 1.0.190128.4, затем см. в разделе [более ранних версиях расширение VSIX](#earlier-versions-of-the-vsix-extension). Этот раздел содержит важные сведения о конфигурации проектов, которые необходимо знать, чтобы обновить их, чтобы использовать последнюю версию расширения VSIX.

Поскольку C + +/ WinRT использует функции из стандарта C ++ 17, назначьте ей свойство проекта **C/C++** > **языка** > **стандартом языка C++**  >  **Стандарт ISO C ++ 17 (/ std: c ++ 17)**. Можно также задать **режим совместимости: Да (/ permissive-)**, который дополнительно ограничивает ваш код будет соответствующих стандартам.

Еще одно свойство, о котором следует знать, это **C/C++** > **General** > **Treat Warnings As Errors**. Задайте для него значение **Yes(/WX)** или **No (/WX-)** по вашему желанию. Иногда исходные файлы, созданные инструментом `cppwinrt.exe`, выдают предупреждения до тех пор, пока вы не добавите в них свою реализацию.

С вашей системой, задайте до, как описано выше, вы сможете создавать и создавать или открывать, C + +/ WinRT проекта в Visual Studio и развернуть его.

Кроме того, можно преобразовать существующий проект, вручную установив **Microsoft.Windows.CppWinRT** пакет NuGet. После установки (или обновления) последнюю версию расширения VSIX, откройте существующий проект в Visual Studio, щелкните **проекта** \> **управление пакетами NuGet...** \> **Обзор**введите или вставьте **Microsoft.Windows.CppWinRT** в поле поиска, выберите элемент в результатах поиска, а затем нажмите кнопку **установить** для установки пакета для этого проекта. После добавления пакета, вы получите C + +/ WinRT MSBuild поддержка проекта, в том числе о вызове `cppwinrt.exe` средство.

Вы можете определить проект, использующий C + +/ поддержку WinRT MSBuild наличием **Microsoft.Windows.CppWinRT** пакета NuGet в проекте.

Ниже приведены шаблоны проектов Visual Studio, предоставляемые расширение VSIX.

### <a name="windows-console-application-cwinrt"></a>Консольное приложение для Windows (C++/WinRT)
Шаблон проекта для клиентского приложения C++/WinRT для Windows Desktop с пользовательским интерфейсом консоли.

### <a name="blank-app-cwinrt"></a>Пустое приложение (C++/WinRT)
Шаблон проекта для приложения универсальной платформы Windows (UWP), которое имеет пользовательский интерфейс XAML.

Visual Studio предоставляет поддержку компилятора XAML для создания заглушек реализаций и заголовков из файла языка описания интерфейса (IDL) (`.idl`) прилагаемого к каждому файлу разметки XAML. В файл IDL определите все классы локальной среды выполнения, на которые нужно сослаться на XAML-страница вашего приложения, а затем один раз выполните сборку приложения для создания шаблонов реализации в `Generated Files` и заглушек определений типов в `Generated Files\sources`. Затем используйте заглушки определений типов для справки при реализации классов локальной среды выполнения. Мы рекомендуем объявлять каждый класс среды выполнения в своем собственном файле IDL.

Surface поддержка конструктора XAML в Visual Studio для C + +/ WinRT близок к четности с C#. Единственным исключением является **события** вкладке **свойства** окна. С помощью C# проекта, эту вкладку можно использовать для добавления обработчиков событий; с использованием C + +/ WinRT проекта, отсутствует этого субъекта. Но см. в разделе [обработки событий с помощью делегатов в C + +/ WinRT](handle-events.md) сведения о том, как добавить обработчики событий в код.

### <a name="core-app-cwinrt"></a>Приложение основных компонентов (C++/WinRT)
Шаблон проекта для приложения универсальной платформы Windows (UWP), которое не использует XAML.

Вместо этого оно использует заголовок пространства имен C++/WinRT (Windows) для пространства имен Windows.ApplicationModel.Core. После выполнения сборки и запуска щелкните пустое пространство для добавления цветной квадрат; затем щелкните цветной квадрат, чтобы перетащить его.

### <a name="windows-runtime-component-cwinrt"></a>Компонент среды выполнения Windows (C++/WinRT)
Шаблон проекта для компонента; как правило, для использования из универсальной платформы Windows (UWP).

Этот шаблон демонстрирует цепочку инструментов `midl.exe` > `cppwinrt.exe`, где метаданные среды выполнения Windows (`.winmd`) создаются из IDL, а затем из метаданных среды выполнения Windows создаются заглушки реализаций и заголовков.

В файле IDL определите классы среды выполнения в вашем компоненте, их интерфейс по умолчанию и другие интерфейсы, которые они реализуют. Единожды выполните сборку проекта для создания шаблонов реализаций `module.g.cpp` и `module.h.cpp` в `Generated Files` и заглушек определений типов в `Generated Files\sources`. Затем используйте заглушки определений типов для справки при реализации классов среды выполнения в вашем компоненте. Мы рекомендуем объявлять каждый класс среды выполнения в своем собственном файле IDL.

Объедините в пакет собранный двоичный файл компонента среды выполнения Windows и его `.winmd` с использующим их приложением UWP.

## <a name="earlier-versions-of-the-vsix-extension"></a>Более ранних версиях расширение VSIX
Мы рекомендуем установить (или обновите) последней версии [расширение VSIX](https://aka.ms/cppwinrt/vsix). Он настраивается для самостоятельного обновления по умолчанию. Если это сделать, и у вас есть проекты, созданные с помощью версии расширения VSIX в более ранних, чем 1.0.190128.4, а затем в этом разделе содержатся важные сведения об обновлении проектов для работы с новой версией. Если вы не обновите, затем вам по-прежнему полезными сведения в этом разделе.

На основе поддерживается пакет SDK для Windows и версиях Visual Studio и конфигурации Visual Studio, сведения в [поддержка Visual Studio для C + +/ WinRT, XAML, это расширение VSIX и пакет NuGet](#visual-studio-support-for-cwinrt-xaml-the-vsix-extension-and-the-nuget-package) раздел выше относится к более ранней версии версии расширения VSIX. Информацию, приведенную ниже описываются важные различия, касающиеся поведение и конфигурации проектов ранее созданных с (или для работы с обновленной) версии.

### <a name="created-earlier-than-101810022"></a>Создана раньше, чем 1.0.181002.2
Если проект был создан с версией расширение VSIX в более ранних, чем 1.0.181002.2, а затем C + +/ WinRT поддержка сборки был встроен в этой версии расширения VSIX. В проекте имеется `<CppWinRTEnabled>true</CppWinRTEnabled>` свойство установлено в `.vcxproj` файл.

```xml
<Project ...>
    <PropertyGroup Label="Globals">
        <CppWinRTEnabled>true</CppWinRTEnabled>
...
```

Можно обновить проект, вручную установив **Microsoft.Windows.CppWinRT** пакет NuGet. После установки (или перехода на) последнюю версию расширения VSIX, откройте проект в Visual Studio, нажмите кнопку **проекта** \> **управление пакетами NuGet...** \> **Обзор**введите или вставьте **Microsoft.Windows.CppWinRT** в поле поиска, выберите элемент в результатах поиска, а затем нажмите кнопку **установить** для установки пакета для проекта.

### <a name="created-with-or-upgraded-to-between-101810022-and-101901283"></a>Созданные с помощью (или обновить до) между 1.0.181002.2 и 1.0.190128.3
Если проект был создан с версией расширение VSIX между 1.0.181002.2 и 1.0.190128.3, включительно, а затем **Microsoft.Windows.CppWinRT** был установлен пакет NuGet в проект автоматически, проект шаблон. Возможно, также модернизированы старого проекта для использования версии расширения VSIX в этом диапазоне. Если вы выполнили, затем&mdash;момента поддержки сборки также по-прежнему присутствует в версиях расширение VSIX в этом диапазоне&mdash;обновленный проект может иметь или не иметь **Microsoft.Windows.CppWinRT** пакета NuGet установлен.

Чтобы обновить проект, следуйте инструкциям в предыдущем разделе и убедитесь, что проект имеет **Microsoft.Windows.CppWinRT** установленный пакет NuGet.

### <a name="invalid-upgrade-configurations"></a>Недопустимое обновление конфигурации
В последней версии расширения VSIX не допускается для проекта требуется `<CppWinRTEnabled>true</CppWinRTEnabled>` свойства, если он не имеет **Microsoft.Windows.CppWinRT** установленный пакет NuGet. Проект с этой конфигурацией выдает сообщения об ошибке сборки, «C + +/ WinRT VSIX не обеспечивает поддержку построения проекта.  Добавьте ссылку на пакет Microsoft.Windows.CppWinRT Nuget.»

Как упоминалось выше, C + +/ WinRT проекта теперь необходимо установить пакет NuGet в нем.

Так как `<CppWinRTEnabled>` элемент больше не используется, при необходимости можно изменить ваш `.vcxproj`и удалите элемент. Это не является обязательным, но соответствующий параметр.

Кроме того Если ваш `.vcxproj` содержит `<RequiredBundles>$(RequiredBundles);Microsoft.Windows.CppWinRT</RequiredBundles>`, его можно удалить, что можно создавать без использования C + +/ расширение WinRT VSIX должны быть установлены.

## <a name="custom-types-in-the-cwinrt-projection"></a>Пользовательские типы в проекции C++/WinRT
В C + +/ WinRT программирования, можно использовать стандартные возможности языка C++ и [типы данных в стандартном языке C++ и C + +/ WinRT](std-cpp-data-types.md)&mdash;включая некоторые типы данных стандартной библиотеки C++. Однако вы также получите сведения о некоторых пользовательских типах данных в проекции, и сможете использовать их. Например, мы используем [**winrt::hstring**](/uwp/cpp-ref-for-winrt/hstring) в кратком примере кода в разделе [Начало работы с C++/WinRT](get-started.md).

[**WinRT::com_array** ](/uwp/cpp-ref-for-winrt/com-array) — другой тип, скорее всего, для использования в будущем. При этом вы с меньшей вероятностью будете использовать напрямую такие типы, как [**winrt::array_view**](/uwp/cpp-ref-for-winrt/array-view). Вы можете решить не использовать его, чтобы у вас не было кода, требующего изменений, если эквивалентный тип появится в стандартной библиотеке C++.

> [!WARNING]
> Также существуют типы, которые можно обнаружить, если внимательно изучить заголовки пространства имен Windows C++/WinRT. Примером служит **winrt::param::hstring**, но существуют и примеры для коллекции. Они существуют исключительно для оптимизации привязки входных параметров, при этом помогают существенно повысить производительность и обеспечивают поддержку большинства шаблонов вызовов для связанных стандартных типов и контейнеров C++. Эти типы будут использоваться проекцией тогда, когда они будут наиболее эффективны. Они существенно оптимизированы и не предназначены для общего использования. Не применяйте их самостоятельно. Вам также не следует использовать что-либо из пространства имен `winrt::impl`, поскольку это типы реализации, которые могут быть изменены. Вам следует продолжать использовать стандартные типы или типы из [пространства имен winrt](/uwp/cpp-ref-for-winrt/winrt).

## <a name="important-apis"></a>Важные API
* [Структура WinRT::hstring](/uwp/cpp-ref-for-winrt/hstring)
* [Пространство имен WinRT](/uwp/cpp-ref-for-winrt/winrt)

## <a name="related-topics"></a>Статьи по теме
* [C++/CX](/cpp/cppcx/visual-c-language-reference-c-cx)
* [C + +/ WinRT Visual Studio расширения (VSIX)](https://aka.ms/cppwinrt/vsix)
* [Начало работы с C++/WinRT](get-started.md)
* [Стандартные типы данных C++ и C++/WinRT](std-cpp-data-types.md)
* [Строка, обработка в C + +/ WinRT](strings.md)
* [Windows API-интерфейсов универсальной платформы Windows](https://docs.microsoft.com/uwp/api/)
