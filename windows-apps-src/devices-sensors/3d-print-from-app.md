---
author: PatrickFarley
title: "Трехмерная печать из приложения"
description: "Узнайте, как добавить функцию трехмерной печати в универсальное приложение для Windows. Эта статья содержит сведения о том, как вызвать диалоговое окно трехмерной печати, убедившись в том, что трехмерная модель поддается печати и создана в нужном формате."
ms.assetid: D78C4867-4B44-4B58-A82F-EDA59822119C
translationtype: Human Translation
ms.sourcegitcommit: 61d9f5c1fca1ad2e26f052b901361813975ae357
ms.openlocfilehash: e68a9c681974152bc0d4dfa58e824f80e77dc51f

---

# Трехмерная печать из приложения


\[ Обновлено для приложений UWP в Windows 10. Статьи о Windows 8.x см. в [архиве](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


**Важные API**

-   [**Windows.Graphics.Printing3D**](https://msdn.microsoft.com/library/windows/apps/dn998169)

Узнайте, как добавить функцию трехмерной печати в универсальное приложение для Windows. В этом разделе рассматривается, как загрузить трехмерные геометрические данные в приложение и открыть диалоговое окно трехмерной печати после того, как вы убедитесь, что ваша трехмерная модель пригодна для печати и выполнена нужном формате. Работающий пример применения этих процедур см. в разделе [Пример трехмерной печати UWP](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/3DPrinting).

## Настройка класса


Добавьте пространство имен [Windows.Graphics.Printing3D](https://msdn.microsoft.com/library/windows/apps/dn998169) в класс, где требуется реализовать возможности трехмерной печати.

[!code-cs[3DPrintNamespace](./code/3dprinthowto/cs/MainPage.xaml.cs#Snippet3DPrintNamespace)]

В этом руководстве будут использованы следующие дополнительные пространства имен.

[!code-cs[OtherNamespaces](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetOtherNamespaces)]

Затем добавьте в класс несколько полезных полей-участников. Объявите объект [Print3DTask](https://msdn.microsoft.com/library/windows/apps/dn998044), чтобы он служил ссылкой на задачу печати, которую требуется передать драйверу печати. Объявите объект [StorageFile](https://msdn.microsoft.com/library/windows/apps/br227171), чтобы он содержал исходный файл данных трехмерной графики. Наконец, объявите объект [Printing3D3MFPackage](https://msdn.microsoft.com/library/windows/apps/dn998063), представляющий готовую для печати трехмерную модель со всеми необходимыми метаданными.

[!code-cs[DeclareVars](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetDeclareVars)]

## Создание простого пользовательского интерфейса


В этом примере используется три пользовательских элемента управления: кнопка загрузки (для переноса файла в память программы), кнопка исправления (для изменения файла согласно необходимости) и кнопка печати (для запуска задания печати). Следующий код позволяет создать эти кнопки (с соответствующими обработчиками события нажатия) в XAML-файле вашего класса.

[!code-xml[Кнопки](./code/3dprinthowto/cs/MainPage.xaml#SnippetButtons)]

Добавьте поле **TextBlock** для обратной связи от пользовательского интерфейса.

[!code-xml[OutputText](./code/3dprinthowto/cs/MainPage.xaml#SnippetOutputText)]

## Получение трехмерных данных


Методы, с помощью которых ваше приложение получает трехмерные геометрические данные для печати, будут варьироваться. Ваше приложение может извлечь трехмерные данные из сканирования, перенести данные модели из веб-ресурса или создать трехмерную сетку программным способом, с помощью формул. Для простоты в этом примере мы загрузим файл с трехмерными данными (любого из нескольких распространенных типов файлов) в память программы из проводника.

В методе `OnLoadClick` используйте класс [FileOpenPicker](https://msdn.microsoft.com/library/windows/apps/br207847) для загрузки отдельного файла в память приложения.

[!code-cs[FileLoad](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetFileLoad)]

## Использование конструктора 3D Builder для преобразования в трехмерный производственный формат (.3mf)

На этом этапе можно загрузить файл данных 3D в памяти приложения. Однако геометрические данные 3D могут быть представлены в самых разных форматах, не все из которых подходят для трехмерной печати. В Windows 10 используется тип файла в формате создания 3D (.3mf) для всех задач трехмерной печати.

> **Примечание**  Тип файла 3MF поддерживает массу функциональных возможностей, не описанных в этом руководстве. Дополнительные сведения о типе файла 3MF и функциональных возможностях, предоставляемых производителям и потребителям трехмерных продуктов, см. в разделе [Спецификация 3MF](http://3mf.io/what-is-3mf/3mf-specification/). Чтобы узнать, как использовать эти средства с помощью API Windows 10, ознакомьтесь с учебником [Создание пакета 3MF](https://msdn.microsoft.com/windows/uwp/devices-sensors/generate-3mf).

К счастью, приложение [3D Builder](https://www.microsoft.com/store/apps/3d-builder/9wzdncrfj3t6) может открывать файлы наиболее распространенных форматов 3D и сохранять их в виде 3MF-файлов. В этом примере, где тип файла может варьироваться, простейшим решением станет открыть конструктор 3D Builder и предложить пользователю сохранить импортированные данные в виде 3MF-файла, а затем повторно загрузить их.

> **Примечание**  Помимо преобразования форматов файлов конструктор **3D Builder** предоставляет простые инструменты для редактирования моделей, добавления данных о цвете и выполнения других операций печати, поэтому конструктор имеет смысл интегрировать в любые приложения, где используется трехмерная печать.

[!code-cs[FileCheck](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetFileCheck)]

## Восстановление данных модели для трехмерной печати

Не все данные трехмерной модели можно напечатать (даже в формате 3MF). Чтобы принтер мог правильно определить, какое пространство заполнять, а какое — оставлять пустым, печатаемые модели должны представлять собой цельную бесшовную структуру, иметь обращенные наружу нормали к поверхности и разностороннюю геометрию. В этих областях могут возникать проблемы разного характера, и обнаружить их в сложных формах весьма затруднительно. К счастью, современные программные решения отлично справляются с задачей преобразования необработанных геометрических данных в доступные для печати трехмерные фигуры. Для этого служит метод `OnFixClick`.

Необходимо преобразовать файл трехмерных данных, чтобы реализовать интерфейс [IRandomAccessStream](https://msdn.microsoft.com/library/windows/apps/br241731), который затем можно использовать для создания объекта [Printing3DModel](https://msdn.microsoft.com/library/windows/apps/mt203679).

[!code-cs[RepairModel](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetRepairModel)]

Все ошибки в объекте **Printing3DModel** теперь устранены, он доступен для печати. Воспользуйтесь методом **SaveModelToPackageAsync**, чтобы назначить модель объекту Printing3D3MFPackage, объявленному при создании класса.

[!code-cs[SaveModel](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetSaveModel)]

## Выполнение задачи печати: создание обработчика TaskRequested


В дальнейшем, когда пользователю отображается диалоговое окно трехмерной печати и пользователь решает начать печать, приложению потребуется передать нужные параметры в конвейер трехмерной печати. API трехмерной печати вызывает событие **TaskRequested**. Необходимо написать метод для правильной обработки этого события. Как всегда, его тип должен совпадать с типом события: событие **TaskRequested** имеет параметры [Print3DManager](https://msdn.microsoft.com/library/windows/apps/dn998029) (объект-отправитель) и объект [Print3DTaskRequestedEventArgs](https://msdn.microsoft.com/library/windows/apps/dn998051), в котором хранится большая часть необходимой информации. Его возвращаемый тип: **void**.

[!code-cs[MyTaskTitle](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetMyTaskTitle)]

Основное назначение этого метода — использовать объект *args* для отправки пакета **Printing3D3MFPackage** по конвейеру. Тип **Print3DTaskRequestedEventArgs** имеет одно свойство: **Request**. Оно имеет тип [Print3DTaskRequest](https://msdn.microsoft.com/library/windows/apps/dn998050) и представляет один запрос задания печати. Метод **CreateTask** позволяет программе отправлять корректную информацию для вашего задания печати и возвращает ссылку на объект [Print3DTask](https://msdn.microsoft.com/library/windows/apps/dn998044), который отправляется по конвейеру трехмерной печати.

**CreateTask** имеет следующие входные параметры: **string** для имени задания печати, **string** для идентификатора используемого принтера и делегат **Print3DTaskSourceRequestedHandler**. Делегат вызывается автоматически при создании события **3DTaskSourceRequested** (за это отвечает API). Важно отметить, что это делегат вызывается, когда инициируется задание печати, и отвечает за предоставление правильного пакета трехмерной печати.

**Print3DTaskSourceRequestedHandler** принимает один параметр — объект [Print3DTaskSourceRequestedArgs](https://msdn.microsoft.com/library/windows/apps/dn998056), предоставляющий данные для отправки. Один открытый метод этого класса — **SetSource** — принимает печатаемый пакет. Реализуйте делегат **Print3DTaskSourceRequestedHandler** следующим образом.

[!code-cs[SourceHandler](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetSourceHandler)]

Затем вызовите **CreateTask**, используя только что определенный делегат `sourceHandler`:

[!code-cs[CreateTask](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetCreateTask)]

Возвращенный объект **Print3DTask** назначается объявленной в начале переменной класса. Теперь при необходимости можно использовать эту ссылку для обработки определенных событий, создаваемых этой задачей.

[!code-cs[Необязательно](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetOptional)]

> **Примечание**  Необходимо реализовать методы `Task_Submitting` и `Task_Completed`, если требуется зарегистрировать их для этих событий.

## Выполнение задачи печати: открытие диалогового окна трехмерной печати


Заключительный фрагмент кода, необходимый для печати из приложения, — это фрагмент кода, запускающий диалоговое окно трехмерной печати. Как и в обычном диалоговом окне печати, здесь представлено несколько сделанных в последний момент спецификаций печати. Здесь же можно выбрать принтер для печати (подключенный через USB или по сети).

Сначала зарегистрируйте метод `MyTaskRequested` с событием **TaskRequested**.

[!code-cs[RegisterMyTaskRequested](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetRegisterMyTaskRequested)]

После регистрации обработчика событий **TaskRequested** можно вызвать метод **ShowPrintUIAsync**, который выведет диалоговое окно трехмерной печати в окне текущего приложения.

[!code-cs[ShowDialog](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetShowDialog)]

Рекомендуется отменять регистрацию обработчиков событий, как только в приложении восстанавливается контроль над процессом: [!code-cs[DeregisterMyTaskRequested](./code/3dprinthowto/cs/MainPage.xaml.cs#SnippetDeregisterMyTaskRequested)].

## Ссылки по теме

[Создание пакета 3MF](https://msdn.microsoft.com/windows/uwp/devices-sensors/generate-3mf)

[Пример трехмерной печати UWP](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/3DPrinting)
 

 







<!--HONumber=Jun16_HO4-->


