---
author: stevewhims
Description: Some kinds of apps (multilingual dictionaries, translation tools, etc.) need to override the default behavior of an app bundle, and build resources into the app package instead of having them in separate resource packages. This topic explains how to do that.
title: Добавление ресурсов в пакет приложения, а не в пакет ресурсов
template: detail.hbs
ms.author: stwhi
ms.date: 11/14/2017
ms.topic: article
keywords: Windows 10, uwp, ресурс, изображение, средство, MRT, квалификатор
ms.localizationpriority: medium
ms.openlocfilehash: 61b526cd7aa2da8733457b16dd0487ef4ead9cca
ms.sourcegitcommit: 70ab58b88d248de2332096b20dbd6a4643d137a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/01/2018
ms.locfileid: "5923499"
---
# <a name="build-resources-into-your-app-package-instead-of-into-a-resource-pack"></a>Добавление ресурсов в пакет приложения, а не в пакет ресурсов

Некоторым видам приложений (многоязычных словари, средства перевода и т. д.) необходимо переопределить поведение пакета приложения по умолчанию и встроить ресурсы в пакет приложения, а не в отдельный пакеты ресурсов. В этом разделе объясняется, как это сделать.

По умолчанию при создании [пакета приложения (.appxbundle)](../packaging/packaging-uwp-apps.md) в него добавляются только ресурсы по умолчанию только для языка, масштаба и функционального уровня DirectX. Переведенные ресурсы и ресурсы для нестандартных масштабов и (или) функциональные уровни DirectX встроены в пакеты ресурсов и скачиваются только на устройства, которым они требуются. Если клиент купит ваше приложение из Microsoft Store на устройстве, на котором в качестве предпочитаемого языка выбран испанский язык, скачиваются и устанавливаются только ваше приложение и пакет ресурсов на испанском языке. Если тот же пользователь позже изменит предпочитаемый язык на французский в **параметрах**, будет скачан и установлен ресурсов приложения на французском языке. То же происходит с ресурсами для масштабирования и функционального уровня DirectX. Для большинства приложений это поведение имеет преимущества, и именно это требуется *клиенту*.

Но если приложение позволяет пользователю изменить язык в самом приложении (а не в **параметрах**), то это поведение по умолчанию не подходит. Вам необходимо, чтобы все языковые ресурсы скачивались и устанавливались в любом случае вместе с приложение один раз и затем оставались на устройстве. Вам следует встроить все эти ресурсы в пакет приложения, а не в отдельные пакеты.

**Примечание.** Добавление ресурсов в пакет приложения существенно увеличивает размер приложения. Именно поэтому это стоит делать, только если это действительно необходимо. В противном случае нужно просто создать обычный пакет приложения, как обычно.

Вы можете настроить Visual Studio для добавления ресурсов в пакет приложения двумя способами. Вы можете добавить файл конфигурации в проект или изменить файл проекта напрямую. Используйте любой из этих способов, который кажется вам более удобным или который лучше всего подходит для системы сборки.

## <a name="option-1-use-priconfigpackagingxml-to-build-resources-into-your-app-package"></a>Вариант 1. Использование файла priconfig.packaging.xml для добавления ресурсов в пакет приложения

1. Добавьте новый элемент в проект в Visual Studio. Выберите XML-файл и укажите для него имя `priconfig.packaging.xml`.
2. В обозревателе решений выберите `priconfig.packaging.xml` и откройте окно "Свойства". Параметру "Действие при сборке" файла должно быть задано значение "Нет", а параметру "Копировать в выходной каталог" — "Не копировать".
3. Замените содержимое файла этим XML-кодом.
   ```xml
   <packaging>
      <autoResourcePackage qualifier="Language" />
      <autoResourcePackage qualifier="Scale" />
      <autoResourcePackage qualifier="DXFeatureLevel" />
   </packaging>
   ```
4. Каждый элемент `<autoResourcePackage>` указывает Visual Studio, что необходимо автоматически разделить ресурсы для заданного имени квалификатора на отдельные пакеты ресурсов. Это называется *автоматическим разделением*. Текущее содержимое файла не меняет поведение Visual Studio. Другими словами, среда Visual Studio *уже работала так, если бы* этот файл с этим содержимым уже существовал, так как эти значения используются по умолчанию. Если вы не хотите, чтобы среда Visual Studio автоматически разделяла ресурсы на основе имени квалификатора, удалите элемент `<autoResourcePackage>` из файла. Вот как будет выглядеть файл, если вам требуется, чтобы все языковые ресурсы были встроены в пакет приложения, а не разделялись автоматически на отдельные пакеты ресурсов.
   ```xml
   <packaging>
      <autoResourcePackage qualifier="Scale" />
      <autoResourcePackage qualifier="DXFeatureLevel" />
   </packaging>
   ```
5. Сохраните и закройте файл и заново выполните построение проекта.

Чтобы убедиться, что выбранные параметры автоматического разделения учитываются, изучите файл `<ProjectFolder>\obj\<ReleaseConfiguration folder>\split.priconfig.xml` и убедитесь, что его содержимое соответствует выбранным параметрам. Если это так, вы успешно настроили Visual Studio для добавления выбранных ресурсов в пакет приложения.

Вам остался один последний шаг. **Но только в том случае, если вы удалили имя квалификатора `Language`**. Вам необходимо указать объединение всех поддерживаемых приложением языков в качестве языка приложения по умолчанию. Дополнительные сведения см. в разделе [Указание ресурсов по умолчанию, которые используются в приложении](specify-default-resources-installed.md). Вот что будет содержать файл `priconfig.default.xml`, если в пакет приложения добавлены ресурсы для английского, испанского и французского языка.

```xml
   <default>
      <qualifier name="Language" value="en;es;fr" />
      ...
   </default>
```

### <a name="how-does-this-work"></a>Как это работает?

Visual Studio запускает средство `MakePri.exe` в фоновом режиме для создания файла, который называют индексом ресурсов пакета, описывающий все ресурсы вашего приложения, в том числе имена квалификаторов ресурсов для автоматического разбиения. Сведения об этом средстве см. в разделе [Компиляция ресурсов вручную с помощью MakePri.exe](compile-resources-manually-with-makepri.md). Visual Studio передает файл конфигурации `MakePri.exe`. Содержимое файла `priconfig.packaging.xml` используется в качестве элемента `<packaging>` этого файла конфигурации, который определяет автоматическое разделение. Таким образом, добавление и изменение `priconfig.packaging.xml` влияет на содержимое файла индекса ресурсов пакетов, который Visual Studio создает для вашего приложения, а также на содержимое пакетов приложения.

### <a name="using-a-different-file-name-than-priconfigpackagingxml"></a>Использование имени, отличного от `priconfig.packaging.xml`

Если назвать файл `priconfig.packaging.xml`, Visual Studio распознает его и будет использовать его автоматически. Если указать другое имя, необходимо сообщить об этом Visual Studio. Добавьте этот XML-код в файл проекта между открывающим и закрывающим тегами первого элемента `<PropertyGroup>`.

```xml
<AppxPriConfigXmlPackagingSnippetPath>FILE-PATH-AND-NAME</AppxPriConfigXmlPackagingSnippetPath>
```

Замените `FILE-PATH-AND-NAME` путем к файлу и именем файла.

## <a name="option-2-use-your-project-file-to-build-resources-into-your-app-package"></a>Вариант 2. Использование файла проекта для добавления ресурсов в пакет приложения

Это альтернатива варианту 1. Если вы поняли, как работает вариант 1, вы можете выбрать вариант 2, если он больше подходит для вас.

Добавьте этот XML-код в файл проекта между открывающим и закрывающим тегами первого элемента `<PropertyGroup>`.

```xml
<AppxBundleAutoResourcePackageQualifiers>Language|Scale|DXFeatureLevel</AppxBundleAutoResourcePackageQualifiers>
```

Вот как это выглядит после удаления первого имени квалификатора.

```xml
<AppxBundleAutoResourcePackageQualifiers>Scale|DXFeatureLevel</AppxBundleAutoResourcePackageQualifiers>
```

Сохраните и закройте файл и заново выполните построение проекта.

Вам остался один последний шаг. **Но только в том случае, если вы удалили имя квалификатора `Language`**. Вам необходимо указать объединение всех поддерживаемых приложением языков в качестве языка приложения по умолчанию. Дополнительные сведения см. в разделе [Указание ресурсов по умолчанию, которые используются в приложении](specify-default-resources-installed.md). Вот что будет содержать файл проекта, если в пакет приложения добавлены ресурсы для английского, испанского и французского языка.

```xml
<AppxDefaultResourceQualifiers>Language=en;es;fr</AppxDefaultResourceQualifiers>
```

## <a name="related-topics"></a>Статьи по теме

* [Упаковка приложения UWP с помощью Visual Studio](../packaging/packaging-uwp-apps.md)
* [Компиляция ресурсов вручную с помощью MakePri.exe](compile-resources-manually-with-makepri.md)
* [Указание ресурсов по умолчанию, которые используются в приложении](specify-default-resources-installed.md)