---
author: stevewhims
Description: When a resource is requested, there may be several candidates that match the current resource context to some degree. The Resource Management System will analyze all of the candidates and determine the best candidate to return. This topic describes that process in detail and gives examples.
title: Как система управления ресурсами сопоставляет и выбирает ресурсы
template: detail.hbs
ms.author: stwhi
ms.date: 10/23/2017
ms.topic: article
keywords: Windows 10, uwp, ресурс, изображение, средство, MRT, квалификатор
ms.localizationpriority: medium
ms.openlocfilehash: c7576f98045bce3bcfcee093aa8d61059354d45a
ms.sourcegitcommit: 38f06f1714334273d865935d9afb80efffe97a17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2018
ms.locfileid: "6201910"
---
# <a name="how-the-resource-management-system-matches-and-chooses-resources"></a>Как система управления ресурсами сопоставляет и выбирает ресурсы
В момент запроса ресурса текущему контексту ресурса может в той или иной степени соответствовать несколько кандидатов. Система управления ресурсами анализирует все кандидаты и выбирает из них лучший, который будет возвращен. Для ранжирования всех кандидатов учитываются все квалификаторы.

В процессе ранжирования разным квалификаторам назначаются разные приоритеты: язык оказывает наибольшее влияние на общее ранжирование, за ним идут контрастность, масштаб и т. д. Для каждого квалификатора квалификаторы кандидатов сравниваются со значением квалификатора контекста, чтобы определить степень соответствия. Порядок сравнения зависит от квалификатора.

Дополнительные сведения о том, как выполняется сопоставление языков тегов, см. в разделе [Как система управления ресурсами сопоставляет языковые теги](how-rms-matches-lang-tags.md).

Для некоторых квалификаторов, например масштаба и контрастности, всегда есть минимальная степень соответствия. Например кандидат с квалификатором «scale-100 «соответствует контексту «масштаба-400» в небольшой степени, хотя и не а также кандидат с квалификатором» scale-200» или (идеальное соответствие)» масштаба-400».

Для других квалификаторов, таких как язык или домашний регион, возможно несоответствие при сравнении (равно как и соответствие в той или иной степени). Например, кандидат с квалификатором языка, такой как en-US, частично соответствует контексту en-GB, а кандидат с квалификатором fr не соответствует этому контексту вовсе. Аналогичным образом кандидат с квалификатором домашнего региона 155 (Западная Европа) до некоторой степени соответствует контексту для пользователя с домашним регионом FR, а кандидат с квалификатором US не соответствует вовсе.

Если во время оценки кандидата имеется несоответствие при сравнении для какого-либо квалификатора, этот кандидат будет считаться в целом несоответствующим и не будет выбран. Таким образом, квалификаторы с более высоким приоритетом могут оказывать максимальное влияние на выбор наилучшего соответствия, но даже квалификатор с низким приоритетом может стать причиной исключения кандидата из-за несоответствия.

Кандидат нейтрален по отношению к квалификатору, если он не отмечен для этого квалификатора вовсе. Для любого квалификатора нейтральный кандидат всегда соответствует значению квалификатора контекста, но только с более низкой степенью соответствия, чем любой кандидат, отмеченный для данного квалификатора и имеющий некоторую степень соответствия (соответствие точное или частичное). Например, если имеются кандидаты с квалификаторами en-US, en, fr и кандидат, не зависящий от языка, то для контекста со значением квалификатора языка en-GB кандидаты будут ранжированы в следующем порядке: en, en-US, нейтральный и fr. В этом случае fr совершенно не соответствует, а другие кандидаты имеют некоторую степень соответствия.

Общий процесс ранжирования начинается с оценки кандидатов по отношению к квалификатору наивысшего приоритета— языку. Несоответствия исключаются. Оставшиеся кандидаты ранжируются по их степени соответствия для языка. Если есть кандидаты с одинаковым рангом, то учитывается следующий по приоритету квалификатор— контрастность— с использованием степени соответствия для контрастности, чтобы различать их. После контрастности используется квалификатор масштаба для различения остальных связанных кандидатов и т. д., пока не будет получена упорядоченная последовательность.

Если все кандидаты удаляются из рассмотрения, так как квалификаторы не соответствуют контексту, загрузчик ресурсов выполняет второй проход, чтобы найти кандидат по умолчанию для отображения. Кандидаты по умолчанию определяются во время создания PRI-файла и нужны для того, чтобы всегда можно было выбрать кандидат для любого контекста времени выполнения. Если кандидат содержит квалификаторы, которые не соответствуют и не используются по умолчанию, такой ресурс-кандидат навсегда исключается из рассмотрения.

Для всех ресурсов-кандидатов, которые все еще участвуют в рассмотрении, загрузчик ресурсов берет значение квалификатора контекста с самым высоким приоритетом и выбирает кандидат, имеющий наилучшее соответствие или наивысшую оценку по умолчанию. Любое фактическое соответствие считается более значимым, чем оценка по умолчанию.

Если появляется привязка, то проверяется значение квалификатора контекста со следующим по уровню приоритетом и процесс повторяется, пока не будет найдено наилучшее соответствие.

## <a name="example-of-choosing-a-resource-candidate"></a>Пример выбора потенциального ресурса
Рассмотрим эти файлы.

```console
en/images/logo.scale-400.jpg
en/images/logo.scale-200.jpg
en/images/logo.scale-100.jpg  
fr/images/logo.scale-100.jpg
fr/images/contrast-high/logo.scale-400.jpg
fr/images/contrast-high/logo.scale-100.jpg
de/images/logo.jpg
```

И предположим, что в текущем контексте действуют следующие параметры.

```console
Application language: en-US; fr-FR;
Scale: 400
Contrast: Standard
```

Система управления ресурсами отвергает три файла, поскольку высокая контрастность и немецкий язык не соответствуют контексту, определенному данными установками. Остаются эти кандидаты.

```console
en/images/logo.scale-400.jpg
en/images/logo.scale-200.jpg
en/images/logo.scale-100.jpg  
fr/images/logo.scale-100.jpg
```

Для оставшихся кандидатов система управления ресурсами использует квалификатор с наивысшим приоритетом контекста, которым является язык. Англоязычные ресурсы ближе, чем ресурсы на французском, поскольку в параметрах английский указан перед французским.

```console
en/images/logo.scale-400.jpg
en/images/logo.scale-200.jpg
en/images/logo.scale-100.jpg  
```

Затем система управления ресурсами использует следующий по приоритету квалификатор — масштаб. И вот возвращаемый ресурс.

```console
en/images/logo.scale-400.jpg
```

Можно использовать особый метод [**NamedResource.ResolveAll**](/uwp/api/windows.applicationmodel.resources.core.namedresource.resolveall?branch=live) для возвращения всех потенциальных ресурсов в порядке их соответствия контекстным установкам. В рассмотренном нами примере **ResolveAll** возвращает кандидаты в указанном порядке.

```console
en/images/logo.scale-400.jpg
en/images/logo.scale-200.jpg
en/images/logo.scale-100.jpg  
fr/images/logo.scale-100.jpg
```

## <a name="example-of-producing-a-fallback-choice"></a>Пример выбора запасного варианта
Рассмотрим эти файлы.

```console
en/images/logo.scale-400.jpg
en/images/logo.scale-200.jpg
en/images/logo.scale-100.jpg  
fr/images/contrast-standard/logo.scale-400.jpg
fr/images/contrast-standard/logo.scale-100.jpg
de/images/contrast-standard/logo.jpg
```

И предположим, что в текущем контексте действуют следующие параметры.

```console
User language: de-DE;
Scale: 400
Contrast: High
```

Отвергаются все файлы из-за несоответствия контексту. Поэтому мы входим в процедуру по умолчанию, где параметры по умолчанию (см. раздел [Компиляция ресурсов вручную с помощью MakePRI.exe](compile-resources-manually-with-makepri.md)) при создании PRI-файла были следующими:

```console
Language: fr-FR;
Scale: 400
Contrast: Standard
```

В результате остаются все ресурсы, соответствующие либо текущему пользователю, либо параметрам по умолчанию.

```console
fr/images/contrast-standard/logo.scale-400.jpg
fr/images/contrast-standard/logo.scale-100.jpg
de/images/contrast-standard/logo.jpg
```

Система управления ресурсами использует квалификатор контекста наивысшего приоритета (язык) и возвращает поименованные ресурсы с наивысшими результатами.

```console
de/images/contrast-standard/logo.jpg
```

## <a name="important-apis"></a>Важные API
* [NamedResource.ResolveAll](/uwp/api/windows.applicationmodel.resources.core.namedresource.resolveall?branch=live)

## <a name="related-topics"></a>Статьи по теме
* [Компиляция ресурсов вручную с помощью MakePri.exe](compile-resources-manually-with-makepri.md)