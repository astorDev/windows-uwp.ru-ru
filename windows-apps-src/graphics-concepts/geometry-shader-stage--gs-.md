---
title: Этап шейдера геометрии (GS)
description: 'Этап шейдера геометрии (GS) обрабатывает целые примитивы: треугольники, линии и точки, а также смежные с ними вершины.'
ms.assetid: 8A1350DD-B006-488F-9DAF-14CD2483BA4E
keywords:
- Этап шейдера геометрии (GS)
ms.date: 02/08/2017
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: 0ea3e7ec73b042eeef560af3d88754afdfa5b441
ms.sourcegitcommit: ac7f3422f8d83618f9b6b5615a37f8e5c115b3c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2019
ms.locfileid: "66370462"
---
# <a name="geometry-shader-gs-stage"></a>Этап шейдера геометрии (GS)


Этап шейдера геометрии (GS) обрабатывает целые примитивы: треугольники, линии и точки, а также смежные с ними вершины. Он полезен для таких алгоритмов, как расширение спрайтов точек, динамические системы частиц и создание объемных теней. Он поддерживает усложнение и упрощение геометрии.

## <a name="span-idpurposeandusesspanspan-idpurposeandusesspanspan-idpurposeandusesspanpurpose-and-uses"></a><span id="Purpose_and_uses"></span><span id="purpose_and_uses"></span><span id="PURPOSE_AND_USES"></span>Назначения и использования


Этап шейдера геометрии (GS) обрабатывает целые примитивы: треугольники (три вершины и до трех смежных вершин), линии (две вершины и до двух смежных вершин) и точки (одна вершина).

![иллюстрация треугольника и линии со смежными вершинами](images/d3d10-gs.png)

Шейдер геометрии также поддерживает ограниченное усложнение и упрощение геометрии. При наличии входного примитива шейдер геометрии может удалить его или сгенерировать один или несколько новых примитивов.

Этап шейдера геометрии (GS) представляет собой этап программируемого шейдера; на схеме [графического конвейера](graphics-pipeline.md) он показан в виде блока с закругленными углами. На этом этапе шейдер предоставляет собственные уникальные функции, основанные на моделях шейдеров (см. [общее ядро шейдера](https://docs.microsoft.com/windows/desktop/direct3dhlsl/dx-graphics-hlsl-common-core)).

Этап шейдера геометрии хорошо подходит для алгоритмов, включая следующие:

-   расширение спрайтов точек;
-   динамические системы частиц;
-   Создание меха/"плавников"
-   Создание объемных теней
-   Однопроходная отрисовка с использованием кубической карты
-   Замена материалов по примитивам
-   Настройка материалов по примитивам. Эта возможность включает создание барицентрических координат как данных примитива, чтобы построитель текстуры мог выполнить настраиваемую интерполяцию атрибутов.

## <a name="span-idinputspanspan-idinputspanspan-idinputspaninput"></a><span id="Input"></span><span id="input"></span><span id="INPUT"></span>Входные данные


Этап шейдера геометрии выполняет указанный приложением код шейдера, используя в качестве входных данных целые примитивы и позволяя создавать вершины в качестве выходных данных. В отличие от шейдеров вершин, работающих с одной вершиной, входными данными шейдера геометрии являются вершины полного примитива (три вершины для треугольников, две вершины для линий или одна вершина для точек). В качестве входных данных шейдеры геометрии также могут использовать данные вершин примитивов со смежными гранями (дополнительно три вершины для треугольника и две вершины для линии).

Этап шейдеров геометрии может использовать **SV\_PrimitiveID** системным значением, который создан с помощью [стадии ассемблера входных данных (IA)](input-assembler-stage--ia-.md). Это позволяет при необходимости получать или вычислять данные каждого примитива.

Если шейдер геометрии активен, он вызывается единожды для каждого примитива, переданного или созданного ранее в рамках конвейера. При каждом вызове шейдер геометрии считает входными данные вызвавшего его примитива, будь то одна точка, одна линия или один треугольник. Полоса треугольника с более раннего этапа конвейера привела бы к вызову шейдера геометрии для каждого отдельного треугольника в полосе (как если бы полоса была развернута в список треугольников). Доступны все входные данные для каждой вершины отдельного примитива (то есть три вершины для треугольника), а также данные смежных вершин, если они требуются и доступны.

Общие сокращения вершин:

|     |                 |
|-----|-----------------|
| TV  | Вершина треугольника |
| LV  | Вершина линии     |
| AV  | Смежная вершина |

 

## <a name="span-idoutputspanspan-idoutputspanspan-idoutputspanoutput"></a><span id="Output"></span><span id="output"></span><span id="OUTPUT"></span>Выходные данные


Этап шейдера геометрии может выводить несколько вершин, формирующих единую выбранную топологию. Доступны следующие выходные топологии шейдера геометрии: **tristrip**, **linestrip** и **pointlist**. Количество сгенерированных примитивов может свободно меняться при каждом вызове шейдера геометрии, но максимальное количество генерируемых вершин необходимо объявить статически. Длины полос, сгенерированных в результате вызова шейдера геометрии, могут быть произвольными, а новые полосы можно создавать с помощью функции HLSL [RestartStrip](https://docs.microsoft.com/windows/desktop/direct3dhlsl/dx-graphics-hlsl-so-restartstrip).

Выполнение экземпляра шейдера геометрии атомарно относительно других вызовов с тем исключением, что добавляемые в потоки данные последовательны. Выходные данные отдельного вызова шейдера геометрии независимы от других вызовов (хотя порядок учитывается). Шейдер геометрии, создающий полосы треугольников, при каждом вызове будет создавать новую полосу.

Выходные данные шейдера геометрии можно передавать на этап растеризации или в буфер вершин в памяти через этап потокового вывода. Выходные данные, переданные в память, разворачиваются в отдельные списки точек, линий или треугольников (в точности так, как они были бы переданы средству отрисовки).

Шейдер геометрии выводит данные по одной вершине путем добавления вершин к объекту потокового вывода. Топология потоков определяется фиксированным объявлением с выбором **TriangleStream**, **LineStream** и **PointStream** в качестве выходных данных для этапа шейдера геометрии.

Существует три типа объектов потока: **TriangleStream**, **LineStream** и **PointStream**, — все шаблонного объекты. Топология выходных данных определяется их соответствующим типом объекта, а формат вершин, добавленных к потоку, определяется типом шаблона.

Когда выходные данные шейдеров геометрии определяется как значение интерпретируется системы (например, **SV\_RenderTargetArrayIndex** или **SV\_позиции**), оборудование рассматривает эти данные и выполняет некоторое поведение в зависимости от значения, кроме того, что было передавать сами данные на следующий этап шейдера для входных данных. Когда такие выходные данные шейдера геометрии имеет значение для оборудования на основе примитивов (таких как **SV\_RenderTargetArrayIndex** или **SV\_ViewportArrayIndex**), а не на основе отдельных вершин (такие как **SV\_ClipDistance\[n\]**  или **SV\_позиции**), данные примитивов берутся из ведущих вершин, созданный для примитива.

Шейдер геометрии может создать частично завершенные примитивы, если работа шейдера геометрии завершена, а примитив остался неполным. Неполные примитивы удаляются без уведомления. Аналогичным образом обращается с частично завершенными примитивами сборщик входных данных.

шейдер геометрии может выполнять операции загрузки и выборки, для которых не требуются производные пространства экрана (**samplelevel**, **samplecmplevelzero**, **samplegrad**).

## <a name="span-idrelated-topicsspanrelated-topics"></a><span id="related-topics"></span>Связанные разделы


[Графический конвейер](graphics-pipeline.md)

 

 




