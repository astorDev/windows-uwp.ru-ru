---
title: Правила с плавающей запятой
description: Direct3D поддерживает несколько представлений с плавающей запятой. Все вычисления с плавающей запятой выполняются согласно определенному набору правил для формата 32-разрядных чисел одинарной точности с плавающей запятой по стандарту IEEE 754.
ms.assetid: 3B0C95E2-1025-4F70-BF14-EBFF2BB53AFF
keywords:
- Правила с плавающей запятой
author: michaelfromredmond
ms.author: mithom
ms.date: 02/08/2017
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: bcfdb8f6258547ff210d80136a6113e04092aad2
ms.sourcegitcommit: 71e8eae5c077a7740e5606298951bb78fc42b22c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2018
ms.locfileid: "6662570"
---
# <a name="span-iddirect3dconceptsfloating-pointrulesspanfloating-point-rules"></a><span id="direct3dconcepts.floating-point_rules"></span>Правила с плавающей запятой


Direct3D поддерживает несколько представлений с плавающей запятой. Все вычисления с плавающей запятой выполняются согласно определенному набору правил для формата 32-разрядных чисел одинарной точности с плавающей запятой по стандарту IEEE 754.

## <a name="span-idalpha32bitspanspan-idalpha32bitspan32-bit-floating-point-rules"></a><span id="alpha_32_bit"></span><span id="ALPHA_32_BIT"></span>32-разрядные правила с плавающей запятой


Существует два набора правил: тех, что соответствуют стандарту IEEE-754, и тех, что отклоняются от него.

### <a name="span-idalpha754rulesspanspan-idalpha754rulesspanspan-idalpha754rulesspanhonored-ieee-754-rules"></a><span id="alpha_754_Rules"></span><span id="alpha_754_rules"></span><span id="ALPHA_754_RULES"></span>Соблюдаемые правила IEEE-754

Некоторые из этих правил безальтернативны, если стандарт IEEE-754 предоставляет несколько вариантов.

-   При делении на ноль получается положительное или отрицательное бесконечное число, за исключением деления нуля на ноль, в результате которого получается не число.
-   Результатом логарифма положительного или отрицательного нуля является отрицательное бесконечное число.  

    Результатом логарифма отрицательного значения (отличного от отрицательного нуля) является не число.
-   Результатом извлечения обратного квадратного корня (rsq) или квадратного корня (sqrt) из отрицательного числа является не число.  

    Исключение— отрицательный ноль; результатом sqrt(-0) является -0, а результатом rsq(-0)— отрицательное бесконечное число.
-   Разностью двух бесконечных чисел является не число.
-   Отношением между положительным или отрицательным бесконечным числом и вторым таким же числом является не число.
-   Произведением положительного или отрицательного бесконечного числа на ноль является не число.
-   Результатом любой операции между не числом и любым значением является не число.
-   Сравнения EQ, GT, GE, LT и LE, в которых один или оба операнда являются не числами, возвращают **FALSE**.
-   В сравнениях знак нуля игнорируется (то есть положительный ноль равен отрицательному).
-   Сравнение NE, в котором один или оба операнда являются не числами, возвращает **TRUE**.
-   Сравнение любого значения, не являющегося не числом, с положительным или отрицательным бесконечным числом возвращает верный результат.

### <a name="span-idalpha754deviationsspanspan-idalpha754deviationsspanspan-idalpha754deviationsspandeviations-or-additional-requirements-from-ieee-754-rules"></a><span id="alpha_754_Deviations"></span><span id="alpha_754_deviations"></span><span id="ALPHA_754_DEVIATIONS"></span>Отклонения или дополнительные требования правил IEEE-754

-   По условиям стандарта IEEE-754, результатом операций с плавающей точкой должно быть представляемое значение, ближайшее к бесконечно точному результату, известное как округление к ближайшему четному числу.

    Direct3D 11 и более поздние версии определяют то же требования, что и в стандарте IEEE-754: 32-разрядные операции с плавающей точкой выдают результат в пределах 0,5 единицы наименьшей точности (ULP) от бесконечно точного результата. Это означает, что, например, оборудованию позволено усекать результаты до 32-разрядного формата, вместо того чтобы округлять их к ближайшему четному числу, так как это привело бы к ошибке в пределах 0,5 ULP. Это правило применяется только к сложению, вычитанию и умножению.

    Более ранние версии Direct3D определяют менее строгое требование, чем в стандарте IEEE-754: 32-разрядные операции с плавающей точкой выдают результат в пределах одной единицы наименьшей точности (1 ULP) от бесконечно точного результата. Это означает, что, например, оборудованию позволено усекать результаты до 32-разрядного формата, вместо того чтобы округлять их к ближайшему четному числу, так как это привело бы к ошибке в пределах одной ULP.

-   Исключения, биты состояния и ловушки с плавающей точкой не поддерживаются.
-   Денормализованные числа приводятся к нулю с сохранением знака при вводе и выводе любой математической операции с плавающей точкой. Исключения делаются для любой операции ввода-вывода или перемещения данных, которая не изменяет данные.
-   Состояния, содержащие значения с плавающей точкой, например значения Viewport MinDepth/MaxDepth или BorderColor, могут предоставляться как денормализованные значения, а также могут сбрасываться, прежде чем их использует оборудование.
-   Операции минимизации или максимизации сбрасывают денормализованные числа для сравнения, но результат в виде денормализованного числа может не быть сброшен.
-   Если входными данными для операции является не число, выходными данными обязательно будет не число. Но точный битовый шаблон не числа не обязательно должен оставаться неизменным (если только выполняемая операция не является инструкцией перемещения необработанных данных, при которой данные не изменяются.)
-   Операции минимизации или максимизации, в которых только один операнд является не числом, возвращают другой операнд в качестве результата (вопреки рассмотренным ранее правилам сравнения). Это правило IEEE 754R.

    Согласно спецификации IEEE-754R для операций минимизации и максимизации с плавающей точкой, если одна из частей входных данных для минимизации или максимизации является значением в виде несигнального не числа (QNaN), результатом операции будет второй параметр. Пример.

    ```ManagedCPlusPlus
    min(x,QNaN) == min(QNaN,x) == x (same for max)
    ```

    В одной из редакций спецификации IEEE-754R было принято другое поведение для минимального и максимального значений, если одна часть входных данных является значением в виде "сигнального" не числа (SNaN), а вторая— значением QNaN.

    ```ManagedCPlusPlus
    min(x,SNaN) == min(SNaN,x) == QNaN (same for max)
     
    ```

    Как правило, Direct3D следует стандартам арифметических действий: IEEE-754 и IEEE-754R. Но в этом случае происходит отклонение.

    Арифметические правила в Direct3D 10 и более поздних версиях не проводят различия между значениями в виде несигнальных и сигнальных не чисел (QNaN и SNaN). Все значения в виде не чисел обрабатываются одинаково. В случае с минимизацией и максимизацией поведение Direct3D относительно любого значения в виде не числа аналогично обработке QNaN по определению IEEE-754R. (Для полноты: если обе части входных данных являются не числами, возвращается любое значение в виде не числа.)

-   Еще одно правило IEEE 754R таково: min(-0,+0) == min(+0,-0) == -0, а max(-0,+0) == max(+0,-0) == +0. При этом учитывается знак, в отличие от правил сравнения для нуля со знаком (как было указано ранее). В этом случае Direct3D рекомендует поведение в соответствии с IEEE 754R, но это необязательно. Результат сравнения нулей может зависеть от порядка параметров при использовании сравнения, в котором игнорируются знаки.
-   x\*1,0f всегда выдает x (за исключением сброса к денормализованному числу).
-   x/1,0f всегда выдает x (за исключением сброса к денормализованному числу).
-   x+/-0,0f всегда выдает x (за исключением сброса к денормализованному числу). Но -0 + 0 = +0.
-   Совмещенные операции (например, mad, dp3) выдают не менее точные результаты, чем худшее возможное последовательное упорядочение вычисления несовмещенного расширения операции. Определение худшего возможного упорядочения, в целях допуска, не является фиксированным определением для данной совмещенной операции. Оно зависит от конкретных значений входных данных. Для каждого отдельного этапа несовмещенного расширения разрешен допуск в 1 ULP (для любых инструкций, вызываемых Direct3D с допуском больше 1 ULP, разрешен больший допуск).
-   Совмещенные операции следуют тем же правилам относительно не чисел, что и несовмещенные операции.
-   Допуск для sqrt и rcp составляет 1 ULP. Для инструкций обратного числа шейдера и обратного квадратного корня, [**rcp**](https://msdn.microsoft.com/library/windows/desktop/hh447205) и [**rsq**](https://msdn.microsoft.com/library/windows/desktop/hh447221), действует особое требование со сниженной точностью.
-   Умножение и деление выполняются на 32-разрядном уровне точности с плавающей точкой (точность до 0,5 ULP при умножении, 1 ULP при получении обратного числа). При прямой реализации x/y точность результатов должна быть выше, чем при двухшаговом методе, или идентична ему.

## <a name="span-iddoubleprec64bitspanspan-iddoubleprec64bitspan64-bit-double-precision-floating-point-rules"></a><span id="double_prec_64_bit"></span><span id="DOUBLE_PREC_64_BIT"></span>64-разрядные правила с плавающей точкой (двойной точности)


Драйверы оборудования и дисплея могут поддерживать операции с плавающей точкой двойной точности. Для указания такой поддержки при вызове [**ID3D11Device::CheckFeatureSupport**](https://msdn.microsoft.com/library/windows/desktop/ff476497) с [**D3D11\_FEATURE\_DOUBLES**](https://msdn.microsoft.com/library/windows/desktop/ff476124#d3d11-feature-doubles) драйвер устанавливает свойству **DoublePrecisionFloatShaderOps** структуры [**D3D11\_FEATURE\_DATA\_DOUBLES**](https://msdn.microsoft.com/library/windows/desktop/ff476127) значение TRUE. В этом случае драйвер и оборудование должны поддерживать все инструкции с плавающей точкой двойной точности.

Инструкции двойной точности соответствуют требованиям к поведению IEEE 754R.

Для данных двойной точности (без сброса до нуля) требуется поддержка генерирования денормализованных значений. Подобным образом, инструкции не считывают денормализованные данные как ноль со знаком, а учитывают денормализованное значение.

## <a name="span-idalpha16bitspanspan-idalpha16bitspan16-bit-floating-point-rules"></a><span id="alpha_16_bit"></span><span id="ALPHA_16_BIT"></span>16-разрядные правила с плавающей запятой


Direct3D также поддерживает 16-разрядные представления чисел с плавающей точкой.

Формат:

-   1 бит знака (s) в положении старшего разряда;
-   5 битов смещенного порядка (e);
-   10 дробных битов (f) с дополнительным скрытым битом.

Значение float16 (v) соответствует следующим правилам:

-   если e == 31 и f != 0, то v— не число независимо от s;
-   если e == 31 и f == 0, то v = (-1)s\*бесконечность (бесконечность со знаком)
-   если e находится в диапазоне от 0 до 31, то v = (-1)s\*2(e-15)\*(1.f)
-   если e == 0 и f != 0, то v = (-1)s\*2(e-14)\*(0.f) (денормализованные числа)
-   если e == 0 и f == 0, то v = (-1)s\*0 (ноль со знаком)

32-разрядные правила с плавающей точкой также действуют для 16-разрядных чисел с плавающей точкой с корректировкой для описанной ранее структуры битов. Но есть следующие исключения:

-   Точность. Несовмещенные операции над 16-разрядными числами с плавающей точкой выдают результат в виде представляемого значения, ближайшего к бесконечно точному результату (согласно IEEE-754, округление к ближайшему четному числу применяется к 16-разрядным значениям). 32-разрядные правила с плавающей точкой придерживаются допуска в 1 ULP, 16-разрядные правила с плавающей точкой придерживаются допуска в 0,5 ULP для несовмещенных операций и 0,6 ULP для совмещенных операций.
-   16-разрядные числа с плавающей тачкой сохраняют денормализованные значения.

## <a name="span-idalpha11bitspanspan-idalpha11bitspan11-bit-and-10-bit-floating-point-rules"></a><span id="alpha_11_bit"></span><span id="ALPHA_11_BIT"></span>11-разрядные и 10-разрядные правила с плавающей точкой


Direct3D также поддерживает 11-разрядные 10-разрядные форматы с плавающей точкой.

Формат:

-   бит знака отсутствует;
-   5 битов смещенного порядка (e);
-   6 дробных битов (f) в 11-разрядном формате, 5 дробных битов (f) в 10-разрядном формате с дополнительным скрытом битом в обоих случаях.

Значение float11/float10 (v) соответствует следующим правилам:

-   если e == 31 и f != 0, то v— не число;
-   если e == 31 и f == 0, то v = положительная бесконечность
-   если e находится в диапазоне от 0 до 31, то v = 2(e-15)\*(1.f)
-   если e == 0 и f != 0, то v = \*2(e-14)\*(0.f) (денормализованные числа)
-   если e == 0 и f == 0, то v = 0 (ноль)

32-разрядные правила с плавающей точкой также действуют для 11-разрядных и 10-разрядных чисел с плавающей точкой с корректировкой для описанной ранее структуры битов. Есть исключения:

-   Точность. 32-разрядные правила с плавающей точкой придерживаются допуска в 0,5 ULP.
-   10/11-разрядные числа с плавающей тачкой сохраняют денормализованные значения.
-   Любая операция, в результате которой получается число меньше нуля, прикрепляется к нулю.

## <a name="span-idrelated-topicsspanrelated-topics"></a><span id="related-topics"></span>Статьи по теме


[Приложения](appendix.md)

[Ресурсы](https://msdn.microsoft.com/library/windows/desktop/ff476894)

[Текстуры](https://msdn.microsoft.com/library/windows/desktop/ff476902)

 

 




