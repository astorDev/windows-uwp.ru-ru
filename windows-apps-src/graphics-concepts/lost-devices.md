---
title: Потерянные устройства
description: Устройство Direct3D может быть в рабочем состоянии или потерянном состоянии.
ms.assetid: 1639CC02-8000-4208-AA95-91C1F0A3B08D
keywords:
- Потерянные устройства
author: michaelfromredmond
ms.author: mithom
ms.date: 02/08/2017
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: 92dc9437dc2417b8f3da99df7cd6d6eb0c8edd1b
ms.sourcegitcommit: e38b334edb82bf2b1474ba686990f4299b8f59c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2018
ms.locfileid: "6851485"
---
# <a name="lost-devices"></a>Потерянные устройства


Устройство Direct3D может быть в рабочем состоянии или потерянном состоянии. *Рабочее* — это обычное состояние устройства, в котором устройство запускается и отображает все отрисованные элементы, как ожидается. Устройство выполняет переход в состояние *потеряно*, когда некоторое событие, например потеря фокуса клавиатуры в приложении в полноэкранном режиме, приводит к невозможности отрисовки. Потерянное состояние характеризуется незаметным сбоем всех операций отрисовки; это означает, что методы отрисовки могут возвращать коды успешного завершения, даже если операции отрисовки завершились сбоем.

Согласно изначальному замыслу исчерпывающий набор сценариев, в которых устройство может перейти в потерянное состояние, не определен. В число самых распространенных примеров входит потеря фокуса, например при нажатии пользователем клавиш ALT+TAB или при инициализации диалогового окна системы. Устройства также могут быть потеряны из-за события управления питанием, или когда другое приложение пытается выполнить операцию в полноэкранном режиме. Кроме того, любой сбой при сбросе устройства переводит устройство в потерянное состояние.

Все методы, которые являются производными от [**IUnknown**](https://msdn.microsoft.com/library/windows/desktop/ms680509), гарантированно будут работать после потери устройства. После потери устройства каждая функция обычно имеет следующие три варианта действий.

-   Сбой с ошибкой «потеря устройства». Это означает, что приложение должно распознать потерю устройства, чтобы определить, что какие-то операции происходят не так, как ожидалось.
-   Тихий сбой с возвращением S\_OK или любого другого кода. Если происходит тихий сбой функции, приложение обычно не может различить результаты «успех» и «тихий сбой».
-   Возврат определенного кода.

## <a name="span-idrespondingtoalostdevicespanspan-idrespondingtoalostdevicespanspan-idrespondingtoalostdevicespanresponding-to-a-lost-device"></a><span id="Responding_to_a_Lost_Device"></span><span id="responding_to_a_lost_device"></span><span id="RESPONDING_TO_A_LOST_DEVICE"></span>Реакция на потерю устройства


Потеря устройства должна привести к повторному созданию ресурсов (включая ресурсы видеопамяти) после его сброса. Если устройство потеряно, приложение отправляет запрос устройству, чтобы определить, можно ли восстановить его рабочее состояние. Если это невозможно, приложение ожидает, пока устройство не сможет быть восстановлено.

Если устройство можно восстановить, приложение подготавливает устройство путем уничтожения всех ресурсов видеопамяти и цепочек буферов. Сброс является единственной действенной процедурой при потере устройства, и это единственный способ, которым приложение можно перевести устройство из потерянного в рабочее состояние. Сброс завершится сбоем, если приложение не освободит все выделенные ресурсы, включая целевые объекты отрисовки и поверхности глубины трафарета.

В большинстве случаев при высокой частоте вызовов Direct3D не возвращается никакой информации о том, было ли устройство потеряно. Приложение может продолжить вызывать методы отрисовки, не получая уведомлений о потере устройства. Внутри системы эти операции отменяются, пока устройство не вернется в рабочее состояние.

## <a name="span-idlockingoperationsspanspan-idlockingoperationsspanspan-idlockingoperationsspanlocking-operations"></a><span id="Locking_Operations"></span><span id="locking_operations"></span><span id="LOCKING_OPERATIONS"></span>Операции блокировки


Внутри системы Direct3D выполняет достаточный объем работы, чтобы гарантировать успешное завершение операции блокировки после потери устройства. Однако не гарантируется, что данные ресурсов видеопамяти будут точными во время операции блокировки. Гарантируется, что не произойдет возврата никакого кода ошибки. Это позволяет писать приложения, не беспокоясь о потере устройства во время операции блокировки.

## <a name="span-idresourcesspanspan-idresourcesspanspan-idresourcesspanresources"></a><span id="Resources"></span><span id="resources"></span><span id="RESOURCES"></span>Ресурсы


Ресурсы могут потреблять видеопамять. Поскольку потерянное устройство отключается от видеопамяти, принадлежащей адаптеру, невозможно гарантировать выделение видеопамяти при потере устройства. В результате реализуются все методы создания ресурсов с целью успешного выполнения, но на самом деле выделяется только фиктивная системная память. Поскольку ресурсы видеопамяти должны быть уничтожены перед изменением размера устройства, проблема избыточного выделения видеопамяти не возникает. Эти фиктивные поверхности создают видимость нормального функционирования операций блокировки и копирования, пока приложение не обнаружит, что устройство потеряно.

Перед переводом устройства из потерянного состояния в рабочее вся видеопамять должна быть освобождена. Другие данные о состоянии автоматически удаляются при переходе в рабочее состояние.

Рекомендуется разрабатывать приложения с одним программным путем для реагирования на потерю устройства. Этот программный путь может быть аналогичен, если не идентичен, программному пути, который используется для инициализации устройства при запуске.

## <a name="span-idretrieveddataspanspan-idretrieveddataspanspan-idretrieveddataspanretrieved-data"></a><span id="Retrieved_Data"></span><span id="retrieved_data"></span><span id="RETRIEVED_DATA"></span>Извлеченные данные


Direct3D позволяет приложениям проверять текстуры и состояния отрисовки по одноэтапной отрисовке оборудованием.

Direct3D также позволяет приложениям копировать сгенерированные или ранее записанные изображения из ресурсов видеопамяти в ресурсы энергонезависимой памяти системы. Так как исходные изображения в таких операциях передачи могут быть потеряны в любое время, Direct3D позволяет таким операциям копирования завершаться сбоем, если устройство потеряно.

Операции копирования могут завершаться сбоем, поскольку при потере устройства нет первичной поверхности. Создание цепочки буферов также может завершаться ошибкой, поскольку при потере устройства невозможно создать обратный буфер.

## <a name="span-idrelated-topicsspanrelated-topics"></a><span id="related-topics"></span>Статьи по теме


[Устройства](devices.md)

 

 




