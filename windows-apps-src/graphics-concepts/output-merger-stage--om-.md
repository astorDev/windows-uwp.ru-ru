---
title: Этап слияния и вывода (OM)
description: На этапе слияния вывода выходные данные различных типов (значения пиксельного шейдера, информация о глубине и наборе элементов) объединяются с содержимым целевого объекта отрисовки и буферов глубины и набора элементов для создания окончательного результата конвейера.
ms.assetid: ED2DC4A0-2B92-47AF-884A-BFC2183C78B8
keywords:
- Этап слияния и вывода (OM)
author: michaelfromredmond
ms.author: mithom
ms.date: 02/08/2017
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: a4e2bbac12ddd3b60b2e4dd78f37b8934a8afea8
ms.sourcegitcommit: 93c0a60cf531c7d9fe7b00e7cf78df86906f9d6e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2018
ms.locfileid: "7555739"
---
# <a name="output-merger-om-stage"></a>Этап слияния и вывода (OM)


На этапе слияния вывода выходные данные различных типов (значения пиксельного шейдера, информация о глубине и наборе элементов) объединяются с содержимым целевого объекта отрисовки и буферов глубины и набора элементов для создания окончательного результата конвейера.

## <a name="span-idpurpose-and-usesspanspan-idpurpose-and-usesspanspan-idpurpose-and-usesspanpurpose-and-uses"></a><span id="Purpose-and-uses"></span><span id="purpose-and-uses"></span><span id="PURPOSE-AND-USES"></span>Назначение и способы использования


Этап слияния и вывода (OM) — это последняя стадия определения видимых пикселей (с проверкой трафарета глубины) и смешиванием окончательных цветов пикселей.

На этапе OM окончательный цвет пикселей формируется с использованием комбинации следующих элементов:

-   состояния конвейера;
-   данные пикселей, созданные пиксельными шейдерами;
-   содержимое целевых объектов отрисовки;
-   содержимое буферов трафарета глубины.

### <a name="span-idblending-overviewspanspan-idblending-overviewspanspan-idblending-overviewspanblending-overview"></a><span id="Blending-overview"></span><span id="blending-overview"></span><span id="BLENDING-OVERVIEW"></span>Обзор смешения

Во время смешения одно или несколько значений пикселей объединяются для получения окончательного цвета. На следующей схеме показан процесс смешения пиксельных данных.

![схема работы смешения данных](images/d3d10-blend-state.png)

Концептуально эту схема применяется на этапе слияния и вывода дважды: в первый раз смешиваются данные RGB, а параллельно смешиваются данные альфа-канала. Сведения об использования API для создания и настройки состояния смешения см. в разделе [Настройка смешения](https://msdn.microsoft.com/library/windows/desktop/bb205072).

Смешение с фиксированной функцией можно включить независимо для каждого целевого объекта отрисовки. Однако существует только один набор элементов управления смешением, поэтому одно смешение применяется ко всем целевым объектам отрисовки, если смешение включено. Значения смешения (в том числе BlendFactor) всегда ужимаются до диапазона формат целевого объекта отрисовки перед смешением. Преобразование выполняется на одном целевом объекте отрисовки с учетом типа объекта. Единственное исключение — форматы float16, float11 и float10, которые не ужимаются таким образом, чтобы операции смешения можно было выполнить с такой же точностью или диапазоном, как у формата вывода. Не числа (NaN) и нули со знаком распространяются во всех случаях (в том числе для весов 0,0).

При использовании целевых объектов отрисовки sRGB среда выполнения преобразует цвет объекта в линейное пространство перед смешением. Среда выполнения преобразует окончательное значение в пространство sRGB перед его сохранением в целевом объекте прорисовки.

### <a name="span-iddual-source-color-blendingspanspan-iddual-source-color-blendingspanspan-iddual-source-color-blendingspandual-source-color-blending"></a><span id="Dual-source-color-blending"></span><span id="dual-source-color-blending"></span><span id="DUAL-SOURCE-COLOR-BLENDING"></span>Смешение цветов с двумя источниками

Эта функция позволяет этапу слияния и вывода одновременно использовать оба выхода пиксельного шейдера (о0 и o1) как входные данные для операции смешения с одним целевым объектом отрисовки в слоте 0. К допустимым операциям смешения относятся добавление, вычитание и revsubtract. Уравнение смешения и маска записи выходных данных определяют, какие компоненты выводит пиксельный шейдер. Дополнительные компоненты игнорируются.

Запись в другие выходы пиксельного шейдера (o2, o3 и т. д.) не определена. Невозможно записать данные в целевой объект прорисовки, если он не привязан к слоту 0. Запись oDepth во время смешения цветов с двумя источниками допускается.

### <a name="span-iddepth-stencil-testspanspan-iddepth-stencil-testspanspan-iddepth-stencil-testspandepth-stencil-testing-overview"></a><span id="Depth-Stencil-Test"></span><span id="depth-stencil-test"></span><span id="DEPTH-STENCIL-TEST"></span>Обзор тестирования трафарета глубины

Буфер трафарета глубины, который создается как ресурс текстуры, может содержать данные глубины и трафарета. Данные глубины позволяет определить, какие пиксели размещены ближе всего к камере, а данные трафарета используются для маскировки пикселей, которые можно обновить. В конечном счете все эти значения применяются на этапе слияния и вывода, чтобы определить, рисуется ли пиксель. На следующей схеме показаны схематический процесс тестирования трафарета глубины.

![схема работы тестирования трафарета глубины](images/d3d10-depth-stencil-test.png)

Сведения о настройке тестирования трафарета глубины см. в разделе [Настройка функции трафарета глубины](configuring-depth-stencil-functionality.md). В объекте трафарета глубины инкапсулируется состояние трафарета глубины. Приложение может указать состояние трафарета глубины, или же на этапе OM будут использоваться значения по умолчанию. Если множественная дискретизация отключена, операции смешения выполняются отдельно для каждого пикселя. Если множественная дискретизация включена, смешение происходит отдельно для каждого объекта мультисэмплинга.

Процесс использования буфера глубины для определения рисуемых пикселей называется буферизацией глубины или z-буферизацией.

Когда значения глубины достигают этапа слияния и вывода (после интерполяции или применения пиксельного шейдера), они всегда ужимаются: z = min(Viewport.MaxDepth,max(Viewport.MinDepth,z)) (в соответствии с форматом или точностью буфера глубины с использованием правил с плавающей запятой). После преобразования значение глубины сравнивается (с помощью DepthFunc) от существующим значением буфера глубины. Если ни один буфер глубины не привязан, тест глубины всегда будет пройден.

Если компонент трафарета в формате буфера глубины или привязанный буфер глубины не существуют, тест трафарета всегда будет пройден.

Только один буфер глубины трафарета может быть активен в заданный момент времени. Все связанные ресурсов должны соответствовать (по размеру и габаритам) представление глубины трафарета. Это не означает, что размер ресурса должен совпадать — совпадать должен только размер представления.

### <a name="span-idsample-maskspanspan-idsample-maskspanspan-idsample-maskspansample-mask-overview"></a><span id="Sample-Mask"></span><span id="sample-mask"></span><span id="SAMPLE-MASK"></span>Обзор маски дискретизации

Маска дискретизации — это 32-разрядная маска покрытия, которая определяет какие образцы обновляются в активных целевых объектах прорисовки. Допускается только одна маска дискретизации. Сопоставление разрядов маски дискретизации с образцами в ресурсе определяется пользователем. Для отрисовки с n-дискретизацией используются первые n разрядов (от LSB) маски дискретизации (максимальное количество разрядов — 32).

## <a name="span-idinputspanspan-idinputspanspan-idinputspaninput"></a><span id="Input"></span><span id="input"></span><span id="INPUT"></span>Входные данные


На этапе слияния и вывода (OM) окончательный цвет пикселей формируется с использованием комбинации следующих элементов:

-   состояния конвейера;
-   данные пикселей, созданные пиксельными шейдерами;
-   содержимое целевых объектов отрисовки;
-   содержимое буферов трафарета глубины.

## <a name="span-idoutputspanspan-idoutputspanspan-idoutputspanoutput"></a><span id="Output"></span><span id="output"></span><span id="OUTPUT"></span>Выходные данные


### <a name="span-idoutput-write-mask-overviewspanspan-idoutput-write-mask-overviewspanspan-idoutput-write-mask-overviewspanoutput-write-mask-overview"></a><span id="Output-write-mask-overview"></span><span id="output-write-mask-overview"></span><span id="OUTPUT-WRITE-MASK-OVERVIEW"></span>Обзор маски записи выходных данных

Маска записи выходных данных используется для управления тем, какие данные можно записать в целевой объекте прорисовки для каждого компонента.

### <a name="span-idmultiple-render-targets-overviewspanspan-idmultiple-render-targets-overviewspanspan-idmultiple-render-targets-overviewspanmultiple-render-targets-overview"></a><span id="Multiple-render-targets-overview"></span><span id="multiple-render-targets-overview"></span><span id="MULTIPLE-RENDER-TARGETS-OVERVIEW"></span>Обзор множества целевых объектов отрисовки

Пиксельный шейдер можно использовать для отображения как минимум восьми отдельных целевых объектов отрисовки, все которые должны быть одного типа (буфер, Texture1D, Texture1DArray и т. д.). Кроме того, все целевые объекты отрисовки должны быть одного размера по всем измерениям (ширина, высота, глубина, размер массива, число выборок). У каждого целевого объекта отрисовки может быть разный формат данных.

Вы можете использовать любое сочетание слотов целевых объектов отрисовки (до восьми). Однако представление ресурса невозможно привязать к нескольким слотам целевых объектов отрисовки одновременно. Представление можно использовать повторно, если ресурсы не применяются одновременно.

## <a name="span-idin-this-sectionspanin-this-section"></a><span id="in-this-section"></span>В этом разделе


<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Статья</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><a href="configuring-depth-stencil-functionality.md">Настройка функции трафарета глубины</a></p></td>
<td align="left"><p>В этом разделе рассматривается настройка буфера трафарета глубины и состояния трафарета глубины для этапа слияния и вывода.</p></td>
</tr>
</tbody>
</table>

 

## <a name="span-idrelated-topicsspanrelated-topics"></a><span id="related-topics"></span>Статьи по теме


[Графический конвейер](graphics-pipeline.md)

 

 




