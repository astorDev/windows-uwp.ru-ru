---
title: Правила растеризации
description: Правила растеризации определяют, как векторные данные сопоставляются с растровыми.
ms.assetid: B604725F-96A5-4DB6-B597-9EC57FBBC024
keywords:
- Правила растеризации
author: michaelfromredmond
ms.author: mithom
ms.date: 02/08/2017
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: 72be66c3bf7b0e58092ae3a7e1baf82c9e686f0c
ms.sourcegitcommit: bdc40b08cbcd46fc379feeda3c63204290e055af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2018
ms.locfileid: "6154376"
---
# <a name="rasterization-rules"></a>Правила растеризации


Правила растеризации определяют, как векторные данные сопоставляются с растровыми. Растровые данные связываются с целочисленными расположениями, которые затем отбираются и вырезаются (для рисования минимального числа пикселей), и с пиксельными атрибутами, которые интерполируются (на основе атрибутов вершин) после передачи пиксельному шейдеру.

Существует несколько типов правил, которые зависят от типа сопоставляемого примитива, а также от того, используют ли данные множественную дискретизацию, чтобы уменьшить искажения. На следующих рисунках показана обработка углов.

## <a name="span-idtrianglespanspan-idtrianglespanspan-idtrianglespantriangle-rasterization-rules-without-multisampling"></a><span id="Triangle"></span><span id="triangle"></span><span id="TRIANGLE"></span>Правила растеризации треугольника (без множественной дискретизации)


Любой центр пикселя, который находится внутри треугольника, рисуется; пиксель считается расположенным внутри, если он соответствует правилу "верхнего левого". Правило "верхнего левого" заключается в том, что центр пикселя считается размещенным внутри треугольника, если он располагается на верхней или левой стороне треугольника.

Где:

-   верхняя сторона — это сторона, которая размещено строго по горизонтали и выше других сторон;
-   левая сторона — это сторона, которая расположена не строго по горизонтали в левой части треугольника (у треугольника может быть одна или две левые стороны).

Правило "верхнего левого" гарантирует, что смежные треугольники рисуются один раз.

На этом рисунке показаны примеры пикселей, которые рисуются, так как они размещены внутри треугольника или соответствуют правилу "верхнего левого".

![примеры растеризации треугольника по правилу "верхнего левого"](images/d3d10-rasterrulestriangle.png)

Светлыми и темно-серыми квадратами показаны группы пикселей, чтобы обозначить, внутри каких треугольников они находятся.

## <a name="span-idline1spanspan-idline1spanspan-idline1spanline-rasterization-rules-aliased-without-multisampling"></a><span id="Line_1"></span><span id="line_1"></span><span id="LINE_1"></span>Правила растеризации линий (без сглаживания, без множественной дискретизации)


Правила растеризации линий используют ромбовидную тестовую область, чтобы определить, охватывает ли линия пиксель. Для основных линий сетки x (у которых –1 &lt;= наклон &lt;= +1) в ромбовидную область проверки (показана сплошным цветом) включены левый нижний и правый нижний край, а также нижний угол; из ромба исключаются (показана пунктиром) левый верхний и правый верхний край, а также верхний, левый и правый угол. Основная линия сетки y — это любая линия, не являющаяся основной линией сетки x. Ромбовидная тестовая область описывается так же, как и для x, но в нее также включен правый угол.

В ромбовидной области линия охватывает пиксель, если она есть в ромбовидной тестовой области при обходе линии с начала до конца. Ломаная ведет себя так же, как при ее отрисовке в виде последовательности линий.

На следующем рисунке представлены некоторые примеры.

![примеры растеризации линии без сглаживания](images/d3d10-rasterrulesline.png)

## <a name="span-idline2spanspan-idline2spanspan-idline2spanline-rasterization-rules-antialiased-without-multisampling"></a><span id="Line_2"></span><span id="line_2"></span><span id="LINE_2"></span>Правила растеризации линий (со сглаживанием, без множественной дискретизации)


Линия со сглаживанием преобразуется в растровый формат так, будто она представляет прямоугольник (с шириной = 1). Прямоугольник пересекается с целью прорисовки, что дает значения покрытия для каждого пикселя, которые умножаются на выходные альфа-компоненты пиксельного шейдера. Сглаживание не выполняется при рисовании линий целевого объекта прорисовки со множественной дискретизацией.

Считается, что не существует единственного лучшего способа отрисовки линии со сглаживанием. В качестве рекомендации Direct3D использует метод, показанный на следующем рисунке. Он был получен опытным путем, т. к. продемонстрировал ряд желательных визуальных свойств.

Оборудования не обязано точно соответствовать этому алгоритму. Отклонения тестов с использованием этого эталонного метода будут «допустимыми», если следовать указанным ниже принципам, что позволяет применять различные аппаратные реализации и размеры ядер фильтра. Но подобная гибкость аппаратной реализации не может быть передана в Direct3D через приложения, помимо простого рисования линий, а также наблюдения и измерения их внешнего вида.

![примеры растеризации линии со сглаживанием](images/d3d10-rasterruleslineaa.png)

Этот алгоритм создает относительно плавные линии одинаковой интенсивности с минимальным числом неровных краев или искажений. Образование муарового узора для рядом расположенных линий минимизировано. Обеспечивается хорошее покрытие соединений между сегментами линий, размещенными возле концов.

Ядро фильтра — это разумный компромисс между объем размытия краев и изменениями интенсивности, вызванными гамма-коррекцией. Значение покрытия умножаются на пиксельный шейдер o0.a (srcAlpha) по следующей формуле на [стадии слияния вывода (OM)](output-merger-stage--om-.md):

srcColor \* srcAlpha + destColor \* (1–srcAlpha)

## <a name="span-idpointspanspan-idpointspanspan-idpointspanpoint-rasterization-rules-without-multisampling"></a><span id="Point"></span><span id="point"></span><span id="POINT"></span>Правила растеризация точки (без множественной дискретизации)


Точка интерпретируется как состоящая из двух треугольников в Z-шаблоне, для которого используются правила растеризации треугольника. Координата определяет центр квадрата шириной один пиксель. Для точек отбрасывание не выполняется.

На следующем рисунке представлены некоторые примеры.

![примеры растеризация точки](images/d3d10-rasterrulespoint.png)

## <a name="span-idmultisamplespanspan-idmultisamplespanspan-idmultisamplespanmultisample-anti-aliasing-rasterization-rules"></a><span id="Multisample"></span><span id="multisample"></span><span id="MULTISAMPLE"></span>Правила растеризации со сглаживанием и множественной дискретизацией


Сглаживание со множественной дискретизацией (MSAA) уменьшает геометрические искажения, используя тесты покрытия пикселей и трафарета глубины в нескольких местах из подмножества выборки. Для повышения производительности пиксельные вычисления выполняются один раз для каждого охваченного пикселя за счет совместного использования выходных данных шейдера для всех охваченных пикселей. Множественное сглаживание не уменьшает искажения поверхности. Расположения выборки и функции реконструкции зависят от аппаратной реализации.

На следующем рисунке представлены некоторые примеры.

![примеры растеризации со множественным сглаживанием](images/d3d10-rasterrulesmsaa.png)

Количество расположений выборки зависит от режима множественной дискретизации. Интерполяции атрибутов вершин происходит в центре пикселей, т. к. здесь вызывается пиксельный шейдер (это становится экстраполяцией, если центр не охвачен). Атрибуты могут быть отмечены в пиксельном шейдере для центроидной дискретизации, из-за чего незатронутые пиксели интерполируют атрибут на пересечения области пикселя и примитива.

Пиксельный шейдер запускается для каждой области размером 2x2 пикселя для поддержки производных вычислений (в которых используется дельта x и y). Это означает, что шейдер вызывается чаще, чем показано, для заполнения минимального кванта 2x2 (который не зависит от множественной дискретизации). Результат шейдера записывается для каждого охваченного образца, который прошел тест трафарета глубины.

Правила растеризации для примитивов, в целом, не изменяются при множественном сглаживании, за исключением следующие случаев:

-   для треугольника тест покрытия выполняется для каждого расположения образца (а не для центра пикселя); Если охватывается больше одного местоположения, пиксельный шейдер запускается один раз, а атрибуты интерполируются в центре пикселей. Результат сохраняется (копируется) для каждого охваченного местоположения в пикселе, прошедшем проверку глубины трафарета.

    Линия считается прямоугольником, состоящим из двух треугольников с толщиной линии 1,4;

-   для точки тест покрытия выполняется для каждого расположения образца (а не для центра пикселя).

Форматы множественной дискретизации могут использоваться в целях отрисовки, которые могут быть считаны в шейдеры с помощью [загрузки](https://msdn.microsoft.com/library/windows/desktop/bb509694), так как разрешение для отдельных образцов, к которым обращается шейдер, не требуется. Форматы глубины не поддерживаются для ресурса множественной дискретизации, поэтому форматы глубины ограничены только целями прорисовки.

Нетипизированные форматы поддерживают множественную дискретизацию, чтобы представление ресурсов могло по-разному интерпретировать данные. Например, вы можете создать ресурс множественной дискретизации с помощью R8G8B8A8\_TYPELESS, визуализировать его с помощью ресурса render-target-view в формате R8G8B8A8\_UINT, а затем разрешить содержимое в другой ресурс с форматом данных R8G8B8A8\_UNORM.

### <a name="span-idhardwaresupportspanspan-idhardwaresupportspanspan-idhardwaresupportspanhardware-support"></a><span id="Hardware_Support"></span><span id="hardware_support"></span><span id="HARDWARE_SUPPORT"></span>Поддержка оборудования

API сообщает о поддержке оборудования для множественной дискретизации с помощью ряда проверок качества. Например, уровень качества 0 означает, что множественная дискретизация (на определенном уровне формата и качества) не поддерживается оборудованием. Уровень качества 3 означает, что оборудование поддерживает три разных макета образца и алгоритма разрешения. Вы также можете предположить следующее:

-   любой формат, который поддерживает множественную дискретизацию, поддерживает одинаковое число уровней качества для каждого формата этого семейства;
-   каждый формат, который поддерживает множественную дискретизацию, и содержит форматы \_UNORM, \_SRGB, \_SNORM или \_FLOAT, также поддерживает разрешение.

### <a name="span-idcentroidsamplingspanspan-idcentroidsamplingspanspan-idcentroidsamplingspancentroid-sampling-of-attributes-when-multisample-antialiasing"></a><span id="Centroid_Sampling"></span><span id="centroid_sampling"></span><span id="CENTROID_SAMPLING"></span>Центроидная дискретизация атрибутов при множественном сглаживании

По умолчанию атрибуты вершин интерполируются в центре пикселей во время множественного сглаживания. Если центр пикселя не охвачен, атрибуты экстраполируются в центре пикселей. Если входные данные пиксельного шейдера, которые содержат семантику центроида (если пиксель не полностью охвачен), будут выбираться где-то в пределах области охвата пикселя, возможно, в одном из охваченных расположений. Маска образца (задается состоянием средства прорисовки) применяется перед вычислением центроида. Поэтому маскированный образец не будет использоваться в качестве расположения центроида.

Средство программной прорисовки выбирает расположение образца для центроидной дискретизации следующим образом.

-   Маска дискретизации разрешает все образцы. Центр пикселя используется, если пиксель охвачен или ни один из образцов не охвачен. В противном случае выбирается первый охваченный образец начиная от центра пикселя и с перемещением вперед.
-   Маска дискретизации отключает все образцы, кроме одного (общий сценарий). Приложение может реализовывать многопроходную супердискретизацию, перебирая одноразрядные значения маски дискретизации и повторно отрисовывая сцену для каждого образца, используя центроидную дискретизации. Для этого приложению потребуется настроить производные данные, чтобы выбрать более детализированные MIP текстур для повышения плотности дискретизации текстур.

### <a name="span-idderivativecalculationsspanspan-idderivativecalculationsspanspan-idderivativecalculationsspanderivative-calculations-when-multisampling"></a><span id="Derivative_Calculations"></span><span id="derivative_calculations"></span><span id="DERIVATIVE_CALCULATIONS"></span>Производные вычисления при множественной дискретизации

Пиксельные шейдеры всегда запускаются с использованием минимальной области размером 2x2 пикселя для поддержки производных вычислений, для получения которых учитывается разница между смежными пикселями (предполагается, что данные в каждом пикселе были дискретизированы с горизонтальным или вертикальным интервалом). Множественная дискретизация на это не влияет.

Если производные вычисления запрашиваются для атрибута, который был дискретизирован по центроиду, аппаратные вычисления не корректируются, что может вызвать неточные результаты. Шейдер ожидает единичный вектор в цели отрисовки, но может получить иной вектор относительно другого векторного пространства. Поэтому приложение отвечает за проверку при запросе производных вычислений на основе атрибутов с центроидной дискретизацией.

К слову, не рекомендуется объединять производные вычисления и центроидную дискретизацию. Центроидная дискретизация может быть полезна в случаях, когда интерполированные атрибуты примитива не должны быть экстраполированы, но при этом требуются компромиссы, например атрибуты меняются резко, а не непрерывно, когда край примитива пересекает пиксель или производные вычисления не могут использоваться в операциях дискретизации текстуры, которые получают уровень детализации.

## <a name="span-idrelated-topicsspanrelated-topics"></a><span id="related-topics"></span>Статьи по теме


[Приложения](appendix.md)

[Этап средства программной прорисовки (RS)](rasterizer-stage--rs-.md)

 

 




