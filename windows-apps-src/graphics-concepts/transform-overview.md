---
title: Обзор преобразований
description: Большая часть низкоуровневых математических вычислений в 3D-графике приходится на матричные преобразования.
ms.assetid: B5220EE8-2533-4B55-BF58-A3F9F612B977
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: 1b6be8ee8aa67196581907087d99e0324d741a00
ms.sourcegitcommit: 8921a9cc0dd3e5665345ae8eca7ab7aeb83ccc6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2018
ms.locfileid: "8892910"
---
# <a name="transform-overview"></a>Обзор преобразований


Значительная часть низкоуровневых математических вычислений в 3D-графике приходится на матричные преобразования.

Геометрический конвейер принимает вершины в качестве входных данных. Модуль преобразований применяет к вершинам мировое, видовое и проекционное преобразования, кадрирует результат и передает все в средство программной прорисовки.

| Преобразование и пространство                           | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Координаты модели в модельном пространстве              | В начале конвейера вершины модели объявлены относительно локальной системы координат. Локальная система координат — это локальное начало координат и ориентация. Эта ориентация координат часто называется *модельным пространством*. Отдельные координаты называются *модельными координатами*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Мировое преобразование в мировое пространство              | Первый этап геометрического конвейера преобразует вершины модели из их локальной системы координат в систему координат, используемую всеми объектами в сцене. Процесс изменения ориентации вершин называется [мировым преобразованием](world-transform.md) и обеспечивает преобразование из модельного пространства в новую ориентацию, которая называется *мировым пространством*. Каждая вершина в мировом пространстве объявляется с использованием *мировых координат*.                                                                                                                                                                                                                                                                                                                           |
| Видовое преобразование в видовое пространство (пространство камеры) | На следующем этапе вершины, которые описывают ваш трехмерный мир, ориентируются по отношению к камере. Это значит, что ваше приложение выбирает точку зрения для сцены, и координаты мирового пространства переносятся и поворачиваются вокруг вида камеры, превращая мировое пространство в *видовое пространство* (также называемое *пространством камеры*). Это [видовое преобразование](view-transform.md), которое обеспечивает преобразование из мирового пространства в видовое пространство.                                                                                                                                                                                                                                                                                                                        |
| Проекционное преобразование в проекционное пространство    | Следующий этап — это [проекционное преобразование](projection-transform.md), которое обеспечивает преобразование из видового пространства в проекционное пространство. На этом этапе конвейера объекты обычно масштабируются по отношению к своему расстоянию от наблюдателя для придания сцене иллюзии глубины; благодаря этому близкие объекты кажутся больше, чем далекие. С целью упрощения в этой документации пространство, в котором существуют вершины после проекционного преобразования, называется *проекционным пространством*. В некоторых книгах по графике проекционное пространство может называться *постперспективным однородным пространством*. Не все проекционные преобразования обеспечивают масштабирование размера объектов в сцене. Такая проекция иногда называется *аффинной* или *ортогональной проекцией*. |
| Кадрирование в экранном пространстве                      | На последнем этапе конвейера все вершины, которые не будут видны на экране, удаляются, чтобы средство программной прорисовки не тратило время на вычисление цветов и затенения для того, что никто не увидит. Этот процесс называется *кадрированием*. После кадрирования оставшиеся вершины масштабируются в соответствии с параметрами окна просмотра и преобразуются в экранные координаты. Итоговые вершины, отображаемые на экране после растеризации стены, существуют в *экранном пространстве*.                                                                                                                                                                                                                                                    |

 

Преобразования используются для преобразования геометрии объектов из одного пространства координат в другое. В Direct3D для 3D-преобразований используются матрицы. Матрицы создают 3D-преобразования. Можно объединять матрицы для получения одной матрицы, охватывающей несколько преобразований.

Можно преобразовывать координаты между модельным пространством, мировым пространством и видовым пространством.

-   [Мировое преобразование](world-transform.md) — обеспечивает преобразование из модельного пространства в мировое пространство.
-   [Видовое преобразование](view-transform.md) — обеспечивает преобразование из мирового пространства в видовое пространство.
-   [Проекционное преобразование](projection-transform.md) — обеспечивает преобразование из видового пространства в проекционное пространство.

## <a name="span-idmatrixtransformsspanspan-idmatrixtransformsspanspan-idmatrixtransformsspanmatrix-transforms"></a><span id="Matrix_Transforms"></span><span id="matrix_transforms"></span><span id="MATRIX_TRANSFORMS"></span>Матричные преобразования


В приложениях, работающих с 3D-графикой, с помощью геометрических преобразований можно:

-   выражать местоположение одного объекта относительного другого объекта;
-   поворачивать объекты и задавать их размер;
-   менять позиции наблюдателя, направления и перспективы.

Любую точку (X,Y,Z) можно преобразовать в другую точку (X', Y', Z') с помощью матрицы 4x4, как показано в следующем уравнении.

![уравнение для преобразования любой точки в другую точку](images/matmult.png)

Примените следующие уравнения к (X, Y, Z) и матрице для получения точки (X', Y', Z').

![уравнения для новой точки](images/matexpnd.png)

Наиболее распространенные преобразования — это параллельный перенос, поворот и масштабирование. Можно объединить матрицы, которые обеспечивают эти эффекты, в одну матрицу и вычислять сразу несколько преобразований. Например, можно построить единую матрицу для параллельного переноса и поворота серии точек.

Матрицы записываются в порядке строка-столбец. Матрица, которая равномерно масштабирует вершины вдоль каждой оси — так называемое пропорциональное масштабирование — в математической записи будет представлена следующей матрицей.

![уравнение матрицы для пропорционального масштабирования](images/matrix.png)

На C++ в Direct3D матрицы объявляются в виде двумерного массива, с использованием матричной структуры. В следующем примере показано, как инициализировать структуру [**D3DMATRIX**](https://msdn.microsoft.com/library/windows/desktop/bb172573), которая будет играть роль матрицы пропорционального масштабирования (коэффициент масштабирования "s").

```
D3DMATRIX scale = {
    5.0f,            0.0f,            0.0f,            0.0f,
    0.0f,            5.0f,            0.0f,            0.0f,
    0.0f,            0.0f,            5.0f,            0.0f,
    0.0f,            0.0f,            0.0f,            1.0f
};
```

## <a name="span-idtranslatespanspan-idtranslatespanspan-idtranslatespantranslate"></a><span id="Translate"></span><span id="translate"></span><span id="TRANSLATE"></span>Параллельный перенос


Следующее уравнение параллельно переносит точку (X, Y, Z) в новую точку (X', Y', Z').

![уравнение матрицы параллельного переноса для получения новой точки](images/transl8.png)

Матрицу параллельного переноса можно вручную создать в C++. В следующем примере показан исходный код для функции, которая создает матрицу для параллельного переноса вершин.

```
D3DXMATRIX Translate(const float dx, const float dy, const float dz) {
    D3DXMATRIX ret;

    D3DXMatrixIdentity(&ret);
    ret(3, 0) = dx;
    ret(3, 1) = dy;
    ret(3, 2) = dz;
    return ret;
}    // End of Translate
```

## <a name="span-idscalespanspan-idscalespanspan-idscalespanscale"></a><span id="Scale"></span><span id="scale"></span><span id="SCALE"></span>Масштабирование


Следующее уравнение масштабирует точку (X, Y, Z) на произвольные значения в направлениях (X, Y, Z) для получения новой точки (X', Y', Z').

![уравнение матрицы масштабирования для получения новой точки](images/matscale.png)

## <a name="span-idrotatespanspan-idrotatespanspan-idrotatespanrotate"></a><span id="Rotate"></span><span id="rotate"></span><span id="ROTATE"></span>Поворот


Описанные здесь преобразования предназначены для левовинтовых систем координат и, следовательно, могут отличаться от матриц преобразования, которые встречались вам где-либо еще.

Следующее уравнение поворачивает точку (X, Y, Z) вокруг оси X для получения новой точки (X', Y', Z').

![уравнение матрицы поворота вокруг оси X для получения новой точки](images/matxrot.png)

Следующее уравнение поворачивает точку вокруг оси Y.

![уравнение матрицы поворота вокруг оси Y для получения новой точки](images/matyrot.png)

Следующее уравнение поворачивает точку вокруг оси Z.

![уравнение матрицы поворота вокруг оси Z для получения новой точки](images/matzrot.png)

В этих примерах матриц греческой буквой тета обозначен угол поворота в радианах. Углы измеряются по часовой стрелке, если смотреть вдоль оси поворота в направлении начала координат.

В следующем коде показана функция для обработки поворота вокруг оси X.

```
    // Inputs are a pointer to a matrix (pOut) and an angle in radians.
    float sin, cos;
    sincosf(angle, &sin, &cos);  // Determine sin and cos of angle

    pOut->_11 = 1.0f; pOut->_12 =  0.0f;   pOut->_13 = 0.0f; pOut->_14 = 0.0f;
    pOut->_21 = 0.0f; pOut->_22 =  cos;    pOut->_23 = sin;  pOut->_24 = 0.0f;
    pOut->_31 = 0.0f; pOut->_32 = -sin;    pOut->_33 = cos;  pOut->_34 = 0.0f;
    pOut->_41 = 0.0f; pOut->_42 =  0.0f;   pOut->_43 = 0.0f; pOut->_44 = 1.0f;

    return pOut;
}
```

## <a name="span-idconcatenatingmatricesspanspan-idconcatenatingmatricesspanspan-idconcatenatingmatricesspanconcatenating-matrices"></a><span id="Concatenating_Matrices"></span><span id="concatenating_matrices"></span><span id="CONCATENATING_MATRICES"></span>Конкатенация матриц


Одним из преимуществ использования матриц является то, что эффекты двух или нескольких матриц можно объединить путем перемножения этих матриц. Это означает, что для поворота модели и последующего ее параллельного переноса в какое-либо место не нужно применять две матрицы. Вместо этого необходимо перемножить матрицы поворота и параллельного переноса для получения составной матрицы, содержащей все их эффекты. Этот процесс называется конкатенацией матриц и может описываться следующим уравнением.

![уравнение конкатенации матриц](images/matrxcat.png)

В этом уравнении C — создаваемая составная матрица, а M₁ – Mₙ — отдельные матрицы. В большинстве случаев объединяют только две или три матрицы, однако на самом деле их количество не ограничено.

Порядок, в котором выполняется перемножение матриц, имеет решающее значение. Приведенная выше формула отражает правило конкатенации матриц "слева направо". Это значит, что визуальные эффекты матриц, используемых для создания составной матрицы, имеют место в порядке слева направо. В следующем примере показана типичная мировая матрица. Предположим, вы создаете мировую матрицу для классической летающей тарелки. Наверное, имеет смысл вращать летающую тарелку вокруг ее центра — оси Y модельного пространства — и параллельно переносить ее в какое-либо другое место в сцене. Для достижения этого эффекта необходимо сначала создать матрицу поворота, а затем умножить ее на матрицу параллельного переноса, как показано в следующем уравнении.

![уравнения вращения, основанное на матрице поворота и матрице параллельного переноса](images/wrldexpl.png)

В этой формуле R<sub>y</sub> — это матрица для поворота вокруг оси Y, а T<sub>w</sub> — это параллельный перенос в некоторую точку в мировых координатах.

Порядок, в котором перемножаются матрицы, имеет значение, потому что, в отличие от умножения двух скалярных значений, умножение матриц не является коммутативным. Перемножение матриц в обратном порядке будет производить визуальный эффект параллельного переноса летающей тарелки в ее положение в мировом пространстве, а затем ее поворота вокруг мирового начала координат.

Вне зависимости от того, матрицу какого типа вы создаете, помните о правиле "слева направо", чтобы результаты всегда соответствовали ожидаемым.

## <a name="span-idrelated-topicsspanrelated-topics"></a><span id="related-topics"></span>Статьи по теме


[Преобразования](transforms.md)

 

 




