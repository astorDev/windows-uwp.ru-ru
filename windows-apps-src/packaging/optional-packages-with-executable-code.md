---
title: Дополнительные пакеты с исполняемым кодом
description: Узнайте, как с помощью Visual Studio создать дополнительный пакет с исполняемым кодом.
ms.date: 9/30/2018
ms.topic: article
keywords: windows 10, uwp, установщик приложений, AppInstaller, загрузка неопубликованных приложений, связанный набор, дополнительные пакеты
ms.localizationpriority: medium
ms.openlocfilehash: 795155ab38be11987d978d8c3843a73b7d359277
ms.sourcegitcommit: b5c9c18e70625ab770946b8243f3465ee1013184
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/29/2018
ms.locfileid: "7990641"
---
# <a name="optional-packages-with-executable-code"></a>Дополнительные пакеты с исполняемым кодом
 
Дополнительные пакеты с исполняемым кодом удобно использовать для разделения больших или сложных приложений или для их добавления в приложения, которые уже были опубликованы. С помощью Visual Studio 2017 версии 15.7 и .NET Native 2.1 можно загрузить исполняемый код из дополнительных пакетов C++ и C#.

## <a name="prerequisites"></a>Что вам понадобится
- VisualStudio2017 версии15.7
- Windows10 версии 1709
- SDK для Windows10 версии1709

Чтобы скачать самые последние средства для разработки, см. раздел [Загружаемые файлы и инструменты для Windows10](https://developer.microsoft.com/windows/downloads). 

> [!NOTE]
> Чтобы отправить приложение, использующее дополнительные пакеты и (или) связанные наборы, в Store, вам потребуется разрешение. Дополнительные пакеты и связанные наборы может использоваться для строки бизнес (LOB) или корпоративных приложений без получения разрешения центра партнеров, если они не отправлялись в Store. Для получения разрешения на отправку приложений, использующих дополнительные пакеты и связанные наборы, см. раздел [Поддержка разработчиков для Windows](https://developer.microsoft.com/windows/support).

## <a name="c-optional-packages-with-executable-code"></a>Дополнительные пакеты C++ с исполняемым кодом

Для загрузки кода из дополнительного пакета C++ см. репозиторий [OptionalPackageSample](https://github.com/AppInstaller/OptionalPackageSample) на GitHub. [OptionalPackageDLL](https://github.com/AppInstaller/OptionalPackageSample/tree/master/OptionalPackageDLL) показывает, как создать проект с кодом, который можно исполнить из основного пакета. Проект MyMainApp демонстрирует, как [загрузить код](https://github.com/AppInstaller/OptionalPackageSample/blob/bf6b4915ff1f3b8abfdaacb1ad9e77184c49fe18/MyMainApp/MainPage.xaml.cpp#L182) из файла OptionalPackageDLL.dll.

## <a name="c-optional-packages-with-executable-code"></a>Дополнительные пакеты C# с исполняемым кодом

Чтобы приступить к созданию дополнительного пакета с кодом на C#, выполните следующие действия для настройки решения:

1. Создайте новое приложение UWP, задав для него минимальную версию ОС: Windows 10 Fall Creators Update SDK (сборка 16299) или выше.

2. Добавьте новый проект **Дополнительный пакет с кодом (Universal Windows)** в решение. Убедитесь, что **Минимальная версия** и **Целевая версия** совпадают с соответствующими версиями основного приложения.

3. Если вы планируете отправить приложения в Store, щелкните правой кнопкой мыши оба проекта и выберите **Store -> Связать приложение с Store...**

4. Откройте файл `Package.appxmanifest` основного приложения и найдите значение `Identity Name`. Запишите это значение, чтобы применить его в ходе следующего шага.

5. Откройте дополнительный пакет приложения `Package.appxmanifest` и найдите значение `uap3:MainAppPackageDependency Name`. Обновите значение `uap3:MainAppPackageDependency Name` в соответствии со значением `Identity Name` пакета основного приложения из предыдущего шага. 

    Вот пример `Identity`из `Package.appxmanifest` основного приложения.
    ```XML
    <Identity Name="12345.MainAppProject" Publisher="CN=PublisherName" Version="1.0.0.0" />
    ```

    Значение `uap3:MainPackageDependency` дополнительного пакета приложения необходимо обновить в соответствии со значением `Identity` основного приложения.
    ```XML
    <uap3:MainPackageDependency Name="12345.MainAppProjectTest" />
    ```

6. Добавьте файл `Bundle.mapping.txt` в основное приложение. Выполните действия в разделе [Связанные наборы](https://docs.microsoft.com/windows/uwp/packaging/optional-packages#related-sets), чтобы создать связанный набор, содержащий оба приложения. 

7. Создайте проект дополнительного пакета и перейдите к папке пакета "Справочник" в выходных данных сборки, расположенной в `..\[PathToOptionalPackageProject]\bin\[architecture]\[configuration]\Reference`. Обратите внимание, что в пути к папке "Справочник" можно выбрать любую архитектуру, так как файл `.winmd` (шаг 8) не зависит от архитектуры.

8. Добавьте ссылку из проекта основного приложения в файл `.winmd`, расположенный в этой папке. При каждом изменении контактной зоны API в проекте дополнительного пакета этот файл `.winmd` **необходимо** обновлять. В этом справочнике приводится проект основного приложения с информацией, необходимой для компиляции.

9. В проекте основного приложения перейдите к свойствам сборки проекта и выберите **Компилировать с помощью цепочки инструментов .NET Native**. В настоящее время для создания дополнительного пакета с кодом на C# поддерживается только отладка в .NET Native. Перейдите к свойствам отладки проекта и выберите **Развернуть дополнительные пакеты**. Это гарантирует, что оба пакета будут синхронизированы при каждом развертывании проекта основного приложения.

После выполнения этих действий можно добавить код в проект дополнительного пакета, как если бы он был управляемым проектом компонента WinRT. Для доступа к коду в проекте основного приложения вызовите открытые методы, предоставляемые в проекте дополнительного пакета.