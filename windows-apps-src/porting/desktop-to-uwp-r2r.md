---
Description: В этом руководстве описывается настройка решения Visual Studio для оптимизации двоичных файлов приложения с помощью образов в машинном коде.
Search.Product: eADQiWindows 10XVcnh
title: Оптимизируйте свои приложения Классические приложения .NET с помощью образов в машинном коде
ms.date: 06/11/2018
ms.topic: article
keywords: Windows 10, образов в машинном коде компилятора
ms.localizationpriority: medium
ms.openlocfilehash: 3071b843a1605d765ab5b087d5e1bfb96a220218
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57642879"
---
# <a name="optimize-your-net-desktop-apps-with-native-images"></a>Оптимизируйте свои приложения Классические приложения .NET с помощью образов в машинном коде

> [!NOTE]
> Некоторые сведения относятся к предварительным версиям продуктов, в которые перед коммерческим выпуском могут быть внесены существенные изменения. Майкрософт не дает никаких гарантий, явных или подразумеваемых, в отношении предоставленной здесь информации.

Время запуска приложения .NET Framework можно улучшить путем предварительной компиляции двоичных файлов. Эту технологию можно использовать в больших приложениях, которые вы упаковки и распространения через Microsoft Store. В некоторых случаях мы встречающейся повышение производительности на 20%. Дополнительные сведения об этой технологии в [Технический обзор](https://github.com/dotnet/coreclr/blob/master/Documentation/botr/readytorun-overview.md).

Мы выпустили предварительную версию компилятора образов в машинном коде, как [пакет NuGet](https://www.nuget.org/packages/Microsoft.DotNet.Framework.NativeImageCompiler). Этот пакет можно применить к любому приложению .NET Framework, предназначенный для .NET Framework версии 4.6.2 или более поздней версии. Этот пакет Добавляет шаг построения post, который содержит собственные полезные данные для всех двоичных файлов, используемых приложением. Этот оптимизированный полезных данных будут загружены, когда приложение работает в .NET Framework 4.7.2 и более поздних версий, а предыдущие версии по-прежнему будет загружать код MSIL.

[.NET framework 4.7.2](https://blogs.msdn.microsoft.com/dotnet/2018/04/30/announcing-the-net-framework-4-7-2/) включается в [обновления Windows 10 апреля 2018 г](https://blogs.windows.com/windowsexperience/2018/04/30/how-to-get-the-windows-10-april-2018-update/). Эта версия .NET Framework также можно установить на ПК, запустите Windows 7 + и Windows Server 2008 R2 более поздней версии.

> [!IMPORTANT]
> Если вы хотите создавать образы в машинном коде для вашего приложения, упакованные в проект упаковки приложений Windows, убедитесь, что значение целевой платформы начиная с версии проекта Юбилейное обновление Windows.

## <a name="how-to-produce-native-images"></a>Как создать образы в машинном коде

Выполните эти инструкции для настройки проектов.

1. Настройка требуемой версии .NET framework 4.6.2 или выше

2. Настроить целевую платформу в качестве x86 или x64 

3. Добавьте пакеты NuGet.

4. Создание сборки выпуска.

## <a name="configure-the-target-framework-as-462-or-above"></a>Настройка требуемой версии .NET framework 4.6.2 или выше

Настройте проект для платформы .NET Framework 4.6.2, вам потребуется средства разработки .NET Framework 4.6.2 или более поздней версии. Эти средства доступны через установщик Visual Studio в качестве дополнительных компонентов в группе рабочей нагрузки разработки классических приложений .NET:

![Установите .NET 4.6.2 средства разработки](images/desktop-to-uwp/install-4.6.2-devpack.png)

Кроме того вы можете получить пакеты разработчика .NET из: [https://www.microsoft.com/net/download/visual-studio-sdks](https://www.microsoft.com/net/download/visual-studio-sdks)

## <a name="configure-the-target-platform-as-x86-or-x64"></a>Настроить целевую платформу в качестве x86 или x64

Образов в машинном коде компилятор оптимизирует код для данной платформы. Чтобы использовать его, необходимо настроить приложение для ориентацию одной конкретной платформы, такие как x86 или x64.

При наличии нескольких проектов в решении, только запись точки проекта (скорее всего, когда проект создает исполняемый файл) должен быть скомпилированы как x86 или x64. Дополнительные двоичные файлы, на которые ссылается основной проект будет обрабатываться с помощью архитектуры, указанные в основной проект, даже если они компилируются как AnyCPU.

Чтобы настроить проект:

1. Щелкните правой кнопкой мыши решение, а затем выберите **Configuration Manager**.

2. Выберите **< создать... >** в **платформы** раскрывающееся меню рядом с именем проекта, который создает исполняемый файл.

3. В **Создание платформы проекта** диалоговом окне убедитесь, что **Копировать параметры из** раскрывающегося списка присваивается **любой ЦП**.

![Настройка x86](images/desktop-to-uwp/configure-x86.png)

Повторите этот шаг для `Release/x64` Если вы хотите создать x64 двоичные файлы.

>[!IMPORTANT]
> Конфигурация AnyCPU не поддерживается компилятором образов в машинном коде.

## <a name="add-the-nuget-packages"></a>Добавьте пакеты NuGet

Компилятор образов в машинном коде предоставляется как пакет NuGet, который необходимо добавить в проект Visual Studio, который создает исполняемый файл. Обычно это проект Windows Forms или WPF. Используйте эту команду PowerShell, чтобы сделать это.

```PS
PM> Install-Package Microsoft.DotNet.Framework.NativeImageCompiler -Version 0.0.1-prerelease-00002  -PRE
```

> [!NOTE]
> Предварительные версии пакетов, публикуются в NuGet.org как отсутствующие в списке. Вы не найдете их, просматривая сайт NuGet.org или с помощью пользовательского интерфейса диспетчера пакетов в Visual Studio. Тем не менее, их можно установить из консоли диспетчера пакетов и когда вы восстановление с другого компьютера. Сделаем пакеты полностью доступны при публикации первой версии не предварительного просмотра.

## <a name="create-a-release-build"></a>Создание сборки выпуска

Пакет NuGet настраивает проект для выполнения дополнительный инструмент для сборок выпуска. Это средство добавляет те же двоичные файлы машинного кода.
Чтобы убедиться, что средство обработал двоичные файлы можно просмотреть выходные данные, убедитесь, что он содержит сообщение, такую как данный сборки:

```
Native image obj\x86\Release\\R2R\DesktopApp1.exe generated successfully.
```

## <a name="faq"></a>Вопросы и ответы

**ВОПРОС. Новые двоичные файлы работают на компьютерах без .NET Framework 4.7.2?**

А) Оптимизированные двоичные файлы будет воспользоваться преимуществами усовершенствований, при работе с .NET Framework 4.7.2. Клиенты, использующие предыдущие версии .NET framework будет загружать не оптимизированного кода на языке MSIL из двоичного файла.

**ВОПРОС. Как отправить отзыв или сообщить о проблемах?**

А) Сообщить о проблеме с помощью средства обратной связи в Visual Studio 2017. [Дополнительные сведения о](https://docs.microsoft.com/visualstudio/ide/how-to-report-a-problem-with-visual-studio-2017).

**ВОПРОС. Что такое влияние добавления образа в машинном коде в существующие двоичные файлы?**

А) Оптимизированные двоичные файлы содержат управляемого и машинного кода, делая больше окончательных версий файлов.

**ВОПРОС. Я снимаю двоичных файлов с помощью этой технологии**

А) Эта версия включает лицензии Go Live, который можно использовать уже сегодня.
