---
ms.assetid: 333f67f5-f012-4981-917f-c6fd271267c6
description: Этот пример, в котором используются данные из примера Bookstore1, начинается с универсального приложения для версии 8.1, отображающего сгруппированные данные в элементе управления SemanticZoom.
title: Пример переноса среды выполнения Windows 8.x в UWP Bookstore2
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: fb3fdd324caa54c6965ae63485b5b4f264980d7e
ms.sourcegitcommit: b52ddecccb9e68dbb71695af3078005a2eb78af1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2019
ms.locfileid: "74259130"
---
# <a name="windows-runtime-8x-to-uwp-case-study-bookstore2"></a>Пример переноса среды выполнения Windows 8.x в UWP: Bookstore2


Этот пример, в котором используются данные из примера [Bookstore1](w8x-to-uwp-case-study-bookstore1.md), начинается с универсального приложения для версии 8.1, отображающего сгруппированные данные в элементе управления [**SemanticZoom**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom). В модели представления каждый экземпляр класса **Author** представляет группу книг одного автора, а в классе **SemanticZoom** мы можем просмотреть список книг, сгруппированных по автору, или уменьшить представление, чтобы просмотреть список переходов по авторам. Список переходов — это гораздо более быстрый способ навигации, чем прокрутка списка книг. Мы рассмотрим шаги переноса приложения в приложение Windows 10 универсальная платформа Windows (UWP).

**Обратите внимание** ,   при открытии Bookstore2Universal\_10 в Visual Studio, если отображается сообщение "требуется обновление Visual Studio", выполните действия, описанные в [TargetPlatformVersion](w8x-to-uwp-troubleshooting.md).

## <a name="downloads"></a>Загрузки

[Скачайте приложение Bookstore2\_81 Universal 8,1](https://codeload.github.com/MicrosoftDocs/windows-topic-specific-samples/zip/Bookstore2_81).

[Скачайте приложение Bookstore2Universal\_10 Windows 10](https://codeload.github.com/MicrosoftDocs/windows-topic-specific-samples/zip/Bookstore2Universal_10).

## <a name="the-universal-81-app"></a>Универсальное приложение для версии 8.1

Вот что такое Bookstore2\_81 — приложение, которое мы будем переносить, — выглядит так. В нем используется горизонтальная прокрутка (вертикальная прокрутка в Windows Phone) [**SemanticZoom**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom) и отображаются книги, сгруппированные по автору. Вы можете уменьшить представление и перейти в список переходов, откуда можно вернуться в любую группу. Приложение состоит из двух основных элементов: модели представления, которая дает сгруппированный источник данных, и пользовательского интерфейса, который привязывается к этой модели. Как мы увидим, оба этих фрагмента легко можно получить от технологии WinRT 8,1 до Windows 10.

![Bookstore2\-81 в Windows, уменьшенное представление](images/w8x-to-uwp-case-studies/c02-01-win81-zi-how-the-app-looks.png)

Bookstore2\_81 в Windows, уменьшенное представление
 

![Bookstore2\-81 в Windows, уменьшенное представление](images/w8x-to-uwp-case-studies/c02-02-win81-zo-how-the-app-looks.png)

Bookstore2\_81 в Windows, уменьшенное представление

![Bookstore2\-81 в Windows Phone, масштабное представление](images/w8x-to-uwp-case-studies/c02-03-wp81-zi-how-the-app-looks.png)

Bookstore2\_81 на Windows Phone, уменьшенное представление

![Bookstore2\-81 на Windows Phone, уменьшенное представление](images/w8x-to-uwp-case-studies/c02-04-wp81-zo-how-the-app-looks.png)

Bookstore2\_81 на Windows Phone, уменьшенное представление

##  <a name="porting-to-a-windows10-project"></a>Перенос в проект Windows 10

Решение Bookstore2\_81 — это проект универсального приложения 8,1. Проект Bookstore2\_81. Windows создает пакет приложения для Windows 8.1, а проект Bookstore2\_81. WindowsPhone создает пакет приложения для Windows Phone 8,1. Bookstore2\_81. Shared — это проект, содержащий исходный код, файлы разметки и другие активы и ресурсы, которые используются обоими двумя другими проектами.

Как и в предыдущем примере, вариант, который мы будем использовать (из перечисленных в разделе, [Если у вас есть универсальное приложение 8,1](w8x-to-uwp-root.md)), заключается в переносе содержимого общего проекта на Windows 10, предназначенное для универсального семейства устройств.

Начните с создания нового проекта пустого приложения (Windows Universal). Назовите его Bookstore2Universal\_10. Это файлы для копирования из Bookstore2\_81 в Bookstore2Universal\_10.

**Из общего проекта**

-   Скопируйте папку, содержащую PNG-файлы с изображением книги (папка \\активы\\Коверимажес). После копирования убедитесь, что в **Обозревателе решений** включена функция **Показать все файлы**. Щелкните правой кнопкой мыши на скопированной папке и выберите **Включить в проект**. Под выполнением этой команды мы и понимаем включение файлов или папок в проект. Каждый раз, копируя файл или папку, нажимайте **Обновить** в **Обозревателе решений**, а затем включайте этот файл или папку в проект. Для тех файлов, которые вы заменяете в конечном местоположении, выполнять эту операцию не нужно.
-   Скопируйте папку, содержащую исходный файл модели представления (папка — \\ViewModel).
-   Скопируйте файл MainPage.xaml и замените на него файл в конечной папке.

**Из проекта Windows**

-   Скопируйте файл BookstoreStyles.xaml. Мы будем использовать его в качестве хорошей начальной точки, так как все ключи ресурсов в этом файле будут разрешаться в приложении Windows 10. Некоторые из них в эквивалентном файле WindowsPhone не будут.
-   Скопируйте файлы SeZoUC.xaml и SeZoUC.xaml.cs. Начнем с версии этого представления для Windows, которая подходит для широких окон, а затем позднее мы сделаем его адаптируемым к небольшим окнам и, следовательно, небольшим устройствам.

Измените только что скопированный исходный код и файлы разметки и измените все ссылки на пространство имен Bookstore2\_81 на Bookstore2Universal\_10. Эту операцию можно быстро выполнить при помощи функции **Заменить в файлах**. В модель представления или любой другой императивный код вносить изменений не надо. Но, просто чтобы понять, какая версия приложения работает, измените значение свойства **Bookstore2Universal\_10. буксторевиевмодел. AppName** с "Bookstore2\_81" на "Bookstore2Universal\_10".

Сейчас вы можете собрать и запустить приложение. Вот как будет выглядеть новое приложение UWP после того, как оно еще не выполнило перенос в Windows 10.

![Работа приложения для Windows 10 с начальными изменениями исходного кода на ПК в увеличенном масштабе](images/w8x-to-uwp-case-studies/c02-05-desk10-zi-initial-source-code-changes.png)

Приложение Windows 10 с первоначальными изменениями исходного кода, выполняемыми на настольном устройстве, масштабном представлении

![Работа приложения для Windows 10 с начальными изменениями исходного кода на ПК в уменьшенном масштабе](images/w8x-to-uwp-case-studies/c02-06-desk10-zo-initial-source-code-changes.png)

Приложение Windows 10 с первоначальным исходным кодом изменения, выполняемые на настольном устройстве, масштабное представление

Модель представления, а также увеличенное и уменьшенное представления интегрированы правильно, хотя присутствует некоторые проблемы с отображением. Одна из проблем состоит в том, что [**SemanticZoom**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom) не прокручивается. Это связано с тем, что в Windows 10 стиль элемента управления [**GridView**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.GridView) по умолчанию приводит к его расположению по вертикали (и рекомендации по проектированию Windows 10 рекомендуют использовать его в новых и перенесенных приложениях). Но параметры горизонтальной прокрутки в шаблоне панели настраиваемые элементы, скопированные из проекта Bookstore2\_81 (который был разработан для приложения 8,1), конфликтуют с параметрами вертикальной прокрутки в стиле по умолчанию Windows 10, который применяется в результате переноса в приложение Windows 10. Вторая причина — это то, что пользовательский интерфейс приложения еще не адаптирован для обеспечения наилучшего взаимодействия в окнах разных размеров и на небольших устройствах. И третья причина состоит в том, что правильные стили и кисти пока не использовались, и большая часть текста невидима (включая заголовки групп, которые можно нажать, чтобы уменьшить масштаб). В следующих трех разделах ([Изменения дизайна SemanticZoom и GridView](#semanticzoom-and-gridview-design-changes), [Адаптивный пользовательский интерфейс](#adaptive-ui) и [Универсальное оформление](#universal-styling)) мы исправим эти три проблемы.

## <a name="semanticzoom-and-gridview-design-changes"></a>Изменения дизайна SemanticZoom и GridView

Изменения в разработке Windows 10 для элемента управления [**семантикзум**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom) описаны в разделе [семантикзум Changes](w8x-to-uwp-porting-xaml-and-ui.md). У нас нет заданий для выполнения в этом разделе в ответ на эти изменения.

Изменения [**GridView**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.GridView) описаны в разделе [Изменения элементов проектирования GridView/ListView](w8x-to-uwp-porting-xaml-and-ui.md). Нам нужно сделать незначительные настройки, необходимые для адаптации к этим изменениям, и они описаны ниже.

-   В файле SeZoUC.xaml для `ZoomedInItemsPanelTemplate` установите значения `Orientation="Horizontal"` и `GroupPadding="0,0,0,20"`.
-   В файле SeZoUC.xaml удалите `ZoomedOutItemsPanelTemplate`, а также удалите атрибут `ItemsPanel` из реализации уменьшенного представления.

Вот и все!

## <a name="adaptive-ui"></a>Адаптивный пользовательский интерфейс

После этого изменения макет пользовательского интерфейса, который обеспечивает SeZoUC.xaml, выглядит отлично, когда приложение запущено в широком окне (а это возможно только на устройстве с большим экраном). Но когда окно приложения узкое (это часто случается на небольших устройствах, но может также произойти и на большом устройстве), наиболее подходящим будет интерфейс, который использовался в приложении Магазина Windows Phone.

Для этих целей мы можем использовать адаптивную функцию диспетчера визуальных состояний. Зададим свойства визуальных элементов, так чтобы по умолчанию пользовательский интерфейс помещался в узком состоянии с использованием меньших шаблонов, используемых в приложении Магазина Windows Phone. Затем необходимо определить, когда окно приложения "более широкое" или "эквивалентное" для конкретного размера (измеренного в [эффективных пикселях](w8x-to-uwp-porting-xaml-and-ui.md)) и изменим свойства визуальных элементов, чтобы получить больший и более широкий макет. Мы внесем эти изменения свойств в визуальное состояние и будем использовать адаптивный триггер для постоянного контроля и определения, следует ли применять это визуальное состояние или нет, в зависимости от ширины окна в эффективные пикселях. В данном случае мы активируем на ширине окна, но можно также активировать на высоте окна.

Минимальная ширина окна в 548 epx подходит для нашего примера, так как это размер самого небольшого устройства, на котором мы хотели бы отображать широкий макет. Размер экрана телефона обычно не превышает 548 epx, поэтому на таком небольшом устройстве, мы можем использовать стандартный узкий макет. На компьютере окно по умолчанию запускается достаточно широким для активации переключения к широкому состоянию. В этом состоянии вы сможете перетащить окно и сделать его достаточно узким для отображения двух столбцов элементов размером 250x250. При размере чуть более узком триггер будет отключен, широкое визуальное состояние будет удалено и стандартный узкий макет будет использоваться.

Итак, какие свойства требуется установить и изменить для использования этих двух различных макетов? Существуют две альтернативы, и каждая использует свой подход.

1.  Мы можем добавить два элемента управления [**SemanticZoom**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom) в нашу разметку. Одна из них будет копией разметки, которую мы использовали в приложении среда выполнения Windows 8. x (с помощью элементов управления [**GridView**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.GridView) внутри него) и свернут по умолчанию. А другая будет копией разметки, используемой в приложении Магазина Windows Phone (элементы управления [**ListView**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.ListView) используются внутри нее), и она будет по умолчанию видимой. Визуальное состояние будет переключать свойства видимости этих двух элементов управления **SemanticZoom**. Для этого потребуется совсем немного усилий, но, в целом, это не высокопроизводительный метод. Поэтому, если вы выберете его, выполните профилирование вашего приложения и убедитесь, что оно по-прежнему соответствует целям по производительности.
2.  Или можно использовать [**SemanticZoom**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom), где будут содержаться оба элемента управления [**ListView**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.ListView). Для обеспечения возможности использования двух макетов в широком визуальном состоянии нам нужно изменить свойства элементов управления **ListView**, включая шаблоны, применяемые к ним, чтобы они размещались так же, как размещается [**GridView**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.GridView). Производительность этого варианта может быть более высокой, но существует так много незначительных различий между разными стилями и шаблонами **GridView** и **ListView**, а также между различными типами их элементов, что это решение становится более сложно реализовать. Это решение также тесно связано со способом разработки стандартных стилей и шаблонов, которые используются в данный момент, что приводит к высокой чувствительности такого решения к любым будущим изменениям параметров по умолчанию.

В этом примере мы будем использовать первый вариант. Но при желании вы можете попробовать реализовать второй вариант и проверить, будет ли он более подходящим для вас. Вот какие действия нужно выполнить, чтобы реализовать первый вариант.

-   В [**SemanticZoom**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom) в разметке нового проекта установите значения `x:Name="wideSeZo"` и `Visibility="Collapsed"`.
-   Вернитесь в проект Bookstore2\_81. WindowsPhone и откройте Сезаук. XAML. Скопируйте разметку элемента [**SemanticZoom**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom) из этого файла и вставьте сразу после `wideSeZo` в новом проекте. Установите `x:Name="narrowSeZo"` для элемента, который вы только что вставили.
-   Но для `narrowSeZo` нужны несколько стилей, которые мы еще не скопировали. В Bookstore2\_81. WindowsPhone скопируйте два стиля (`AuthorGroupHeaderContainerStyle` и `ZoomedOutAuthorItemContainerStyle`) из Сезаук. XAML и вставьте их в Буксторестилес. XAML в новом проекте.
-   Теперь у вас есть два элемента [**SemanticZoom**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.SemanticZoom) в новом файле SeZoUC.xaml. Заключите эти два элемента в **Grid**.
-   В файле BookstoreStyles.xaml в новом проекте добавьте слово `Wide` к этим трем ключам ресурсов (и к ссылкам на них в файле SeZoUC.xaml, но только в ссылкам внутри `wideSeZo`): `AuthorGroupHeaderTemplate`, `ZoomedOutAuthorTemplate` и `BookTemplate`.
-   В проекте Bookstore2\_81. WindowsPhone откройте Буксторестилес. XAML. В этом файле скопируйте те же три ресурса (упомянутые выше) и два конвертера элементов списка переходов, а\_объявление префикса пространства имен\_XAML\_элементы управления\_примитивы и вставьте их в Буксторестилес. XAML в новом проекте.
-   Наконец, в SeZoUC.xaml в новом проекте добавьте соответствующую разметку диспетчера визуальных состояний в элемент **Grid**, добавленный ранее.

```xml
    <Grid>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState x:Name="WideState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="548"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="wideSeZo.Visibility" Value="Visible"/>
                        <Setter Target="narrowSeZo.Visibility" Value="Collapsed"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

    ...

    </Grid>
```

## <a name="universal-styling"></a>Универсальное оформление

Теперь нужно исправить некоторые проблемы с оформлением, в том числе те, которые мы вызвали ранее, выполняя копирование из старого проекта.

-   В файле MainPage.xaml измените фон `LayoutRoot` на `"{ThemeResource ApplicationPageBackgroundThemeBrush}"`.
-   В файле BookstoreStyles.xaml установите для источника `TitlePanelMargin` значение `0` (или другое значение, которое, по вашему мнению, выглядит хорошо).
-   В файле SeZoUC.xaml установите для поля `wideSeZo` значение `0` (или другое значение, которое, по вашему мнению, выглядит хорошо).
-   В файле BookstoreStyles.xaml удалите атрибут поля из `AuthorGroupHeaderTemplateWide`.
-   Удалите атрибут FontFamily из `AuthorGroupHeaderTemplate` и `ZoomedOutAuthorTemplate`.
-   Bookstore2\_81 использовала ключи ресурсов `BookTemplateTitleTextBlockStyle`, `BookTemplateAuthorTextBlockStyle`и `PageTitleTextBlockStyle` в качестве косвенного обращения, чтобы один ключ имел разные реализации в двух приложениях. Мы более не нуждаемся в этом методе обхода и можем ссылаться на стили системы напрямую. Замените эти ссылки во всем приложении на `TitleTextBlockStyle`, `CaptionTextBlockStyle` и `HeaderTextBlockStyle` соответственно. Эту операцию можно быстро и точно выполнить при помощи функции **Заменить в файлах** в Visual Studio. Эти три неиспользуемые ресурса можно удалить.
-   В `AuthorGroupHeaderTemplate` замените `PhoneAccentBrush` на `SystemControlBackgroundAccentBrush` и установите значение `Foreground="White"` для **TextBlock**, чтобы обеспечить правильное отображение на семействе мобильных устройств.
-   В `BookTemplateWide` скопируйте атрибут Foreground из второго **TextBlock** в первый.
-   В `ZoomedOutAuthorTemplateWide` замените ссылку на `SubheaderTextBlockStyle` (который сейчас слишком велик) ссылкой на `SubtitleTextBlockStyle`.
-   Уменьшенное представление (список переходов) больше не перекрывает увеличенное представление на новой платформе, поэтому мы можем удалить атрибут `Background` из реализации уменьшенного представления `narrowSeZo`.
-   Теперь, когда все стили и шаблоны собраны в одном файле, переместите `ZoomedInItemsPanelTemplate` из файла SeZoUC.xaml в файл BookstoreStyles.xaml.

После описанных выше действий приложение будет выглядеть так.

![Перенесенное приложение для Windows 10, запущенное на настольном устройстве, в увеличенном представлении, которое в два раза превышает размеры окна](images/w8x-to-uwp-case-studies/c02-07-desk10-zi-ported.png)

Приложение с переносом Windows 10, работающее на настольном устройстве, уменьшенное представление, два размера окна

![Перенесенное приложение для Windows 10, запущенное на настольном устройстве, в уменьшенном представлении, которое в два раза превышает размеры окна](images/w8x-to-uwp-case-studies/c02-08-desk10-zo-ported.png)

Приложение с переносом Windows 10, работающее на настольном устройстве, уменьшенное представление, два размера окна

![Перенесенное приложение для Windows 10 запущено на мобильном устройстве в увеличенном представлении](images/w8x-to-uwp-case-studies/c02-09-mob10-zi-ported.png)

Приложение с переносом Windows 10, работающее на мобильном устройстве, масштабное представление

![Перенесенное приложение для Windows 10 запущено на мобильном устройстве в уменьшенном представлении](images/w8x-to-uwp-case-studies/c02-10-mob10-zo-ported.png)

Приложение с переносом Windows 10, работающее на мобильном устройстве, уменьшенное представление

## <a name="conclusion"></a>Заключение

В этом примере представлен более амбициозный пользовательский интерфейс, чем в предыдущем примере. Как и в предыдущем примере, для этой конкретной модели представления не потребовалось выполнять много работы, и все наши усилия были преимущественно потрачены на рефакторинг пользовательского интерфейса. Некоторые изменения потребовались в результате группирования двух проектов и для обеспечения поддержки большого количества форм-факторов (на самом деле намного большего количества, чем когда-либо ранее). И некоторые изменения были связаны с изменениями, которые были применены к платформе.

Следующий пример — [QuizGame](w8x-to-uwp-case-study-quizgame.md), где мы рассмотрим доступ к сгруппированным данным и их и отображение.
