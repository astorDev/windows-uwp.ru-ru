---
author: seksenov
title: "Размещенные веб-приложения. Получение доступа к функциям универсальной платформы Windows (UWP) и API среды выполнения"
description: "С помощью удаленного сценария JavaScript можно получать доступ к собственным функциям универсальной платформы Windows (UWP) и API среды выполнения Windows 10, в том числе к голосовым командам Кортаны, живым плиткам, ACUR для обеспечения безопасности, а также OpenID и OAuth."
kw: Hosted Web Apps, Accessing Windows 10 features from remote JavaScript, Building a Win10 Web Application, Windows JavaScript Apps, Microsoft Web Apps, HTML5 app for PC, ACUR URI Rules for Windows App, Call Live Tiles with web app, Use Cortana with web app, Access Cortana from website, msapplication-cortanavcd
translationtype: Human Translation
ms.sourcegitcommit: 3de603aec1dd4d4e716acbbb3daa52a306dfa403
ms.openlocfilehash: fb74bfc40750941860dae0a8f811fde4a614e403

---

# Доступ к функциям универсальной платформы Windows (UWP)

Ваше веб-приложение может получать полный доступ к универсальной платформе Windows (UWP), активировать собственные функции устройств с Windows, [использовать преимущества средств обеспечения безопасности Windows](#keep-your-app-secure-setting-application-content-uri-rules-acurs), [вызывать API среды выполнения Windows](#call-windows-runtime-apis) непосредственно из размещенного на сервере сценария, использовать [интеграцию с Кортаной](#integrate-cortana-voice-commands), а также работать с [поставщиком проверки подлинности в Интернете](#web-authentication-broker). Также поддерживаются [гибридные приложения](#create-hybrid-apps-packaged-web-apps-vs-hosted-web-apps). Вы можете включить локальный код, который будет вызываться из размещенного сценария, и управлять навигацией по приложению на удаленных и локальных страницах.

## Обеспечение безопасности приложения. Настройка правил универсального кода ресурса (URI) для содержимого приложения (ACUR)

С помощью правил универсального кода ресурса (URI) для содержимого приложения (ACUR), также известных как список разрешенных URL-адресов, вы можете предоставлять удаленным URL-адресам прямой доступ к универсальным API Windows из удаленных файлов HTML, стилей CSS и сценариев JavaScript. На уровне ОС Windows установлены необходимые ограничения политики, которые разрешают коду, хранящемуся на веб-сервере, напрямую вызывать API платформы. Вы определяете эти ограничения в манифесте пакета приложения, когда задаете набор URL-адресов, составляющих размещенное веб-приложение в правилах универсального кода ресурса (URI) для содержимого приложения (ACUR). Правила должны включать начальную страницу приложения и любые другие страницы, которые следует включить как страницы приложения. Дополнительно можно также исключить определенные URL-адреса.

Существует несколько способов указать соответствие URL-адресов в правилах.

- Точное имя узла
- Имя узла, для которого включен или исключен универсальный код ресурса (URI) со всеми поддоменами этого имени узла
- Точный URI
- Точный URI, который может содержать свойство запроса
- Частичный путь и подстановочный знак для указания конкретного расширения файлов
- Относительные пути для правил исключения

Если пользователь перейдет на URL-адрес, которое не включен в правила, Windows открывает целевой URL-адрес в браузере.

Ниже приведены несколько примеров ACUR.

```HTML
<Application
Id="App"
StartPage="http://contoso.com/home">
<uap:ApplicationContentUriRules>
    <uap:Rule Type="include" Match="https://contoso.com/" WindowsRuntimeAccess="all" />
    <uap:Rule Type="include" Match="https://*.contoso.com/" WindowsRuntimeAccess="all" />
    <uap:Rule Type="exclude" Match="https://contoso.com/excludethispage.aspx" />
</uap:ApplicationContentUriRules>
```

## Вызов интерфейсов API среды выполнения Windows

Если URL-адрес определяется в ограничениях приложения (ACUR), он может вызвать API среды выполнения Windows с помощью сценария JavaScript благодаря использованию атрибута WindowsRuntimeAccess. Пространство имен Windows включается в модуль сценария при загрузке URL-адреса с соответствующим уровнем доступа на хост приложений. Это позволяет сценариям приложения напрямую вызывать универсальные API Windows. Разработчику просто требуется добавить функцию обнаружения вызываемого API Windows и, если это возможно, перейти к использованию функций платформы.

Для этого необходимо указать атрибут `(WindowsRuntimeAccess="<<level>>")` в правилах ACUR с одним из следующих значений.

- **all**: удаленный код JavaScript получает доступ ко всем API платформы UWP и всем локальным компонентам в пакете.
- **allowForWeb**: удаленный код JavaScript получает доступ только к пользовательским компонентам в коде пакета. Локальный доступ к пользовательским компонентам C++/C#
- **none**: стандартное значение. Указанный URL-адрес не получает доступ к платформе.

Ниже приведен пример типа правила.

```HTML
<uap:ApplicationContentUriRules>
    <uap:Rule Type="include" Match="http://contoso.com/" WindowsRuntimeAccess="all"  />
</uap:ApplicationContentUriRules>
```

Этот код дает сценарию, запущенному на сайте http://contoso.com/, доступ к пространствам имен среды выполнения Windows и пользовательским компонентам в пакете. См. пример [Windows.UI.Notifications.js](https://gist.github.com/Gr8Gatsby/3d471150e5b317eb1813#file-windows-ui-notifications-js) на GitHub для ознакомления со всплывающими уведомлениями.

В следующем примере показано, как создавать живую плитку и обновлять ее из удаленного кода JavaScript.

```Javascript
function updateTile(message, imgUrl, imgAlt) {
    // Namespace: Windows.UI.Notifications

    if (typeof Windows !== 'undefined'&&
            typeof Windows.UI !== 'undefined' &&
            typeof Windows.UI.Notifications !== 'undefined') {  
        var notifications = Windows.UI.Notifications,
        tile = notifications.TileTemplateType.tileSquare150x150PeekImageAndText01,
        tileContent = notifications.TileUpdateManager.getTemplateContent(tile),
        tileText = tileContent.getElementsByTagName('text'),
        tileImage = tileContent.getElementsByTagName('image');  
        tileText[0].appendChild(tileContent.createTextNode(message || 'Demo Message'));
        tileImage[0].setAttribute('src', imgUrl || 'https://unsplash.it/150/150/?random');
        tileImage[0].setAttribute('alt', imgAlt || 'Random demo image');    
        var tileNotification = new notifications.TileNotification(tileContent);
        var currentTime = new Date();
        tileNotification.expirationTime = new Date(currentTime.getTime() + 600 * 1000);
        notifications.TileUpdateManager.createTileUpdaterForApplication().update(tileNotification);
    } else {
        //Alternative behavior

    }
}
```

Этот код создает плитку, которая выглядит примерно так.

![Вызов живой плитки в Windows 10](images/hwa-to-uwp/hwa_livetile.png)

Вы можете вызывать API среды выполнения Windows с помощью любых известных вам методов, сохранив перед вызовом ресурсы на сервере, обеспечивающем обнаружение возможностей Windows. Если возможности платформы недоступны, а веб-приложение запущено на другом узле, вы можете предоставить пользователю стандартные средства взаимодействия с помощью браузера.

## Интеграция голосовых команд Кортаны

Вы можете воспользоваться преимуществами интеграции с Кортаной, указав файл определения голосовых команд (VCD) на HTML-странице. VCD-файл является XML-файлом, в котором команды сопоставлены определенным фразам. Например, пользователь может коснуться кнопки «Пуск» и произнести фразу «Contoso Books, показать бестселлеры», чтобы запустить приложение Contoso Books и перейти в нем на страницу бестселлеров.

При добавлении тега элемента `<meta>`, в котором приведено местоположение вашего VCD-файла, Windows автоматически загружает и регистрирует файл определения голосовых команд.

Вот пример использования тега на HTML-странице в размещенном веб-приложении.

```HTML
<meta name="msapplication-cortanavcd" content="http:// contoso.com/vcd.xml"/>
```

Подробнее об интеграции Кортаны и VCD-файлов см. в руководстве «Взаимодействие с Кортаной, а также элементы и атрибуты определения голосовых команд (VCD), вер. 1.2».

## Создание гибридных приложений. Упакованные и размещенные веб-приложения

Вы можете использовать различные варианты создания приложения UWP. Приложение может быть предназначено для загрузки из Магазина Windows и полного размещения на локальном клиенте. Обычно такое приложение называется **упакованным веб-приложением**. Такой сценарий позволяет запускать приложение в автономном режиме на любой совместимой платформе. Приложения также могут представлять собой полностью размещенные веб-приложения, запускаемые на удаленном веб-сервере. Обычно такие приложения называются **размещенными веб-приложениями**. Кроме того, существует третий вариант: приложение может быть частично размещено на локальном клиенте и частично — на удаленном веб-сервере. Такие приложения называются **гибридными**. В этом случае обычно используется компонент **WebView**, благодаря которому удаленное содержимое выглядит как локальное. Гибридные приложения могут включать код HTML5, CSS и Javascript, работающий в качестве пакета в локальном клиенте приложения и сохраняющий способность взаимодействовать с удаленным содержимым.

## Брокер веб-проверки подлинности

С помощью брокера веб-проверки подлинности можно обрабатывать процедуру входа пользователей, если у вас есть поставщик интернет-удостоверений, который использует проверку подлинности в Интернете, и задействованы такие протоколы авторизации, как OpenID или OAuth. Начальный и конечный URI указываются в теге `<meta>` на HTML-странице в вашем приложении. Windows определяет эти URI и передает их брокеру веб-проверки подлинности для выполнения процедуры входа. Начальный URI запроса состоит из адреса, по которому поставщику отправляется запрос проверки подлинности, и другой необходимой информации (например, идентификатора приложения или секретных данных), а также URI перенаправления, по которому переходит пользователь, завершивший проверку подлинности, и ожидаемого типа ответа. Вы можете выяснить у поставщика, какие именно параметры необходимы. Ниже приведен пример использования тега `<meta>`.

```HTML
<meta name="ms-webauth-uris" content="https://<providerstartpoint>?client_id=<clientid>&response_type=token, https://<appendpoint>"/>
```

Дополнительные рекомендации см. в разделе [Рекомендации по брокеру веб-проверки подлинности для сетевых поставщиков](https://msdn.microsoft.com/library/windows/apps/dn448956.aspx).

## Объявления возможностей приложения

Для приложений, которым необходим программный доступ к ресурсам пользователя, например к изображениям или музыке, или к таким устройствам, как камера или микрофон, необходимо объявить соответствующую возможность. Ниже приводятся три категории объявления возможностей приложения. 

- [Возможности общего применения](https://msdn.microsoft.com/library/windows/apps/Mt270968.aspx#General-use_capabilities), которые используются в большей части сценариев приложений. 
- [Возможности устройства](https://msdn.microsoft.com/library/windows/apps/Mt270968.aspx#Device_capabilities), которые позволяют вашему приложению получать доступ к периферийным и внутренним устройствам. 
- [Особые возможности](https://msdn.microsoft.com/library/windows/apps/Mt270968.aspx#Special_and_restricted_capabilities), для использования которых приложение необходимо отправить в Магазин с помощью особой учетной записи компании. 

Подробнее об учетных записях компаний см. в разделе [Типы, доступность и стоимость учетных записей](https://msdn.microsoft.com/library/windows/apps/jj863494.aspx).

> [!NOTE]
> Не забывайте, что когда пользователи загружают ваше приложение из Магазина Windows, они получают уведомление обо всех объявленных возможностях приложения. Поэтому не используйте возможности, которые вашему приложению не требуются.

Запрос доступа осуществляется с помощью объявления возможностей в [манифесте пакета](https://msdn.microsoft.com/library/windows/apps/br211474.aspx) приложения. Общие возможности можно объявить с помощью [конструктора манифестов](https://msdn.microsoft.com/library/windows/apps/xaml/hh454036(v=vs.140).aspx#Configure) в Microsoft Visual Studio или добавить вручную (см. раздел [Определение возможностей в манифесте пакета](https://msdn.microsoft.com/library/windows/apps/br211477.aspx)).

Некоторые возможности обеспечивают приложениям доступ к конфиденциальным ресурсам. Эти ресурсы считаются конфиденциальными, так как они могут получать доступ к личным данным пользователя или стоить пользователю денег. Настройки конфиденциальности, управляемые приложением «Параметры», позволяют пользователю динамически управлять доступом к конфиденциальным ресурсам. Таким образом, важно, чтобы приложение не считало конфиденциальные ресурсы всегда доступными. Подробнее о доступе к конфиденциальным ресурсам см. в разделе [Руководство по приложениям, учитывающим требования конфиденциальности](https://msdn.microsoft.com/library/windows/apps/hh768223.aspx).

## manifoldjs и манифест приложения

Простой способ превратить ваш веб-сайт в приложение UWP — использовать **манифест приложения** и **manifoldjs**. Манифест приложения — это XML-файл, содержащий метаданные о приложении. В нем указаны имя приложения, ссылки на ресурсы, режим отображения, URL-адреса и другие данные, описывающие то, как необходимо развертывать и запускать приложение. manifoldjs значительно упрощает этот процесс даже на системах, не поддерживающих веб-приложения. Дополнительные сведения о принципах работы manifoldjs см. на веб-сайте [manifoldjs.com](http://www.manifoldjs.com/). Кроме того, можно посмотреть демонстрацию manifoldjs, входящую в состав презентации [Веб-приложения Windows 10](http://channel9.msdn.com/Events/WebPlatformSummit/2015/Hosted-web-apps-and-web-platform-innovations?wt.mc_id=relatedsession).

## Связанные разделы
- [API среды выполнения Windows: примеры кода на JavaScript](http://rjs.azurewebsites.net/)
- [Codepen: песочница для использования при вызовах интерфейсов API среды выполнения Windows](http://codepen.io/seksenov/pen/wBbVyb/)
- [Взаимодействие с Кортаной](https://msdn.microsoft.com/library/windows/apps/dn974231.aspx)
- [Элементы и атрибуты определения голосовых команд (VCD), версия 1.2](https://msdn.microsoft.com/library/windows/apps/dn954977.aspx)
- [Рекомендации по брокеру веб-проверки подлинности для сетевых поставщиков](https://msdn.microsoft.com/library/windows/apps/dn448956.aspx)
- [Объявления возможностей приложения](https://msdn.microsoft.com/ibrary/windows/apps/hh464936.aspx)


<!--HONumber=Aug16_HO3-->


