---
title: Пример переноса среды выполнения Windows 8.x в UWP, Bookstore1
ms.assetid: e4582717-afb5-4cde-86bb-31fb1c5fc8f3
description: В этом разделе представлен пример того, как перенести очень простое универсальное приложение 8,1 в приложение Windows 10 универсальная платформа Windows (UWP).
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: ecbc4d3fcdff9d06469e7a274fd56ef453a81e02
ms.sourcegitcommit: b52ddecccb9e68dbb71695af3078005a2eb78af1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2019
ms.locfileid: "74260123"
---
# <a name="windows-runtime-8x-to-uwp-case-study-bookstore1"></a>Пример переноса среды выполнения Windows 8.x в UWP: Bookstore1


В этом разделе представлен пример того, как перенести очень простое универсальное приложение 8,1 в приложение Windows 10 универсальная платформа Windows (UWP). Универсальное приложение 8,1 состоит из одного пакета приложения для Windows 8.1 и другого пакета приложения для Windows Phone 8,1. В Windows 10 можно создать один пакет приложения, который клиенты могут устанавливать на широком спектре устройств, и это будет сделано в нашем примере. См. раздел [Руководство по приложениям UWP](https://docs.microsoft.com/windows/uwp/get-started/universal-application-platform-guide).

Приложение, которое мы будем портировать, состоит из элемента **ListBox**, привязанного к модели представления. Модель представления содержит список книг, в котором отображается заголовок, имя автора и обложка книги. У изображений обложки книги **Действие при сборке** установлено на **Содержимое**, а **Копировать в выходной каталог** установлено на **Не копировать**.

Предыдущая тема в этом разделе описывает различия между платформами. Это описание содержит подробные сведения и руководство по переносу различных элементов приложения из разметки XAML через привязку к модели представления и далее к доступу к данным. Цель этого практического примера — дополнить это руководство, показывая его в действии на реальном примере. Предполагается, что вы ознакомились с этим руководством, которое в данных примерах не повторяется.

**Обратите внимание** ,   при открытии Bookstore1Universal\_10 в Visual Studio, если отображается сообщение "требуется обновление Visual Studio", выполните действия, описанные в [TargetPlatformVersion](w8x-to-uwp-troubleshooting.md).

## <a name="downloads"></a>Загрузки

[Скачайте приложение Bookstore1\_81 Universal 8,1](https://codeload.github.com/MicrosoftDocs/windows-topic-specific-samples/zip/Bookstore1_81).

[Скачайте приложение Bookstore1Universal\_10 Windows 10](https://codeload.github.com/MicrosoftDocs/windows-topic-specific-samples/zip/Bookstore1Universal_10).

## <a name="the-universal-81-app"></a>Универсальное приложение для версии 8.1

Вот что такое Bookstore1\_81 — приложение, которое мы будем переносить, — выглядит так. Это просто список книг с вертикальной прокруткой под заголовком имени и названия страницы приложения.

![как bookstore1\-81 отображается в Windows](images/w8x-to-uwp-case-studies/c01-01-win81-how-the-app-looks.png)

Bookstore1\_81 в Windows

![как bookstore1\-81 выглядит в Windows Phone](images/w8x-to-uwp-case-studies/c01-02-wp81-how-the-app-looks.png)

Bookstore1\_81 на Windows Phone

##  <a name="porting-to-a-windows10-project"></a>Перенос в проект Windows 10

Решение Bookstore1\_81 — это проект универсального приложения 8,1, который содержит эти проекты.

-   Bookstore1\_81. Windows. Это проект, который строит пакет приложения для Windows 8.1.
-   Bookstore1\_81. WindowsPhone. Этот проект создает пакет приложения для Windows Phone 8.1.
-   Bookstore1\_81. Shared. Этот проект содержит исходный код, файлы разметки и другие ресурсы, которые используются обоими приложениями.

В этом примере мы выберем обычные параметры, описанные в разделе [Если у вас универсальное приложение для версии 8.1](w8x-to-uwp-root.md), которые относятся к поддержке устройств. Решение здесь является простым: это приложение имеет те же функции и делает это в основном с тем же кодом, как в его Windows 8.1, так и в Windows Phone 8,1 Forms. Итак, мы будем переносить содержимое общего проекта (и все, что нам нужно из других проектов) в Windows 10, предназначенное для универсального семейства устройств (которое можно установить на самых широком диапазоне устройств).

Это очень быстрая задача создания нового проекта в Visual Studio, копирования в него файлов из Bookstore1\_81 и включения скопированных файлов в новый проект. Начните с создания нового проекта пустого приложения (Windows Universal). Назовите его Bookstore1Universal\_10. Это файлы для копирования из Bookstore1\_81 в Bookstore1Universal\_10.

**Из общего проекта**

-   Скопируйте папку, содержащую PNG-файлы с изображением книги (папка \\активы\\Коверимажес). После копирования убедитесь, что в **Обозревателе решений** включена функция **Показать все файлы**. Щелкните правой кнопкой мыши на скопированной папке и выберите **Включить в проект**. Под выполнением этой команды мы и понимаем включение файлов или папок в проект. Каждый раз, копируя файл или папку, нажимайте **Обновить** в **Обозревателе решений**, а затем включайте этот файл или папку в проект. Для тех файлов, которые вы заменяете в конечном местоположении, выполнять эту операцию не нужно.
-   Скопируйте папку, содержащую исходный файл модели представления (папка — \\ViewModel).
-   Скопируйте файл MainPage.xaml и замените на него файл в конечной папке.

**Из проекта Windows**

-   Скопируйте файл BookstoreStyles.xaml. Мы будем использовать его в качестве хорошей начальной точки, так как все ключи ресурсов в этом файле будут разрешаться в приложении Windows 10. Некоторые из них в эквивалентном файле WindowsPhone не будут.

Измените только что скопированный исходный код и файлы разметки и измените все ссылки на пространство имен Bookstore1\_81 на Bookstore1Universal\_10. Эту операцию можно быстро выполнить при помощи функции **Заменить в файлах**. В модель представления или любой другой императивный код вносить изменений не надо. Но, просто чтобы понять, какая версия приложения работает, измените значение свойства **Bookstore1Universal\_10. буксторевиевмодел. AppName** с "BOOKSTORE1\_81" на "Bookstore1Universal\_10".

Сейчас вы можете собрать и запустить приложение. Вот как выглядит новое приложение UWP после того, как не сделали явной работы, чтобы перенести его на Windows 10.

![Приложение для Windows 10 с начальными изменениями исходного кода](images/w8x-to-uwp-case-studies/c01-03-desk10-initial-source-code-changes.png)

Приложение Windows 10 с исходными изменениями исходного кода, запущенными на настольном устройстве

![Приложение для Windows 10 с начальными изменениями исходного кода](images/w8x-to-uwp-case-studies/c01-04-mob10-initial-source-code-changes.png)

Приложение Windows 10 с исходными изменениями исходного кода, запущенными на мобильном устройстве

Представление и модель представления правильно работают друг с другом, а элемент **ListBox** выполняет свои функции. Нам необходимо только подкорректировать оформление. На мобильном устройстве при выборе светлой темы заметна граница списка. Ее нетрудно скрыть. Кроме того, текст слишком велик, поэтому мы изменим используемый стиль. Также приложение должно отображаться в светлых тонах при запуске на ПК, если мы хотим, чтобы оно выглядело так же, как и по умолчанию. Мы изменим цвет.

## <a name="universal-styling"></a>Универсальное оформление

Приложение Bookstore1\_81 использовало два разных словаря ресурсов (Буксторестилес. XAML) для адаптации своих стилей к Windows 8.1 и Windows Phone 8,1 операционных систем. Ни один из этих двух файлов Буксторестилес. XAML не содержит именно те стили, которые необходимы для нашего приложения Windows 10. Но, к счастью, то, что нам нужно, на самом деле, намного проще любого из них. Поэтому далее мы в основном будем заниматься удалением и упрощением файлов и разметки нашего проекта. Порядок действий описан ниже. Вы можете использовать ссылки в верхней части данного раздела, чтобы загрузить проекты и сравнить результаты всех изменений на данном этапе и в конце примера.

-   Чтобы сократить расстояние между элементами, найдите шаблон данных `BookTemplate` в файле MainPage.xaml и удалите `Margin="0,0,0,8"` из корневого элемента **Grid**.
-   Также в `BookTemplate` есть ссылки на `BookTemplateTitleTextBlockStyle` и `BookTemplateAuthorTextBlockStyle`. Bookstore1\_81 использует эти ключи в качестве косвенного обращения, чтобы один ключ имел разные реализации в двух приложениях. Мы более не нуждаемся в этом методе обхода и можем ссылаться на стили системы напрямую. Замените эти ссылки на `TitleTextBlockStyle` и `SubtitleTextBlockStyle` соответственно.
-   Теперь нам необходимо задать корректное значение по умолчанию для фона `LayoutRoot`, чтобы приложение выглядело соответствующим образом при запуске на всех устройствах вне зависимости от используемой темы. Измените его с `"Transparent"` на `"{ThemeResource ApplicationPageBackgroundThemeBrush}"`.
-   В `TitlePanel` замените ссылку на `TitleTextBlockStyle` (который сейчас слишком велик) ссылкой на `CaptionTextBlockStyle`. `PageTitleTextBlockStyle` — еще одно Bookstore1\_81, которое больше не требуется. Используйте вместо него ссылку на `HeaderTextBlockStyle`.
-   Нам более не нужно задавать специальные значения для свойств Background, Style или ItemContainerStyle для **ListBox**, поэтому просто удалите эти три атрибута и их значения из файла разметки. Но мы хотим скрыть границу элемента **ListBox**, поэтому добавьте сюда свойство `BorderBrush="{x:Null}"`.
-   Мы не ссылаемся на какие либо ресурсы в **ResourceDictionary** файла BookstoreStyles.xaml. Вы можете удалить все эти ресурсы. Однако не удаляйте сам файл BookstoreStyles.xaml. Как будет видно в следующем разделе, он нам еще понадобится.

После описанных выше действий приложение будет выглядеть так.

![Практически перенесенное приложение для Windows 10](images/w8x-to-uwp-case-studies/c01-05-desk10-almost-ported.png)

Почти перенесенное приложение Windows 10, работающее на настольном устройстве

![Практически перенесенное приложение для Windows 10](images/w8x-to-uwp-case-studies/c01-06-mob10-almost-ported.png)

Почти перенесенное приложение Windows 10, работающее на мобильном устройстве

## <a name="an-optional-adjustment-to-the-list-box-for-mobile-devices"></a>Дополнительная настройка списка для мобильных устройств

При запуске на мобильном устройстве у списка по умолчанию светлый фон при использовании обеих тем. Возможно, вы отдадите предпочтение именно этому стилю. Если это так, то вам более не нужно делать ничего, кроме небольшой уборки. Удалите файл словаря ресурсов BookstoreStyles.xaml из проекта и удалите разметку, которая включает его в MainPage.xaml.

Тем не менее элементы управления спроектированы таким образом, что вы можете настроить их внешний вид, не изменяя поведения. Поэтому если вы хотите, чтобы при использовании темной темы список был темного цвета, как это было в оригинальном приложении, то в этом разделе приводится описание того, как это можно сделать.

То изменение, которое мы вносим, должно влиять на приложение только в том случае, если оно запускается на мобильных устройствах. Поэтому мы будем использовать слегка измененный стиль списка при запуске приложения на семействе мобильных устройств и стиль по умолчанию на остальных устройствах. Для этого мы создадим копию файла BookstoreStyles.xaml и присвоим ему специальное, пригодное для MRT имя, благодаря которому она будет загружаться только на мобильных устройствах.

Добавьте новый элемент проекта **ResourceDictionary** и назовите его BookstoreStyles.DeviceFamily-Mobile.xaml. Теперь у вас есть два файла, оба логических имени которых — BookstoreStyles.xaml (и именно это имя вы используете в разметке и коде). Тем не менее физические имена у файлов разные, поэтому они могут содержать различную разметку. Вы можете использовать эту MRT-совместимую систему именования с любым файлом в формате XAML, но имейте в виду, что все файлы этого формата с одним и тем же логическим именем используют один и тот же файл кода программной части xaml.cs (там где это применимо).

Отредактируйте копию шаблона списка и сохраните ее вместе с ключом `BookstoreListBoxStyle` в новом словаре ресурсов BookstoreStyles.DeviceFamily-Mobile.xaml. Теперь внесем несложные изменения в три метода задания свойств.

-   В методе задания свойств Foreground измените значение на `"{x:Null}"`. Обратите внимание, что изменение значения свойства на `"{x:Null}"` непосредственно для элемента равносильно его изменению на `null` в коде. Однако использование значения `"{x:Null}"` в методе присваивания значения приводит к своеобразному эффекту: оно переопределяет метод присваивания значения в стиле по умолчанию (для одного и того же свойства) и восстанавливает значение по умолчанию для целевого элемента.
-   В методе присваивания значения Background измените значение на `"Transparent"`, чтобы убрать этот светлый фон.
-   В методе присваивания значения Template найдите визуальное состояние `Focused` и удалите его раскадровку, оставив пустой тег.
-   Удалите из разметки все остальные методы присваивания значения.

Наконец, скопируйте `BookstoreListBoxStyle` в файл BookstoreStyles.xaml и удалите три метода присваивания значения, оставив пустой тег. Мы делаем это для того, чтобы на всех устройствах, кроме мобильных, наша ссылка на BookstoreStyles.xaml и `BookstoreListBoxStyle` обрабатывалась, но не применялась.

![перенесенное приложение для windows 10](images/w8x-to-uwp-case-studies/c01-07-mob10-ported.png)

Приложение с переносом Windows 10, работающее на мобильном устройстве

## <a name="conclusion"></a>Заключение

В этом примере показан процесс переноса очень простого приложения, вероятно, нереально простого. Например, список можно использовать для выбора или задания контекста для навигации; приложение переходит на страницу с дополнительной информацией об элементе, которого коснулся пользователь. Данное приложение не выполняет никаких действий с выбором пользователя и не поддерживает ни навигацию. Но даже в этом случае данный пример помог вам познакомиться с процессом портирования и продемонстрировал важные методики, которые вы можете использовать с реальными приложениями UWP.

Мы также убедились в том, что перенос моделей представления обычно происходит без затруднений. Пользовательский интерфейс и поддержка форм-факторов — это те аспекты, которые наиболее вероятно потребуют нашего внимания при переносе.

Следующий пример — [Bookstore2](w8x-to-uwp-case-study-bookstore2.md), где мы рассмотрим доступ к сгруппированным данным и их и отображение.
