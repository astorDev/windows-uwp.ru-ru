---
title: Пример переноса среды выполнения Windows 8.x в UWP, Bookstore1
ms.assetid: e4582717-afb5-4cde-86bb-31fb1c5fc8f3
description: В этом разделе представлен пример использования переноса очень простое приложение Uwp 8.1 приложение 10 универсальных Windows платформы Windows (UWP).
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: fad621eb9b6ef9ef863240644ae0fa46d41baacc
ms.sourcegitcommit: ac7f3422f8d83618f9b6b5615a37f8e5c115b3c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2019
ms.locfileid: "66371604"
---
# <a name="windows-runtime-8x-to-uwp-case-study-bookstore1"></a>Среда выполнения Windows 8.x в UWP пример использования: Bookstore1


В этом разделе представлен пример использования переноса очень простое приложение Uwp 8.1 приложение 10 универсальных Windows платформы Windows (UWP). Приложение Uwp 8.1 — это приложения, создает один пакет приложения для Windows 8.1 и другого пакета приложения для Windows Phone 8.1. С Windows 10, можно создать пакет одним приложением, клиентам можно устанавливать на широкий спектр устройств, и это, что мы перейдем в этом практическом. См. раздел [Руководство по приложениям UWP](https://docs.microsoft.com/windows/uwp/get-started/universal-application-platform-guide).

Приложение, которое мы будем портировать, состоит из элемента **ListBox**, привязанного к модели представления. Модель представления содержит список книг, в котором отображается заголовок, имя автора и обложка книги. У изображений обложки книги **Действие при сборке** установлено на **Содержимое**, а **Копировать в выходной каталог** установлено на **Не копировать**.

Предыдущая тема в этом разделе описывает различия между платформами. Это описание содержит подробные сведения и руководство по переносу различных элементов приложения из разметки XAML через привязку к модели представления и далее к доступу к данным. Цель этого практического примера — дополнить это руководство, показывая его в действии на реальном примере. Предполагается, что вы ознакомились с этим руководством, которое в данных примерах не повторяется.

**Примечание**    при открытии Bookstore1Universal\_10 в Visual Studio, если вы видите сообщение «Требуется Visual Studio обновление», затем выполните действия, описанные в [TargetPlatformVersion](w8x-to-uwp-troubleshooting.md).

## <a name="downloads"></a>Загрузки

[Скачайте Bookstore1\_81 универсальной 8.1 приложение](https://go.microsoft.com/fwlink/?linkid=532946).

[Скачайте Bookstore1Universal\_приложения 10 Windows 10](https://go.microsoft.com/fwlink/?linkid=532950).

## <a name="the-universal-81-app"></a>Универсальное приложение для версии 8.1

Вот какие Bookstore1\_81 — приложение, которое мы собираемся порт, как выглядит. Это просто список книг с вертикальной прокруткой под заголовком имени и названия страницы приложения.

![как bookstore1\-81 выглядит на windows](images/w8x-to-uwp-case-studies/c01-01-win81-how-the-app-looks.png)

Bookstore1\_81 на Windows

![как bookstore1\-81 выглядит на windows phone](images/w8x-to-uwp-case-studies/c01-02-wp81-how-the-app-looks.png)

Bookstore1\_81 на Windows Phone

##  <a name="porting-to-a-windows10-project"></a>Перенос кода в проекте Windows 10

Bookstore1\_81 решение — это 8.1 проект универсального приложения, и она содержит эти проекты.

-   Bookstore1\_81.Windows. Это проект, который создает пакет приложения для Windows 8.1.
-   Bookstore1\_81.WindowsPhone. Этот проект создает пакет приложения для Windows Phone 8.1.
-   Bookstore1\_81.Shared. Этот проект содержит исходный код, файлы разметки и другие ресурсы, которые используются обоими приложениями.

В этом примере мы выберем обычные параметры, описанные в разделе [Если у вас универсальное приложение для версии 8.1](w8x-to-uwp-root.md), которые относятся к поддержке устройств. Здесь решение — это простой продукт: это приложение имеет те же функции и не в основном с тем же кодом, в формах Windows 8.1 и Windows Phone 8.1. Таким образом мы будем порт содержимое общего проекта (и все, что нужно от других проектов) до Windows 10, предназначенного семейству универсальных устройств (по одному, которую можно установить на множестве различных устройств).

Это очень быстро задачи для создания нового проекта в Visual Studio, копирование файлов через к нему из Bookstore1\_81 и включать скопированные файлы в новом проекте. Начните с создания нового проекта пустого приложения (Windows Universal). Назовите его Bookstore1Universal\_10. Файлы для копирования из Bookstore1\_81 для Bookstore1Universal\_10.

**Из общего проекта**

-   Скопируйте папку, содержащую файлы книги охватывают изображений PNG (она \\активы\\CoverImages). После копирования убедитесь, что в **Обозревателе решений** включена функция **Показать все файлы**. Щелкните правой кнопкой мыши на скопированной папке и выберите **Включить в проект**. Под выполнением этой команды мы и понимаем включение файлов или папок в проект. Каждый раз, копируя файл или папку, нажимайте **Обновить** в **Обозревателе решений**, а затем включайте этот файл или папку в проект. Для тех файлов, которые вы заменяете в конечном местоположении, выполнять эту операцию не нужно.
-   Скопируйте папку, содержащую файл исходной модели представления (она \\ViewModel).
-   Скопируйте файл MainPage.xaml и замените на него файл в конечной папке.

**Из проекта Windows**

-   Скопируйте файл BookstoreStyles.xaml. Мы будем использовать этот второй в качестве хорошей начальной точки, так как все ключи ресурсов в этом файле разрешится в приложении Windows 10; Некоторые из них в файле эквивалентное WindowsPhone не будет.

Редактировать файлы исходного кода и разметки, которые были скопированы и измените все ссылки на Bookstore1\_81 пространство имен для Bookstore1Universal\_10. Эту операцию можно быстро выполнить при помощи функции **Заменить в файлах**. В модель представления или любой другой императивный код вносить изменений не надо. Но, чтобы все было проще видеть, какие версии приложение работает, измените значение, возвращенное **Bookstore1Universal\_10.BookstoreViewModel.AppName** свойства из «BOOKSTORE1\_81» к " BOOKSTORE1UNIVERSAL\_10".

Сейчас вы можете собрать и запустить приложение. Вот как выглядит нашего нового приложения UWP после выполнения нет явного задания еще переносить его в Windows 10.

![Приложение для Windows 10 с начальными изменениями исходного кода](images/w8x-to-uwp-case-studies/c01-03-desk10-initial-source-code-changes.png)

Приложения для Windows 10 с первоначального исходного кода изменяется на Настольное устройство

![Приложение для Windows 10 с начальными изменениями исходного кода](images/w8x-to-uwp-case-studies/c01-04-mob10-initial-source-code-changes.png)

Приложения для Windows 10 с первоначального исходного изменения кода, работающие на мобильных устройствах

Представление и модель представления правильно работают друг с другом, а элемент **ListBox** выполняет свои функции. Нам необходимо только подкорректировать оформление. На мобильном устройстве при выборе светлой темы заметна граница списка. Ее нетрудно скрыть. Кроме того, текст слишком велик, поэтому мы изменим используемый стиль. Также приложение должно отображаться в светлых тонах при запуске на ПК, если мы хотим, чтобы оно выглядело так же, как и по умолчанию. Мы изменим цвет.

## <a name="universal-styling"></a>Универсальное оформление

Bookstore1\_81 приложение, используемое две различные словари ресурсов (BookstoreStyles.xaml) чтобы адаптировать его стили к операционным системам Windows 8.1 и Windows Phone 8.1. Ни один из этих двух файлов BookstoreStyles.xaml содержит ровно стили, которые нужны для нашего приложения Windows 10. Но, к счастью, то, что нам нужно, на самом деле, намного проще любого из них. Поэтому далее мы в основном будем заниматься удалением и упрощением файлов и разметки нашего проекта. Порядок действий описан ниже. Вы можете использовать ссылки в верхней части данного раздела, чтобы загрузить проекты и сравнить результаты всех изменений на данном этапе и в конце примера.

-   Чтобы сократить расстояние между элементами, найдите шаблон данных `BookTemplate` в файле MainPage.xaml и удалите `Margin="0,0,0,8"` из корневого элемента **Grid**.
-   Также в `BookTemplate` есть ссылки на `BookTemplateTitleTextBlockStyle` и `BookTemplateAuthorTextBlockStyle`. Bookstore1\_81 использовать эти ключи как косвенное обращение, таким образом, чтобы один ключ имеют разные реализации в двух приложений. Мы более не нуждаемся в этом методе обхода и можем ссылаться на стили системы напрямую. Замените эти ссылки на `TitleTextBlockStyle` и `SubtitleTextBlockStyle` соответственно.
-   Теперь нам необходимо задать корректное значение по умолчанию для фона `LayoutRoot`, чтобы приложение выглядело соответствующим образом при запуске на всех устройствах вне зависимости от используемой темы. Измените его с `"Transparent"` на `"{ThemeResource ApplicationPageBackgroundThemeBrush}"`.
-   В `TitlePanel` замените ссылку на `TitleTextBlockStyle` (который сейчас слишком велик) ссылкой на `CaptionTextBlockStyle`. `PageTitleTextBlockStyle` является другой Bookstore1\_81 косвенного обращения, мы больше не нужен. Используйте вместо него ссылку на `HeaderTextBlockStyle`.
-   Нам более не нужно задавать специальные значения для свойств Background, Style или ItemContainerStyle для **ListBox**, поэтому просто удалите эти три атрибута и их значения из файла разметки. Но мы хотим скрыть границу элемента **ListBox**, поэтому добавьте сюда свойство `BorderBrush="{x:Null}"`.
-   Мы не ссылаемся на какие либо ресурсы в **ResourceDictionary** файла BookstoreStyles.xaml. Вы можете удалить все эти ресурсы. Однако не удаляйте сам файл BookstoreStyles.xaml. Как будет видно в следующем разделе, он нам еще понадобится.

После описанных выше действий приложение будет выглядеть так.

![Практически перенесенное приложение для Windows 10](images/w8x-to-uwp-case-studies/c01-05-desk10-almost-ported.png)

Почти перенесена Windows 10 приложение должно запуститься на Настольное устройство

![Практически перенесенное приложение для Windows 10](images/w8x-to-uwp-case-studies/c01-06-mob10-almost-ported.png)

Приложение Windows 10 почти перенесена, работающее на мобильном устройстве

## <a name="an-optional-adjustment-to-the-list-box-for-mobile-devices"></a>Дополнительная настройка списка для мобильных устройств

При запуске на мобильном устройстве у списка по умолчанию светлый фон при использовании обеих тем. Возможно, вы отдадите предпочтение именно этому стилю. Если это так, то вам более не нужно делать ничего, кроме небольшой уборки. Удалите файл словаря ресурсов BookstoreStyles.xaml из проекта и удалите разметку, которая включает его в MainPage.xaml.

Тем не менее элементы управления спроектированы таким образом, что вы можете настроить их внешний вид, не изменяя поведения. Поэтому если вы хотите, чтобы при использовании темной темы список был темного цвета, как это было в оригинальном приложении, то в этом разделе приводится описание того, как это можно сделать.

То изменение, которое мы вносим, должно влиять на приложение только в том случае, если оно запускается на мобильных устройствах. Поэтому мы будем использовать слегка измененный стиль списка при запуске приложения на семействе мобильных устройств и стиль по умолчанию на остальных устройствах. Для этого мы создадим копию файла BookstoreStyles.xaml и присвоим ему специальное, пригодное для MRT имя, благодаря которому она будет загружаться только на мобильных устройствах.

Добавьте новый элемент проекта **ResourceDictionary** и назовите его BookstoreStyles.DeviceFamily-Mobile.xaml. Теперь у вас есть два файла, оба логических имени которых — BookstoreStyles.xaml (и именно это имя вы используете в разметке и коде). Тем не менее физические имена у файлов разные, поэтому они могут содержать различную разметку. Вы можете использовать эту MRT-совместимую систему именования с любым файлом в формате XAML, но имейте в виду, что все файлы этого формата с одним и тем же логическим именем используют один и тот же файл кода программной части xaml.cs (там где это применимо).

Отредактируйте копию шаблона списка и сохраните ее вместе с ключом `BookstoreListBoxStyle` в новом словаре ресурсов BookstoreStyles.DeviceFamily-Mobile.xaml. Теперь внесем несложные изменения в три метода задания свойств.

-   В методе задания свойств Foreground измените значение на `"{x:Null}"`. Обратите внимание, что изменение значения свойства на `"{x:Null}"` непосредственно для элемента равносильно его изменению на `null` в коде. Однако использование значения `"{x:Null}"` в методе присваивания значения приводит к своеобразному эффекту: оно переопределяет метод присваивания значения в стиле по умолчанию (для одного и того же свойства) и восстанавливает значение по умолчанию для целевого элемента.
-   В методе присваивания значения Background измените значение на `"Transparent"`, чтобы убрать этот светлый фон.
-   В методе присваивания значения Template найдите визуальное состояние `Focused` и удалите его раскадровку, оставив пустой тег.
-   Удалите из разметки все остальные методы присваивания значения.

Наконец, скопируйте `BookstoreListBoxStyle` в файл BookstoreStyles.xaml и удалите три метода присваивания значения, оставив пустой тег. Мы делаем это для того, чтобы на всех устройствах, кроме мобильных, наша ссылка на BookstoreStyles.xaml и `BookstoreListBoxStyle` обрабатывалась, но не применялась.

![перенесенное приложение для windows 10](images/w8x-to-uwp-case-studies/c01-07-mob10-ported.png)

Перенесенном Windows 10 приложение, работающее на мобильном устройстве

## <a name="conclusion"></a>Заключение

В этом примере показан процесс переноса очень простого приложения, вероятно, нереально простого. Например, список можно использовать для выбора или задания контекста для навигации; приложение переходит на страницу с дополнительной информацией об элементе, которого коснулся пользователь. Данное приложение не выполняет никаких действий с выбором пользователя и не поддерживает ни навигацию. Но даже в этом случае данный пример помог вам познакомиться с процессом портирования и продемонстрировал важные методики, которые вы можете использовать с реальными приложениями UWP.

Мы также убедились в том, что перенос моделей представления обычно происходит без затруднений. Пользовательский интерфейс и поддержка форм-факторов — это те аспекты, которые наиболее вероятно потребуют нашего внимания при переносе.

Следующий пример — [Bookstore2](w8x-to-uwp-case-study-bookstore2.md), где мы рассмотрим доступ к сгруппированным данным и их и отображение.
