---
author: awkoren
Description: "Подготовьте ваше классическое приложение для Windows (например, Win32, WPF и Windows Forms) к преобразованию в приложение для универсальной платформы Windows (UWP) с помощью расширений для преобразования классических приложений."
Search.Product: eADQiWindows 10XVcnh
title: "Преобразование классического приложения в приложение для универсальной платформы Windows (UWP)"
translationtype: Human Translation
ms.sourcegitcommit: ff8cd3ab5e38cfc3a2b5fabaad15f78a5f2620f2
ms.openlocfilehash: 6cf6367ed0f6acea0f87ac36a050e874425423b1

---

# Преобразование классического приложения в приложение для универсальной платформы Windows (UWP)

\[Некоторые сведения относятся к предварительным версиям продуктов, в которые перед коммерческим выпуском могут быть внесены существенные изменения. Майкрософт не дает никаких гарантий, прямых или косвенных, в отношении указанной здесь информации.\]

Подготовьте ваше классическое приложение для Windows (например, Win32, WPF и Windows Forms) к преобразованию в приложение для универсальной платформы Windows (UWP) с помощью расширений для преобразования классических приложений.

## Преимущества преобразования приложений в приложения UWP

UWP, используя расширения для преобразования классических приложений, позволяет преобразовывать классические приложения для Windows (например, Win32, Windows Forms и WPF) или игры в приложения или игры для универсальной платформы Windows (UWP). Дополнительные сведения см. в разделе [Руководство по приложениям UWP](https://msdn.microsoft.com/library/windows/apps/dn894631.aspx). После преобразования ваше классическое приложение для Windows упаковывается, обслуживается и разворачивается в виде пакета приложения UWP (.appx или an .appxbundle), и его целью является классическая версия Windows10.

Механизм преобразования классических приложений в пакеты UWP делится на два этапа. На первом этапе преобразователь классических приложений использует имеющиеся двоичные файлы и повторно упаковывает их в качестве пакета UWP. Ваш код остается прежним, он просто по-другому упаковывается. На втором этапе используются технологии среды выполнения, содержащиеся в юбилейном обновлении Windows10, которые позволяют исполняемым файлам пакета UWP выполняться в качестве файлов с полным доверием, а не в контейнере приложения. Этот механизм также присваивает преобразованному приложению идентификатор пакета, который необходим для использования некоторых API-интерфейсов UWP.

Вот некоторые из преимуществ преобразования классического приложения для Windows.

* Процедура установки вашего приложения становится значительно удобнее для пользователей. Вы можете разворачивать такие приложения на компьютерах, использующих загрузку неопубликованного приложения (см. [Загрузка неопубликованных бизнес-приложений в Windows 10](https://technet.microsoft.com/library/mt269549.aspx)), и после их удаления не остается каких-либо остаточных файлов. В долгосрочной перспективе вы также сможете опубликовать свое приложение в Магазине Windows.

* Поскольку ваше преобразованное приложение обладает идентификатором пакета, вы сможете вызывать дополнительные API-интерфейсы UWP даже из раздела с полным доверием. См. полный список [Поддерживаемых API UWP для преобразованных классических приложений](desktop-to-uwp-supported-api.md). 

* Вы можете на свое усмотрение добавлять в пакет приложения возможности UWP, такие как пользовательский интерфейс на языке XAML, обновления живых плиток, фоновые задачи UWP, службы приложений и многое другое. Все возможности, доступные любому другому приложению UWP, также доступны для вашего приложения.

* Если вы решите переместить все возможности своего приложения из раздела с полным доверием приложения в раздел с контейнером приложения, то ваше приложение сможет выполняться на любом устройстве с Windows 10.

* Будучи приложением UWP, ваше приложение обладает всеми возможностями классического приложения для Windows. Приложение взаимодействует с виртуализированным представлением реестра и файловой системы, которое неотличимо от фактических реестра и файловой системы.

* Ваше приложение может взаимодействовать со встроенными средствами лицензирования и автоматического обновления Магазина Windows Автоматическое обновление— очень надежный и эффективный механизм, поскольку загружаются только измененные части файлов.

## Подготовка классического приложения для преобразования в приложение UWP

Для подготовки приложения к процессу преобразования требуется мало усилий. Не забывайте, что Магазин Windows управляет вместо вас лицензированием и автоматическим обновлением, поэтому эти возможности можно исключить из вашей базы кода. Если любая из перечисленных ниже ситуаций применима к вашему приложению, перед преобразованием необходимо устранить эту проблему.

+ __Приложение использует версию .NET ниже, чем 4.6.1__. Поддерживается только .NET версии 4.6.1. Перед преобразованием приложение необходимо настроить для работы с .NET 4.6.1. 

+ __Ваше приложение всегда запускается с повышенными привилегиями безопасности__. Ваше приложение должно работать при его выполнении в качестве текущего пользователя. Пользователи, устанавливающие ваше приложение из Магазина Windows, могут не являться системными администраторами, поэтому необходимость выполнения вашего приложения с более высокими привилегиями означает, что оно будет работать неправильно для обычных пользователей.

+ __Вашему приложению нужен драйвер, работающий в режиме ядра, или служба Windows__. Мост подходит для приложения, но он не поддерживает драйвер, работающий в режиме ядра, или службу Windows, которая должна работать с правами учетной записи системы. Вместо службы Windows используйте [фоновую задачу](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task).

+ __Модули вашего приложения загружаются во внутрипроцессном режиме в процессы, которые отсутствуют в пакете AppX__. Это запрещено и означает, что внутрипроцессные расширения, такие как [расширения оболочки](https://msdn.microsoft.com/library/windows/desktop/dd758089.aspx) не поддерживаются. Но если у вас есть два приложения в одинаковом пакете, вы можете настроить межпроцессное взаимодействие между ними.

+ __Ваше приложение вызывает [SetDllDirectory](https://msdn.microsoft.com/library/windows/desktop/ms686203) или [AddDllDirectory](https://msdn.microsoft.com/library/windows/desktop/hh310513)__. В настоящее время эти функции не поддерживаются для преобразованных приложений. Мы работаем над тем, чтобы добавить поддержку в дальнейших выпусках. В качестве обходного пути вы можете скопировать все DLL-файлы, которые вы искали с помощью этих функций, в корневой каталог пакета. 

+ __Ваше приложение использует пользовательский идентификатор пользовательской модели (AUMID) приложения__. Если ваш процесс вызывает элемент [SetCurrentProcessExplicitAppUserModelID](https://msdn.microsoft.com/library/windows/desktop/dd378422.aspx), чтобы задать собственный AUMID, то этот процесс может использовать только тот AUMID, который был сформирован для него средой модели приложения/пакетом AppX. Вы не можете определять пользовательские AUMID.

+ __Ваше приложение изменяет куст реестра HKEY_LOCAL_MACHINE (HKLM)__. Любая попытка приложения создать ключ HKLM или открыть такой ключ для изменения в результате приведет к сбою в виде отказа в доступе. Не забывайте, что у вашего приложения есть собственное закрытое виртуализированное представление реестра, поэтому в такой ситуации понятие куста реестра на уровне пользователя и компьютера (чем является HKLM) неприменимо. Потребуется найти другой способ достичь того, чего требовалось при использовании HKLM, например запись в HKEY_CURRENT_USER (HKCU).

+ __Ваше приложение использует подраздел реестра ddeexec в качестве средства для запуска другого приложения__. Вместо этого используйте один из обработчиков команды DelegateExecute в соответствии с настройками различных расширений Activatable* в вашем [манифесте пакета приложения](https://msdn.microsoft.com/library/windows/apps/br211474.aspx).

+ __Ваше приложение выполняет запись в папку AppData с намерением поделиться данными с другим приложением__. После преобразования AppData перенаправляется в локальное хранилище данных приложения, являющееся частным хранилищем для каждого приложения UWP. Используйте другие средства межпроцессного обмена данными. Подробнее: [Хранение и извлечение параметров и прочих данных приложения](https://msdn.microsoft.com/windows/uwp/app-settings/store-and-retrieve-app-data).

+ __Ваше приложение выполняет запись в папку установки приложения__. Например, ваше приложение выполняет запись в файл журнала, который вы поместили в тот же каталог, что и файл exe. Эта операция не поддерживается, поэтому потребуется найти другое расположение, например, локальное хранилище данных приложения.

+ __Для установки приложения требуется участие пользователя__. Ваш установщик приложений должен запускаться в автоматическом режиме, а также устанавливать все свои дополнительные компоненты, которые не активированы по умолчанию в чистом образе ОС.

+ __Ваше приложение использует Current Working Directory (текущий рабочий каталог)__. Во время выполнения ваше преобразованное приложение не получит тот же рабочий каталог, который был ранее указан для вашего ярлыка .LNK на рабочем столе. Необходимо изменить CWD во время выполнения, если у вашего приложения должен быть правильный каталог, чтобы оно работало должным образом.

+ __Ваше приложение запрашивает доступ UIAccess__. Если приложение задает значение `UIAccess=true` элементу `requestedExecutionLevel` манифеста UAC, то преобразование в UWP не поддерживается на данный момент. Подробнее см. в разделе [Обзор системы безопасности модели автоматизации пользовательского интерфейса](https://msdn.microsoft.com/library/ms742884.aspx).

+ __Ваше приложение уже является полноценным приложением UWP и вызывает процесс с полным доверием из пакета приложения__. Использование моста в обратном порядке не поддерживается, поэтому приложения UWP, вызывающие процессы с полным доверием, не пройдут сертификацию в Магазине. Чтобы обеспечить поддержку этого сценария в загруженном неопубликованном приложении, сначала включите декларацию ```<desktop:Extension>``` в манифест вашего приложения (который содержит атрибут *EntryPoint* со значением *Windows.FullTrustApplication*). Затем установите параметру ```<TargetDeviceFamily>``` вашего приложения значение *Windows.Desktop*. Оно указывает на то, что для вашего приложения целевым является только настольное семейство устройств, а не все устройства UWP. Если приложение возвращает ошибку *APPX0501: ошибка проверки* с этими параметрами, проверьте целевое семейство устройств. Вероятно, для вашего приложения целевым является семейство *Windows.Universal*, а не *Windows.Desktop*. 

+ __Приложение предоставляет объекты модели COM или сборки GAC для использования другими процессами__. В текущем выпуске приложение не может предоставлять объекты модели COM или сборки GAC для использования процессами, возникающими в результате запуска исполняемых файлов, которые являются внешними по отношению к пакету AppX. Процессы из пакета могут регистрировать и использовать объекты модели COM и сборки GAC обычным образом, но они не будут видны извне. Это означает, что сценарии межпрограммного взаимодействия (например, OLE) не будут работать при их вызове внешними процессами. 

+ __Приложение связывается с библиотеками среды выполнения C неподдерживаемым способом__. Библиотека среды выполнения C/C++ Майкрософт предоставляет процедуры для программирования в среде операционной системы Microsoft Windows. Эти процедуры автоматизируют выполнение многих распространенных задач программирования, которые не предоставляются языками C и C++. Если ваше приложение использует библиотеку среды выполнения C/C++, необходимо убедиться, что она связана поддерживаемом способом. 
    
    Visual Studio 2015 поддерживает как динамическое связывание, чтобы код мог использовать общие файлы DLL, так и статическое связывание для связывания библиотеки непосредственно с кодом, до текущей версии CRT. По возможности мы рекомендуем использовать в приложениях динамическое связывание Visual Studio 2015. 

    Поддержка различных типов связывания зависит от версии Visual Studio. Подробности см. в следующей таблице: 

    <table>
    <th>Версия Visual Studio</td><th>Динамическое связывание</th><th>Статическое связывание</th></th>
    <tr><td>2005 (VC 8)</td><td>Не поддерживается</td><td>Поддерживается</td>
    <tr><td>2008 (VC 9)</td><td>Не поддерживается</td><td>Поддерживается</td>
    <tr><td>2010 (VC 10)</td><td>Поддерживается</td><td>Поддерживается</td>
    <tr><td>2012 (VC 11)</td><td>Поддерживается</td><td>Не поддерживается</td>
    <tr><td>2013 (VC 12)</td><td>Поддерживается</td><td>Не поддерживается</td>
    <tr><td>2015 (VC 14)</td><td>Поддерживается</td><td>Поддерживается</td>
    </table>
    
    Примечание. Во всех случаях связывание необходимо выполнять с самой последней общедоступной библиотекой CRT.

+ __Приложение устанавливает и загружает сборки из параллельной папки Windows (SxS)__. Например, в вашем приложении используются библиотеки VC8 или VC9 среды выполнения C и они динамически связываются из папки Windows SxS, то есть в коде используются общие файлы DLL из общей папки. Такой способ связывания не поддерживается. Необходимо связать их статически, то есть связать с распространяемыми файлами библиотеки непосредственно в самом коде.

## Начало процесса преобразования

Есть несколько различных способов преобразования приложения.

* **Desktop App Converter (DAC)**. Средство DAC автоматически преобразует и подписывает приложение за вас. DAC удобен в использовании и работает автоматически. Он полезен, если приложение вносит многочисленные системные изменения, либо если нет уверенности в действиях установщика. Инструкции по началу работы с DAC см. в разделе [Desktop App Converter](desktop-to-uwp-run-desktop-app-converter.md). 

* **Ручное преобразование**. Если приложение установлено с помощью xcopy, или если вам известно, какие изменения установщик вносит в систему, ручное преобразование может быть проще. При этом создается файл манифеста и запускается средство MakeAppx.exe, после чего подписывается пакет приложения. Подробнее о ручном преобразовании см. в разделе [Ручное преобразование классического приложения для Windows в приложение для универсальной платформы Windows (UWP)](desktop-to-uwp-manual-conversion.md). 

* **Сторонний установщик**. Три распространенных сторонних установщика— [InstallShield от Flexera](http://www.flexerasoftware.com/producer/products/software-installation/installshield-software-installer), [WiX от FireGiant](https://www.firegiant.com/r/appx) и [Advanced Installer от Caphyon](http://www.advancedinstaller.com/uwp-app-package) — теперь поддерживают мост для настольных компьютеров и могут создавать установщик MSI и пакет преобразованного приложения всего за несколько щелчков. Дополнительные сведения см. на соответствующих веб-сайтах для каждого установщика. 

## Получение поддержки и отправка отзывов

Если у вас возникли проблемы при преобразовании приложения, вы можете получить помощь на [форумах](https://social.msdn.microsoft.com/Forums/windowsapps/en-US/home?forum=wpdevelop). 

Чтобы оставить отзыв или предложить новые возможности, воспользуйтесь [UserVoice](https://wpdev.uservoice.com/forums/110705-universal-windows-platform/category/161895-desktop-bridge-centennial). 

## В этом разделе

| Раздел | Описание |
|-------|-------------|
| [Desktop App Converter](desktop-to-uwp-run-desktop-app-converter.md) | В разделе описывается процесс запуска Desktop App Converter. Возможно, вам не потребуется прилагать много усилий (скорее даже наоборот) для подготовки вашего приложения к процессу преобразования. |
| [Ручное преобразование классического приложения](desktop-to-uwp-manual-conversion.md) | Создание пакета приложения и манифеста для него вручную. |
| [Расширения преобразованных классических приложений](desktop-to-uwp-extensions.md) | Улучшайте преобразованное приложение с помощью расширений, чтобы обеспечить такие возможности, как задачи автозагрузки, интеграция проводника и многие другие. |
| [Поддерживаемые API UWP для преобразованных классических приложений](desktop-to-uwp-supported-api.md) | Узнайте, какие API UWP доступны для использования в вашем преобразованном классическом приложении. |
| [Подписывание преобразованного классического приложения](desktop-to-uwp-signing.md) | Узнайте, как подписать преобразованный пакет .appx с помощью сертификата. |
| [Развертывание и отладка преобразованного приложения UWP](desktop-to-uwp-deploy-and-debug.md) | Получите помощь в развертывании и отладке приложения после его преобразования. Этот раздел также подойдет вам, если вам интересны какие-либо подробные сведения о расширениях для преобразования классических приложений. |
| [Примеры кода для преобразования классических приложений в приложения UWP](https://github.com/Microsoft/DesktopBridgeToUWP-Samples) | Примеры кода на GitHub, демонстрирующие возможности преобразованных приложений. |


<!--HONumber=Sep16_HO3-->


