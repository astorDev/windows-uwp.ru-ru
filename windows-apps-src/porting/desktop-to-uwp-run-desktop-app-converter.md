---
author: awkoren
Description: "Запуск преобразователя классических приложений для преобразования классического приложения для Windows (например, Win32, WPF и Windows Forms) в приложение для универсальной платформы Windows (UWP)"
Search.Product: eADQiWindows 10XVcnh
title: "Обзор преобразователя классических приложений (Project Centennial)"
ms.sourcegitcommit: 6d1c6e836d666972641320c73896459490f45924
ms.openlocfilehash: 874b6452386526d66062a27a5b520cb1a232ae64

---

# Обзор преобразователя классических приложений (Project Centennial)

\[Некоторые сведения относятся к предварительным версиям продуктов, в которые перед коммерческим выпуском могут быть внесены существенные изменения. Майкрософт не дает никаких гарантий, прямых или косвенных, в отношении указанной здесь информации.\]

[Получение преобразователя классических приложений (Desktop App Converter).](http://go.microsoft.com/fwlink/?LinkId=785437)

Преобразователь классических приложений — это предварительная версия инструмента, позволяющего преобразовывать имеющиеся классические приложения, написанные для .NET 4.6.1 или Win32, в приложения универсальной платформы Windows (UWP). Используя преобразователь, вы можете запускать свои классические программы установки в автоматическом режиме и получать пакет AppX, который можно установить с помощью командлета Add-AppxPackage PowerShell на вашем компьютере, использующемся для разработки.

Преобразователь запустит классическую программу установки в изолированной среде Windows, используя чистый базовый образ, предоставляемый в составе скачиваемых файлов преобразователя. Он захватывает любые операции ввода-вывода реестра и файловой системы, инициализируемые классической программой установки, и упаковывает их в виде части выходных данных. Выходные данные преобразователя содержат пакет AppX с идентификатором пакета. Также преобразователь обеспечивает возможность осуществлять вызов разнообразных API-интерфейсов WinRT.

## Что нового

В этом разделе описываются изменения в версиях преобразователя классических приложений. 

### 8 июня 2016 г.

* Добавлена поддержка возможности создания пакетов appx x86 на хостах-компьютерах AMD64, на которых выполняется преобразователь.
* Повышена эффективность использования дискового пространства за счет удаления всех ранее развернутых базовых образов.
* Добавлена поддержка возможности удаления временных файлов и любых ненужных базовых образов.
* Улучшена поддержка возможности определения сопоставлений типов файлов и протоколов.
* Улучшена логика определения свойства AppExecutable для большого набора приложений.
* Добавлена поддержка возможности предоставления дополнительного параметра "–InstallerArguments" для установщиков на основе MSI.
* Устранение неполадок при возникновении любых ошибок класса PathTooLongException во время процесса преобразования.

### 12 апреля 2016 г.

- Восстановлена поддержка выпуска Windows Профессиональная. 
- Флажок ```-Setup``` преобразователя теперь активирует функцию контейнеров Windows и управляет развертыванием базового образа. В командной строке PowerShell с повышенными привилегиями запустите следующую команду, чтобы выполнить одноразовую установку: ```PS C:\> .\DesktopAppConverter.ps1 -Setup -BaseImage BaseImage-12345.wim -Verbose```
- Добавлена возможность автоматического обнаружения пути установки приложения и перемещения корня приложения вне VFS, чтобы уменьшить объем любых лишних перенаправлений файловой системы во время выполнения.
- Добавлена возможность автоматического обнаружения развернутого базового образа в качестве части процесса преобразования.
- Добавлена возможность автоматического обнаружения сопоставлений типов файлов и протоколов.
- Улучшена логика обнаружения ярлыка меню "Пуск".
- Улучшена функция фильтрации файловой системы для сохранения файлов MUI, размещаемых в системе в ходе установки приложения.
- Для Project Centennial в манифесте обновлена минимальная поддерживаемая классическая версия (10.0.14342.0).

## Требования к системе

### Поддерживаемая операционная система
+ Предварительное юбилейное обновление Windows 10 Корпоративная (сборка 10.0.14342.0 и более поздней версии)

### Необходимая конфигурация оборудования

Компьютер должен обладать следующими минимальными возможностями:
+ 64-разрядный процессор (x64)
+ Аппаратная виртуализация
+ Преобразование адресов второго уровня (SLAT)

### Рекомендуемые ресурсы
+ [Пакет средств разработки программного обеспечения (SDK) для Windows 10](https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk)

## Настройка преобразователя классических приложений   
Преобразователь классических приложения использует возможности Windows 10, предоставляемые в качестве части сборок Windows Insider Preview. Убедитесь, что вы используете самую последнюю сборку, чтобы использовать преобразователь.

1. Убедитесь, что вы используете последнюю версию сборки операционной системы Windows 10 Insider Preview — в редакциях Корпоративная или Профессиональная (http://insider.windows.com). 
2. Скачайте DesktopAppConverter.zip и файл .wim базового образа, который соответствует вашей сборке Insider Preview (http://aka.ms/converter). 
3. Извлеките DesktopAppConverter.zip в локальную папку.
4. В окне администратора PowerShell:  
```CMD
PS C:\> Set-ExecutionPolicy bypass
```
5. Выполните следующую команду в окне администратора PowerShell, чтобы настроить преобразователь.
```CMD
PS C:\> .\DesktopAppConverter.ps1 -Setup -BaseImage .\BaseImage-1XXXX.wim -Verbose
```
6. Если при выполнении предыдущей команды отобразился запрос на перезагрузку, перезагрузите компьютер и выполните команду повторно.

## Запуск преобразователя классических приложений
У преобразователя классических приложений есть две точки входа: PowerShell и командная оболочка. Вы можете использовать любую из этих точек входа, чтобы начать процесс преобразования.

### Использование
```CMD
DesktopAppConverter.ps1
-Installer <String> [-InstallerArguments <String>] [-InstallerValidExitCodes <Int32>]
-Destination <String>
-PackageName <String>
-Publisher <String>
-Version <Version>
[-ExpandedBaseImage <String>]
[-AppExecutable <String>]
[-AppFileTypes <String>]
[-AppId <String>]
[-AppDisplayName <String>]
[-AppDescription <String>]
[-PackageDisplayName <String>]
[-PackagePublisherDisplayName <String>]
[-MakeAppx]
[-LogFile <String>]
[<CommonParameters>]  
```

### Пример
В следующем примере показано, как преобразовать классическое приложение с именем *MyApp*, названное по имени издателя (*&lt;publisher_name&gt;*), в пакет UWP (AppX).

+ В окне администратора PowerShell, выполните следующую команду:
```CMD
PS C:\>.\DesktopAppConverter.ps1 -Installer C:\Installer\MyApp.exe 
-InstallerArguments "/S" -Destination C:\Output\MyApp -PackageName "MyApp" 
-Publisher "CN=<publisher_name>" -Version 0.0.0.1 -MakeAppx -Verbose
```

## Развертывание преобразованного пакета AppX
Используйте командлет [Add-AppxPackage](https://technet.microsoft.com/en-us/library/hh856048.aspx) в PowerShell, чтобы развернуть подписанный пакет приложения (.appx) в учетной записи пользователя. Процесс подписывания пакета .appx см. в разделе «Подписывание пакета .Appx». Также можно добавить параметр *Register* командлета для выполнения установки из папки нераспакованных файлов в процессе разработки. Дополнительные сведения см. в разделе [Развертывание и отладка преобразованного приложения UWP](desktop-to-uwp-deploy-and-debug.md).

## Подписывание пакета .Appx

Для командлета Add-AppxPackage необходимо, чтобы развертываемый пакет приложения (.appx) был подписан. Используйте файл SignTool.exe, который входит в состав Microsoft Windows 10 SDK, чтобы подписать пакет .appx.

### Пример
```CMD
C:\> MakeCert.exe -r -h 0 -n "CN=<publisher_name>" -eku 1.3.6.1.5.5.7.3.3 -pe -sv <my.pvk> <my.cer>
C:\> pvk2pfx.exe -pvk <my.pvk> -spc <my.cer> -pfx <my.pfx>
C:\> signtool.exe sign -f <my.pfx> -fd SHA256 -v .\<outputAppX>.appx
```
**Примечание.** При запуске файла MakeCert.exe, когда вам будет предложено ввести пароль, выберите **Нет**.

Дополнительные сведения о сертификатах и процессе подписывания см. в следующих разделах:

+ [Практическое руководство: создание временных сертификатов для использования во время разработки](https://msdn.microsoft.com/library/ms733813.aspx)
+ [SignTool](https://msdn.microsoft.com/library/windows/desktop/aa387764.aspx)
+ [SignTool.exe (инструмент подписывания)](https://msdn.microsoft.com/library/8s9b9yaz.aspx)

### Предупреждения
1. Сборка Windows 10 на хост-компьютере должна соответствовать базовому образу, который вы получили в составе скачанных файлов преобразователя классических приложений.  
2. Убедитесь, что классическая программа установки находится в независимом каталоге, так как преобразователь копирует все содержимое каталога в изолированную среду Windows.  
3. В данный момент преобразователь классических приложений поддерживает выполнение процесса преобразования только на 64-разрядный операционной системе. Вы можете развернуть преобразованные пакеты .appx только на 64-разрядной операционной системе x64).  
4. Для преобразователя классических приложений требуется, чтобы классическая программа установки выполнялась в автоматическом режиме. Убедитесь, что вы перенесли флаг автоматического режима для программы установки в преобразователь с помощью параметра *-InstallerArguments*.
5. Публикация общедоступных сборок SxS Fusion будет невозможна. В ходе процесса установки приложение может публиковать располагающиеся рядом друг с другом общедоступные сборки Fusion, которые являются доступными для любого другого процесса. Во время создания контекста активации процесса эти сборки извлекаются системным процессом с именем CSRSS.exe. Когда эта процедура выполняется для процесса Centennial, будет происходить сбой процессов создания контекста активации и загрузки модулей этих сборок. Входящие сборки, такие как ComCtl поставляются вместе с операционной системой, поэтому указание зависимости на них от процессов Centennial является безопасным. Сборки SxS Fusion регистрируются в следующих местах:
  + Реестр: `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\SideBySide\Winners`
  + Файловая система: %windir%\\SideBySide

## Известные проблемы

+ Если вы выполняете тестирование возможности в рамках программы предварительной оценки Windows на компьютере разработчика, на котором ранее была установлена предварительная версия преобразователя классических приложений, при установке нового базового образа может возникнуть ошибка `New-ContainerNetwork: The object already exists`. В качестве обходного пути выполните команду `Netsh int ipv4 reset` в командной строке с повышенными привилегиями, а затем перезагрузите компьютер. 
+ Приложение .NET, скомпилированное с использованием параметра сборки "AnyCPU", не удастся установить, если главный исполняемый файл или какая-либо зависимость были помещены в каталог "Program Files "или "Windows\System32". В качестве обходного пути используйте классическую программу установки, применяемую в архитектуре вашей системы (32- или 64-разрядная), чтобы создать пакет AppX.

## Телеметрия преобразователя классических приложений  
Преобразователь классических приложений может осуществлять сбор сведений о вас и использовании вами программного обеспечения, а затем отправлять эти данные в Майкрософт. Подробнее о процессе сбора данных корпорацией Майкрософт и их использовании в документации по продуктам см. в [заявлении о конфиденциальности корпорации Майкрософт](http://go.microsoft.com/fwlink/?LinkId=521839). Вы соглашаетесь выполнять требования всех применимых положений заявления о конфиденциальности корпорации Майкрософт.

По умолчанию для преобразователя классических приложений телеметрия будет включена. Добавьте следующий раздел реестра для настройки телеметрии:  
```CMD
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\DesktopAppConverter
```
+ Добавьте или измените значение *DisableTelemetry* с помощью DWORD со значением 1.
+ Для включения телеметрии удалите раздел или задайте значение 0.

## Использование преобразователя классических приложений
Вот список параметров преобразователя классических приложений. Вы также можете просмотреть этот список в окне Windows PowerShell, выполнив следующую команду:  
```CMD
get-help .\DesktopAppConverter.ps1 -detailed
```

### Параметры настройки  
|Параметр|Описание|
|---------|-----------|
|```-Setup [<SwitchParameter>]``` | Запускает DesktopAppConverter в режиме установки. Режим установки поддерживает развертывание предоставляемого базового образа.|
|```-BaseImage <String>``` | Полный путь к неразвернутому базовому образу. Этот параметр необходим, если указана программа установки.|
|```-LogFile <String>``` [необязательно] | Определяет файл журнала. Если этот параметр пропущен, для файла журнала будет создано временное расположение.|
|```-NatSubnetPrefix <String>``` [необязательно] | Значение префикса, которое необходимо использовать для экземпляра Nat. Как правило, это значение будет необходимо изменить, только если ваш хост-компьютер подключен к тому же диапазону адресов подсети, что и NetNat преобразователя. Вы можете запросить текущую конфигурацию NetNat преобразователя, используя командлет **Get-NetNat**. |
|```-NoRestart [<SwitchParameter>]``` | Запрос на перезагрузку при выполнении программы установки не выводится (перезагрузка необходима для включения функции контейнеров). |

### Параметры преобразования  
|Параметр|Описание|
|---------|-----------|
|```-Installer <String>``` | Путь к программе установки приложения, которая должна поддерживать запуск в автоматическом режиме|
|```-InstallerArguments <String>``` [необязательно] | Список с разделителями-запятыми или строка аргументов, чтобы перевести выполнение программы установки в автоматический режим. Этот параметр необязателен, если вы используете программу установки msi. Для получения журнала из программы установки укажите в этом месте аргумент журнала для программы установки и используйте путь ```<log_folder>```, являющийся маркером, который преобразователь заменит соответствующим путем. <br><br>**ПРИМЕЧАНИЕ. Типы флага автоматического режима и аргументов журнала зависят от технологий, использующихся в программе установки.** <br><br>Пример использования этого параметра: ```-InstallerArguments "/silent /log <log_folder>\install.log"``` Другой пример, в котором не выполняется создание файла журнала, может выглядеть так: ```-InstallerArguments "/quiet", "/norestart"``` Опять же, если вы хотите, чтобы преобразователь осуществлял захват пути маркера и помещал его в папку с конечным журналом, вы должны в буквальном смысле направлять все журналы по пути маркера ```<log_folder>```.|
|```-InstallerValidExitCodes <Int32>``` [необязательно] | Список с разделителями-запятыми кодов выхода, указывающий на то, что программа установки была запущена успешно (например, 0, 1234, 5678).  По умолчанию это 0 для программы установки отличной от msi и 0, 1641, 3010 для программы установки msi.|
|```-Destination <String>``` | Является целевым объектом для вывода преобразователем пакета appx — DesktopAppConverter может создать это местоположение, если оно еще не существует.|

### Параметры удостоверения Appx  
|Параметр|Описание|
|---------|-----------|
|```-PackageName <String>``` | Имя пакета универсального приложения для Windows
|```-Publisher <String>``` | Издатель вашего пакета универсального приложения для Windows
|```-Version <Version>``` | Номер версии вашего пакета универсального приложения для Windows

### Необязательные параметры манифеста Appx  
|Параметр|Описание|
|---------|-----------|
|```-AppExecutable <String>``` [необязательно] | Полный путь к главному исполняемому файлу вашего приложения, если он должен был быть использован для установки (а фактически не должен), например «C:\Program Files (x86)\MyApp\MyApp.exe».|
|```-AppFileTypes <String>``` [необязательно] | Список с разделителями-запятыми типов файлов, с которыми приложение будет связано (например, ".txt, .doc", без кавычек).|
|```-AppId <String>``` [необязательно] | Указывает значение, которое нужно задать идентификатору приложения в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*.|
|```-AppDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени приложения в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. |
|```-AppDescription <String>``` [необязательно] | Указывает значение, которое нужно задать описанию приложения в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*.|
|```-PackageDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени пакета в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. |
|```-PackagePublisherDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени издателя пакета в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *Publisher*. |

### Другие параметры преобразования  
|Параметр|Описание|
|---------|-----------|
|```-ExpandedBaseImage <String>``` [необязательно] | Полный путь к уже развернутому базовому образу.|
|```-MakeAppx [<SwitchParameter>]``` [необязательно] | Переключатель, который при его наличии, сообщает этому сценарию, что MakeAppx должен вызвать выходные данные. |
|```-LogFile <String>``` [необязательно] | Определяет файл журнала. Если этот параметр пропущен, для файла журнала будет создано временное расположение. |
|```<Common parameters>``` | Данный командлет поддерживает общие параметры: *Verbose*, *Debug*, *ErrorAction*, *ErrorVariable*, *WarningAction*, *WarningVariable*, *OutBuffer*, *PipelineVariable* и *OutVariable*. Дополнительные сведения см. в разделе [about_CommonParameters](http://go.microsoft.com/fwlink/?LinkID=113216). |

### Параметры очистки
|Параметр|Описание|
|---------|-----------|
|```Cleanup [<Option>]``` | Запускает очистку артефактов DesktopAppConverter. Есть 3 допустимых варианта режима отчистки. |
|```Cleanup All``` | Удаляет все развернутые базовые образы, удаляет все временные файлы преобразователя, удаляет контейнерную сеть и отключает необязательную функцию Windows — "Контейнеры". |
|```Cleanup WorkDirectory``` | Удаляет все временные файлы преобразователя. |
|```Cleanup ExpandedImages``` | Удаляет все развернутые базовые образы, установленные на хост-компьютере. |

### Параметры пакета x86
Предварительная версия преобразователя классических приложений теперь поддерживает создание пакетов приложений x86, которые можно устанавливать и запускать на компьютерах x86 и AMD64. Примечание. Чтобы преобразование было проведено успешно, преобразователь классических приложений все еще необходимо запускать на компьютерах AMD64.

|Параметр|Описание|
|---------|-----------|
|```-CreateX86Package[<SwitchParameter>]``` | Создает 32-разрядный пакет, который можно установить и запустить как в среде 32-разрядной, так и в среде 64-разрядной ОС хост-компьютера. Сначала преобразователь пытается определить архитектуру пакета из основного исполняемого файла приложения, однако если файл .exe не был найден, по умолчанию используется 64-разрядная архитектура. |

## См. также
+ [Получение преобразователя классических приложений](http://go.microsoft.com/fwlink/?LinkId=785437)
+ [Перенос классического приложения на универсальную платформу Windows](https://developer.microsoft.com/en-us/windows/bridges/desktop)
+ [Перенос классических приложений в UWP с помощью преобразователя классических приложений](https://channel9.msdn.com/events/Build/2016/P504)
+ [Project Centennial: перенос имеющихся классических приложений на универсальную платформу Windows.](https://channel9.msdn.com/events/Build/2016/B829)  
+ [UserVoice для Desktop Bridge (Project Centennial)](http://aka.ms/UserVoiceDesktopToUwp)
+ [Примеры кода на GitHub для преобразования классических приложений в приложения UWP](https://github.com/Microsoft/DesktopBridgeToUWP-Samples)



<!--HONumber=Jun16_HO3-->


