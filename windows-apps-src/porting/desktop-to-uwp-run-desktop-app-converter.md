---
author: awkoren
Description: "Запуск Desktop App Converter для преобразования классического приложения для Windows (например, Win32, WPF и Windows Forms) в приложение для универсальной платформы Windows (UWP)."
Search.Product: eADQiWindows 10XVcnh
title: Desktop App Converter
translationtype: Human Translation
ms.sourcegitcommit: 8429e6e21319a03fc2a0260c68223437b9aed02e
ms.openlocfilehash: fcff283e0d97d76fefe3f42a6cd1076b6cdd2aae

---

# Desktop App Converter

[Получение Desktop App Converter](https://aka.ms/converter)

Desktop App Converter (DAC) — это инструмент, позволяющий преобразовывать имеющиеся классические приложения, написанные для .NET 4.6.1 или Win32, в приложения универсальной платформы Windows (UWP). Используя преобразователь, вы можете запускать свои классические установщики в автоматическом режиме и получать пакет AppX, который можно установить с помощью командлета Add-AppxPackage PowerShell на вашем компьютере, использующемся для разработки.

Desktop App Converter доступен в [Магазине Windows](https://aka.ms/converter).

Преобразователь запустит классическую программу установки в изолированной среде Windows, используя чистый базовый образ, предоставляемый в составе скачиваемых файлов преобразователя. Он захватывает любые операции ввода-вывода реестра и файловой системы, инициализируемые классической программой установки, и упаковывает их в виде части выходных данных. Выходные данные преобразователя содержат пакет AppX с идентификатором пакета. Также преобразователь обеспечивает возможность осуществлять вызов разнообразных API-интерфейсов WinRT.

## Что нового

В этом разделе описываются изменения в версиях Desktop App Converter. 

### 14.09.2016 (версия 1.0)

* Desktop App Converter доступен для скачивания в [Магазине Windows](https://aka.ms/converter)! 
* Скачайте новейшие базовые образы Windows 10 (.wim) в [Центре загрузки](https://aka.ms/converterimages) и используйте их в DAC.
* С помощью приложения в магазине вы можете использовать новую точку входа *DesktopAppConverter.exe <arguments>* для запуска преобразователя из любого места в командной строке с повышенными привилегиями или окне PowerShell.  


### 02.09.2016 (версия 0.1.25)

* Интегрирован последний пакет NuGet dotnet-computervirtualization.
* Добавлены новые зависимости от common.dll.
* Исправлено несколько ошибок.

### 04.08.2016 (версия 0.1.24)

* Добавлена поддержка автоматического подписывания преобразованных приложений, созданных DAC для тестирования. См. флаг ```–Sign```, чтобы опробовать эту функцию. 
* Добавлены предупреждения в случае, если какие-либо регистрации COM в виртуальном кусте реестра не поддерживаются в пакете AppX.  
* Добавлена поддержка автоматического обнаружения зависимостей от библиотек VC++ и последующего их преобразования в зависимости манифеста AppX. Обратите внимание, что для загрузки неопубликованных приложений и их тестирования с помощью среды выполнения VC++ вам потребуется скачать пакеты платформы VCLib, о чем говорится в записи блога [Использование среды выполнения Visual C++ в проекте Centennial](https://blogs.msdn.microsoft.com/vcblog/2016/07/07/using-visual-c-runtime-in-centennial-project). Найдите пакеты в папке ```Program Files (x86)\Microsoft SDKs\Windows Kits\10\ExtensionSDKs\Microsoft.VCLibs.Desktop``` на вашем компьютере, перейдите к используемой версии (например, 11.0, 12.0, 14.0) и дважды щелкните пакет для соответствующей архитектуры (x64, x86), чтобы установить его.
* Схема манифеста обновлена в соответствии с юбилейным обновлением Windows 10 (10.0.14393.0). 
* Исправлено несколько ошибок и улучшен макет выходных данных. 

### 7.07.2016 (версия 0.1.22)

* Добавлена поддержка автоматического обнаружения расширений оболочки из классических приложений и их объявление в AppXManifest пакетов UWP. Подробнее о настольных расширениях см. в разделе [**Расширения преобразованных классических приложений**](desktop-to-uwp-extensions.md). 
* Улучшенное обнаружение AppExecutable для большого набора приложений. 

### 16.06.2016 г. (версия 0.1.20)

* Устранены проблемы, блокирующие успешное преобразование в последних сборках Windows 10 Insider Preview. 
* ```–CreateX86Package``` заменено на ```–PackageArch```, чтобы можно было выбрать архитектуру для создаваемого пакета. 

### 8июня 2016г.

* Добавлена поддержка возможности создания пакетов appx x86 на хостах-компьютерах AMD64, на которых выполняется преобразователь.
* Повышена эффективность использования дискового пространства за счет удаления всех ранее развернутых базовых образов.
* Добавлена поддержка возможности удаления временных файлов и любых ненужных базовых образов.
* Улучшена поддержка возможности определения сопоставлений типов файлов и протоколов.
* Улучшена логика определения свойства AppExecutable для большого набора приложений.
* Добавлена поддержка возможности предоставления дополнительного параметра "–InstallerArguments" для установщиков на основе MSI.
* Устранение неполадок при возникновении любых ошибок класса PathTooLongException во время процесса преобразования.

### 12апреля 2016г.

- Восстановлена поддержка выпуска Windows Профессиональная. 
- Флажок ```-Setup``` преобразователя теперь активирует функцию контейнеров Windows и управляет развертыванием базового образа. В командной строке PowerShell с повышенными привилегиями запустите следующую команду, чтобы выполнить одноразовую установку: ```PS C:\> .\DesktopAppConverter.ps1 -Setup -BaseImage BaseImage-12345.wim -Verbose```
- Добавлена возможность автоматического обнаружения пути установки приложения и перемещения корня приложения вне VFS, чтобы уменьшить объем любых лишних перенаправлений файловой системы во время выполнения.
- Добавлена возможность автоматического обнаружения развернутого базового образа в качестве части процесса преобразования.
- Добавлена возможность автоматического обнаружения сопоставлений типов файлов и протоколов.
- Улучшена логика обнаружения ярлыка меню "Пуск".
- Улучшена функция фильтрации файловой системы для сохранения файлов MUI, размещаемых в системе в ходе установки приложения.
- В манифесте обновлена минимальная поддерживаемая классическая версия (10.0.14342.0).

## Требования к системе

### Операционная система

+ Юбилейное обновление Windows 10 Pro или Корпоративная (10.0.14393.0 и более поздней версии).

### Конфигурация оборудования

+ 64-разрядный процессор (x64)
+ Аппаратная виртуализация
+ Преобразование адресов второго уровня (SLAT)

### Необходимые ресурсы

+ [Пакет средств разработки программного обеспечения (SDK) для Windows10](https://go.microsoft.com/fwlink/?linkid=821375)

## Установка Desktop App Converter

Desktop App Converter задействует новейшие возможности Windows 10. Убедитесь, что у вас установлено юбилейное обновление Windows 10 (14393.0 или более позднюю версию сборки).

### Скачивание из Магазина

1.  Скачайте [DesktopAppConverter из Магазина Windows](https://aka.ms/converter) и [WIM-файл базового образа, соответствующий вашей сборке](https://aka.ms/converterimages).  
2.  Запустите DesktopAppConverter от имени администратора. Это можно сделать из меню «Пуск», щелкнув плитку правой кнопкой мыши и выбрав *Запуск от имени администратора* в разделе *Еще*, или с панели задач, щелкнув плитку правой кнопкой мыши, затем еще щелкнув правой кнопкой мыши на появившемся имени приложения и выбрав *Запуск от имени администратора.*
3.  В окне консоли приложения выполните команду ```CMD PS C:\> Set-ExecutionPolicy bypass```.
4.  Установите преобразователь, выполнив в окне консоли приложения команду ```CMD PS C:\> DesktopAppConverter.exe -Setup -BaseImage .\BaseImage-1XXXX.wim -Verbose```.
5.  Если при выполнении указанной выше команды появится запрос на перезагрузку, перезапустите компьютер.

### ZIP-файл 

DAC остается доступным в виде ZIP-файла в [центре загрузок](https://aka.ms/converterimages) для упрощения реализации автономных сценариев. Однако все последующие обновления будут публиковаться только в версии, размещенной в Магазине.

1.  Скачайте ZIP-файл DAC и [WIM-файл базового образа, соответствующий вашей сборке](https://aka.ms/converterimages).  
2. Извлеките DesktopAppConverter.zip в локальную папку.
3. В окне администратора PowerShell выполните команду ```CMD PS C:\> Set-ExecutionPolicy bypass```.
4. Установите преобразователь, выполнив в окне администратора PowerShell команду ```CMD PS C:\> .\DesktopAppConverter.ps1 -Setup -BaseImage .\BaseImage-1XXXX.wim -Verbose```.
5. Если при выполнении указанной выше команды появится запрос на перезагрузку, перезапустите компьютер.

## Запуск Desktop App Converter

+ **Скачивание из Магазина**: используйте для запуска преобразователя файл ```DesktopAppConverter.exe```.
+ **ZIP-файл**: используйте для запуска преобразователя файл ```DesktopAppConverter.ps1```. 

### Использование

```CMD
DesktopAppConverter.exe
-Installer <String> [-InstallerArguments <String>] [-InstallerValidExitCodes <Int32>]
-Destination <String>
-PackageName <String>
-Publisher <String>
-Version <Version>
[-ExpandedBaseImage <String>]
[-AppExecutable <String>]
[-AppFileTypes <String>]
[-AppId <String>]
[-AppDisplayName <String>]
[-AppDescription <String>]
[-PackageDisplayName <String>]
[-PackagePublisherDisplayName <String>]
[-MakeAppx]
[-LogFile <String>]
[<CommonParameters>]  
```

### Пример

В следующем примере показано, как преобразовать классическое приложение с именем *MyApp* издателя *&lt;publisher_name&gt;* в пакет UWP (AppX).

```CMD
DesktopAppConverter.exe -Installer C:\Installer\MyApp.exe 
-InstallerArguments "/S" -Destination C:\Output\MyApp -PackageName "MyApp" 
-Publisher "CN=<publisher_name>" -Version 0.0.0.1 -MakeAppx -Verbose
```

## Развертывание преобразованного пакета AppX

Для развертывания подписанного пакета приложения (.appx) в учетной записи пользователя используется командлет [Add-AppxPackage](https://technet.microsoft.com/library/hh856048.aspx) в PowerShell. 

Вы можете использовать флаг ```-Sign``` в Desktop App Converter (версия 0.1.24) для автоматического подписывания преобразованного приложения. Либо вы можете обратиться к разделу [Подписывание преобразованного классического приложения](desktop-to-uwp-signing.md) и узнать, как самостоятельно подписывать пакеты AppX.

Вы также можете использовать параметр ```-Register``` командлета Add-AppXPackage PowerShell для выполнения установки из папки нераспакованных файлов в процессе разработки. 

Подробнее о развертывании и отладке преобразованных приложений см. в разделе [Развертывание и отладка преобразованного приложения UWP](desktop-to-uwp-deploy-and-debug.md). 

## Подписывание пакета .Appx

Для командлета Add-AppxPackage необходимо, чтобы развертываемый пакет приложения (.appx) был подписан. Используйте флаг ```-Sign``` как часть командной строки преобразователя или SignTool.exe в составе пакета SDK Microsoft Windows 10 для подписывания пакета .appx.

Подробнее о том, как подписывать пакет .appx, см. в разделе [Подписывание преобразованного классического приложения](desktop-to-uwp-signing.md). 

## Предупреждения

1. Сборка Windows 10 на хост-компьютере должна соответствовать базовому образу, который вы получили в составе скачанных файлов Desktop App Converter.  
2. Убедитесь, что классическая программа установки находится в независимом каталоге, так как преобразователь копирует все содержимое каталога в изолированную среду Windows.  
3. В данный момент Desktop App Converter поддерживает выполнение процесса преобразования только на 64-разрядный операционной системе. Вы можете развернуть преобразованные пакеты .appx только на 64-разрядной операционной системе x64).  
4. Desktop App Converter требует, чтобы классическая программа установки выполнялась в автоматическом режиме. Убедитесь, что вы перенесли флаг автоматического режима для программы установки в преобразователь с помощью параметра *-InstallerArguments*.
5. Публикация общедоступных сборок SxS Fusion будет невозможна. В ходе процесса установки приложение может публиковать располагающиеся рядом друг с другом общедоступные сборки Fusion, которые являются доступными для любого другого процесса. Во время создания контекста активации процесса эти сборки извлекаются системным процессом с именем CSRSS.exe. Когда эта процедура выполняется для преобразованного процесса, будет происходить сбой процессов создания контекста активации и загрузки модулей этих сборок. Входящие сборки, такие как ComCtl, поставляются вместе с операционной системой, поэтому указание зависимости от них является безопасным. Сборки SxS Fusion регистрируются в следующих местах:
  + Реестр: `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\SideBySide\Winners`
  + Файловая система: %windir%\\SideBySide

## Известные проблемы

+ Если вы выполняете тестирование возможности в рамках программы предварительной оценки Windows на компьютере разработчика, на котором ранее был установлен Desktop App Converter, при установке нового базового образа может возникнуть ошибка `New-ContainerNetwork: The object already exists`. В качестве обходного пути выполните команду `Netsh int ipv4 reset` в командной строке с повышенными привилегиями, а затем перезапустите компьютер. 
+ Приложение .NET, скомпилированное с использованием параметра сборки "AnyCPU", не удастся установить, если главный исполняемый файл или какая-либо зависимость были помещены в каталог "Program Files "или "Windows\System32". В качестве обходного пути используйте классическую программу установки, применяемую в архитектуре вашей системы (32- или 64-разрядная), чтобы создать пакет AppX.

## Телеметрия Desktop App Converter  
Desktop App Converter может собирать сведения о вас и об используемом вами программном обеспечении и отправлять эти данные в Майкрософт. Подробнее о процессе сбора данных корпорацией Майкрософт и их использовании в документации по продуктам см. в [заявлении о конфиденциальности корпорации Майкрософт](http://go.microsoft.com/fwlink/?LinkId=521839). Вы соглашаетесь выполнять требования всех применимых положений заявления о конфиденциальности корпорации Майкрософт.

По умолчанию для Desktop App Converter телеметрия будет включена. Добавьте следующий раздел реестра для настройки телеметрии:  
```CMD
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\DesktopAppConverter
```
+ Добавьте или измените значение *DisableTelemetry* с помощью DWORD со значением 1.
+ Для включения телеметрии удалите раздел или задайте значение 0.

## Использование Desktop App Converter

Ниже приведен список параметров Desktop App Converter. Просмотреть этот список также можно, выполнив следующую команду:   

```CMD
Get-Help DesktopAppConverter.exe -detailed
```

### Параметры установки  

|Параметр|Описание|
|---------|-----------|
|```-Setup [<SwitchParameter>]``` | Запускает DesktopAppConverter в режиме установки. Режим установки поддерживает развертывание предоставляемого базового образа.|
|```-BaseImage <String>``` | Полный путь к неразвернутому базовому образу. Этот параметр необходим, если указана программа установки.|
|```-LogFile <String>``` [необязательно] | Определяет файл журнала. Если этот параметр пропущен, для файла журнала будет создано временное расположение.|
|```-NatSubnetPrefix <String>``` [необязательно] | Значение префикса, которое необходимо использовать для экземпляра Nat. Как правило, это значение будет необходимо изменить, только если ваш хост-компьютер подключен к тому же диапазону адресов подсети, что и NetNat преобразователя. Вы можете запросить текущую конфигурацию NetNat преобразователя, используя командлет **Get-NetNat**. |
|```-NoRestart [<SwitchParameter>]``` | Подавляет вывод запроса на перезагрузку при выполнении программы установки (перезагрузка необходима для включения функции контейнеров). |

### Параметры преобразования  

|Параметр|Описание|
|---------|-----------|
|```-AppInstallPath <String> [optional]``` | Полный путь к корневой папке вашего приложения для установленных файлов, если они были установлены (например, «C:\Program Files (x86)\MyApp»).| 
|```-Destination <String>``` | Желаемое расположение создаваемого преобразователем пакета AppX. DesktopAppConverter может создать это расположение, если оно еще не существует.|
|```-Installer <String>``` | Путь к программе установки вашего приложения, которая должна поддерживать выполнение в автоматическом режиме.|
|```-InstallerArguments <String>``` [необязательно] | Список с разделителями-запятыми или строка аргументов, чтобы перевести выполнение программы установки в автоматический режим. Этот параметр необязателен, если вы используете программу установки msi. Для получения журнала из программы установки укажите в этом месте аргумент журнала для программы установки и используйте путь ```<log_folder>```, являющийся маркером, который преобразователь заменит соответствующим путем. <br><br>**ПРИМЕЧАНИЕ. Типы флага автоматического режима и аргументов журнала зависят от технологий, использующихся в программе установки.** <br><br>Пример использования этого параметра: ```-InstallerArguments "/silent /log <log_folder>\install.log"``` Другой пример, в котором не выполняется создание файла журнала, может выглядеть так: ```-InstallerArguments "/quiet", "/norestart"``` Опять же, если вы хотите, чтобы преобразователь осуществлял захват пути маркера и помещал его в папку с конечным журналом, вы должны в буквальном смысле направлять все журналы по пути маркера ```<log_folder>```.|
|```-InstallerValidExitCodes <Int32>``` [необязательно] | Разделенный запятыми список кодов завершения, указывающих на то, что программа установки была выполнена успешно (например: 0, 1234, 5678).  По умолчанию это 0 для программ установки, отличных от MSI, и 0, 1641, 3010 для программ установки MSI.|

### Параметры, идентифицирующие пакет AppX  

|Параметр|Описание|
|---------|-----------|
|```-PackageName <String>``` | Имя вашего пакета универсального приложения для Windows.
|```-Publisher <String>``` | Издатель вашего пакета универсального приложения для Windows
|```-Version <Version>``` | Номер версии вашего пакета универсального приложения для Windows

### Необязательные параметры манифеста Appx  

|Параметр|Описание|
|---------|-----------|
|```-AppExecutable <String> [optional]``` [необязательно] | Имя основного исполняемого файла вашего приложения (например, "MyApp.exe"). |
|```-AppFileTypes <String>``` [необязательно] | Список с разделителями-запятыми типов файлов, с которыми приложение будет связано (например, ".txt, .doc", без кавычек).|
|```-AppId <String>``` [необязательно] | Указывает значение, которое нужно задать идентификатору приложения в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*.|
|```-AppDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени приложения в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. |
|```-AppDescription <String>``` [необязательно] | Указывает значение, которое нужно задать описанию приложения в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*.|
|```-PackageDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени пакета в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. |
|```-PackagePublisherDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени издателя пакета в манифесте appx. Если параметр не настроен, ему будет задано значение, передаваемое для *Publisher*. |

### Другие параметры преобразования  

|Параметр|Описание|
|---------|-----------|
|```-ExpandedBaseImage <String>``` [необязательно] | Полный путь к уже развернутому базовому образу.|
|```-MakeAppx [<SwitchParameter>]``` [необязательно] | Переключатель, который при его наличии, сообщает этому сценарию, что MakeAppx должен вызвать выходные данные. |
|```-LogFile <String>``` [необязательно] | Определяет файл журнала. Если этот параметр пропущен, для файла журнала будет создано временное расположение. |
| ```Sign [<SwitchParameter>] [optional]``` | Сообщает этому сценарию о необходимости подписать выходной appx. Этот параметр следует использовать вместе с параметром ```-MakeAppx```. 
|```<Common parameters>``` | Данный командлет поддерживает общие параметры: *Verbose*, *Debug*, *ErrorAction*, *ErrorVariable*, *WarningAction*, *WarningVariable*, *OutBuffer*, *PipelineVariable* и *OutVariable*. Дополнительные сведения см. в разделе [about_CommonParameters](http://go.microsoft.com/fwlink/?LinkID=113216). |

### Параметры очистки

|Параметр|Описание|
|---------|-----------|
|```Cleanup [<Option>]``` | Запускает очистку артефактов DesktopAppConverter. Есть 3допустимых варианта режима отчистки. |
|```Cleanup All``` | Удаляет все развернутые базовые образы, удаляет все временные файлы преобразователя, удаляет контейнерную сеть и отключает необязательную функцию Windows— "Контейнеры". |
|```Cleanup WorkDirectory``` | Удаляет все временные файлы преобразователя. |
|```Cleanup ExpandedImage``` | Удаляет все развернутые базовые образы, установленные на хост-компьютере. |

### Архитектура пакета

Desktop App Converter теперь поддерживает создание пакетов приложений x86 и x64, которые можно устанавливать и запускать на компьютерах x86 и AMD64. Обратите внимание, что для успешного преобразования запускать Desktop App Converter необходимо на компьютере AMD64.

|Параметр|Описание|
|---------|-----------|
|```-PackageArch <String>``` | Создает пакет с выбранной архитектурой. Допустимые типы архитектуры: "x86" или "x64"; например — PackageArch x86. Это необязательный параметр. Если не выбрать тип архитектуры пакета, DesktopAppConverter попытается определить ее автоматически. Если автоматически определить архитектуру не удается, будет использоваться архитектура пакета по умолчанию — x64. 

### Запуск PEHeaderCertFixTool

В процессе преобразования DesktopAppConverter автоматически запускает PEHeaderCertFixTool, чтобы исправить все поврежденные заголовки PE. Но вы также можете запустить PEHeaderCertFixTool для appx UWP, свободных файлов или определенного двоичного файла. 

PEHeaderCertFixTool поставляется в составе DesktopAppConverter.zip. Пример использования: 

```CMD
PEHeaderCertFixTool.exe <binary file>|<.appx package>|<folder> [/c] [/v]
 /c   -- check for corrupted certificate but do not fix (optional)
 /v   -- verbose (optional)
example1: PEHeaderCertFixTool app.exe
example2: PEHeaderCertFixTool c:\package.appx /c
example3: PEHeaderCertFixTool c:\myapp /c /v
```

## Поддержка языков

Desktop App Converter не поддерживает Юникод, поэтому в нем нельзя использовать символы китайского языка или символы, отличные от набора ASCII.

## См. также

+ [Перенос классических приложений в UWP с помощью Desktop App Converter](https://channel9.msdn.com/events/Build/2016/P504)
+ [Project Centennial: перенос имеющихся классических приложений на универсальную платформу Windows](https://channel9.msdn.com/events/Build/2016/B829)  


<!--HONumber=Nov16_HO1-->


