---
author: normesta
Description: "Запуск Desktop App Converter для преобразования классического приложения для Windows (например, Win32, WPF и Windows Forms) в приложение для универсальной платформы Windows (UWP)."
Search.Product: eADQiWindows 10XVcnh
title: "Мост переноса классических приложений на UWP: Desktop App Converter"
ms.author: normesta
ms.date: 03/09/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: windows 10, uwp
ms.assetid: 74c84eb6-4714-4e12-a658-09cb92b576e3
ms.openlocfilehash: 4daf45a4637ac846c550430cbc7518238ebd5bd8
ms.sourcegitcommit: 909d859a0f11981a8d1beac0da35f779786a6889
translationtype: HT
---
# <a name="desktop-to-uwp-bridge-desktop-app-converter"></a>Мост переноса классических приложений на UWP: Desktop App Converter

[Получение Desktop App Converter](https://aka.ms/converter)

Desktop App Converter (DAC) — это инструмент, позволяющий преобразовывать имеющиеся классические приложения, написанные для .NET 4.6.1 или Win32, в приложения универсальной платформы Windows (UWP). Используя преобразователь, вы можете запускать свои классические установщики в автоматическом режиме и получать пакет приложения для Windows, который можно установить с помощью командлета Add-AppxPackage PowerShell на вашем компьютере, использующемся для разработки.

Desktop App Converter доступен в [Магазине Windows](https://aka.ms/converter).

Преобразователь запустит классическую программу установки в изолированной среде Windows, используя чистый базовый образ, предоставляемый в составе скачиваемых файлов преобразователя. Он захватывает любые операции ввода-вывода реестра и файловой системы, инициализируемые классической программой установки, и упаковывает их в виде части выходных данных. Выходные данные преобразователя содержат пакет приложения для Windows с идентификатором пакета. Также преобразователь обеспечивает возможность осуществлять вызов разнообразных API WinRT.

## <a name="whats-new"></a>Новые возможности

Последняя версия DAC— v1.0.9.0. Новое в этом обновлении:

* Преобразование без установщика. Если приложение установлено с помощью команды xcopy или вы знакомы с изменениями, которые установщик вашего приложения вносит в систему, можно выполнить преобразование без установщика, задав параметр -Installer в корневом каталоге файлов приложения.
* Проверка пакета приложения: используйте новый флаг `-Verify`, чтобы проверить преобразованный пакет приложения на соответствие требованиям моста для классических приложений и Магазина


## <a name="system-requirements"></a>Требования к системе

### <a name="operating-system"></a>Операционная система

+ Юбилейное обновление Windows 10 Pro или Корпоративная (10.0.14393.0 и более поздней версии).

### <a name="hardware-configuration"></a>Конфигурация оборудования

+ 64-разрядный процессор (x64)
+ Аппаратная виртуализация
+ Преобразование адресов второго уровня (SLAT)

### <a name="required-resources"></a>Необходимые ресурсы

+ [Пакет средств разработки программного обеспечения (SDK) для Windows10](https://go.microsoft.com/fwlink/?linkid=821375)

## <a name="set-up-the-desktop-app-converter"></a>Установка Desktop App Converter

*(Эти действия не требуются для преобразования без установщика)*

Desktop App Converter задействует новейшие возможности Windows 10. Убедитесь, что у вас установлено юбилейное обновление Windows 10 (14393.0 или более позднюю версию сборки).

1.    Скачайте [DesktopAppConverter из Магазина Windows](https://aka.ms/converter) и [WIM-файл базового образа, соответствующий вашей сборке](https://aka.ms/converterimages).  
2.    Запустите DesktopAppConverter от имени администратора. Это можно сделать из меню «Пуск», щелкнув плитку правой кнопкой мыши и выбрав *Запуск от имени администратора* в разделе *Еще*, или с панели задач, щелкнув плитку правой кнопкой мыши, затем еще щелкнув правой кнопкой мыши на появившемся имени приложения и выбрав *Запуск от имени администратора.*
3.    В окне консоли приложения выполните команду ```Set-ExecutionPolicy bypass```.
4.    Установите преобразователь, выполнив в окне консоли приложения команду ```DesktopAppConverter.exe -Setup -BaseImage .\BaseImage-1XXXX.wim -Verbose```.
5.    Если при выполнении указанной выше команды появится запрос на перезагрузку, перезапустите компьютер.

## <a name="run-the-desktop-app-converter"></a>Запуск Desktop App Converter

+ **Загрузка из Магазина**: используйте для запуска преобразователя файл ```DesktopAppConverter.exe```.

### <a name="usage"></a>Использование

```CMD
DesktopAppConverter.exe
-Installer <String> [-InstallerArguments <String>] [-InstallerValidExitCodes <Int32>]
-Destination <String>
-PackageName <String>
-Publisher <String>
-Version <Version>
[-ExpandedBaseImage <String>]
[-AppExecutable <String>]
[-AppFileTypes <String>]
[-AppId <String>]
[-AppDisplayName <String>]
[-AppDescription <String>]
[-PackageDisplayName <String>]
[-PackagePublisherDisplayName <String>]
[-MakeAppx]
[-LogFile <String>]
[<CommonParameters>]  
```

### <a name="examples"></a>Примеры

В следующих примерах показано, как преобразовать классическое приложение с именем *MyApp* издателя *MyPublisher* в пакет приложения для Windows.

#### <a name="no-installer-conversion"></a>Преобразование без установщика

При преобразовании без установщика параметр `-Installer` указывает на корневой каталог файлов приложения, а параметр `-AppExecutable` является обязательным.

```cmd
DesktopAppConverter.exe -Installer C:\Installer\MyApp\ -AppExecutable MyApp.exe -Destination C:\Output\MyApp -PackageName "MyApp" -Publisher "CN=MyPublisher" -Version 0.0.0.1 -MakeAppx -Sign -Verbose
```

#### <a name="installer-based-conversion"></a>Преобразование на основе установщика

При преобразовании на основе установщика `-Installer` указывает на установщик приложения.

```cmd
DesktopAppConverter.exe -Installer C:\Installer\MyAppSetup.exe -InstallerArguments "/S" -Destination C:\Output\MyApp -PackageName "MyApp" -Publisher "CN=MyPublisher" -Version 0.0.0.1 -MakeAppx -Sign -Verbose
```

## <a name="deploy-your-converted-windows-app-package"></a>Развертывание преобразованного пакета приложения для Windows

Для развертывания подписанного пакета приложения (.appx) в учетной записи пользователя используется командлет [Add-AppxPackage](https://technet.microsoft.com/library/hh856048.aspx) в PowerShell.

Вы можете использовать флаг ```-Sign``` в Desktop App Converter (версия 0.1.24) для автоматического подписывания преобразованного приложения. Либо вы можете обратиться к разделу [Подписывание преобразованного классического приложения](desktop-to-uwp-signing.md) и узнать, как самостоятельно подписывать пакеты AppX.

Вы также можете использовать параметр ```-Register``` командлета Add-AppXPackage PowerShell для выполнения установки из папки нераспакованных файлов в процессе разработки.

Подробнее о развертывании и отладке преобразованных приложений см. в разделе [Развертывание и отладка преобразованного приложения UWP](desktop-to-uwp-deploy-and-debug.md).

## <a name="sign-your-windows-app-package"></a>Подписывание пакета приложения для Windows

Для командлета Add-AppxPackage необходимо, чтобы развертываемый пакет приложения для Windows (.appx) был подписан. Используйте флаг ```-Sign``` как часть командной строки преобразователя или SignTool.exe в составе пакета SDK Microsoft Windows 10, чтобы подписать пакет приложения для Windows.

Подробнее о том, как подписывать пакет приложения для Windows, см. в разделе [Подписывание преобразованного классического приложения](desktop-to-uwp-signing.md).

Примечание. При попытке подписать пакет с помощью автоматически созданного сертификата необходимо использовать пароль по умолчанию "123456".

## <a name="modify-vfs-folder-and-registry-hive-optional"></a>Изменение папки VFS и куста реестра (необязательно)

Desktop App Converter использует очень консервативный подход к фильтрации файлов и системного шума в контейнере.  Это не обязательно, но после преобразования вы сможете:

1. просматривать папку VFS и удалять все файлы, которые не требуются вашему установщику;
2. Просматривать содержимое Reg.dat и удалять все ключи, которые не установлены или не нужны приложению.

В случае внесения каких-либо изменений в преобразованное приложение (в том числе указанных выше) вам не потребуется запускать преобразователь еще раз, вы можете вручную перепаковать свое приложение, используя средство MakeAppx и файл appxmanifest.xml, создаваемый DAC для вашего приложения. Дополнительные сведения см. в разделе [Ручное преобразование приложения в приложение UWP с помощью Desktop Bridge](desktop-to-uwp-manual-conversion.md).

## <a name="caveats"></a>Предупреждения

1. Сборка Windows 10 на хост-компьютере должна соответствовать базовому образу, который вы получили в составе скачанных файлов Desktop App Converter.  
2. Убедитесь, что классическая программа установки находится в независимом каталоге, так как преобразователь копирует все содержимое каталога в изолированную среду Windows.  
3. В данный момент Desktop App Converter поддерживает выполнение процесса преобразования только на 64-разрядной операционной системе. Вы можете развернуть преобразованные пакеты приложений Windows только на 64-разрядной операционной системе (x64).  
4. Desktop App Converter требует, чтобы классическая программа установки выполнялась в автоматическом режиме. Убедитесь, что вы перенесли флаг автоматического режима для программы установки в преобразователь с помощью параметра *-InstallerArguments*.
5. Публикация общедоступных сборок SxS Fusion будет невозможна. В ходе процесса установки приложение может публиковать располагающиеся рядом друг с другом общедоступные сборки Fusion, которые являются доступными для любого другого процесса. Во время создания контекста активации процесса эти сборки извлекаются системным процессом с именем CSRSS.exe. Когда эта процедура выполняется для преобразованного процесса, будет происходить сбой процессов создания контекста активации и загрузки модулей этих сборок. Входящие сборки, такие как ComCtl, поставляются вместе с операционной системой, поэтому указание зависимости от них является безопасным. Сборки SxS Fusion регистрируются в следующих местах:
  + Реестр: `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\SideBySide\Winners`
  + Файловая система: %windir%\\SideBySide

## <a name="known-issues"></a>Известные проблемы

* Мы в данное время изучаем следующие ошибки, возникающих в некоторых сборках операционной системы:

    * ```E_CREATTING_ISOLATED_ENV_FAILED```
    * ```E_STARTING_ISOLATED_ENV_FAILED```

    Если вы столкнетесь с какой-либо из этих ошибок, убедитесь, что вы используете правильный базовый образ из [центра загрузки](https://aka.ms/converterimages). Если вы используете допустимый .wim, отправьте нам журналы на адрес converter@microsoft.com, чтобы помочь нам лучше изучить возникающие ошибки.

* Если вы выполняете тестирование возможности в рамках программы предварительной оценки Windows на компьютере разработчика, на котором ранее был установлен Desktop App Converter, при установке нового базового образа может возникнуть ошибка `New-ContainerNetwork: The object already exists`. В качестве обходного пути выполните команду `Netsh int ipv4 reset` в командной строке с повышенными привилегиями, а затем перезапустите компьютер.

* Приложение .NET, скомпилированное с использованием параметра сборки "AnyCPU", не удастся установить, если главный исполняемый файл или какая-либо зависимость были помещены в каталог "Program Files "или "Windows\System32". В качестве обходного пути используйте классическую программу установки, применяемую в архитектуре вашей системы (32- или 64-разрядная), чтобы создать пакет приложения для Windows.

## <a name="telemetry-from-desktop-app-converter"></a>Телеметрия Desktop App Converter

Desktop App Converter может собирать сведения о вас и об используемом вами программном обеспечении и отправлять эти данные в Майкрософт. Подробнее о процессе сбора данных корпорацией Майкрософт и их использовании в документации по продуктам см. в [заявлении о конфиденциальности корпорации Майкрософт](http://go.microsoft.com/fwlink/?LinkId=521839). Вы соглашаетесь выполнять требования всех применимых положений заявления о конфиденциальности корпорации Майкрософт.

По умолчанию для Desktop App Converter телеметрия будет включена. Добавьте следующий раздел реестра для настройки телеметрии:  

```cmd
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\DesktopAppConverter
```
+ Добавьте или измените значение *DisableTelemetry* с помощью DWORD со значением 1.
+ Для включения телеметрии удалите раздел или задайте значение 0.

## <a name="desktop-app-converter-usage"></a>Использование Desktop App Converter

Ниже приведен список параметров Desktop App Converter. Просмотреть этот список также можно, выполнив следующую команду:   

```CMD
Get-Help DesktopAppConverter.exe -detailed
```

### <a name="setup-parameters"></a>Параметры установки  

|Параметр|Описание|
|---------|-----------|
|```-Setup [<SwitchParameter>]``` | Запускает DesktopAppConverter в режиме установки. Режим установки поддерживает развертывание предоставляемого базового образа.|
|```-BaseImage <String>``` | Полный путь к неразвернутому базовому образу. Этот параметр необходим, если указана программа установки.|
|```-LogFile <String>``` [необязательно] | Определяет файл журнала. Если этот параметр пропущен, для файла журнала будет создано временное расположение.|
|```-NatSubnetPrefix <String>``` [необязательно] | Значение префикса, которое необходимо использовать для экземпляра Nat. Как правило, это значение будет необходимо изменить, только если ваш хост-компьютер подключен к тому же диапазону адресов подсети, что и NetNat преобразователя. Вы можете запросить текущую конфигурацию NetNat преобразователя, используя командлет **Get-NetNat**. |
|```-NoRestart [<SwitchParameter>]``` | Подавляет вывод запроса на перезагрузку при выполнении программы установки (перезагрузка необходима для включения функции контейнеров). |

### <a name="conversion-parameters"></a>Параметры преобразования  

|Параметр|Описание|
|---------|-----------|
|```-AppInstallPath <String> [optional]``` | Полный путь к корневой папке вашего приложения для установленных файлов, если они были установлены (например, «C:\Program Files (x86)\MyApp»).|
|```-Destination <String>``` | Желаемое расположение создаваемого преобразователем пакета AppX. DesktopAppConverter может создать это расположение, если оно еще не существует.|
|```-Installer <String>``` | Путь к программе установки вашего приложения, которая должна поддерживать выполнение в автоматическом режиме (без предупреждения). Преобразование без установщика, это путь к корневому каталогу файлов приложения. |
|```-InstallerArguments <String>``` [необязательно] | Список с разделителями-запятыми или строка аргументов, чтобы перевести выполнение программы установки в автоматический режим. Этот параметр необязателен, если вы используете программу установки msi. Для получения журнала из программы установки укажите в этом месте аргумент журнала для программы установки и используйте путь ```<log_folder>```, являющийся маркером, который преобразователь заменит соответствующим путем. <br><br>**ПРИМЕЧАНИЕ. Типы флага автоматического режима и аргументов журнала зависят от технологий, использующихся в программе установки.** <br><br>Пример использования этого параметра: ```-InstallerArguments "/silent /log <log_folder>\install.log"``` Другой пример, в котором не выполняется создание файла журнала, может выглядеть так: ```-InstallerArguments "/quiet", "/norestart"``` Опять же, если вы хотите, чтобы преобразователь осуществлял захват пути маркера и помещал его в папку с конечным журналом, вы должны в буквальном смысле направлять все журналы по пути маркера ```<log_folder>```.|
|```-InstallerValidExitCodes <Int32>``` [необязательно] | Разделенный запятыми список кодов завершения, указывающих на то, что программа установки была выполнена успешно (например: 0, 1234, 5678).  По умолчанию это 0 для программ установки, отличных от MSI, и 0, 1641, 3010 для программ установки MSI.|

### <a name="windows-app-package-identity-parameters"></a>Параметры, идентифицирующие пакет приложения для Windows  

|Параметр|Описание|
|---------|-----------|
|```-PackageName <String>``` | Имя вашего пакета универсального приложения для Windows.
|```-Publisher <String>``` | Издатель вашего пакета универсального приложения для Windows
|```-Version <Version>``` | Номер версии вашего пакета универсального приложения для Windows

### <a name="optional-windows-app-package-manifest-parameters"></a>Необязательные параметры манифеста пакета приложения для Windows  

|Параметр|Описание|
|---------|-----------|
|```-AppExecutable <String> [optional]``` [необязательно] | Имя основного исполняемого файла вашего приложения (например, "MyApp.exe"). Этот параметр является обязательным для преобразования без установщика. |
|```-AppFileTypes <String>``` [необязательно] | Список с разделителями-запятыми типов файлов, с которыми приложение будет связано (например, ".txt, .doc", без кавычек).|
|```-AppId <String>``` [необязательно] | Указывает значение, которое нужно задать идентификатору приложения в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*.|
|```-AppDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени приложения в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. |
|```-AppDescription <String>``` [необязательно] | Указывает значение, которое нужно задать описанию приложения в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*.|
|```-PackageDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени пакета в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. |
|```-PackagePublisherDisplayName <String>``` [необязательно] | Указывает значение, которое нужно задать отображаемому имени издателя пакета в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *Publisher*. |

### <a name="other-conversion-parameters"></a>Другие параметры преобразования  

|Параметр|Описание|
|---------|-----------|
|```-ExpandedBaseImage <String>``` [необязательно] | Полный путь к уже развернутому базовому образу.|
|```-MakeAppx [<SwitchParameter>]``` [необязательно] | Переключатель, который при его наличии, сообщает этому сценарию, что MakeAppx должен вызвать выходные данные. |
|```-LogFile <String>``` [необязательно] | Определяет файл журнала. Если этот параметр пропущен, для файла журнала будет создано временное расположение. |
| ```-Sign [<SwitchParameter>] [optional]``` | Передает сценарию команду подписать выходной пакет приложения для Windows. Этот параметр следует использовать вместе с параметром ```-MakeAppx```.
|```<Common parameters>``` | Данный командлет поддерживает общие параметры: *Verbose*, *Debug*, *ErrorAction*, *ErrorVariable*, *WarningAction*, *WarningVariable*, *OutBuffer*, *PipelineVariable* и *OutVariable*. Дополнительные сведения см. в разделе [about_CommonParameters](http://go.microsoft.com/fwlink/?LinkID=113216). |
| ```-Verify [<SwitchParameter>] [optional]``` | Если имеется, этот переключатель передает DAC команду проверить преобразованный пакет приложения на соответствие требованиям моста для классических приложений и Магазина Windows. Результат — отчет о проверке "VerifyReport.xml", который лучше всего отображается в браузере. Этот параметр следует использовать вместе с параметром `-MakeAppx`.

### <a name="cleanup-parameters"></a>Параметры очистки

|Параметр|Описание|
|---------|-----------|
|```Cleanup [<Option>]``` | Запускает очистку артефактов DesktopAppConverter. Есть 3допустимых варианта режима отчистки. |
|```Cleanup All``` | Удаляет все развернутые базовые образы, удаляет все временные файлы преобразователя, удаляет контейнерную сеть и отключает необязательную функцию Windows— "Контейнеры". |
|```Cleanup WorkDirectory``` | Удаляет все временные файлы преобразователя. |
|```Cleanup ExpandedImage``` | Удаляет все развернутые базовые образы, установленные на хост-компьютере. |

### <a name="package-architecture"></a>Архитектура пакета

Desktop App Converter теперь поддерживает создание пакетов приложений x86 и x64, которые можно устанавливать и запускать на компьютерах x86 и AMD64. Обратите внимание, что для успешного преобразования запускать Desktop App Converter необходимо на компьютере AMD64.

|Параметр|Описание|
|---------|-----------|
|```-PackageArch <String>``` | Создает пакет с выбранной архитектурой. Допустимые типы архитектуры: "x86" или "x64"; например — PackageArch x86. Это необязательный параметр. Если не выбрать тип архитектуры пакета, DesktopAppConverter попытается определить ее автоматически. Если автоматически определить архитектуру не удается, будет использоваться архитектура пакета по умолчанию — x64.

### <a name="running-the-peheadercertfixtool"></a>Запуск PEHeaderCertFixTool

В процессе преобразования DesktopAppConverter автоматически запускает PEHeaderCertFixTool, чтобы исправить все поврежденные заголовки PE. Но вы также можете запустить PEHeaderCertFixTool для пакета приложения UWP для Windows, свободных файлов или определенного двоичного файла. Пример использования:

```CMD
PEHeaderCertFixTool.exe <binary file>|<.appx package>|<folder> [/c] [/v]
 /c   -- check for corrupted certificate but do not fix (optional)
 /v   -- verbose (optional)
example1: PEHeaderCertFixTool app.exe
example2: PEHeaderCertFixTool c:\package.appx /c
example3: PEHeaderCertFixTool c:\myapp /c /v
```

## <a name="language-support"></a>Языковая поддержка

Desktop App Converter не поддерживает Юникод, поэтому в нем нельзя использовать символы китайского языка или символы, отличные от набора ASCII.

## <a name="see-also"></a>См. также

+ [Перенос классических приложений в UWP с помощью Desktop App Converter](https://channel9.msdn.com/events/Build/2016/P504)
+ [Project Centennial: перенос имеющихся классических приложений на универсальную платформу Windows](https://channel9.msdn.com/events/Build/2016/B829)  
