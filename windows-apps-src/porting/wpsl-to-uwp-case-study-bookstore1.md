---
ms.assetid: 2b63a4c8-b1c0-4c77-95ab-0b9549ba3c0e
description: В этом разделе представлен практический пример переноса очень простого приложения WindowsPhone Silverlight в приложение универсальной платформы Windows (UWP) Windows10.
title: WindowsPhone Silverlight практический пример UWP, Bookstore1
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: 19045e84f1ca3396321dd4f8c4e76da24dc9a588
ms.sourcegitcommit: 49d58bc66c1c9f2a4f81473bcb25af79e2b1088d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2018
ms.locfileid: "8935918"
---
# <a name="windowsphone-silverlight-to-uwp-case-study-bookstore1"></a>WindowsPhone Silverlight в UWP практический пример: Bookstore1


В этом разделе представлен практический пример переноса очень простого приложения WindowsPhone Silverlight в приложение Windows10Universal платформы Windows (UWP). С помощью Windows10, можно создать один пакет приложения, покупатели могут установить на широкий спектр устройств, и именно то, что мы выполним займемся в этом. См. раздел [Руководство по приложениям UWP](https://msdn.microsoft.com/library/windows/apps/dn894631).

Приложение, которое мы будем портировать, состоит из элемента **ListBox**, привязанного к модели представления. Модель представления содержит список книг, в котором отображается заголовок, имя автора и обложка книги. У изображений обложки книги **Действие при сборке** установлено на **Содержимое**, а **Копировать в выходной каталог** установлено на **Не копировать**.

Предыдущая тема в этом разделе описывает различия между платформами. Это описание содержит подробные сведения и руководство по переносу различных элементов приложения из разметки XAML через привязку к модели представления и далее к доступу к данным. Цель этого практического примера — дополнить это руководство, показывая его в действии на реальном примере. Предполагается, что вы ознакомились с этим руководством, которое в данных примерах не повторяется.

**Примечание**  при открытии Bookstore1Universal\_10 в Visual Studio, если вы видите сообщение «Требуется обновление Visual Studio», следуйте инструкциям по выбору целевой версии платформы в [TargetPlatformVersion](wpsl-to-uwp-troubleshooting.md).

## <a name="downloads"></a>Загрузки

[Скачать Bookstore1WPSL8 WindowsPhone Silverlight приложение](http://go.microsoft.com/fwlink/?linkid=517053).

[Скачать приложение Bookstore1Universal\_10 для Windows10](http://go.microsoft.com/fwlink/?linkid=532950).

## <a name="the-windowsphone-silverlight-app"></a>Приложение WindowsPhone Silverlight

Вот как Bookstore1WPSL8, приложение, которое мы собираемся переносить, выглядит. Это просто список книг с вертикальной прокруткой под заголовком имени и названия страницы приложения.

![как выглядит bookstore1wpsl8](images/wpsl-to-uwp-case-studies/c01-01-wpsl-how-the-app-looks.png)

## <a name="porting-to-a-windows10-project"></a>Перенос в проект Windows10

Создание нового проекта в Visual Studio, копирование в него файлов Bookstore1WPSL8 и подключение скопированных файлов к новому проекту не займут много времени. Начните с создания нового проекта пустого приложения (Windows Universal). Назовите его Bookstore1Universal\_10. Эти файлы следует скопировать из Bookstore1WPSL8 в Bookstore1Universal\_10.

-   Скопируйте папку, содержащую файлы изображений обложек книг в формате PNG (папка \\Assets\\CoverImages). После копирования убедитесь, что в **Обозревателе решений** включена функция **Показать все файлы**. Щелкните правой кнопкой мыши на скопированной папке и выберите **Включить в проект**. Под выполнением этой команды мы и понимаем включение файлов или папок в проект. Каждый раз, копируя файл или папку, нажимайте **Обновить** в **Обозревателе решений**, а затем включайте этот файл или папку в проект. Для тех файлов, которые вы заменяете в конечном местоположении, выполнять эту операцию не нужно.
-   Скопируйте папку, содержащую исходный файл модели представления (папка \\ViewModel).
-   Скопируйте файл MainPage.xaml и замените на него файл в конечной папке.

Мы можем сохранить App.xaml и App.xaml.cs, которые Visual Studio создает для нас в проекте Windows10.

Отредактируйте исходный код и файлы разметки, которые вы только что скопировали, и измените все ссылки на пространство имен Bookstore1WPSL8 на Bookstore1Universal\_10. Эту операцию можно быстро выполнить при помощи функции **Заменить в файлах**. В императивном коде в исходном файле модели представления необходимо сделать следующие изменения для переноса.

-   Измените `System.ComponentModel.DesignerProperties` на `DesignMode`, а затем примените к нему команду **Разрешить**. Удалите свойство `IsInDesignTool` и используйте функцию IntelliSense, чтобы добавить правильное имя свойства: `DesignModeEnabled`.
-   Примените команду **Разрешить** к `ImageSource`.
-   Примените команду **Разрешить** к `BitmapImage`.
-   Удалите использование `System.Windows.Media;` и `using System.Windows.Media.Imaging;`.
-   Измените значение, возвращенное свойством **Bookstore1Universal\_10.BookstoreViewModel.AppName**, с "BOOKSTORE1WPSL8" на "BOOKSTORE1UNIVERSAL".

В файле MainPage.xaml необходимо сделать следующие изменения для переноса.

-   Измените `phone:PhoneApplicationPage` на `Page` (не забудьте вхождения в синтаксисе элементов свойства).
-   Удалите объявления префикса пространства имен `phone` и `shell`.
-   Измените "clr-namespace" на "using" в остальных объявлениях префикса пространства имен.

Мы можем очень быстро исправить ошибки компиляции разметки, если хотим как можно быстрее увидеть результаты, даже если это означает временное удаление разметки. Однако давайте продолжать записывать долги, которые мы накапливаем, поступая таким образом. Вот, что получается в этом примере.

1.  В корневом элементе **Page** в **MainPage.xaml** удалите `SupportedOrientations="Portrait"`.
2.  В корневом элементе **Page** в **MainPage.xaml** удалите `Orientation="Portrait"`.
3.  В корневом элементе **Page** в **MainPage.xaml** удалите `shell:SystemTray.IsVisible="True"`.
4.  В шаблоне данных `BookTemplate` удалите ссылки на `PhoneTextExtraLargeStyle` и стили `PhoneTextSubtleStyle` **TextBlock**.
5.  В `TitlePanel` **StackPanel** удалите ссылки на `PhoneTextNormalStyle` и стили `PhoneTextTitle1Style` **TextBlock**.

Давайте для начала поработаем с пользовательским интерфейсом для семейства мобильных устройств, а затем мы сможем рассмотреть другие форм-факторы. Теперь вы можете выполнить сборку и запустить приложение. Вот как это выглядит на мобильном эмуляторе.

![приложение uwp на мобильном устройстве с начальными изменениями исходного кода](images/wpsl-to-uwp-case-studies/c01-02-mob10-initial-source-code-changes.png)

Представление и модель представления правильно работают друг с другом, а элемент **ListBox** выполняет свои функции. В основном нам просто нужно исправить оформление и заставить изображения отображаться.

## <a name="paying-off-the-debt-items-and-some-initial-styling"></a>Выплачивание долгов и некоторый начальный стиль

По умолчанию все ориентации поддерживаются. Приложение WindowsPhone Silverlight явно ограничивает себя только книжной ориентацией, тем не менее, поэтому элементы \#1 и \#2 оплачиваются, перейдя в манифесте пакета приложения в новом проекте и проверка **книжной** в разделе **Supported ориентации**.

Для этого приложения элемент \#3 не является долгом, так как строка состояния (ранее называемая панелью задач) отображается по умолчанию. Для элементов \#4 и \#5 необходимо найти четыре стили универсальной платформы Windows (UWP) **TextBlock** , которые соответствуют стилям WindowsPhone Silverlight, которые мы использовали. Можно запустить приложение WindowsPhone Silverlight в эмуляторе и сравнить его рядом с иллюстрацией в разделе " [текст](wpsl-to-uwp-porting-xaml-and-ui.md) ". Из этого, и просмотра свойств системных стилей WindowsPhone Silverlight мы сможем сделать эту таблицу.

| Ключ стиля WindowsPhone Silverlight | Ключ стилей UWP          |
|-------------------------------------|------------------------|
| PhoneTextExtraLargeStyle            | TitleTextBlockStyle    |
| PhoneTextSubtleStyle                | SubtitleTextBlockStyle |
| PhoneTextNormalStyle                | CaptionTextBlockStyle  |
| PhoneTextTitle1Style                | HeaderTextBlockStyle   |
 
Чтобы установить эти стили, можно просто ввести их в редактор разметки или использовать средства XAML в Visual Studio и установить их не введя ни единого знака. Для этого щелкните правой кнопкой мыши **TextBlock**, затем щелкните **Изменить стиль** &gt; **Применить ресурс**. Чтобы сделать это с **TextBlock** в шаблоне элементов, щелкните правой кнопкой мыши **ListBox** и выберите **Изменить дополнительные шаблоны** &gt; **Изменить созданные элементы (ItemTemplate)**.

За элементами присутствует на 80% непрозрачный белый фон, так как стиль по умолчанию элемента управления **ListBox** устанавливает фон для системного ресурса `ListBoxBackgroundThemeBrush`. Установите для параметра `Background="Transparent"` значение **ListBox**, чтобы очистить этот фон. Чтобы выровнять **TextBlock** по левому краю в шаблоне элементов, отредактируйте его еще раз выше описанным способом и установите для **Margin** значение `"9.6,0"` на обоих **TextBlock**.

После этого из-за [изменений, связанных с пикселями представления](wpsl-to-uwp-porting-xaml-and-ui.md) необходимо идти дальше и умножить все фиксированные измерения размеров, которые мы еще не изменили (поля, ширина, высота и т. д.) на 0,8. Например, изображения должны измениться с 70x70пикселей на 56x56пикселей.

Однако давайте сначала заставим эти изображения отрисовываться, прежде чем покажем результаты оформления.

## <a name="binding-an-image-to-a-view-model"></a>Привязка изображения к модели представления

В Bookstore1WPSL8 мы сделали это:

```csharp
    // this.BookCoverImagePath contains a path of the form "/Assets/CoverImages/one.png".
    return new BitmapImage(new Uri(this.CoverImagePath, UriKind.Relative));
```

В Bookstore1Universal мы используем ms-appx [Схема URI](https://msdn.microsoft.com/library/windows/apps/jj655406). Чтобы сохранить остальную часть кода такой же, можно использовать другую перегрузку конструктора **System.Uri**, чтобы поместить схему URI ms-appx в базовый URI и добавить в него оставшуюся часть пути. Вот как это сделать.

```csharp
    // this.BookCoverImagePath contains a path of the form "/Assets/CoverImages/one.png".
    return new BitmapImage(new Uri(new Uri("ms-appx://"), this.CoverImagePath));
```

## <a name="universal-styling"></a>Универсальное оформление

Теперь необходимо выполнить окончательные настройки стиля и убедиться, что приложение выглядит хорошо на настольных (и других), а также мобильных форм-факторах. Порядок действий описан ниже. Вы можете использовать ссылки в верхней части данного раздела, чтобы загрузить проекты и сравнить результаты всех изменений на данном этапе и в конце примера.

-   Чтобы сократить расстояние между элементами, найдите шаблон данных `BookTemplate` в файле MainPage.xaml и удалите атрибут `Margin` из корневого элемента **Grid**.
-   Если вы хотите предоставить заголовку страницы несколько больше места, можно выполнить сброс нижнего поля `-5.6` до `0` в заголовке страницы **TextBlock**.
-   Теперь нам необходимо задать корректное значение по умолчанию для фона `LayoutRoot`, чтобы приложение выглядело соответствующим образом при запуске на всех устройствах вне зависимости от используемой темы. Измените его с `"Transparent"` на `"{ThemeResource ApplicationPageBackgroundThemeBrush}"`.

С более сложным приложением это была бы точка, в которой мы бы использовали руководство в разделе [Перенос для форм-фактора и взаимодействия с пользователем](wpsl-to-uwp-form-factors-and-ux.md) и действительно оптимально использовали бы конструктивные параметры форм-фактора каждого из многих устройств, на которых можно запускать приложение. Но для этого простого приложения можно остановить здесь и увидеть, как выглядит приложение после этой последней последовательности операций по изменению стилей. В действительности оно выглядит одинаково на мобильных и настольных устройствах, хотя пространство не используется наилучшим образом на широких форм-факторах (но мы исследуем, как это сделать, в дальнейшем примере).

Способы управления темой приложения описаны в разделе [Изменения тем](wpsl-to-uwp-porting-xaml-and-ui.md) .

![перенесенное приложение для windows10](images/w8x-to-uwp-case-studies/c01-07-mob10-ported.png)

Перенесенное приложение Windows10, запущенное на мобильном устройстве

## <a name="an-optional-adjustment-to-the-list-box-for-mobile-devices"></a>Дополнительная настройка списка для мобильных устройств

При запуске на мобильном устройстве у списка по умолчанию светлый фон при использовании обеих тем. Возможно, это стиль, который вы предпочитаете. Если это так, ничего больше делать не надо. Тем не менее элементы управления спроектированы таким образом, что вы можете настроить их внешний вид, не изменяя поведения. Поэтому если вы хотите, чтобы при использовании темной темы список был темного цвета, то есть так, как это было в оригинальном приложении, тогда следуйте [этим инструкциям](w8x-to-uwp-case-study-bookstore1.md) в разделе "Дополнительная настройка".

## <a name="conclusion"></a>Заключение

В этом примере показан процесс переноса очень простого приложения, вероятно, нереально простого. Например, список элементов управления можно использовать для выбора или задания контекста для навигации; приложение переходит на страницу с дополнительной информацией об элементе, которого коснулся пользователь. Данное приложение не выполняет никаких действий с выбором пользователя и не поддерживает ни навигацию. Но даже в этом случае данный пример помог вам познакомиться с процессом портирования и продемонстрировал важные методики, которые вы можете использовать с реальными приложениями UWP.

Следующий пример — [Bookstore2](wpsl-to-uwp-case-study-bookstore2.md), где мы рассмотрим доступ к сгруппированным данным и их и отображение.
