---
Description: В этой статье перечислены задачи, которые необходимо знать перед упаковкой приложения для настольных компьютеров. Подготовка приложения к процессу упаковки, как правило, не требует больших усилий.
Search.Product: eADQiWindows 10XVcnh
title: Подготовка для упаковки классического приложения (мост для классических приложений)
ms.date: 05/18/20188
ms.topic: article
keywords: windows 10, uwp
ms.assetid: 71a57ca2-ca00-471d-8ad9-52f285f3022e
ms.localizationpriority: medium
ms.openlocfilehash: 49238ba1b72cf3daf46fb076432a478e9f381bc6
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2019
ms.locfileid: "57600899"
---
# <a name="prepare-to-package-a-desktop-application"></a>Подготовка для упаковки классического приложения

В этой статье рассказывается, что необходимо знать перед упаковкой классического приложения. Может не потребоваться значительно Подготовка приложения для процесса упаковки, но если какие-либо элементы ниже действует для приложения, необходимо для решения этой проблемы перед упаковкой. Не забывайте, что лицензирование и автоматическое обновление вашего приложения обеспечивается Microsoft Store, поэтому любые возможности, относящиеся к этим задачам, можно исключить из вашей базы кода.

>[!IMPORTANT]
>Возможность создания пакета приложения Windows для своего настольного приложения (также известное как мост для классических приложений) была введена в Windows 10 версии 1607, и может использоваться только в проектах, предназначенных для Windows 10 Anniversary Update (10.0; Сборка 14393) или более поздней версии, в Visual Studio.

+ __Приложению требуется версия .NET предшествующих 4.6.2__. Необходимо убедиться, что приложение работает в среде .NET 4.6.2. Невозможно требовать или перераспределять версии ниже 4.6.2. Это версия .NET, которая поставлялась в юбилейном обновлении Windows 10. Проверка того, что приложение работает в этой версии будет гарантировать, что приложения будут продолжать совместим с обновлениями Windows 10.  Если приложение предназначено для .NET Framework 4.0 или более поздней версии, он должен выполняться на платформе .NET 4.6.2, но по-прежнему необходимо протестировать его.

+ __Приложение всегда работает с привилегиями безопасности с повышенными правами,__. Приложение должно работать при запуске в качестве интерактивного пользователя. Пользователи, устанавливающие приложение из Microsoft Store, не может быть системных администраторов, поэтому требуется приложение для запуска с повышенными правами означает, что он не будет работать правильно, для обычных пользователей. Приложения, требующие повышения прав для любой своей функций, не будут приняты в Microsoft Store.

+ __Приложению требуется драйвер режима ядра или службы Windows__. Мост подходит для приложения, но он не поддерживает драйвер, работающий в режиме ядра, или службу Windows, которая должна работать с правами учетной записи системы. Вместо службы Windows используйте [фоновую задачу](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task).

+ __Модули вашего приложения загружаются во внутрипроцессном режиме в процессы, которые отсутствуют в пакете приложения для Windows__. Это запрещено и означает, что внутрипроцессные расширения, такие как [расширения оболочки](https://msdn.microsoft.com/library/windows/desktop/dd758089.aspx) не поддерживаются. Но если у вас есть два приложения в одинаковом пакете, вы можете настроить межпроцессное взаимодействие между ними.

+ __Приложение использует пользовательские приложения пользователя модели идентификатор (AUMID)__. Если ваш процесс вызывает [SetCurrentProcessExplicitAppUserModelID](https://msdn.microsoft.com/library/windows/desktop/dd378422.aspx) задать свой собственный AUMID, то его использование только AUMID, созданных для нее пакетом приложения среды/Windows модели приложения. Вы не можете определять пользовательские AUMID.

+ __Приложение изменяет куст реестра HKEY_LOCAL_MACHINE (HKLM)__. Любая попытка создать ключ реестра HKLM или откройте существующее для изменения, приложение будет привести к сбою отказе в доступе. Помните, что приложение имеет свой собственный закрытый виртуальное представление реестра, поэтому понятие куст реестра пользователя и компьютера (который является HKLM) не применяется. Потребуется найти другой способ достичь того, чего требовалось при использовании HKLM, например запись в HKEY_CURRENT_USER (HKCU).

+ __Приложение использует раздел реестра ddeexec как средство запуска другого приложения__. Вместо этого используйте один из обработчиков команды DelegateExecute в соответствии с настройками различных расширений Activatable* в вашем [манифесте пакета приложения](https://msdn.microsoft.com/library/windows/apps/br211474.aspx).

+ __Приложение записывает в папку AppData или в реестр с целью обмена данными с другим приложением__. После преобразования AppData перенаправляется в локальное хранилище данных приложения, являющееся частным хранилищем для каждого приложения UWP.

  Все операции, которые приложение записывает куст реестра HKEY_LOCAL_MACHINE перенаправляются в изолированном двоичный файл и все записи, которые приложение записывает в кусте реестра HKEY_CURRENT_USER помещаются в закрытый каждого пользователя, расположение на уровне приложения. Дополнительные сведения о перенаправлении файлов и реестра см. в разделе [Как работает мост для классических приложений](desktop-to-uwp-behind-the-scenes.md).  

  Используйте другие средства межпроцессного обмена данными. Подробнее: [Хранение и извлечение параметров и прочих данных приложения](https://msdn.microsoft.com/windows/uwp/app-settings/store-and-retrieve-app-data).

+ __Приложение записывает в каталог установки для приложения__. Например приложение записывает в файл журнала, которую вы помещаете в том же каталоге, что exe-файл. Эта операция не поддерживается, поэтому потребуется найти другое расположение, например, локальное хранилище данных приложения.

+ __Установка приложения требуется взаимодействие с пользователем__. Установщик приложения должен иметь возможность выполняться без вмешательства пользователя, и его необходимо установить все необходимые компоненты, которые не входят в по умолчанию на основе чистого образа операционной системы.

+ __Приложение использует текущий рабочий каталог__. Во время выполнения упакованные приложения рабочего стола не будете получать в том же рабочий каталог, указанное ранее в рабочем столе. LNK ярлык. Вам нужно изменить ваш CWD во время выполнения, если наличие правильный каталог очень важно для правильной работы приложения.

+ __Приложению требуется UIAccess__. Если приложение задает значение `UIAccess=true` элементу `requestedExecutionLevel` манифеста UAC, то преобразование в UWP не поддерживается на данный момент. Подробнее см. в разделе [Обзор системы безопасности модели автоматизации пользовательского интерфейса](https://msdn.microsoft.com/library/ms742884.aspx).

+ __Приложение предоставляет COM-объекты__. Процессы и расширения из пакета могут регистрировать и использовать серверы COM и OLE, как внутрипроцессные, так и внепроцессные (OOP).  Creators Update добавляет поддержку технологии Packaged COM, позволяющей регистрировать серверы OOP COM и OLE, которые видимы за пределами пакета.  См. раздел [Поддержка сервера COM и документа OLE для моста для классических приложений](https://blogs.windows.com/buildingapps/2017/04/13/com-server-ole-document-support-desktop-bridge/#bjPyETFgtpZBGrS1.97).

   Технология Packaged COM поддерживает работу с существующими API модели COM, но не будет работать для расширений приложения, которые зависят от чтения реестра напрямую, так как расположение для Packaged COM находится в частном расположении.

+ __Приложение предоставляет сборки глобального КЭША сборок для использования другими процессами__. В текущем выпуске приложение не может представлять сборки глобального КЭША сборок для использования процессами, полученные из внешних исполняемые файлы для пакета приложения Windows. Процессы из пакета могут регистрировать и использовать сборки GAC обычным образом, но они не будут видны извне. Это означает, что сценарии межпрограммного взаимодействия (например, OLE) не будут работать при их вызове внешними процессами.

+ __Приложения — это связывание библиотеки времени выполнения C (CRT) неверным образом__. Библиотека времени выполнения C/C++ Майкрософт предоставляет процедуры для программирования в среде операционной системы Microsoft Windows. Эти процедуры автоматизируют выполнение многих распространенных задач программирования, которые не предоставляются языками C и C++. Если приложение использует библиотеки времени выполнения C/C++, необходимо убедиться, что он связан поддерживаемых образом.

    Visual Studio 2017 поддерживает как динамическое связывание, чтобы код мог использовать общие файлы DLL, так и статическое связывание для связывания библиотеки непосредственно с кодом, до текущей версии CRT. Если это возможно мы рекомендуем приложение для использования динамическая компоновка с Visual STUDIO 2017.

    Поддержка различных типов связывания зависит от версии Visual Studio. Подробности см. в следующей таблице:

    <table>
    <th>Версия Visual Studio</td><th>Динамическое связывание</th><th>Статическое связывание</th></th>
    <tr><td>2005 (VC 8)</td><td>Не поддерживается.</td><td>Поддерживается</td>
    <tr><td>2008 (VC 9)</td><td>Не поддерживается.</td><td>Поддерживается</td>
    <tr><td>2010 (VC 10)</td><td>Поддерживается</td><td>Поддерживается</td>
    <tr><td>2012 (VC 11)</td><td>Поддерживается</td><td>Не поддерживается.</td>
    <tr><td>2013 (VC 12)</td><td>Поддерживается</td><td>Не поддерживается.</td>
    <tr><td>2015 и 2017 (VC 14)</td><td>Поддерживается</td><td>Поддерживается</td>
    </table>

    Примечание. В любом случае необходимо установить связь с последней общедоступной CRT.

+ __Приложение устанавливает и загружает сборки из папки Windows side-by-side__. Например приложение использует библиотеки времени выполнения C VC8 или VC9 и — это динамически связывание их из папки side-by-side Windows, это означает, что код использует общих библиотек DLL из общей папки. Такой способ связывания не поддерживается. Необходимо подключать их статически, то есть связать с распространяемыми файлами библиотеки непосредственно в самом коде.

+ __Приложение использует зависимость в папке System32/SysWOW64__. Чтобы эти DLL-файлы начали работать, необходимо включить их в часть вашего пакета приложения для Windows, находящуюся в виртуальной файловой системе. Это гарантирует, что приложение ведет себя как если библиотеки DLL были установлены в **System32**/**SysWOW64** папки. В корне пакета создайте папку с именем **VFS**. В этой папке создайте папки **SystemX64** и **SystemX86**. Затем поместите 32-разрядную версию DLL-файла в папку **SystemX86**, а 64-разрядную версию — в папку **SystemX64**.

+ __Ваше приложение использует пакет платформы VCLibs__. Библиотеки VCLibs можно установить напрямую из Microsoft Store, если они определены как зависимость в пакете приложения для Windows. Например если приложение использует пакеты vclibs. Этот Dev11, внесите следующее изменение в манифест пакета приложения: В разделе `<Dependencies>` узел, добавьте:  
`<PackageDependency Name="Microsoft.VCLibs.110.00.UWPDesktop" MinVersion="11.0.24217.0" Publisher="CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=US" />`  
Во время установки из Microsoft Store будет установлена нужная версия (x86 или x64) платформы VCLibs перед установкой приложения.  
Не зависимости будет установлен при установке путем загрузки неопубликованного приложения. Чтобы установить зависимости на компьютере вручную, вам потребуется скачать и установить соответствующий пакет платформы VCLibs для моста для настольных компьютеров. Подробнее об этих сценариях см. в разделе [Использование среды выполнения Visual C++ в проекте Centennial](https://blogs.msdn.microsoft.com/vcblog/2016/07/07/using-visual-c-runtime-in-centennial-project/).

  **Пакеты платформы**:

  * [Пакеты framework VC 14.0 для мост для классических приложений](https://www.microsoft.com/download/details.aspx?id=53175)
  * [Пакеты framework VC 12.0 для мост для классических приложений](https://www.microsoft.com/download/details.aspx?id=53176)
  * [Пакеты framework VC 11.0 для мост для классических приложений](https://www.microsoft.com/download/details.aspx?id=53340)


+ __Приложение содержит списка переходов настраиваемых__. Списки переходов следует использовать с учетом некоторых оговорок и условий.

    - __Архитектуры приложения не соответствует операционной системе.__  Списки переходов в настоящее время работают неправильно, если они соответствуют приложения и архитектуры операционной системы (например, x86 приложения, работающего в x64 Windows). В настоящее время нет обходных путей, отличное от повторной компиляции на соответствующую архитектуру.

    - __Приложение создает записи списка переходов и вызовы [ICustomDestinationList::SetAppID](https://msdn.microsoft.com/library/windows/desktop/dd378403(v=vs.85).aspx) или [SetCurrentProcessExplicitAppUserModelID](https://msdn.microsoft.com/library/windows/desktop/dd378422(v=vs.85).aspx)__. Не задавайте свой AppID в коде программными средствами. Это приведет к тому, что элементы списка переходов не будут отображаться. Если приложению требуется пользовательский идентификатор, укажите его с помощью файла манифеста. Ссылаться на [вручную упаковать настольного приложения](desktop-to-uwp-manual-conversion.md) инструкции. AppID для вашего приложения указан в разделе *YOUR_PRAID_HERE*.

    - __Приложение добавляет ссылку оболочки списка переходов, которая ссылается на исполняемый файл в пакете__. Напрямую запускать исполняемые файлы в пакете из списка переходов нельзя (за исключением абсолютного пути собственного файла .exe приложения). Вместо этого следует регистрировать псевдоним выполнения приложения (что позволяет упакованные приложения рабочего стола для запуска с помощью ключевого слова, как если бы оно было на путь) и целевой путь ссылки на псевдоним, вместо этого установить. Дополнительные сведения о том, как использовать расширение appExecutionAlias см. в разделе [интегрировать приложения для настольных компьютеров с Windows 10](desktop-to-uwp-extensions.md). Обратите внимание, что если требуется, чтобы ресурсы ссылки в списке переходов совпадали с исходным файлом .exe, необходимо задать ресурсы, такие как значок, используя [**SetIconLocation**](https://msdn.microsoft.com/library/windows/desktop/bb761047(v=vs.85).aspx), а для отображения имени использовать PKEY_Title, так же, как и для других пользовательских записей.

    - __Приложение добавляет записи списка переходов, на которые ссылается на ресурсы в пакет приложения с абсолютные пути__. Путь установки приложения может измениться при обновлении пакетов, изменение местоположения ресурсов (например, значков, документы, исполняемый файл и т. д.). Если элементы списка переходов ссылаться на таких активов, абсолютные пути, то приложение следует обновить его список переходов периодически (например, на приложения запустите) для обеспечения пути будут разрешаться правильно. Либо можно использовать API-интерфейсы UWP [**Windows.UI.StartScreen.JumpList**](https://msdn.microsoft.com/library/windows/apps/windows.ui.startscreen.jumplist.aspx), которые позволяют ссылаться на ресурсы строк и изображений с помощью схемы URI package-relative ms-resource (которая также поддерживает определение языка, DPI и высокой контрастности).

+ __Приложение запускает программу для выполнения задач__. Избегайте запуска служебных программ командной строки, таких как PowerShell и Cmd.exe. На самом деле Если пользователи устанавливают приложения в системе Windows 10 S, приложения не смогут запустить их вообще. Это может заблокировать приложение от отправки в Microsoft Store, так как все приложения, отправляемые Microsoft Store должны быть совместимы с Windows 10 S.

Служебные программы часто предоставляют удобный способ для получения информации из операционной системы, доступа к реестру или к возможностям системы. Однако для выполнения такого рода задач можно использовать API UWP. Эти API-интерфейсы являются более высокую производительность, поскольку они не требуется отдельный исполняемый файл для запуска, но что более важно, они запретит приложению достижения вне пакета. Проектирование приложений на соответствие изоляции, доверия и безопасности, входящий в состав приложения, которое упаковано, и приложение будет вести себя ожидаемым в системах под управлением Windows 10 S.

+ __Приложение размещает надстройки, подключаемые модули или модули__.   Во многих случаях расширения в стиле COM устанавливаются как расширения с полным доверием, и, скорее всего, они будут работать до тех пор, пока не будут упакованы. Том, что эти установщики можно использовать возможности полного доверия для изменения в реестр и поместите файлы расширения везде, где это ведущее приложение ожидает их найти.

   Тем не менее если эти расширения упаковываются и затем установить в виде пакета приложения Windows, они не будет работать, так как каждый пакет (ведущего приложения и расширения) будут изолированы друг от друга. Дополнительные сведения о том, как приложения изолированы от системы, см. в разделе [за кулисами Desktop Bridge](desktop-to-uwp-behind-the-scenes.md).

 Все приложения и расширения, которые устанавливаются пользователями в системе под управлением Windows 10 S, должны устанавливаться в виде пакетов приложений для Windows. Поэтому если планируется упаковать, или вы планируете рекомендуем участников таким образом, чтобы упаковать их, следует проверить, как можно легко обмен данными между пакета приложения узла и все пакеты расширения. Вы можете сделать это, например, с помощью [службы приложений](../launch-resume/app-services.md).

+ __Приложение создает код__. Приложения можно создавать код, который занимает в памяти, но без кода создается запись на диск, поскольку процесс сертификации приложений Windows не удалось проверить этот код перед отправкой приложения. Кроме того приложения, писать код на диск не выполняются правильно в системах под управлением Windows 10 S. Это может заблокировать приложение от отправки в Microsoft Store, так как все приложения, отправляемые Microsoft Store должны быть совместимы с Windows 10 S.

>[!IMPORTANT]
> После создания пакета приложения Windows, протестируйте приложение, чтобы убедиться, что оно правильно работает в системах под управлением Windows 10 S. Все приложения, отправляемые Microsoft Store должны быть совместимы с Windows 10 S. приложений, не совместимы не будет приниматься в хранилище. См. статью [Тестирование приложения для Windows на Windows 10 S](desktop-to-uwp-test-windows-s.md).

## <a name="next-steps"></a>Дальнейшие действия

**Найдите ответы на ваши вопросы**

Есть вопросы? Задайте их на Stack Overflow. Наша команда следит за этими [тегами](https://stackoverflow.com/questions/tagged/project-centennial+or+desktop-bridge). Вы также можете задать нам вопросы [здесь](https://social.msdn.microsoft.com/Forums/en-US/home?filter=alltypes&sort=relevancedesc&searchTerm=%5BDesktop%20Converter%5D).

**Отправить отзыв или предложения по функциям**

См. раздел [UserVoice](https://wpdev.uservoice.com/forums/110705-universal-windows-platform/category/161895-desktop-bridge-centennial)

**Создать пакет приложения Windows для настольных приложений**

См. раздел [Создание пакета приложения для Windows](desktop-to-uwp-root.md#convert).
