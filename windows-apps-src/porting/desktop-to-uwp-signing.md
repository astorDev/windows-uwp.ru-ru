---
author: normesta
Description: "В этой статье описывается процедура подписывания классического приложения, преобразованного в приложение универсальной платформы Windows (UWP)."
Search.Product: eADQiWindows 10XVcnh
title: "Мост переноса классических приложений на UWP: подписывание"
ms.author: normesta
ms.date: 03/09/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: windows 10, uwp
ms.assetid: 232c3012-71ff-4f76-a81e-b1758febb596
ms.openlocfilehash: bed23b75a966e3a858d1e34a686fa3ba2730354c
ms.sourcegitcommit: 909d859a0f11981a8d1beac0da35f779786a6889
translationtype: HT
---
# <a name="desktop-to-uwp-bridge-sign"></a>Мост переноса классических приложений на UWP: подписывание

В этой статье описывается процедура подписывания классического приложения, преобразованного в приложение универсальной платформы Windows (UWP). Прежде чем вы сможете развернуть пакет приложения для Windows, его необходимо подписать с помощью сертификата.

## <a name="automatically-sign-using-the-desktop-app-converter-dac"></a>Автоматическое подписывание с помощью Desktop App Converter (DAC)

Используйте флаг ```-Sign``` при запуске DAC для автоматического подписывания пакета приложения для Windows. Подробнее см. в разделе [Предварительная версия Desktop App Converter](desktop-to-uwp-run-desktop-app-converter.md).

## <a name="manually-sign-using-signtoolexe"></a>Ручное подписывание с помощью SignTool.exe

Сначала создайте сертификат с помощью средства MakeCert.exe. При отображении запроса на ввод пароля выберите "Нет".

```cmd
C:\> MakeCert.exe -r -h 0 -n "CN=<publisher_name>" -eku 1.3.6.1.5.5.7.3.3 -pe -sv <my.pvk> <my.cer>
```

Затем скопируйте сведения об открытом и закрытом ключах в сертификат с помощью pvk2pfx.exe.

```cmd
C:\> pvk2pfx.exe -pvk <my.pvk> -spc <my.cer> -pfx <my.pfx>
```
И наконец, используйте средство SignTool.exe, чтобы подписать пакет приложения для Windows с помощью сертификата.

```cmd
C:\> signtool.exe sign -f <my.pfx> -fd SHA256 -v .\<outputAppX>.appx
```

Дополнительные сведения см. в разделе [Подписывание пакета приложения с помощью SignTool](https://msdn.microsoft.com/library/windows/desktop/jj835835.aspx).

Все три упомянутые выше средства входят в состав Microsoft Windows 10 SDK. Чтобы вызвать их напрямую, вызовите из командной строки сценарий ```C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\Tools\VsDevCmd.bat```.

## <a name="common-errors"></a>Распространенные ошибки

### <a name="publisher-and-cert-mismatch-causes-signtool-error-error-signersign-failed--21470248850x8007000b"></a>Несоответствие издателя и сертификата приводит к ошибке Signtool "Error: SignerSign() Failed" (-2147024885/0x8007000b)

Запись издателя в манифесте пакета приложения для Windows должна соответствовать субъекту сертификата, с помощью которого выполняется подписывание.  Вы можете использовать любой из следующих методов для просмотра субъекта сертификата.

**Вариант 1: Powershell**

Выполните следующую команду PowerShell: В качестве файла сертификата можно использовать как .cer, так и .pfx, так как они содержат идентичные сведения об издателе.

```ps
(Get-PfxCertificate <cert_file>).Subject
```

**Вариант 2: проводник**

Дважды щелкните сертификат в проводнике, выберите вкладку *Сведения*, а затем выберите поле *Субъект* в списке. Скопируйте его содержимое.

**Вариант 3: CertUtil**

Запустите **certutil** через командную строку в файле PFX и скопируйте поле *Субъект* в выходных данных.

```cmd
certutil -dump <cert_file.pfx>
```

### <a name="corrupted-or-malformed-authenticode-signatures"></a>Поврежденные или деформированные подписи Authenticode

Этот раздел содержит инструкции по выявлению проблем с переносными исполняемыми файлами (PE) в пакете приложения для Windows, который может содержать поврежденные или деформированные подписи Authenticode. Наличие недействительных подписей Authenticode в файлах PE, которые могут иметь любой двоичный формат (например, .exe, .dll, .chm и т.д.), приведет к тому, что вы не сможете правильно подписать пакет и, таким образом, не сможете развернуть его из пакета приложения для Windows.

Расположение подписи Authenticode файла PE определяется записью в таблице сертификатов в каталогах данных необязательных заголовков и соответствующей таблице сертификатов атрибутов. Во время проверки подписи сведения, указанные в этих местах, используются для поиска подписи на файле PE. При повреждении этих значений процесс подписывания файла может быть выполнен некорректно.

Чтобы подпись Authenticode была правильной, применительно к ней должны быть выполнены следующие условия:

- Начало записи **WIN_CERTIFICATE** в файле PE не должно выходить за границу исполняемого файла.
- Запись **WIN_CERTIFCATE** должна размещаться в конце образа.
- Размер записи **WIN_CERTIFICATE** должен быть положительным.
- Запись **WIN_CERTIFICATE** должна начинаться после структуры **IMAGE_NT_HEADERS32** для 32-разрядных исполняемых файлов и после структуры IMAGE_NT_HEADERS64 для 64-разрядных исполняемых файлов.

Дополнительные сведения см. в спецификациях [Формат подписи Authenticode Portal Executable](http://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx) и [Формат файла PE](https://msdn.microsoft.com/windows/hardware/gg463119.aspx).

Обратите внимание, что при попытке подписывания пакета приложения для Windows средство SignTool.exe может выводить информацию о поврежденных или деформированных двоичных файлах. Чтобы это сделать, включите регистрацию подробных сведений в журнале, задав переменной среды APPXSIP_LOG значение 1 (например, ```set APPXSIP_LOG=1``` ) и перезапустите средство SignTool.exe.

Чтобы исправить эти деформированные двоичные файлы, убедитесь, что они соответствуют требованиям выше.

## <a name="see-also"></a>См. также

- [SignTool](https://msdn.microsoft.com/library/windows/desktop/aa387764.aspx)
- [SignTool.exe (инструмент подписывания)](https://msdn.microsoft.com/library/8s9b9yaz.aspx)
- [Подписание пакета приложения с помощью SignTool](https://msdn.microsoft.com/library/windows/desktop/jj835835.aspx)
