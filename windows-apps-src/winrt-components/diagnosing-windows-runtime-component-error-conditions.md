---
title: Диагностика состояний ошибки компонентов среды выполнения Windows
description: В этой статье содержатся дополнительные сведения об ограничениях среда выполнения Windows компонентов, написанных с помощью управляемого кода.
ms.assetid: CD0D0E11-E68A-411D-B92E-E9DECFDC9599
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: ab1ad2054288c38498eb1077a924531d3e22c0dd
ms.sourcegitcommit: d38e2f31c47434cd6dbbf8fe8d01c20b98fabf02
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70393703"
---
# <a name="diagnosing-windows-runtime-component-error-conditions"></a>Диагностика состояний ошибки компонентов среды выполнения Windows

В этой статье содержатся дополнительные сведения об ограничениях среда выполнения Windows компонентов, написанных с помощью управляемого кода. Он расширяет сведения, предоставленные в сообщениях об ошибках из [Winmdexp. exe (средство экспорта метаданных Среда выполнения Windows)](https://docs.microsoft.com/dotnet/framework/tools/winmdexp-exe-windows-runtime-metadata-export-tool), и дополняет сведения об ограничениях, предоставляемых [Среда выполнения Windows компонентами с C# и Visual Базовый](creating-windows-runtime-components-in-csharp-and-visual-basic.md).

Эта статья не охватывает все ошибки. Описанные здесь ошибки группируются по общим категориям, а каждая категория содержит таблицу связанных сообщений об ошибках. Выполняйте поиск текста сообщения (опустив конкретные значения, заменяемые заполнителями) или номера сообщения. Если вам не удается найти здесь необходимую информацию, помогите нам улучшить качество документации, отправив отзыв с помощью кнопки в конце этой статьи. Включите в отзыв сообщение об ошибке. Кроме того, вы можете зарегистрировать ошибку на веб-сайте Microsoft Connect.

## <a name="error-message-for-implementing-async-interface-provides-incorrect-type"></a>При реализации асинхронного интерфейса сообщение об ошибке содержит неверный тип

Управляемые компоненты Среда выполнения Windows не могут реализовывать интерфейсы универсальная платформа Windows (UWP), представляющие асинхронные действия или операции ([IAsyncAction](https://docs.microsoft.com/windows/desktop/api/windows.foundation/nn-windows-foundation-iasyncaction), [IAsyncActionWithProgress&lt;TProgress&gt; ](https://docs.microsoft.com/previous-versions/br205784(v=vs.85)) , [IAsyncOperation&lt;TResult&gt;](https://docs.microsoft.com/uwp/api/Windows.Foundation.IAsyncOperation_TResult_)или [IAsyncOperationWithProgress&gt;TResult, TProgress).&lt;](https://docs.microsoft.com/uwp/api/Windows.Foundation.IAsyncOperationWithProgress_TResult_TProgress_) Вместо этого .NET предоставляет класс [асинЦинфо](https://docs.microsoft.com/dotnet/api/system.runtime.interopservices.windowsruntime?redirectedfrom=MSDN) для создания асинхронных операций в среда выполнения Windowsных компонентах. В сообщении об ошибке, отображаемом в Winmdexp.exe при попытке реализовать асинхронный интерфейс, по ошибке указывается прежнее имя класса — AsyncInfoFactory. .NET больше не включает класс АсинЦинфофактори.

| Номер ошибки | Текст сообщения|       
|--------------|-------------|
| WME1084      | Тип "{0}" реализует среда выполнения Windows асинхронный интерфейс{1}"". Типы среды выполнения Windows не могут реализовывать асинхронные интерфейсы. Используйте класс System.Runtime.InteropServices.WindowsRuntime.AsyncInfoFactory для создания асинхронных операций для экспорта в среду выполнения Windows. |

> **Обратите внимание** на сообщения об ошибках, которые ссылаются на среда выполнения Windows использовать старую терминологию. Теперь эта среда называется универсальной платформой Windows (UWP). Например, типы среды выполнения Windows теперь называются типами UWP.

## <a name="missing-references-to-mscorlibdll-or-systemruntimedll"></a>Отсутствуют ссылки на библиотеки mscorlib.dll или System.Runtime.dll

Эта проблема возникает только при использовании средства Winmdexp.exe через командную строку. Рекомендуется использовать параметр/reference для включения ссылок на библиотеки mscorlib. dll и System. Runtime. dll из .NET Framework базовых эталонных сборок, расположенных в сборках\\\\"%ProgramFiles(x86)%"Microsoft\\Framework.\\ NETCore\\v 4.5 "("% ProgramFiles%\\... " на 32-разрядном компьютере).

| Номер ошибки | Текст сообщения                                                                                                                                     |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| WME1009      | Нет ссылок на mscorlib.dll. Ссылка на этот файл метаданных необходима для успешного выполнения экспорта.                               |
| WME1090      | Не удалось определить основную ссылочную сборку. Убедитесь, что на файлы mscorlib.dll и System.Runtime.dll даны ссылки с помощью параметра /reference. |

## <a name="operator-overloading-is-not-allowed"></a>Перегрузка операторов не разрешена

В компоненте среды выполнения Windows, написанном с использованием управляемого кода, нельзя предоставлять перегруженные операторы открытых типов.

> **Обратите внимание** , что в сообщении об ошибке оператор идентифицируется по имени метаданных,\_например к\_добавлению\_операций, умножению Op, операции\_монопольного доступа Op, оператору неявного преобразования (неявное преобразование) и т. д.

| Номер ошибки | Текст сообщения                                                                                          |
|--------------|-------------------------------------------------------------------------------------------------------|
| WME1087      | "{0}" является перегрузкой оператора. Управляемые типы не могут предоставлять доступ к перегрузкам операторов в среде выполнения Windows. |

## <a name="constructors-on-a-class-have-the-same-number-of-parameters"></a>Конструкторы класса имеют одинаковое число параметров

В UWP у класса может быть только один конструктор с заданным количеством параметров; например, нельзя иметь один конструктор с одним параметром типа **String** и другой с одним параметром типа **int** (**Integer** в Visual Basic). Единственное решение — использовать разное число параметров для каждого конструктора.

| Номер ошибки | Текст сообщения                                                                                                                                            |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| WME1099      | Тип "{0}" имеет несколько конструкторов с аргументами "{1}". Типы среды выполнения Windows не могут иметь несколько конструкторов с одинаковым числом аргументов. |

## <a name="must-specify-a-default-for-overloads-that-have-the-same-number-of-parameters"></a>Необходимо указать значение по умолчанию для перегрузок с одинаковым числом параметров

В UWP перегруженные методы могут иметь одинаковое число параметров, только если одна перегрузка определена как перегрузка по умолчанию. См. раздел "перегруженные методы" в [Среда выполнения Windows компонентах с C# и Visual Basic](creating-windows-runtime-components-in-csharp-and-visual-basic.md).

| Номер ошибки | Текст сообщения                                                                                                                                                                      |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WME1059      | Перегрузки с несколькими {0}параметрами для "{1}.{2}" дополнены Windows. Foundation. Metadata. DefaultOverloadAttribute.                                                            |
| WME1085      | Перегрузки {1}параметра.{2} должны иметь ровно один метод, указанный в качестве перегрузки по умолчанию, путем его оформления в Windows. Foundation. Metadata. DefaultOverloadAttribute. {0} |

## <a name="namespace-errors-and-invalid-names-for-the-output-file"></a>Ошибки пространства имен и недопустимое имя выходного файла

На универсальной платформе Windows все открытые типы из файла метаданных Windows (.winmd) должны находиться в пространстве имен, совместно использующем имя файла .winmd, или во вложенных пространствах имен имени файла. Например, если проект Visual Studio называется A.B (т. е. компонент среды выполнения Windows — это файл A.B.winmd), он может содержать открытые классы A.B.Class1 и A.B.C.Class2, но не классы A.Class3 (WME0006) или D.Class4 (WME1044).

> **Обратите внимание**  , что эти ограничения относятся только к открытым типам, а не к закрытым типам, используемым в реализации.

В случае с классом A.Class3 можно либо переместить Class3 в другое пространство имен, либо изменить имя компонента среды выполнения Windows на A.winmd. Хотя класс WME0006 является предупреждением, следует рассматривать его как ошибку. В предыдущем примере код, вызывающий A.B.winmd, не сможет найти A.Class3.

В случае с классом D.Class4 имя файла не может одновременно содержать имя D.Class4 и классы из пространства имен A.B, поэтому изменение имени компонента среды выполнения Windows не поможет исправить проблему. Вы можете переместить класс D.Class4 в другое пространство имен или поместить его в другой компонент среды выполнения Windows.

Файловая система не различает регистр символов, поэтому не разрешается использовать пространства имен, отличающиеся лишь регистром (WME1067).

Компонент должен содержать хотя бы один тип **public sealed** (**Public NotInheritable** в Visual Basic). В противном случае вы получите ошибку WME1042 или WME1043, в зависимости от того, содержит ли компонент закрытые типы.

В компоненте среды выполнения Windows у типа не может быть имени, совпадающего с пространством имен (WME1068).

> **Внимание!**   если вы вызываете Winmdexp. exe напрямую и не используете параметр/out, чтобы указать имя для компонента Среда выполнения Windows, Winmdexp. exe пытается создать имя, включающее в себя все пространства имен в компоненте. Переименование пространств имен может изменить имя компонента.

 

| Номер ошибки | Текст сообщения                                                                                                                                                                                                                                                                                                                                             |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WME0006      | "{0}" не является допустимым именем WINMD-файла для этой сборки. Все типы в файле метаданных Windows должны находиться во вложенном пространстве имен пространства имен, заданного именем файла. Типы, отсутствующие в этом вложенном пространстве имен, невозможно найти во время выполнения. В этой сборке наименьшее общее пространство имен, которое можно использовать в качестве имени файла, — "{1}". |
| WME1042      | Входной модуль должен содержать по крайней мере один открытый тип, расположенный внутри пространства имен.                                                                                                                                                                                                                                                                   |
| WME1043      | Входной модуль должен содержать по крайней мере один открытый тип, расположенный внутри пространства имен. Внутри пространств имен содержатся только закрытые типы.                                                                                                                                                                                                               |
| WME1044      | Открытый тип имеет пространство имен ("{1}"), которое не использует общий префикс с другими пространствами имен ("{0}"). Все типы в файле метаданных Windows должны находиться во вложенном пространстве имен пространства имен, заданного именем файла.                                                                                                                              |
| WME1067      | Имена пространств имен не могут отличаться только регистром{0}: ""{1}, "".                                                                                                                                                                                                                                                                                                |
| WME1068      | Тип "{0}" не может иметь то же имя, что{1}и пространство имен "".                                                                                                                                                                                                                                                                                                 |

## <a name="exporting-types-that-arent-valid-universal-windows-platform-types"></a>Экспорт типов, не являющихся допустимыми типами универсальной платформы Windows

Открытый интерфейс компонента должен предоставлять только типы UWP. Однако .NET предоставляет сопоставления для ряда часто используемых типов, которые немного отличаются в .NET и UWP. Это позволяет разработчику .NET работать с привычными типами, а не изучать новые. Эти сопоставленные типы .NET можно использовать в открытом интерфейсе компонента. См. раздел "объявление типов в среда выполнения Windows компонентов" и "передача типов универсальная платформа Windows в управляемый код" в [Среда выполнения Windows C# компонентах с помощью и Visual Basic](creating-windows-runtime-components-in-csharp-and-visual-basic.md), а также [сопоставлениями типов Среда выполнения Windows в .NET](net-framework-mappings-of-windows-runtime-types.md).

Многие из этих сопоставлений являются интерфейсами. Например, интерфейс [IList&lt;T&gt;](https://docs.microsoft.com/dotnet/api/system.collections.generic.ilist-1?redirectedfrom=MSDN) соответствует интерфейсу UPW [IVector&lt;T&gt;](https://docs.microsoft.com/uwp/api/Windows.Foundation.Collections.IVector_T_). При использовании List&lt;string&gt; (`List(Of String)` в Visual Basic) вместо IList&lt;string&gt; в качестве типа параметра Winmdexp.exe предоставляет список альтернативных вариантов, который включает все сопоставленные интерфейсы, реализованные типом List&lt;T&gt;. При использовании вложенных универсальных типов, таких как List&lt;Dictionary&lt;int, string&gt;&gt; (List(Of Dictionary(Of Integer, String)) в Visual Basic), Winmdexp.exe предлагает варианты для каждого уровня вложения. Эти списки могут быть довольно длинными.

Как правило, наиболее подходящим является ближайший к типу интерфейс. Например, для Dictionary&lt;int, string&gt; самым подходящим, вероятнее всего, является интерфейс IDictionary&lt;int, string&gt;.

> **Важно!**   в JavaScript используется интерфейс, который отображается первым в списке интерфейсов, реализуемых управляемым типом. Например, если в код JavaScript возвращается тип Dictionary&lt;int, string&gt;, он отображается как IDictionary&lt;int, string&gt; независимо от того, какой интерфейс указан в качестве типа возвращаемого значения. Это означает, что если первый интерфейс не включает элемент, который отображается в последующих интерфейсах, этот элемент не будет видимым в JavaScript.

> Осторожно  Избегайте использования неуниверсальных интерфейсов [IList](https://docs.microsoft.com/dotnet/api/system.collections.ilist?redirectedfrom=MSDN) и [IEnumerable](https://docs.microsoft.com/dotnet/api/system.collections.ienumerable?redirectedfrom=MSDN) , если компонент будет использоваться JavaScript. Эти интерфейсы сопоставляются с [IBindableVector](https://docs.microsoft.com/uwp/api/windows.ui.xaml.interop.ibindablevector) и [IBindableIterator](https://docs.microsoft.com/uwp/api/windows.ui.xaml.interop.ibindableiterator), соответственно. Они поддерживают привязку для элементов управления XAML и невидимы в коде JavaScript. JavaScript выдает ошибку во время выполнения «Не удается вызвать функцию 'X', так как ее подпись недопустима».

 

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Номер ошибки</th>
<th align="left">Текст сообщения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">WME1033</td>
<td align="left">Метод "{0}" имеет параметр "{1}" типа "{2}". "{2}" не является допустимым типом параметра среды выполнения Windows.</td>
</tr>
<tr class="even">
<td align="left">WME1038</td>
<td align="left">В сигнатуре метода "{0}" содержится параметр типа "{1}". Хотя этот тип не является допустимым типом среды выполнения Windows, он реализует интерфейсы, являющиеся допустимыми типами среды выполнения Windows. Попробуйте изменить сигнатуру метода с использованием одного из следующих типов: "{2}".</td>
</tr>
<tr class="odd">
<td align="left">WME1039</td>
<td align="left"><p>В сигнатуре метода "{0}" содержится параметр типа "{1}". Хотя этот универсальный тип не является допустимым типом среды выполнения Windows, сам тип или его универсальные параметры реализуют интерфейсы, являющиеся допустимыми типами среды выполнения Windows. {2}</p>
> **Примечание**&lt;&gt;. для программа{2}Winmdexp. exe добавляет список альтернативных вариантов, например "рассмотрите возможность изменения типа" System. Collections. Generic. List T "в сигнатуре метода  на один из следующих Вместо этого используйте следующие типы: System. Collections. Generic. IList&lt;t&gt;, System. Collections. Generic.&lt;иреадонлилист&gt;t, System. Collections. Generic&lt;.&gt;IEnumerable t ".
</td>
</tr>
<tr class="even">
<td align="left">WME1040</td>
<td align="left">В сигнатуре метода "{0}" содержится параметр типа "{1}". Вместо управляемого типа Task используйте Windows.Foundation.IAsyncAction, Windows.Foundation.IAsyncOperation или один из асинхронных интерфейсов среды выполнения Windows. Стандартный шаблон ожидания .NET также применим к этим интерфейсам. Дополнительные сведения о преобразовании объектов управляемых задач в асинхронные интерфейсы среды выполнения Windows вы можете найти в разделе System.Runtime.InteropServices.WindowsRuntime.AsyncInfo.</td>
</tr>
</tbody>
</table>

 

## <a name="structures-that-contain-fields-of-disallowed-types"></a>Структуры, содержащие поля неразрешенных типов


В UWP структура может содержать только поля, и только структуры могут содержать поля. Эти поля должны быть открытыми. Допустимые типы полей включают перечисления, структуры и типы-примитивы.

| Номер ошибки | Текст сообщения                                                                                                                                                                                                                                                            |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WME1060      | Структура "{0}" имеет поле "{1}" типа "{2}". "{2}" не является допустимым типом поля среды выполнения Windows. Каждое поле в структуре среды выполнения Windows должно иметь тип UInt8, Int16, UInt16, Int32, UInt32, Int64, UInt64, Single, Double, Boolean, String, Enum или само быть структурой. |

 

## <a name="restrictions-on-arrays-in-member-signatures"></a>Ограничения на массивы в сигнатурах членов


В UWP массивы в сигнатурах членов должны быть одномерными с нижней границей, равной 0 (нулю). Вложенные типы массивов, такие как `myArray[][]` (`myArray()()` в Visual Basic), не допускаются.

> **Примечание. это**ограничение не применяется к массивам, которые используются внутри реализации. 

 

| Номер ошибки | Текст сообщения                                                                                                                                                     |
|--------------|--------------------|
| WME1034      | В сигнатуре метода "{0}" имеется массив типа "{1}" с ненулевой нижней границей. Нижняя граница массивов в сигнатурах методов среды выполнения Windows должна равняться нулю. |
| WME1035      | В сигнатуре метода "{0}" имеется многомерный массив типа "{1}". Массивы в сигнатурах методов среды выполнения Windows должны быть одномерными.                  |
| WME1036      | В сигнатуре метода "{0}" содержится вложенный массив типа "{1}". Массивы в подписях методов среды выполнения Windows не могут быть вложенными.                                    |

 

## <a name="array-parameters-must-specify-whether-array-contents-are-readable-or-writable"></a>Параметры массива должны определять, доступно ли содержимое массива для чтения или записи


В UWP параметры должны быть доступны только для чтения или только для записи. Параметры нельзя пометить модификатором **ref** (**ByRef** без атрибута [OutAttribute](https://docs.microsoft.com/dotnet/api/system.runtime.interopservices.outattribute?redirectedfrom=MSDN) в Visual Basic). Это относится к содержимому массивов, поэтому параметры массивов должны указывать, доступно ли содержимое массива только для чтения или только для записи. Направление четко определено для параметров **out** (параметр **ByRef** с атрибутом OutAttribute в Visual Basic), но параметры массивов, передаваемые по значению (ByVal в Visual Basic), должны быть помечены. Ознакомьтесь с разделом [Передача массивов в компонент среды выполнения Windows](passing-arrays-to-a-windows-runtime-component.md).

| Номер ошибки | Текст сообщения         |
|--------------|----------------------|
| WME1101      | Метод "{0}" имеет параметр "{1}" {2} , который является массивом и содержит и, и {3}. В среде выполнения Windows содержимое параметров-массивов должно быть доступным для чтения или записи. Удалите один из атрибутов из "{1}".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| WME1102      | Метод "{0}" имеет выходной параметр "{1}", который является массивом, но имеет {2}. В среде выполнения Windows содержимое выходных массивов доступно для записи. Удалите атрибут из "{1}".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| WME1103      | Метод "{0}" имеет параметр "{1}", который является массивом и имеет либо атрибут System. Runtime. InteropServices. InAttribute, либо System. Runtime. InteropServices. OutAttribute. В среде выполнения Windows у параметров массива должен быть атрибут {2} или {3}. Удалите эти атрибуты или при необходимости замените их соответствующими атрибутами среды выполнения Windows.                                                                                                                                                                                                                                                                                                                                                                                          |
| WME1104      | Метод "{0}" имеет параметр "{1}", который не является массивом {2} и {3}имеет значение или. Среда выполнения Windows не поддерживает использование {2} и {3} для пометки параметров, не являющихся массивами.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| WME1105      | Метод "{0}" имеет параметр "{1}" с атрибутом System. Runtime. InteropServices. InAttribute или System. Runtime. InteropServices. OutAttribute. Среда выполнения Windows не поддерживает пометку параметров атрибутами System.Runtime.InteropServices.InAttribute и System.Runtime.InteropServices.OutAttribute Попробуйте удалить System.Runtime.InteropServices.InAttribute и заменить System.Runtime.InteropServices.OutAttribute на модификатор out. Метод "{0}" имеет параметр "{1}" с атрибутом System. Runtime. InteropServices. InAttribute или System. Runtime. InteropServices. OutAttribute. Среда выполнения Windows поддерживает пометку параметров ByRef только атрибутом System.Runtime.InteropServices.OutAttribute и не поддерживает использование указанных атрибутов. |
| WME1106      | Метод "{0}" имеет параметр "{1}", который является массивом. В среде выполнения Windows содержимое параметров-массивов должно быть доступным для чтения или записи. Примените к "{1}" {2} или {3}.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |


## <a name="member-with-a-parameter-named-value"></a>Член с параметром value


В UWP возвращаемые значения считаются выходными параметрами, а имена параметров должны быть уникальными. По умолчанию Winmdexp.exe присваивает возвращаемому значению имя value. Если у метода есть параметр с именем value, возникнет ошибка WME1092. Эту проблему можно устранить двумя способами.

-   Присвойте параметру имя, отличное от value (в методах доступа к свойствам — имя, отличное от returnValue).
-   Используйте атрибут ReturnValueNameAttribute для изменения имени возвращаемого значения, как показано ниже:

    > [!div class="tabbedCodeSnippets"]
    > ```cs
    > using System.Runtime.InteropServices;
    > using System.Runtime.InteropServices.WindowsRuntime;
    >
    > [return: ReturnValueName("average")]
    > public int GetAverage(out int lowValue, out int highValue)
    > ```
    > ```vb
    > Imports System.Runtime.InteropServices
    > Imports System.Runtime.InteropServices.WindowsRuntime
    >
    > Public Function GetAverage(<Out> ByRef lowValue As Integer, _
    > <Out> ByRef highValue As Integer) As <ReturnValueName("average")> String
    > ```

> **Примечание. Если**изменить имя возвращаемого значения, а новое имя конфликтует с именем другого параметра, появится сообщение об ошибке WME1091.  

Код JavaScript может получить доступ к выходным параметрам метода (в том числе к возвращаемому значению) по имени. Пример можно найти в описании атрибута [ReturnValueNameAttribute](https://docs.microsoft.com/dotnet/api/system.runtime.interopservices.windowsruntime.returnvaluenameattribute?redirectedfrom=MSDN).

| Номер ошибки | Текст сообщения |
|--------------|--------------|
| WME1091 | Метод "\{0}" имеет возвращаемое значение с именем "\{1}", которое совпадает с именем параметра. В среде выполнения Windows параметры методов и возвращаемые значения должны иметь уникальные имена. |
| WME1092 | Метод "\{0}" имеет параметр с именем "\{1}", который совпадает с именем возвращаемого значения по умолчанию. Попробуйте использовать другое имя параметра или с помощью атрибута System.Runtime.InteropServices.WindowsRuntime.ReturnValueNameAttribute явно укажите имя возвращаемого значения. |

**Обратите внимание**  , что имя по умолчанию — «ReturnValue» для методов доступа к свойствам и «значение» для всех остальных способов.

## <a name="related-topics"></a>См. также

* [Среда выполнения Windows компонентов с C# и Visual Basic](creating-windows-runtime-components-in-csharp-and-visual-basic.md)
* [Winmdexp. exe (средство экспорта метаданных среда выполнения Windows)](https://docs.microsoft.com/dotnet/framework/tools/winmdexp-exe-windows-runtime-metadata-export-tool)
