---
author: msatranjr
title: Диагностика состояний ошибки компонентов среды выполнения Windows
description: В этой статье приведены дополнительные сведения об ограничениях, которые применяются к компонентам среды выполнения Windows, написанным с использованием управляемого кода.
ms.assetid: CD0D0E11-E68A-411D-B92E-E9DECFDC9599
ms.author: misatran
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: 833dd0a6447e9d0bb49c21a18d17bd7b0dc3455d
ms.sourcegitcommit: 144f5f127fc4fbd852f2f6780ef26054192d68fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/02/2018
ms.locfileid: "5997663"
---
# <a name="diagnosing-windows-runtime-component-error-conditions"></a>Диагностика состояний ошибки компонентов среды выполнения Windows




В этой статье приведены дополнительные сведения об ограничениях, которые применяются к компонентам среды выполнения Windows, написанным с использованием управляемого кода. Эти сведения расширяют информацию, которая предоставляется в сообщениях об ошибке, отправляемых средством [Winmdexp.exe (Windows Runtime Metadata Export Tool)](https://msdn.microsoft.com/library/hh925576.aspx), и дополняют сведения об ограничениях, представленные в разделе [Создание компонентов среды выполнения Windows в C# и Visual Basic](creating-windows-runtime-components-in-csharp-and-visual-basic.md).

Эта статья не охватывает все ошибки. Описанные здесь ошибки группируются по общим категориям, а каждая категория содержит таблицу связанных сообщений об ошибках. Выполняйте поиск текста сообщения (опустив конкретные значения, заменяемые заполнителями) или номера сообщения. Если вам не удается найти здесь необходимую информацию, помогите нам улучшить качество документации, отправив отзыв с помощью кнопки в конце этой статьи. Включите в отзыв сообщение об ошибке. Кроме того, вы можете зарегистрировать ошибку на веб-сайте Microsoft Connect.

## <a name="error-message-for-implementing-async-interface-provides-incorrect-type"></a>При реализации асинхронного интерфейса сообщение об ошибке содержит неверный тип


Управляемые компоненты среды выполнения Windows не могут реализовывать интерфейсы универсальной платформы Windows (UWP), представляющие асинхронные действия или операции ([IAsyncAction](https://msdn.microsoft.com/library/br205781.aspx), [IAsyncActionWithProgress&lt;TProgress&gt;](https://msdn.microsoft.com/library/br205784.aspx), [IAsyncOperation&lt;TResult&gt;](https://msdn.microsoft.com/library/windows/apps/br206598.aspx) или [IAsyncOperationWithProgress&lt;TResult, TProgress&gt;](https://msdn.microsoft.com/library/windows/apps/br206594.aspx)). Вместо этого в .NET Framework есть класс [AsyncInfo](https://msdn.microsoft.com/library/system.runtime.interopservices.windowsruntime.asyncinfo.aspx) для создания асинхронных операций в компонентах среды выполнения Windows. В сообщении об ошибке, отображаемом в Winmdexp.exe при попытке реализовать асинхронный интерфейс, по ошибке указывается прежнее имя класса— AsyncInfoFactory. Платформа .NET Framework больше не содержит класс AsyncInfoFactory.

| Номер ошибки | Текст сообщения|       
|--------------|-------------|
| WME1084      | Тип "{0}«реализует асинхронный интерфейс среды выполнения Windows»{1}". Типы среды выполнения Windows не могут реализовывать асинхронные интерфейсы. Используйте класс System.Runtime.InteropServices.WindowsRuntime.AsyncInfoFactory для создания асинхронных операций для экспорта в среду выполнения Windows. |

> **Примечание**сообщения об ошибках, которые ссылаются на среды выполнения Windows, используется устаревшая терминология. Теперь эта среда называется универсальной платформой Windows (UWP). Например, типы среды выполнения Windows теперь называются типами UWP.

 

## <a name="missing-references-to-mscorlibdll-or-systemruntimedll"></a>Отсутствуют ссылки на библиотеки mscorlib.dll или System.Runtime.dll


Эта проблема возникает только при использовании средства Winmdexp.exe через командную строку. Мы рекомендуем использовать параметр /reference, чтобы включить ссылки на обе библиотеки— mscorlib.dll и System.Runtime.dll— из основных ссылочных сборок .NET Framework, расположенных в папке %ProgramFiles(x86)%\\Reference Assemblies\\Microsoft\\Framework\\.NETCore\\v4.5 (%ProgramFiles%\\... на 32-разрядном компьютере).

| Номер ошибки | Текст сообщения                                                                                                                                     |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| WME1009      | Нет ссылок на mscorlib.dll. Ссылка на этот файл метаданных необходима для успешного выполнения экспорта.                               |
| WME1090      | Не удалось определить основную ссылочную сборку. Убедитесь, что на файлы mscorlib.dll и System.Runtime.dll даны ссылки с помощью параметра /reference. |

 

## <a name="operator-overloading-is-not-allowed"></a>Перегрузка операторов не разрешена


В компоненте среды выполнения Windows, написанном с использованием управляемого кода, нельзя предоставлять перегруженные операторы открытых типов.

> **Примечание**в сообщении об ошибке оператор определяется по имени метаданных, например op\_Addition, op\_Multiply, op\_ExclusiveOr, op\_Implicit (неявное преобразование) и т. д.

 

| Номер ошибки | Текст сообщения                                                                                          |
|--------------|-------------------------------------------------------------------------------------------------------|
| WME1087      | "{0}" является перегрузкой оператора. Управляемые типы не могут предоставлять доступ к перегрузкам операторов в среде выполнения Windows. |

 

## <a name="constructors-on-a-class-have-the-same-number-of-parameters"></a>Конструкторы класса имеют одинаковое число параметров


В UWP у класса может быть только один конструктор с заданным количеством параметров; например, нельзя иметь один конструктор с одним параметром типа **String** и другой с одним параметром типа **int** (**Integer** в Visual Basic). Единственное решение — использовать разное число параметров для каждого конструктора.

| Номер ошибки | Текст сообщения                                                                                                                                            |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| WME1099      | Тип "{0}«имеет несколько конструкторов с»{1}" аргументы. Типы среды выполнения Windows не могут иметь несколько конструкторов с одинаковым числом аргументов. |

 

## <a name="must-specify-a-default-for-overloads-that-have-the-same-number-of-parameters"></a>Необходимо указать значение по умолчанию для перегрузок с одинаковым числом параметров


В UWP перегруженные методы могут иметь одинаковое число параметров, только если одна перегрузка определена как перегрузка по умолчанию. Ознакомьтесь с разделом "Перегруженные методы" в статье [Создание компонентов среды выполнения Windows в C# и Visual Basic](creating-windows-runtime-components-in-csharp-and-visual-basic.md).

| Номер ошибки | Текст сообщения                                                                                                                                                                      |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WME1059      | Несколько {0}-перегрузок "{1}. {2}"параметрами помечены атрибутом Windows.Foundation.Metadata.DefaultOverloadAttribute.                                                            |
| WME1085      | {0}-Перегрузок {1}. {2} должны иметь ровно один метод как перегрузка по умолчанию с помощью оформления атрибутом Windows.Foundation.Metadata.DefaultOverloadAttribute. |

 

## <a name="namespace-errors-and-invalid-names-for-the-output-file"></a>Ошибки пространства имен и недопустимое имя выходного файла


На универсальной платформе Windows все открытые типы из файла метаданных Windows (.winmd) должны находиться в пространстве имен, совместно использующем имя файла .winmd, или во вложенных пространствах имен имени файла. Например, если проект Visual Studio называется A.B (т. е. компонент среды выполнения Windows — это файл A.B.winmd), он может содержать открытые классы A.B.Class1 и A.B.C.Class2, но не классы A.Class3 (WME0006) или D.Class4 (WME1044).

> **Примечание**эти ограничения относятся только к открытым типам, а не к закрытым типам, используемым в вашей реализации.

 

В случае с классом A.Class3 можно либо переместить Class3 в другое пространство имен, либо изменить имя компонента среды выполнения Windows на A.winmd. Хотя класс WME0006 является предупреждением, следует рассматривать его как ошибку. В предыдущем примере код, вызывающий A.B.winmd, не сможет найти A.Class3.

В случае с классом D.Class4 имя файла не может одновременно содержать имя D.Class4 и классы из пространства имен A.B, поэтому изменение имени компонента среды выполнения Windows не поможет исправить проблему. Вы можете переместить класс D.Class4 в другое пространство имен или поместить его в другой компонент среды выполнения Windows.

Файловая система не различает регистр символов, поэтому не разрешается использовать пространства имен, отличающиеся лишь регистром (WME1067).

Компонент должен содержать хотя бы один тип **public sealed** (**Public NotInheritable** в Visual Basic). В противном случае вы получите ошибку WME1042 или WME1043, в зависимости от того, содержит ли компонент закрытые типы.

В компоненте среды выполнения Windows у типа не может быть имени, совпадающего с пространством имен (WME1068).

> **Внимание**при непосредственном вызове Winmdexp.exe и не используйте параметр/out для указания имени компонента среды выполнения Windows, Winmdexp.exe пытается сформировать имя, включающее все пространства имен в компоненте. Переименование пространств имен может изменить имя компонента.

 

| Номер ошибки | Текст сообщения                                                                                                                                                                                                                                                                                                                                             |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WME0006      | "{0}" не является допустимым именем файла .winmd для этой сборки. Все типы в файле метаданных Windows должны находиться во вложенном пространстве имен пространства имен, заданного именем файла. Типы, отсутствующие в этом вложенном пространстве имен, невозможно найти во время выполнения. В этой сборке наименьшее общее пространство имен, которое можно использовать в качестве имени файла — "{1}". |
| WME1042      | Входной модуль должен содержать по крайней мере один открытый тип, расположенный внутри пространства имен.                                                                                                                                                                                                                                                                   |
| WME1043      | Входной модуль должен содержать по крайней мере один открытый тип, расположенный внутри пространства имен. Внутри пространств имен содержатся только закрытые типы.                                                                                                                                                                                                               |
| WME1044      | Открытый тип имеет пространство имен ("{1}"), имеющую нет общего префикса с другими пространствами имен ("{0}"). Все типы в файле метаданных Windows должны находиться во вложенном пространстве имен пространства имен, заданного именем файла.                                                                                                                              |
| WME1067      | Имена пространств имен не могут различаться только регистром: "{0}«,»{1}".                                                                                                                                                                                                                                                                                                |
| WME1068      | Тип "{0}«не может иметь имя, совпадающее с именем пространства имен»{1}".                                                                                                                                                                                                                                                                                                 |

 

## <a name="exporting-types-that-arent-valid-universal-windows-platform-types"></a>Экспорт типов, не являющихся допустимыми типами универсальной платформы Windows


Открытый интерфейс компонента должен предоставлять только типы UWP. Однако платформа .NET Framework предоставляет сопоставления для нескольких часто используемых типов, незначительно отличающихся в .NET Framework и UWP. Это позволяет разработчикам .NET Framework работать со знакомыми типами вместо изучения новых. Вы можете использовать эти сопоставленные типы .NET Framework в открытом интерфейсе компонента. Ознакомьтесь с подразделами «Объявление типов в компонентах среды выполнения Windows» и «Передача типов универсальной платформы Windows в управляемый код» в разделах [Создание компонентов среды выполнения Windows в C# и Visual Basic](creating-windows-runtime-components-in-csharp-and-visual-basic.md)и [Сопоставление типов .NET Framework с типами среды выполнения Windows](net-framework-mappings-of-windows-runtime-types.md).

Многие из этих сопоставлений являются интерфейсами. Например, интерфейс [IList&lt;T&gt;](https://msdn.microsoft.com/library/5y536ey6.aspx) соответствует интерфейсу UPW [IVector&lt;T&gt;](https://msdn.microsoft.com/library/windows/apps/br206631.aspx). При использовании List&lt;string&gt; (`List(Of String)` в Visual Basic) вместо IList&lt;string&gt; в качестве типа параметра Winmdexp.exe предоставляет список альтернативных вариантов, который включает все сопоставленные интерфейсы, реализованные типом List&lt;T&gt;. При использовании вложенных универсальных типов, таких как List&lt;Dictionary&lt;int, string&gt;&gt; (List(Of Dictionary(Of Integer, String)) в Visual Basic), Winmdexp.exe предлагает варианты для каждого уровня вложения. Эти списки могут быть довольно длинными.

Как правило, наиболее подходящим является ближайший к типу интерфейс. Например, для Dictionary&lt;int, string&gt; самым подходящим, вероятнее всего, является интерфейс IDictionary&lt;int, string&gt;.

> **Важные**JavaScript используется интерфейс, занимающий первую позицию в списке интерфейсов, реализуемых управляемым типом. Например, если в код JavaScript возвращается тип Dictionary&lt;int, string&gt;, он отображается как IDictionary&lt;int, string&gt; независимо от того, какой интерфейс указан в качестве типа возвращаемого значения. Это означает, что если первый интерфейс не включает член, который отображается в последующих интерфейсах, этот член не будет видимым в JavaScript.

> **Внимание**старайтесь не использовать неуниверсальные интерфейсы [IList](https://msdn.microsoft.com/library/system.collections.ilist.aspx) и [IEnumerable](https://msdn.microsoft.com/library/system.collections.ienumerable.aspx) , если компонент будет использоваться в JavaScript. Эти интерфейсы сопоставляются с [IBindableVector](https://msdn.microsoft.com/library/windows/apps/windows.ui.xaml.interop.ibindablevector.aspx) и [IBindableIterator](https://msdn.microsoft.com/library/windows/apps/windows.ui.xaml.interop.ibindableiterator.aspx), соответственно. Они поддерживают привязку для элементов управления XAML и невидимы в коде JavaScript. JavaScript выдает ошибку во время выполнения «Не удается вызвать функцию 'X', так как ее подпись недопустима».

 

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Номер ошибки</th>
<th align="left">Текст сообщения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">WME1033</td>
<td align="left">Метод "{0}«есть параметр»{1}«типа»{2}". "{2}" не является допустимым типом параметра среды выполнения Windows.</td>
</tr>
<tr class="even">
<td align="left">WME1038</td>
<td align="left">Метод "{0}«имеет параметр типа»{1}" сигнатура. Хотя этот тип не является допустимым типом среды выполнения Windows, он реализует интерфейсы, являющиеся допустимыми типами среды выполнения Windows. Попробуйте изменить сигнатуру метода с вместо этого используйте один из следующих типов: "{2}".</td>
</tr>
<tr class="odd">
<td align="left">WME1039</td>
<td align="left"><p>Метод "{0}«имеет параметр типа»{1}" сигнатура. Хотя этот универсальный тип не является допустимым типом среды выполнения Windows, сам тип или его универсальные параметры реализуют интерфейсы, являющиеся допустимыми типами среды выполнения Windows. {2}</p>
> **Примечание**для {2}, Winmdexp.exe добавляет список альтернативных вариантов, таких как «рассмотрите возможность изменения типа "System.Collections.Generic.List&lt;T&gt;" вместо этого в сигнатуру метода с одним из следующих типов: " System.Collections.Generic.IList&lt;T&gt;, System.Collections.Generic.IReadOnlyList&lt;T&gt;, System.Collections.Generic.IEnumerable&lt;T&gt;".»
</td>
</tr>
<tr class="even">
<td align="left">WME1040</td>
<td align="left">Метод "{0}«имеет параметр типа»{1}" сигнатура. Вместо управляемого типа Task используйте Windows.Foundation.IAsyncAction, Windows.Foundation.IAsyncOperation или один из асинхронных интерфейсов среды выполнения Windows. Стандартный шаблон ожидания .NET также применим к этим интерфейсам. Дополнительные сведения о преобразовании объектов управляемых задач в асинхронные интерфейсы среды выполнения Windows вы можете найти в разделе System.Runtime.InteropServices.WindowsRuntime.AsyncInfo.</td>
</tr>
</tbody>
</table>

 

## <a name="structures-that-contain-fields-of-disallowed-types"></a>Структуры, содержащие поля неразрешенных типов


В UWP структура может содержать только поля, и только структуры могут содержать поля. Эти поля должны быть открытыми. Допустимые типы полей включают перечисления, структуры и типы-примитивы.

| Номер ошибки | Текст сообщения                                                                                                                                                                                                                                                            |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WME1060      | Структура "{0}«содержит поле»{1}«типа»{2}". "{2}" не является допустимым типом поля среды выполнения Windows. Каждое поле в структуре среды выполнения Windows должно иметь тип UInt8, Int16, UInt16, Int32, UInt32, Int64, UInt64, Single, Double, Boolean, String, Enum или само быть структурой. |

 

## <a name="restrictions-on-arrays-in-member-signatures"></a>Ограничения на массивы в сигнатурах членов


В UWP массивы в сигнатурах членов должны быть одномерными с нижней границей, равной 0 (нулю). Вложенные типы массивов, такие как `myArray[][]` (`myArray()()` в Visual Basic), не допускаются.

> **Примечание**это ограничение не применяется к массивам внутреннего использования в вашей реализации.

 

| Номер ошибки | Текст сообщения                                                                                                                                                     |
|--------------|--------------------|
| WME1034      | Метод "{0}«содержит массив типа»{1}" с ненулевой нижней границей. Нижняя граница массивов в сигнатурах методов среды выполнения Windows должна равняться нулю. |
| WME1035      | Метод "{0}«содержит многомерный массив типа»{1}" сигнатура. Массивы в сигнатурах методов среды выполнения Windows должны быть одномерными.                  |
| WME1036      | Метод "{0}«содержит вложенный массив типа»{1}" сигнатура. Массивы в подписях методов среды выполнения Windows не могут быть вложенными.                                    |

 

## <a name="array-parameters-must-specify-whether-array-contents-are-readable-or-writable"></a>Параметры массива должны определять, доступно ли содержимое массива для чтения или записи


В UWP параметры должны быть доступны только для чтения или только для записи. Параметры нельзя пометить модификатором **ref** (**ByRef** без атрибута [OutAttribute](https://msdn.microsoft.com/library/system.runtime.interopservices.outattribute.aspx) в Visual Basic). Это относится к содержимому массивов, поэтому параметры массивов должны указывать, доступно ли содержимое массива только для чтения или только для записи. Направление четко определено для параметров **out** (параметр **ByRef** с атрибутом OutAttribute в Visual Basic), но параметры массивов, передаваемые по значению (ByVal в Visual Basic), должны быть помечены. Ознакомьтесь с разделом [Передача массивов в компонент среды выполнения Windows](passing-arrays-to-a-windows-runtime-component.md).

| Номер ошибки | Текст сообщения         |
|--------------|----------------------|
| WME1101      | Метод "{0}«есть параметр»{1}", являющийся массивом и одновременно содержит {2} и {3}. В среде выполнения Windows содержимое параметров-массивов должно быть доступным для чтения или записи. Удалите один из атрибутов из "{1}".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| WME1102      | Метод "{0}«есть выходной параметр»{1}", являющийся массивом, но содержит {2}. В среде выполнения Windows содержимое выходных массивов доступно для записи. Удалите атрибут из "{1}".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| WME1103      | Метод "{0}«есть параметр»{1}", являющийся массивом и содержит с атрибутом System.Runtime.InteropServices.InAttribute или System.Runtime.InteropServices.OutAttribute. В среде выполнения Windows, параметров массива должен иметь либо {2} или {3}. Удалите эти атрибуты или при необходимости замените их соответствующими атрибутами среды выполнения Windows.                                                                                                                                                                                                                                                                                                                                                                                          |
| WME1104      | Метод "{0}«есть параметр»{1}" которого не является массивом и содержит {2} или {3}. Среда выполнения Windows не поддерживает отметка являющихся параметрами с помощью {2} или {3}.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| WME1105      | Метод "{0}«есть параметр»{1}" с атрибутом System.Runtime.InteropServices.InAttribute или System.Runtime.InteropServices.OutAttribute. Среда выполнения Windows не поддерживает пометку параметров атрибутами System.Runtime.InteropServices.InAttribute и System.Runtime.InteropServices.OutAttribute Попробуйте удалить System.Runtime.InteropServices.InAttribute и заменить System.Runtime.InteropServices.OutAttribute на модификатор out. Метод "{0}«есть параметр»{1}" с атрибутом System.Runtime.InteropServices.InAttribute или System.Runtime.InteropServices.OutAttribute. Среда выполнения Windows поддерживает пометку параметров ByRef только атрибутом System.Runtime.InteropServices.OutAttribute и не поддерживает использование указанных атрибутов. |
| WME1106      | Метод "{0}«есть параметр»{1}", являющийся массивом. В среде выполнения Windows содержимое параметров-массивов должно быть доступным для чтения или записи. Примените {2} или {3} для "{1}".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |


## <a name="member-with-a-parameter-named-value"></a>Член с параметром value


В UWP возвращаемые значения считаются выходными параметрами, а имена параметров должны быть уникальными. По умолчанию Winmdexp.exe присваивает возвращаемому значению имя value. Если у метода есть параметр с именем value, возникнет ошибка WME1092. Эту проблему можно устранить двумя способами.

-   Присвойте параметру имя, отличное от value (в методах доступа к свойствам — имя, отличное от returnValue).
-   Используйте атрибут ReturnValueNameAttribute для изменения имени возвращаемого значения, как показано ниже:

    > [!div class="tabbedCodeSnippets"]
    > ```cs
    > using System.Runtime.InteropServices;
    > using System.Runtime.InteropServices.WindowsRuntime;
    >
    > [return: ReturnValueName("average")]
    > public int GetAverage(out int lowValue, out int highValue)
    > ```
    > ```vb
    > Imports System.Runtime.InteropServices
    > Imports System.Runtime.InteropServices.WindowsRuntime
    >
    > Public Function GetAverage(<Out> ByRef lowValue As Integer, _
    > <Out> ByRef highValue As Integer) As <ReturnValueName("average")> String
    > ```

> **Примечание**Если при изменении имени возвращаемого значения новое имя конфликтует с именем другого параметра, возникнет ошибка WME1091.

Код JavaScript может получить доступ к выходным параметрам метода (в том числе к возвращаемому значению) по имени. Пример можно найти в описании атрибута [ReturnValueNameAttribute](https://msdn.microsoft.com/library/windows/apps/system.runtime.interopservices.windowsruntime.returnvaluenameattribute.aspx).

| Номер ошибки | Текст сообщения |
|--------------|--------------|
| WME1091 | Метод "\{0}" имеет возвращаемое значение с именем "\{1}" которого совпадает с именем параметра. В среде выполнения Windows параметры методов и возвращаемые значения должны иметь уникальные имена. |
| WME1092 | Метод "\{0}" имеет параметр с именем "\{1}" которого совпадает с по умолчанию именем возвращаемого значения. Попробуйте использовать другое имя параметра или с помощью атрибута System.Runtime.InteropServices.WindowsRuntime.ReturnValueNameAttribute явно укажите имя возвращаемого значения. |

**Примечание**имя по умолчанию — «returnValue» для доступа к свойствам и «value» для всех других методов.


## <a name="related-topics"></a>Еще по теме

* [Создание компонентов среды выполнения Windows на C# и VisualBasic](creating-windows-runtime-components-in-csharp-and-visual-basic.md)
* [Winmdexp.exe (Windows Runtime Metadata Export Tool)](https://msdn.microsoft.com/library/hh925576.aspx)
