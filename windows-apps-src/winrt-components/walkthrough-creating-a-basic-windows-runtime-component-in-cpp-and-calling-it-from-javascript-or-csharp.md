---
author: martinekuan
title: Базовый компонент среды Windows на C++ и его вызов из JavaScript и C#
description: В этом пошаговом руководстве описан процесс создания базового компонента среды выполнения Windows, являющегося библиотекой DLL, которую можно вызвать из JavaScript, C# или Visual Basic.
ms.assetid: 764CD9C6-3565-4DFF-88D7-D92185C7E452
---

# Пошаговое руководство: создание базового компонента среды выполнения Windows на C++ и его вызов из JavaScript или C#


\[ Обновлено для приложений UWP в Windows 10. Статьи о Windows 8.x см. в [архиве](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


\[Некоторые сведения относятся к предварительным версиям продуктов, в которые перед коммерческим выпуском могут быть внесены существенные изменения. Майкрософт не дает никаких гарантий, прямых или косвенных, в отношении указанной здесь информации.\]

В этом пошаговом руководстве описан процесс создания базового компонента среды выполнения Windows, являющегося библиотекой DLL, которую можно вызвать из JavaScript, C# или Visual Basic. Прежде чем приступить к изучению этого пошагового руководства, убедитесь, что вы знакомы с такими понятиями, как абстрактный двоичный интерфейс (ABI), ссылочные классы и расширения компонентов Visual C++, которые упрощают работу со ссылочными классами. Дополнительные сведения см. в статье [Создание компонентов среды выполнения Windows в C++](creating-windows-runtime-components-in-cpp.md) и [Справочник по языку Visual C++ (C++/CX)](https://msdn.microsoft.com/library/windows/apps/xaml/hh699871.aspx).

## Создание библиотеки DLL компонента C++


В этом примере сначала создается проект компонента, но можно сначала создать проект JavaScript. Порядок не имеет значения.

Обратите внимание, что основной класс компонента содержит примеры определений свойств и методов, а также объявление события. Они включаются в проект только для демонстрации самого процесса создания. В данном примере они не требуются, и мы заменим весь созданный код нашим собственным кодом.

## **Создание проекта компонента C++**

1.  В строке меню Visual Studio выберите **Файл, Создать, Проект**.
2.  В левой области диалогового окна **Новый проект** разверните узел **Visual C++** и выберите узел универсальных приложений для Windows.
3.  На центральной панели выберите **Компонент среды выполнения Windows**, а затем назовите проект WinRT\_CPP.
4.  Нажмите кнопку **ОК**.

## **Добавление активируемого класса в компонент**

1.  Активируемый класс — это класс, который может создаваться в клиентском коде с помощью выражения **new** (**New** в Visual Basic и **ref new** в C++). В вашем компоненте он объявляется как **public ref class sealed**. В действительности файлы Class1.h и Class1.cpp уже содержат ссылочный класс. Имя можно изменить, однако в данном примере мы будет использовать имя по умолчанию Class1. При необходимости в компоненте можно задать дополнительные ссылочные классы или регулярные классы. Дополнительные сведения о ссылочных классах см. в статье [Система типов (C++/CX)](https://msdn.microsoft.com/library/windows/apps/hh755822.aspx).

2.  Добавьте следующие директивы \#include в файл Class1.h:

    ```cpp
             private void PrimesUnOrderedButton_Click_1(object sender, RoutedEventArgs e)
            {
                var nativeObject = new WinRT_CPP.Class1();

                StringBuilder sb = new StringBuilder();
                sb.Append("Primes found (unordered): ");
                PrimesUnOrderedResult.Text = sb.ToString();

                // primeFoundEvent is a user-defined event in nativeObject
                // It passes the results back to this thread as they are produced
                // and the event handler that we define here immediately displays them.
                nativeObject.primeFoundEvent += (n) =>
                {
                    sb.Append(n.ToString()).Append(" ");
                    PrimesUnOrderedResult.Text = sb.ToString();
                };

                // Call the async method.
                var asyncResult = nativeObject.GetPrimesUnordered(2, 100000);

                // Provide a handler for the Progress event that the asyncResult
                // object fires at regular intervals. This handler updates the progress bar.
                asyncResult.Progress += (asyncInfo, progress) =>
                    {
                        PrimesUnOrderedProgress.Value = progress;
                    };
            }

            private void Clear_Button_Click(object sender, RoutedEventArgs e)
            {
                PrimesOrderedProgress.Value = 0;
                PrimesUnOrderedProgress.Value = 0;
                PrimesUnOrderedResult.Text = "";
                PrimesOrderedResult.Text = "";
                Result1.Text = "";
            }
    ```

## Запуск приложения


Выберите проект C# или проект JavaScript в качестве запускаемого проекта, открыв контекстное меню узла проекта в Обозревателе решений и выбрав команду **Назначить запускаемым проектом**. Затем нажмите клавишу F5, чтобы запустить программу с отладкой, или CTRL+F5, чтобы запустить ее без отладки.

## Проверка компонентов в Обозревателе объектов (необязательно)


В Обозревателе объектов можно проверять все типы среды выполнения Windows, определенные в файлах WinMD. Сюда входят типы из пространства имен «Platform», а также из пространства имен по умолчанию. Однако, поскольку типы в пространстве имен Platform::Collections определены в файле заголовков collections.h, а не в файле WinMD, они не отображаются в Обозревателе объектов.

## **Проверка компонента**

1.  В строке меню выберите **Вид, Обозреватель объектов** (Ctrl+Alt+J).
2.  На левой панели Обозревателя объектов разверните узел WinRT\_CPP, чтобы увидеть типы и методы, которые определены в компоненте.

## Советы по отладке


Для более эффективной отладки скачайте символы отладки с открытых серверов символов Майкрософт.

## **Скачивание символов отладки**

1.  В строке меню выберите **Сервис, Параметры**.
2.  В диалоговом окне **Параметры** разверните узел **Отладка** и выберите **Символы**.
3.  Установите флажок **Серверы символов Майкрософт** и нажмите кнопку **OK**.

Первоначальное скачивание символов может занять некоторое время. Для повышения производительности при следующем нажатии клавиши F5 укажите локальный каталог, в котором следует кэшировать символы.

При отладке решения JavaScript, содержащего библиотеку DLL компонента, можно настроить отладчик для пошагового выполнения скрипта или машинного кода в компоненте, однако нельзя отлаживать эти части одновременно. Чтобы изменить параметр, откройте контекстное меню узла проекта JavaScript в Обозревателе решений и выберите пункт **Свойства, Отладка, Тип отладчика**.

Обязательно выберите соответствующие возможности в конструкторе пакетов. Открыть конструктор пакетов можно, запустив файл Package.appxmanifest. Например, если вы пытаетесь программным образом обратиться к файлам в папке «Рисунки», не забудьте установить флажок **Библиотека изображений** в области **Возможности** конструктора пакетов.

Если коду JavaScript не удается распознать открытые свойства или методы в компоненте, убедитесь, что в JavaScript используется «верблюжий» стиль имен. Например, метод `ComputeResult` C++ следует вызывать из JavaScript как `computeResult`.

При удалении проекта компонента среды выполнения Windows C++ из решения необходимо также вручную удалить ссылку на проект из проекта JavaScript. Невыполнение этого требования приведет к невозможности последующей отладки и сборки. При необходимости можно добавить ссылку на сборку в библиотеку DLL.

## Связанные разделы

* [Создание компонентов среды выполнения Windows на C++](creating-windows-runtime-components-in-cpp.md)



<!--HONumber=May16_HO2-->


