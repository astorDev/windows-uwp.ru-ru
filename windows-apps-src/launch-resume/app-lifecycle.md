---
author: TylerMSFT
title: "Жизненный цикл приложения"
description: "В этой статье рассказывается о жизненном цикле приложения универсальной платформы Windows (UWP) с момента его активации и до закрытия."
ms.assetid: 6C469E77-F1E3-4859-A27B-C326F9616D10
ms.sourcegitcommit: 213384a194513a0f98a5f37e7f0e0849bf0a66e2
ms.openlocfilehash: 8451942c05d5d44cafba243f7cbebceedbe86fc0

---

# Жизненный цикл приложения


\[ Обновлено для приложений UWP в Windows 10. Статьи, касающиеся Windows 8.x, см. в [архиве](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


**Важные API**

-   [**Класс Windows.UI.Xaml.Application**](https://msdn.microsoft.com/library/windows/apps/br242324)
-   [**Пространство имен Windows.ApplicationModel.Activation**](https://msdn.microsoft.com/library/windows/apps/br224766)

В этой статье рассказывается о жизненном цикле приложения универсальной платформы Windows (UWP) с момента его активации и до закрытия. Многие пользователи используют для работы и развлечений несколько приложений и устройств. В наши дни стало нормой, что приложение запоминает свое состояние и пользователь может продолжить работу с ним на другом устройстве. Например, пользователи ожидают, что просмотренная страница будет открыта на том же месте, где они остановились, и все элементы управления будут находиться в неизмененном состоянии. Знания в области жизненного цикла запуска, приостановки и возобновления работы приложения помогут вам обеспечить его безупречную работу.

## Состояние выполнения приложения


На этой иллюстрации показаны переходы между состояниями выполнения приложения. Эти состояния и события описаны в следующих нескольких разделах. Дополнительную информацию о каждой смене состояний и о том, что ваше приложение должно сделать в ответ, см. в документах по перечислению [**ApplicationExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224694).

![Диаграмма состояния, показывающая переходы между состояниями приложения](images/state-diagram.png)

## Развертывание


Чтобы активировать приложение, сначала необходимо развернуть его. Развертывание приложения выполняется когда пользователь устанавливает приложение или когда вы используете Visual Studio для сборки и запуска своего приложения во время разработки и тестирования. Подробнее об этом и о расширенных сценариях развертывания см. в статье [Пакеты приложений и их развертывание](https://msdn.microsoft.com/library/windows/apps/hh464929).

## Запуск приложения


Приложение запускается, когда оно находится в состоянии **NotRunning** и пользователь выбирает плитку приложения на начальном экране или в списке приложений. Часто используемые приложения также могут быть предварительно запущены для оптимизации отклика (см. [Обработка предварительного запуска приложения](handle-app-prelaunch.md)). Приложение может быть в состоянии **NotRunning**, если оно никогда не запускалось, завершило работу в результате сбоя или было приостановлено, но не смогло сохраниться в памяти и система завершила его выполнение. Запуск и активация приложения отличаются. Активация — это включение приложения через надстройку или посредством контракта, такого как контракт "Поиск".

Метод [**OnLaunched**](https://msdn.microsoft.com/library/windows/apps/br242335) вызывается, когда приложение запущено, в том числе, когда оно было приостановлено и находится в памяти. Параметр [**LaunchActivatedEventArgs**](https://msdn.microsoft.com/library/windows/apps/br224731) содержит предыдущее состояние приложения и аргументы активации.

Когда пользователь переключается на приложение, которое завершило работу, система отправляет аргументы события [**LaunchActivatedEventArgs**](https://msdn.microsoft.com/library/windows/apps/br224731), свойству [**Kind**](https://msdn.microsoft.com/library/windows/apps/br224728) которого задано значение **Launch**, а свойству [**PreviousExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224729) — значение **Terminated** или **ClosedByUser**. Приложение должно загрузить свои сохраненные данные и обновить отображаемое содержимое.

Если параметру [**PreviousExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224729) присвоено значение **NotRunning**, то приложение должно перезапуститься, как если бы оно было запущено в первый раз.

При запуске приложения Windows отображает его экран-заставку. Подробнее о настройке экрана-заставки см. в статье [Добавление экрана-заставки](https://msdn.microsoft.com/library/windows/apps/xaml/hh465331).

Одновременно с отображением экрана-заставки приложение должно подготовить свой пользовательский интерфейс. Его основные задачи — регистрация обработчиков событий и установка всех настраиваемых элементов пользовательского интерфейса, которые необходимы для загрузки начальной страницы. Эти задачи должны выполняться всего за несколько секунд. Если приложению требуется запросить данные из сети или получить большой объем информации с диска, эти действия необходимо совершать отдельно от активации. Приложение может использовать собственный настраиваемый пользовательский интерфейс или расширенный экран-заставку, ожидая завершения таких продолжительных операций. Подробнее см. в разделах [Более продолжительное отображение экрана-заставки](create-a-customized-splash-screen.md) и [Пример экрана-заставки](http://go.microsoft.com/fwlink/p/?linkid=234889). После завершения активации приложение переходит в состояние **Running**, и экран-заставка исчезает (а все соответствующие ресурсы и объекты удаляются).

## Активация приложений


Пользователь может активировать приложение с помощью ряда расширений и контрактов, таких как контракт отправки данных. Перечень способов активации приложения см. в статье [**ActivationKind**](https://msdn.microsoft.com/library/windows/apps/br224693).

Класс [**Windows.UI.Xaml.Application**](https://msdn.microsoft.com/library/windows/apps/br242324) определяет методы, которые можно переопределить для обработки различных типов активации. Для некоторых типов активации предусмотрен специальный метод, который можно переопределить, такой как [**OnFileActivated**](https://msdn.microsoft.com/library/windows/apps/br242331), [**OnSearchActivated**](https://msdn.microsoft.com/library/windows/apps/br242336) и т. д. Для других типов активации следует переопределить метод [**OnActivated**](https://msdn.microsoft.com/library/windows/apps/br242330).

Код активации приложения может проверить причину его активации, а также узнать, не находилось ли оно в состоянии **Running**.

Во время активации приложение может восстановить сохраненные ранее данные в том случае, если операционная система завершила работу приложения, а затем пользователь снова запустил его. Windows может завершить работу приложения после того, как оно было приостановлено по той или иной причине. Пользователь может закрыть его вручную или выйти из него. Кроме того, системе может не хватать ресурсов. Если пользователь запускает приложение после того, как Windows завершила его работу, оно получает обратный вызов [**Application.OnActivated**](https://msdn.microsoft.com/library/windows/apps/br242330) и экран-заставка отображается вплоть до его активации. С помощью этого события можно определить, следует ли приложению восстановить данные, сохраненные им при последней приостановке, или же вам нужно загрузить данные по умолчанию. Поскольку отображается экран-заставка, код приложения может потратить на эту процедуру немного времени обработки без явной задержки для пользователя. Однако упомянутые ранее проблемы, связанные с длительными операциями, остаются в силе, если вы выполняете перезагрузку или продолжаете работу.

Среди данных события [**OnActivated**](https://msdn.microsoft.com/library/windows/apps/br242330) имеется свойство [**PreviousExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224729), которое указывает, в каком состоянии находилось приложение перед активацией. Это свойство является одним из значений перечисления [**ApplicationExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224694).

| Причина завершения                                                        | Значение свойства [**PreviousExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224729) | Предстоящее действие          |
|-------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|-------------------------|
| Завершено системой (например, из-за ограничений ресурсов)       | **Terminated**                                                                                          | Восстановить данные сеанса    |
| Закрыто пользователем или процесс завершен пользователем                             | **ClosedByUser**                                                                                        | Запустить с данными по умолчанию |
| Приложение неожиданно закрыто или не выполнялось с начала *текущего сеанса пользователя* | **NotRunning**                                                                                          | Запустить с данными по умолчанию |

 

**Примечание**
            *Текущий сеанс пользователя* основан на входе в систему Windows. Пока текущий пользователь явно не выйдет из системы, не завершит работу или не произойдет перезагрузка Windows по иным причинам, сеанс этого пользователя сохраняется для всех событий, таких как проверка подлинности на экране блокировки, переключение пользователя и т. д.

 

[
              Свойство **PreviousExecutionState**
            ](https://msdn.microsoft.com/library/windows/apps/br224729) может также иметь значение **Running** или **Suspended**, но в этих случаях ваше приложение не было завершено ранее и вам не нужно восстанавливать данные, так как все они уже находятся в памяти.

**Примечание**  

Если вы войдете в систему с учетной записью администратора, то не сможете активировать какие-либо приложения UWP.

Дополнительные сведения об этом см. в статье [Расширения приложений](https://msdn.microsoft.com/library/windows/apps/hh464906).

### **OnActivated** и особые активации

Метод [**OnActivated**](https://msdn.microsoft.com/library/windows/apps/br242330) используется для обработки всех возможных типов активации. Однако более часто используются другие методы обработки наиболее распространенных типов активации, и метод **OnActivated** используется только как резервный метод для менее распространенных типов активации. Например, класс [**Application**](https://msdn.microsoft.com/library/windows/apps/br242324) имеет метод [**OnLaunched**](https://msdn.microsoft.com/library/windows/apps/br242335), который вызывается как обратный вызов при [**ActivationKind**](https://msdn.microsoft.com/library/windows/apps/br224693) **Launch**, а это типичный способ активации для большинства приложений. Существует еще 6 методов **On\*** для конкретных активаций: [**OnCachedFileUpdaterActivated**](https://msdn.microsoft.com/library/windows/apps/hh701797), [**OnFileActivated**](https://msdn.microsoft.com/library/windows/apps/br242331), [**OnFileOpenPickerActivated**](https://msdn.microsoft.com/library/windows/apps/hh701799), [**OnFileSavePickerActivated**](https://msdn.microsoft.com/library/windows/apps/hh701801), [**OnSearchActivated**](https://msdn.microsoft.com/library/windows/apps/br242336), [**OnShareTargetActivated**](https://msdn.microsoft.com/library/windows/apps/hh701806). Начальные шаблоны для приложений XAML имеют реализацию для метода **OnLaunched** и обработчик события [**Suspending**](https://msdn.microsoft.com/library/windows/apps/br242341).

## Приостановка приложения


Система приостанавливает работу приложения всякий раз, когда пользователь переключается на другое приложение, рабочий стол или начальный экран. Она может приостановить приложение, даже если устройство перешло в режим пониженного энергопотребления. Система возобновляет работу приложения всякий раз, когда пользователь возвращается к нему. Когда система возобновляет работу приложения, содержимое переменных и структур данных остается таким же, каким оно было до приостановки приложения. Система восстанавливает работу приложения точно с места приостановки, поэтому пользователю кажется, что приложение выполнялось в фоновом режиме.

Если пользователь переводит приложение в фоновый режим, Windows ждет несколько секунд, чтобы обеспечить максимально быстрый переход, если пользователь сразу же вернется к приложению. Если пользователь не возвращается в этот период времени, Windows приостанавливает приложение.

Если требуется выполнить асинхронную работу, а приложение было приостановлено, необходимо отложить приостановку до завершения работы. Метод [**GetDeferral**](https://msdn.microsoft.com/library/windows/apps/br224690) объекта [**SuspendingOperation**](https://msdn.microsoft.com/library/windows/apps/br224688) (доступного через аргументы события) позволяет отложить приостановку до момента, когда будет вызван метод [**Complete**](https://msdn.microsoft.com/library/windows/apps/br224685) возвращенного объекта [**SuspendingDeferral**](https://msdn.microsoft.com/library/windows/apps/br224684).

Система старается сохранить приложение и его данные в памяти, если его выполнение приостановлено. Тем не менее, если системных ресурсов недостаточно для сохранения приложения в памяти, система завершает его работу. Приложения не получают никаких уведомлений о том, что их работа будет завершена. Поэтому возможность сохранить данные приложения существует только при приостановке. Когда приложение определяет, что оно было активировано после завершения работы, ему нужно загрузить данные, сохраненные в момент приостановки, чтобы перейти в состояние до приостановки. Когда пользователь снова переключается на приостановленное приложение, работа которого была завершена, приложению необходимо восстановить свои данные в методе [**OnLaunched**](https://msdn.microsoft.com/library/windows/apps/br242335). Система не уведомляет приложение о завершении его работы, поэтому в случае приостановки оно должно сохранять свои данные и освобождать монопольные ресурсы и дескрипторы файлов, а затем восстанавливать их во время активации после завершения работы.

Если приложение зарегистрировало обработчик событий для события [**Application.Suspending**](https://msdn.microsoft.com/library/windows/apps/br242341), то этот код вызывается сразу же перед приостановкой приложения. Вы можете использовать обработчик событий для сохранения данных приложения и пользователя. Мы рекомендуем использовать с этой целью интерфейсы API данных приложения, так как они гарантированно завершают работу до входа приложения в состояние **Suspended**. Подробнее: [Хранение и извлечение параметров и прочих данных приложения](https://msdn.microsoft.com/library/windows/apps/mt299098).

Вам также нужно освободить монопольные ресурсы и дескрипторы файлов, чтобы другие приложения могли получать к ним доступ, пока ваше приложение их не использует. Примеры монопольных ресурсов включают камеры, устройства ввода-вывода, внешние устройства и сетевые ресурсы. Явное освобождение монопольных ресурсов и дескрипторов файлов обеспечивает доступ к ним других приложений, пока ваше приложение их не использует. Приложение, активируемое после завершения работы, должно повторно открывать свои монопольные ресурсы и дескрипторы файлов.

Как правило, приложение должно сохранять свое состояние и освобождать монопольные ресурсы и дескрипторы файлов сразу же при обработке события приостановки. Выполнение кода при этом должно занимать не более одной секунды. Если за эти несколько секунд приложение не возвращается из состояния приостановки, Windows считает, что приложение не отвечает и принудительно завершает его.

В некоторых случаях приложение должно продолжать работу для завершения фоновых задач. Например, ваше приложение может продолжать воспроизводить звук в фоновом режиме. Дополнительные сведения об этом см. в статье [Воспроизведение звука в фоновом режиме](https://msdn.microsoft.com/library/windows/apps/mt282140). Фоновые операции переноса также продолжают выполняться, когда приложение приостановлено или даже завершено. Дополнительные сведения об этом см. в статье [Как скачать файл](https://msdn.microsoft.com/en-us/library/windows/apps/xaml/jj152726.aspx#downloading_a_file_using_background_transfer).

Рекомендации см. в [руководстве по приостановке и возобновлению работы приложения](https://msdn.microsoft.com/library/windows/apps/hh465088).

**Замечание об отладке с использованием Microsoft Visual Studio:** с помощью Visual Studio можно предотвратить приостановку системой Windows работы программы, подключенной к отладчику. Это позволяет пользователю видеть пользовательский интерфейс отладчика Visual Studio во время выполнения приложения. При отладке программы с помощью Visual Studio вы можете отправить ей событие приостановки. Убедитесь, что отображается панель инструментов **Место отладки**, а затем щелкните значок **Приостановить**.

## Видимость приложений


Когда пользователь переходит от вашего приложения к другому, ваше приложение больше не отображается, но остается в состоянии **Running**, до тех пор пока Windows его не приостановит. Если пользователь переключается с окна приложения на что-то другое, но возвращается в него до того, как работа приложения может быть приостановлена, приложение остается в состоянии **Running**.

Ваше приложение не получает событие активации, когда изменяется его видимость, поскольку приложение все еще выполняется. Windows просто переключается с одного приложения на другое по мере необходимости. Если приложению нужно выполнить какое-либо действие, когда пользователь выходит из него и возвращается обратно, используется событие [**Window.VisibilityChanged**](https://msdn.microsoft.com/library/windows/apps/hh702458).

Не полагайтесь на точный порядок этих событий.

## Возобновление работы приложения


Работа приостановленного приложения возобновляется, когда пользователь переключается на него или если оно активно во время выхода устройства из состояния пониженного энергопотребления.

Перечисление состояний, в которых может находиться ваше приложение в случае возобновления работы, см. в статье [**ApplicationExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224694). Когда работа приложения возобновляется из состояния **Suspended**, оно переходит в состояние **Running** и продолжает работу с момента приостановки. При этом данные приложения, которые сохранены в памяти, не будут потеряны. Следовательно, большинству приложений не требуется выполнять никаких действий при возобновлении. Однако приложение может оставаться в состоянии приостановки несколько часов или даже несколько дней. Если ваше приложение работает с содержимым или сетевыми подключениями, которые могут устареть за это время, оно должно обновить их после возобновления работы. Если приложение зарегистрировало обработчик события [**Application.Resuming**](https://msdn.microsoft.com/library/windows/apps/br242339), то он будет вызываться при возобновлении работы приложения после выхода из состояния **Suspended**. С помощью этого обработчика событий вы можете обновлять содержимое и данные приложения.

Если приостановленное приложение активировано для участия в контракте приложений или расширении, оно получает сначала событие **Resuming**, а затем — событие **Activated**.

Когда приложение приостановлено, оно не получает никаких сетевых событий, для получения которых зарегистрировано. Эти сетевые события не добавляются в очередь, а просто пропускаются. Поэтому при возобновлении работы ваше приложение должно проверять состояние сети.

**Примечание**  Так как событие [**Resuming**](https://msdn.microsoft.com/library/windows/apps/br242339) не вызывается из потока пользовательского интерфейса, необходимо использовать диспетчер, если код в обработчике возобновления взаимодействует с пользовательским интерфейсом.

 

Рекомендации см. в [руководстве по приостановке и возобновлению работы приложения](https://msdn.microsoft.com/library/windows/apps/hh465088).

## Закрытие приложений


Обычно пользователям не нужно закрывать приложения. Они могут разрешить Windows управлять ими. Но пользователь может закрыть приложение с помощью соответствующего жеста, нажав клавиши ALT+F4 в Windows или воспользовавшись диспетчером задач в Windows Phone.

Не существует какого-либо особого события, указывающего на то, что пользователь закрыл приложение.

После подобного закрытия приложение вначале приостанавливается, а затем завершается, переходя в состояние **NotRunning**.

В Windows 8.1 и более поздних версиях, если пользователь закрыл приложение, оно просто удаляется с экрана и из списка переключения, но его работа не завершается явным образом.

Если приложение зарегистрировало обработчик события **Suspending**, то он вызывается во время приостановки приложения. Этот обработчик событий можно использовать для сохранения необходимых данных приложения и пользователя в постоянном хранилище.

**Поведение при закрытии пользователем. **Если требуется, чтобы приложение вело себя по-разному при закрытии пользователем и Windows, то для определения инициатора закрытия вы можете использовать обработчик событий активации. Описания состояний **ClosedByUser** и **Terminated** приведены в справочных документах по перечислению [**ApplicationExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224694).

Мы не рекомендуем закрывать приложение программными методами, если в этом нет серьезной необходимости. Например, если приложение обнаруживает утечку памяти, оно может закрыться самостоятельно, чтобы обеспечить защиту персональных данных пользователя. Если приложение закрывается программным методом, система воспринимает это как сбой приложения.

## Сбой приложения


Взаимодействие при сбое системы организовано таким образом, чтобы пользователи могли вернуться к выполняемым действиям как можно скорее. Вам не нужно показывать диалоговое окно с предупреждением или иное уведомление, поскольку это вызовет задержку в работе пользователя.

Если приложение дает сбой, перестает отвечать или создает исключение, в Microsoft отправляется отчет о проблеме в соответствии с [параметрами отзывов и диагностики](http://go.microsoft.com/fwlink/p/?LinkID=614828) пользователя. Microsoft включает набор данных об ошибке в предоставляемый отчет о проблеме, что позволяет вам улучшить приложение. Эти данные можно просмотреть на странице «Качество» вашего приложения, расположенной на информационной панели.

Когда пользователь активирует приложение после сбоя, его обработчик событий активации получает параметр [**ApplicationExecutionState**](https://msdn.microsoft.com/library/windows/apps/br224694) со значением **NotRunning** и должен просто отобразить его начальный пользовательский интерфейс и данные. После сбоя не используйте данные приложения, которые вы бы использовали для события **Resuming** из состояния **Suspended**, поскольку эти данные могут быть повреждены; см. раздел [Рекомендации по приостановке и возобновлению приложений](https://msdn.microsoft.com/library/windows/apps/hh465088).

## Удаление приложения


Когда пользователь удаляет приложение, вместе с ним удаляются все локальные данные этого приложения. При удалении приложения не затрагиваются данные пользователей, сохраненные в стандартных расположениях, таких как файлы в библиотеках "Документы" или "Изображения".

## Жизненный цикл приложения и шаблоны проектов Visual Studio


Базовый код, который соответствует жизненному циклу приложения, содержится в начальных шаблонах проектов Visual Studio. Базовое приложение обрабатывает активацию запуска, предоставляет место для восстановления данных приложения и отображает основной пользовательский интерфейс еще до того как, вы добавите собственный код. Дополнительные сведения можно найти в статье [Шаблоны проектов на C#, VB и C++ для приложений](https://msdn.microsoft.com/library/windows/apps/hh768232).

## Основные API жизненного цикла приложения


-   [
              Пространство имен **Windows.ApplicationModel**
            ](https://msdn.microsoft.com/library/windows/apps/br224691)
-   [
              Пространство имен **Windows.ApplicationModel.Activation**
            ](https://msdn.microsoft.com/library/windows/apps/br224766)
-   [
              Пространство имен **Windows.ApplicationModel.Core**
            ](https://msdn.microsoft.com/library/windows/apps/br205865)
-   [
              Класс **Windows.UI.Xaml.Application**
            ](https://msdn.microsoft.com/library/windows/apps/br242324) (XAML)
-   [
              Класс **Windows.UI.Xaml.Window**
            ](https://msdn.microsoft.com/library/windows/apps/br209041) (XAML)

**Примечание.**  
Эта статья адресована разработчикам приложений для Windows 10 на базе универсальной платформы Windows (UWP). В случае разработки приложений для Windows 8.x или Windows Phone 8.x см. раздел [архивной документации](http://go.microsoft.com/fwlink/p/?linkid=619132).

 

## Связанные темы


* [Руководство по приостановке и возобновлению работы приложения](https://msdn.microsoft.com/library/windows/apps/hh465088)
* [Обработка предварительного запуска приложения](handle-app-prelaunch.md)
* [Обработка активации приложения](activate-an-app.md)
* [Обработка приостановки работы приложения](suspend-an-app.md)
* [Обработка возобновления работы приложения](resume-an-app.md)

 

 



<!--HONumber=Jun16_HO5-->


