---
author: TylerMSFT
title: "Обработка активации файла"
description: "Приложение можно зарегистрировать в качестве стандартного обработчика определенного типа файлов."
ms.assetid: A0F914C5-62BC-4FF7-9236-E34C5277C363
ms.author: twhitney
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows 10, uwp
ms.openlocfilehash: e05cc939d4a836e2f385a20f63d6ffb2242696db
ms.sourcegitcommit: 7f03e200ef34f7f24b6f8b6489ecb44aa2b870bc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/01/2017
---
# <a name="handle-file-activation"></a>Обработка активации файла


\[ Обновлено для приложений UWP в Windows10. Статьи о Windows 8.x см. в [архиве](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


**Важные API**

-   [**Windows.ApplicationModel.Activation.FileActivatedEventArgs**](https://msdn.microsoft.com/library/windows/apps/br224716)
-   [**Windows.UI.Xaml.Application.OnFileActivated**](https://msdn.microsoft.com/library/windows/apps/br242331)

Приложение можно зарегистрировать в качестве стандартного обработчика определенного типа файлов. Это касается как классических приложений для Windows, так и приложений универсальной платформы Windows (UWP). Если пользователь выбирает ваше приложение в качестве стандартного обработчика для какого-либо типа файлов, оно будет активироваться при запуске файлов этого типа.

Мы рекомендуем регистрировать приложение в качестве обработчика по умолчанию для файлов определенного типа, только если планируется обрабатывать все запуски файлов этого типа. Если файлы данного типа будут использоваться только внутри приложения, нет необходимости регистрировать его в качестве обработчика по умолчанию. Если вы все-таки решите зарегистрировать тип файла, необходимо предоставить пользователю функциональность, ожидаемую при активации вашего приложения для файлов этого типа. Например, приложение для просмотра изображений может быть зарегистрировано для отображения JPG-файлов. Подробнее о сопоставлениях файлов: [Руководство по типам файлов и URI](https://msdn.microsoft.com/library/windows/apps/hh700321).

Далее показано, как зарегистрировать собственный тип файлов (.alsdk) и как активировать приложение при запуске ALSDK-файла пользователем.

> **Примечание.** В приложениях UWP определенные URI и расширения файлов зарезервированы для использования во встроенных приложениях и операционной системе. Попытки регистрации приложения с зарезервированным URI или расширением файла будут проигнорированы. Дополнительные сведения об этом см. в статье [Зарезервированные файлы и имена схем URI](reserved-uri-scheme-names.md).

## <a name="step-1-specify-the-extension-point-in-the-package-manifest"></a>Шаг 1. Указание точки расширения в манифесте пакета


Приложение принимает события активации только для расширений файлов, указанных в манифесте пакета. Указать, что ваше приложение обрабатывает файлы с расширением `.alsdk`, можно следующим образом:

1.  В **обозревателе решений** дважды щелкните файл package.appxmanifest, чтобы открыть конструктор манифеста. Перейдите на вкладку **Объявления** и в раскрывающемся списке **Доступные объявления** выберите **Сопоставление типов файлов** и нажмите кнопку **Добавить**. Дополнительные сведения об идентификаторах, используемых в сопоставлениях файлов, см. в разделе о [программных идентификаторах](https://msdn.microsoft.com/library/windows/desktop/cc144152).

    Далее приведено краткое описание каждого из полей, которые можно заполнить в конструкторе манифеста:

| Поле | Описание |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Отображаемое имя** | Укажите отображаемое имя для группы типов файлов. Это отображаемое имя используется для определения типа файла в разделе [Выбор программ по умолчанию](https://msdn.microsoft.com/library/windows/desktop/cc144154) на **панели управления**. |
| **Логотип** | Укажите логотип, по которому можно будет определить тип файла на рабочем столе и в разделе [Выбор программ по умолчанию](https://msdn.microsoft.com/library/windows/desktop/cc144154) на **панели управления**. Если логотип не указан, используется мелкий логотип приложения. |
| **Подсказка** | Укажите [подсказку](https://msdn.microsoft.com/library/windows/desktop/cc144152) для группы типов файлов. Эта подсказка отображается, когда пользователь наводит указатель мыши на значок файла этого типа. |
| **Имя** | Выберите имя для группы типов файлов, которые имеют общие отображаемое имя, логотип, подсказку и флаги редактирования. Выберите для группы такое имя, которое будет сохраняться неизменным при обновлении приложения. **Примечание.** Все буквы имени должны быть строчными. |
| **Тип содержимого** | Укажите тип содержимого MIME, например **image/jpeg**, для определенного типа файла. **Важное примечание о допустимых типах содержимого!** Далее приводится список типов содержимого MIME в алфавитном порядке, которые запрещено вводить в манифест пакета, поскольку они либо зарезервированы, либо запрещены: **application/force-download**, **application/octet-stream**, **application/unknown**, **application/x-msdownload**. |
| **Тип файла** | Укажите тип файла для регистрации с точкой в начале имени, например ".jpeg". **Зарезервированные и запрещенные типы файлов.** Алфавитный список типов файлов для встроенных приложений, которые нельзя зарегистрировать для приложений UWP, поскольку они уже зарегистрированы или запрещены, см. в статье [Зарезервированные имена схем URI и типы файлов](reserved-uri-scheme-names.md). |

2.  Введите `alsdk` в поле **Имя**.
3.  Введите `.alsdk` в поле **Тип файла**.
4.  Введите "images\\Icon.png" в поле "Логотип".
5.  Нажмите клавиши CTRL+S, чтобы сохранить изменения в файле package.appxmanifest.

Шаги выше добавляют в манифест пакета элемент [**Extension**](https://msdn.microsoft.com/library/windows/apps/br211400) указанного типа. Категория **windows.fileTypeAssociation** указывает, что приложение обрабатывает файлы с расширением `.alsdk`.

```xml
      <Extensions>
        <uap:Extension Category="windows.fileTypeAssociation">
          <uap:FileTypeAssociation Name="alsdk">
            <uap:Logo>images\icon.png</uap:Logo>
            <uap:SupportedFileTypes>
              <uap:FileType>.alsdk</uap:FileType>
            </uap:SupportedFileTypes>
          </uap:FileTypeAssociation>
        </uap:Extension>
      </Extensions>
```

## <a name="step-2-add-the-proper-icons"></a>Шаг 2. Добавление подходящих значков


Значки приложений, используемых по умолчанию для того или иного типа файла, отображаются в различных частях системы. Например, эти значки можно увидеть:

-   в представлении просмотра элементов, в контекстных меню и на ленте проводника;
-   на панели управления в разделе программ по умолчанию;
-   в средстве выбора файлов;
-   в результатах поиска на начальном экране.

Добавьте в проект значок размером 44 x 44, чтобы ваш логотип отображался в этих расположениях. Вместо того чтобы делать фон значка прозрачным, используйте для логотипа на плитке приложения цвет, который совпадает с цветом фона самого приложения. Растяните логотип до краев, не заполняя плитку. Проверьте, как выглядят значки на белом фоне. Дополнительные сведения о значках см. в разделе [Руководство по работе с ресурсами плиток и значков](https://docs.microsoft.com/windows/uwp/controls-and-patterns/tiles-and-notifications-app-assets).

## <a name="step-3-handle-the-activated-event"></a>Шаг 3. Обработка события активации


Обработчик событий [**OnFileActivated**](https://msdn.microsoft.com/library/windows/apps/br242331) принимает все события активации файлов.

> [!div class="tabbedCodeSnippets"]
```vb
Protected Overrides Sub OnFileActivated(ByVal args As Windows.ApplicationModel.Activation.FileActivatedEventArgs)
      ' TODO: Handle file activation
      ' The number of files received is args.Files.Size
      ' The name of the first file is args.Files(0).Name
End Sub
```
```cpp
void App::OnFileActivated(Windows::ApplicationModel::Activation::FileActivatedEventArgs^ args)
{
       // TODO: Handle file activation
       // The number of files received is args->Files->Size
       // The first file is args->Files->GetAt(0)->Name
}
```
```cs
protected override void OnFileActivated(FileActivatedEventArgs args)
{
       // TODO: Handle file activation
       // The number of files received is args.Files.Size
       // The name of the first file is args.Files[0].Name
}
```

    > **Note**  When launched via File Contract, make sure that Back button takes the user back to the screen that launched the app and not to the app's previous content.

Рекомендуется, чтобы приложения создавали новый элемент XAML Frame для каждого события активации, открывающего новую страницу. Тогда стек переходов назад для нового фрейма XAML не будет включать предыдущее содержимое, которое могло отображаться в текущем окне во время приостановки приложения. Приложения, использующие один элемент XAML Frame для контрактов файла и запуска, должны очищать страницы в журнале навигации "Frame" перед переходом на новую страницу.

При запуске через активацию файла в приложении должен быть предусмотрен пользовательский интерфейс, при помощи которого можно вернуться на начальную страницу приложения.

## <a name="remarks"></a>Примечания


Принимаемые вами файлы могут поступать из ненадежного источника. Мы рекомендуем проверять содержимое файла перед тем, как выполнять с ним какие-либо действия. Подробнее о проверке ввода см. в книге [Написание безопасного кода](http://go.microsoft.com/fwlink/p/?LinkID=142053).

> **Примечание.** Эта статья адресована разработчикам приложений для Windows 10 на базе универсальной платформы Windows (UWP). В случае разработки приложений для Windows 8.x или Windows Phone 8.x см. раздел [архивной документации](http://go.microsoft.com/fwlink/p/?linkid=619132).

 

## <a name="related-topics"></a>Связанные разделы

**Полный пример**

* [Пример запуска с сопоставлением](http://go.microsoft.com/fwlink/p/?LinkID=231484)

**Понятия**

* [Программы по умолчанию](https://msdn.microsoft.com/library/windows/desktop/cc144154)
* [Модель сопоставления типов файлов и протоколов](https://msdn.microsoft.com/library/windows/desktop/hh848047)

**Задачи**

* [Запуск приложения по умолчанию для файла](launch-the-default-app-for-a-file.md)
* [Обработка активации URI](handle-uri-activation.md)

**Руководства**

* [Руководство по типам файлов и URI](https://msdn.microsoft.com/library/windows/apps/hh700321)

**Ссылки**
* [**Windows.ApplicationModel.Activation.FileActivatedEventArgs**](https://msdn.microsoft.com/library/windows/apps/br224716)
* [**Windows.UI.Xaml.Application.OnFileActivated**](https://msdn.microsoft.com/library/windows/apps/br242331)

 

 
