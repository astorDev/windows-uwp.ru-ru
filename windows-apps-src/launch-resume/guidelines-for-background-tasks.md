---
author: TylerMSFT
title: "Руководство по работе с фоновыми задачами"
description: "Убедитесь, что ваше приложение отвечает требованиям, необходимым для выполнения фоновых задач."
ms.assetid: 18FF1104-1F73-47E1-9C7B-E2AA036C18ED
ms.author: twhitney
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: windows 10, uwp
ms.openlocfilehash: c9bf682e6818f7c9854604448e52aa0111605a05
ms.sourcegitcommit: 909d859a0f11981a8d1beac0da35f779786a6889
translationtype: HT
---
# <a name="guidelines-for-background-tasks"></a>Руководство по работе с фоновыми задачами

\[ Обновлено для приложений UWP в Windows10. Статьи, касающиеся Windows 8.x, см. в разделе [Архив](http://go.microsoft.com/fwlink/p/?linkid=619132) \]

Убедитесь, что ваше приложение отвечает требованиям, необходимым для выполнения фоновых задач.

## <a name="background-task-guidance"></a>Руководство по фоновым задачам

Рекомендуем использовать следующее руководство при разработке фоновой задачи и перед публикацией вашего приложения.

Если фоновая задача используется для воспроизведения мультимедиа в фоновом режиме, см. раздел [Воспроизведение мультимедиа в фоновом режиме](https://msdn.microsoft.com/windows/uwp/audio-video-camera/background-audio), где приведены сведения об улучшениях в Windows 10 версии 1607, которые значительно упрощают работу.

**Фоновые задачи, выполняемые внутри или вне процесса:** в Windows 10 версии 1607 появились [фоновые задачи, выполняемые внутри процесса](create-and-register-an-inproc-background-task.md), которые позволяют выполнять фоновый код в том же процессе, что и основное приложение. При выборе фоновых задач внутри или вне процесса необходимо учитывать следующие факторы:

|Параметр | Влияние |
|--------------|--------|
|Устойчивость   | Если фоновый процесс выполняется в другом процессе, сбой в фоновом процессе не повлияет на работу приложения переднего плана. Кроме того, фоновую операцию можно завершить (даже из приложения), если время ее выполнения выходит за заданные пределы. Выделение фоновой работы в задачу, отдельную от приложения переднего плана, может быть лучшим выбором, когда не требуется обмениваться данными между процессом переднего плана и фоновым процессом (поскольку отсутствие необходимости во взаимодействии между процессами является одним из основных преимуществ фоновых задач, выполняющихся внутри процесса). |
|Простота    | Фоновые задачи, выполняющиеся внутри процесса, не требуют взаимодействия между процессами и проще в разработке.  |
|Доступные триггеры | Фоновые задачи внутри процесса не поддерживают следующие триггеры: [DeviceUseTrigger](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.deviceusetrigger.aspx?f=255&MSPPError=-2147217396), [DeviceServicingTrigger](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.deviceservicingtrigger.aspx) и **IoTStartupTask**. |
|VoIP | Фоновые задачи внутри процесса не поддерживают активации фоновой задачи VoIP в приложении. |  

**Квоты ЦП:** фоновые задачи ограничены физическим временем использования, которое они получают в зависимости от типа триггера. Большинство триггеров ограничены 30 секундами использования, хотя некоторые могут выполняться до 10 минут для завершения сложных задач. Фоновые задачи должны быть облегченными, чтобы экономить время работы батареи и обеспечивать удобную работу с приложениями переднего плана. Сведения об ограничениях ресурсов для фоновых задач см. в статье [Поддержка приложения с помощью фоновых задач](support-your-app-with-background-tasks.md).

**Управление фоновыми задачами:** ваше приложение должно получать список зарегистрированных фоновых задач, регистрировать обработчики выполнения и завершения и обрабатывать эти события соответствующим образом. Классы фоновой задачи должны сообщать о выполнении, отмене и завершении. Подробнее об этом см. в статьях [Обработка отмененной фоновой задачи](handle-a-cancelled-background-task.md) и [Отслеживание хода выполнения и завершения фоновых задач](monitor-background-task-progress-and-completion.md).

**Использование [BackgroundTaskDeferral](https://msdn.microsoft.com/library/windows/apps/hh700499):** если класс вашей фоновой задачи выполняет асинхронный код, обязательно используйте отсрочки. В противном случае фоновая задача может быть преждевременно прервана, когда метод [Run](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.ibackgroundtask.run.aspx) (или метод [OnBackgroundActivated](https://msdn.microsoft.com/library/windows/apps/windows.ui.xaml.application.onbackgroundactivated.aspx) в случае фоновых задач внутри процесса). Дополнительные сведения см. в разделе [Создание и регистрация фоновой задачи вне процесса](create-and-register-a-background-task.md).

Можно также запросить одну отсрочку и использовать **async/await**, чтобы завершить асинхронные вызовы метода. Закройте отсрочку после вызовов метода **await**.

**Обновление манифеста приложения:** для фоновых задач, которые выполняются вне процесса, объявите каждую фоновую задачу в манифесте приложения вместе с типом триггеров, который используется с этой задачей. В противном случае ваше приложение не сможет зарегистрировать фоновую задачу во время выполнения.

Фоновые задачи, которые выполняются в том же процессе, что и приложение переднего плана, не требуется объявлять в манифесте приложения. Дополнительные сведения об объявлении в манифесте фоновых задач, которые выполняются вне процесса, см. в разделе [Объявление фоновых задач в манифесте приложения](declare-background-tasks-in-the-application-manifest.md).

**Подготовка к обновлениям приложений:** если ваше приложение будет обновляться, создайте и зарегистрируйте фоновую задачу **ServicingComplete** (см. [SystemTriggerType](https://msdn.microsoft.com/library/windows/apps/br224839)), чтобы отменить регистрацию фоновых задач для предыдущей версии приложения и зарегистрировать фоновые задачи для новой версии. Это также подходящий момент для выполнения обновлений приложения, которые могут быть необходимы вне контекста выполнения на переднем плане.

**Запрос на выполнение фоновых задач:**

> **Важно!** Начиная с Windows 10, для выполнения фоновых задач не требуется, чтобы приложение обязательно располагалось на экране блокировки.

Приложения универсальной платформы Windows (UWP) могут выполнять все поддерживаемые типы задач без закрепления на экране блокировки. Но приложения должны вызвать метод [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) перед регистрацией фоновой задачи любого типа. Этот метод возвратит [**BackgroundAccessStatus.Denied**](https://msdn.microsoft.com/library/windows/apps/hh700439), если пользователь в параметрах устройствах явно запретил разрешения на выполнение фоновых задач для вашего приложения.
## <a name="background-task-checklist"></a>Контрольный список для фоновых задач

*Относится к фоновым задачам, которые выполняются как внутри, так и вне процесса*

-   Сопоставьте вашу фоновую задачу с правильным триггером.
-   Добавьте условия, которые поспособствуют успешному выполнению вашей фоновой задачи.
-   Обработайте выполнение, завершение и отмену фоновой задачи.
-   Повторно зарегистрируйте свои фоновые задачи во время запуска приложения. Это гарантирует их регистрацию во время первого запуска. Это позволяет узнать, отключил ли пользователь возможности фонового выполнения приложения (в случае сбоя регистрации).
-   Проверьте наличие ошибок регистрации фоновых задач. При необходимости попытайтесь зарегистрировать фоновую задачу снова с другими значениями параметров.
-   Если устройству не хватает памяти, фоновые задачи могут быть завершены для всех семейств устройств (за исключением настольных компьютеров). Если исключение "Недостаточно памяти" не отображается или приложение не обрабатывает его, то фоновая задача будет завершена без предупреждения и без вызова события OnCanceled. Это позволяет не прерывать работу пользователя с активным приложением. Ваша фоновая задача должна поддерживать этот сценарий.

*Относится только к фоновым задачам вне процесса*

-   Создайте свою фоновую задачу в компоненте среды выполнения Windows.
-   Не отображайте никакие элементы пользовательского интерфейса, кроме уведомлений, плиток и обновлений индикаторов событий из кода фоновой задачи.
-   В методе [Run](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.ibackgroundtask.run.aspx) запросите отсрочки для каждого асинхронного вызова метода и закройте их после завершения метода. Можно также использовать одну отсрочку вместе с **async/await**.
-   Используйте постоянное хранилище для совместного использования данных фоновой задачей и приложением.
-   Объявите каждую фоновую задачу в манифесте приложения вместе с типом триггеров, если он используется с задачей. Убедитесь, что точка входа и типы триггеров указаны правильно.
-   Не указывайте в манифесте элемент Executable за исключением случая, когда используется триггер, который должен выполняться в одном контексте с приложением (например, [**ControlChannelTrigger**](https://msdn.microsoft.com/library/windows/apps/hh701032)).

*Относится только к фоновым задачам внутри процесса*

- При отмене задачи убедитесь, что существует обработчик события `BackgroundActivated`; в противном случае будет прервано выполнение всего процесса.
-   Пишите кратковременные фоновые задачи. Фоновые задачи ограничены 30 секундами физического времени.
-   Не используйте взаимодействие с пользователем в фоновых задачах.

## <a name="windows-background-task-checklist-for-lock-screen-capable-apps"></a>Windows: контрольный список для фоновых задач для приложений, поддерживающих экран блокировки

Следуйте этим рекомендациям при разработке фоновых задач для приложений, которые могут размещаться на экране блокировки. Следуйте рекомендациям в статье [Руководство и контрольный список для плиток на экране блокировки](https://msdn.microsoft.com/library/windows/apps/hh465403).

-   Убедитесь, что ваше приложение должно размещаться на экране блокировки, прежде чем разрабатывать его как приложение, поддерживающее экран блокировки. Подробнее см. в статье [Общие сведения об экране блокировки](https://msdn.microsoft.com/library/windows/apps/hh779720).

-   Убедитесь, что ваше приложение будет работать, если оно не будет размещено на экране блокировки.

-   Включите фоновую задачу, зарегистрированную с помощью [**PushNotificationTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700543), [**ControlChannelTrigger**](https://msdn.microsoft.com/library/windows/apps/hh701032) или [**TimeTrigger**](https://msdn.microsoft.com/library/windows/apps/br224843), и объявите ее в манифесте приложения. Убедитесь, что точка входа и типы триггеров указаны правильно. Это необходимо для сертификации и позволяет пользователю разместить приложение на экране блокировки.

**Примечание.**  
Эта статья адресована разработчикам приложений для Windows10 на базе универсальной платформы Windows (UWP). В случае разработки приложений для Windows 8.x или Windows Phone 8.x см. раздел [архивной документации](http://go.microsoft.com/fwlink/p/?linkid=619132).

## <a name="related-topics"></a>Статьи по теме

* [Создание и регистрация внутрипроцессной фоновой задачи](create-and-register-an-inproc-background-task.md)
* [Создание и регистрация внепроцессной фоновой задачи](create-and-register-a-background-task.md)
* [Объявление фоновых задач в манифесте приложения](declare-background-tasks-in-the-application-manifest.md)
* [Воспроизведение мультимедиа в фоновом режиме](https://msdn.microsoft.com/windows/uwp/audio-video-camera/background-audio)
* [Обработка отмененной фоновой задачи](handle-a-cancelled-background-task.md)
* [Отслеживание хода выполнения и завершения фоновых задач](monitor-background-task-progress-and-completion.md)
* [Регистрация фоновой задачи](register-a-background-task.md)
* [Реагирование на системные события с помощью фоновых задач](respond-to-system-events-with-background-tasks.md)
* [Задание условий выполнения фоновой задачи](set-conditions-for-running-a-background-task.md)
* [Обновление живой плитки из фоновой задачи](update-a-live-tile-from-a-background-task.md)
* [Использование триггера обслуживания](use-a-maintenance-trigger.md)
* [Запуск фоновой задачи по таймеру](run-a-background-task-on-a-timer-.md)
* [Отладка фоновой задачи](debug-a-background-task.md)
* [Вызов событий приостановки, возобновления и фоновых событий в приложениях Магазина Windows (во время отладки)](http://go.microsoft.com/fwlink/p/?linkid=254345)

 

 
