---
author: mcleblanc
title: Поддержка приложения с помощью фоновых задач
description: В этом разделе показано, как выполнить собственный облегченный код в фоновом режиме, отвечая на триггеры с помощью фоновых задач.
ms.assetid: EFF7CBFB-D309-4ACB-A2A5-28E19D447E32
---

# Поддержка приложения с помощью фоновых задач


\[ Обновлено для приложений UWP в Windows 10. Статьи о Windows 8.x см. в [архиве](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


В этом разделе показано, как выполнить собственный облегченный код в фоновом режиме, отвечая на триггеры с помощью фоновых задач. Фоновые задачи представляют собой облегченные классы, которые выполняются ОС в фоновом режиме. Фоновые задачи можно использовать для предоставления функциональных возможностей, когда приложение приостановлено или не выполняется. Фоновые задачи также можно использовать для приложений, обеспечивающих общение в реальном времени, например компьютерной телефонии, почты и обмена мгновенными сообщениями.

Фоновые задачи — это отдельные классы, реализующие интерфейс [**IBackgroundTask**](https://msdn.microsoft.com/library/windows/apps/br224794). Вы регистрируете фоновую задачу с помощью класса [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768). Имя класса используется для указания точки входа при регистрации фоновой задачи.

Сведения о создании фоновых задач см. в разделе [Создание и регистрация фоновой задачи](create-and-register-a-background-task.md).

**Совет**. Начиная c Windows 10, больше не нужно помещать приложение на экран блокировки, чтобы регистрировать фоновые задачи.

 

## Фоновые задачи для системных событий


Ваше приложение может отвечать на события, создаваемые системой, регистрируя фоновую задачу с помощью класса [**SystemTrigger**](https://msdn.microsoft.com/library/windows/apps/br224838). Оно может использовать любые из нижеперечисленных триггеров системных событий (определенных в [**SystemTriggerType**](https://msdn.microsoft.com/library/windows/apps/br224839)).

| Имя триггера                     | Описание                                                                                                    |
|----------------------------------|----------------------------------------------------------------------------------------------------------------|
| **InternetAvailable**            | Появляется доступ к Интернету.                                                                                |
| **NetworkStateChange**           | Происходит изменение сети, такое как изменение стоимости или подключения.                                              |
| **OnlineIdConnectedStateChange** | ИД интернет-службы, связанный с изменением учетной записи.                                                                 |
| **SmsReceived**                  | Установленным устройством с высокоскоростным мобильным подключением получено новое SMS-сообщение.                                         |
| **TimeZoneChange**               | В устройстве изменяется часовой пояс (например, когда система переводит часы на летнее время). |

 

Подробнее см. в разделе [Реагирование на системные события с помощью фоновых задач](respond-to-system-events-with-background-tasks.md).

## Условия для фоновых задач


Добавив условие, вы сможете контролировать выполнение фоновой задачи даже после ее запуска. При активации фоновая задача не будет выполняться, пока не будут соблюдены все условия. Можно использовать следующие условия (представленные перечислением [**SystemConditionType**](https://msdn.microsoft.com/library/windows/apps/br224835)).

| Имя условия           | Описание                       |
|--------------------------|-----------------------------------|
| **InternetAvailable**    | Интернет должен быть доступен.   |
| **InternetNotAvailable** | Интернет должен быть недоступен. |
| **SessionConnected**     | Сеанс должен быть подключен.    |
| **SessionDisconnected**  | Сеанс должен быть отключен. |
| **UserNotPresent**       | Пользователь должен отсутствовать.            |
| **UserPresent**          | Пользователь должен присутствовать.         |

 

Подробнее см. в разделе [Задание условий для выполнения фоновой задачи](set-conditions-for-running-a-background-task.md).

## Требования к манифесту приложения


Перед тем как приложение сможет успешно зарегистрировать фоновую задачу, оно должно быть объявлено в манифесте приложения. Подробнее см. в разделе [Объявление фоновых задач в манифесте приложения](declare-background-tasks-in-the-application-manifest.md).

## Фоновые задачи


Следующие триггеры реального времени можно использовать для выполнения облегченного пользовательского кода в фоновом режиме.

**Control Channel: **фоновые задачи могут поддерживать подключение и получать сообщения по каналу управления, используя класс [**ControlChannelTrigger**](https://msdn.microsoft.com/library/windows/apps/hh701032). Если приложение ожидает передачи данных из сокета, можно использовать посредник сокетов вместо **ControlChannelTrigger**. Узнать больше об использовании посредника сокетов можно в разделе [SocketActivityTrigger](https://msdn.microsoft.com/library/windows/apps/dn806009). **ControlChannelTrigger** не поддерживается в Windows Phone.

**Timer: **фоновые задачи могут выполняться через каждые 15 минут, и их можно настроить на выполнение в определенное время, используя [**TimeTrigger**](https://msdn.microsoft.com/library/windows/apps/br224843). Подробнее см. в разделе [Запуск фоновой задачи по таймеру](run-a-background-task-on-a-timer-.md).

**Push Notification: **фоновые задачи реагируют на [**PushNotificationTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700543), чтобы получать необработанные push-уведомления.

**Примечание.**  

Универсальные приложения для Windows должны вызвать [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) перед регистрацией любых типов фоновых триггеров.

Чтобы универсальное приложение для Windows продолжало правильно работать после выпуска обновления, необходимо вызвать метод [**RemoveAccess**](https://msdn.microsoft.com/library/windows/apps/hh700471), а затем — метод [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485) при запуске приложения после обновления. Подробнее см. в разделе [Руководство по фоновым задачам](guidelines-for-background-tasks.md).

## Триггеры системных событий


> **Примечание**. Перечисление [**SystemTriggerType**](https://msdn.microsoft.com/library/windows/apps/br224839) содержит следующие триггеры системных событий.

| Имя триггера            | Описание                                                       |
|-------------------------|-------------------------------------------------------------------|
| **UserPresent**         | Фоновая задача запускается в присутствии пользователя.   |
| **UserAway**            | Фоновая задача запускается в отсутствие пользователя.    |
| **ControlChannelReset** | Фоновая задача запускается при сбросе канала управления. |
| **SessionConnected**    | Фоновая задача запускается при подключенном сеансе.   |

 

Следующие триггеры системных событий позволяют узнать, поместил ли пользователь приложение на экран блокировки или убрал с него.

| Имя триггера                     | Описание                                  |
|----------------------------------|----------------------------------------------|
| **LockScreenApplicationAdded**   | На экран блокировки добавляется плитка приложения.     |
| **LockScreenApplicationRemoved** | С экрана блокировки удаляется плитка приложения. |

 
## Ограничения на ресурсы фоновых задач


Фоновые задачи являются облегченными. Поддержание выполнения в фоновом режиме на минимальном уровне обеспечивает оптимальное взаимодействие с пользователем для приложений переднего плана и времени работы батареи. Для этого на ресурсы фоновых задач накладываются ограничения.

-   Фоновые задачи ограничены 30 секундами физического времени.

## Дополнительные ограничения на ресурсы фоновых задач


### Ограничения на использование памяти

Из-за ограничений на ресурсы для устройств с небольшим объемом памяти фоновые задачи приложений могут иметь ограничение на использование памяти, определяющее максимальный объем памяти, который может использовать фоновая задача. Если фоновая задача попытается выполнить операцию, которая превысит это ограничение, операция завершится ошибкой и может вызвать исключение «Недостаточно памяти», которое задача сможет обработать. Если задача не обрабатывает исключение «Недостаточно памяти» или тип операции не вызывает такое исключение, задача будет немедленно остановлена. Вы можете использовать API [**MemoryManager**](https://msdn.microsoft.com/library/windows/apps/dn633831), чтобы запросить текущий объем и ограничение используемой памяти, а также чтобы отслеживать использование памяти фоновой задачей.

### Ограничения «на устройство» для приложений с фоновыми задачами для устройств с небольшим объемом памяти

Для устройств с малым объемом памяти существует ограничение на количество приложений, которые устанавливаются на устройство и используют фоновые задачи одновременно. Если превысить это количество, произойдет сбой вызова [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/hh700485), необходимого для регистрации всех фоновых задач.

### Экономия заряда аккумулятора

Если не добавить приложение в список исключений, чтобы оно могло продолжить выполнение фоновых задач и получать push-уведомления при включенной экономии заряда, фоновые задачи не будут запускаться, если устройство не подключено к внешнему источнику питания и заряд аккумулятора становится меньше определенного уровня. Но это не повлияет на возможность регистрации фоновых задач.

## Ресурс фоновой задачи гарантирует связь в реальном времени


Чтобы исключить помехи для функций связи в реальном времени из-за выделения квот ресурсов, каждая выполняющаяся фоновая задача, использующая [**ControlChannelTrigger**](https://msdn.microsoft.com/library/windows/apps/hh701032) и [**PushNotificationTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700543), получает гарантированные объемы ресурсов ЦП. Квоты ресурсов остаются такими, как упоминалось выше, и сохраняются постоянными для этих фоновых задач.

Приложению не нужно специально что-то делать, чтобы получать гарантированные квоты ресурсов для фоновых задач [**ControlChannelTrigger**](https://msdn.microsoft.com/library/windows/apps/hh701032) и [**PushNotificationTrigger**](https://msdn.microsoft.com/library/windows/apps/hh700543). Система всегда рассматривает их как критически важные фоновые задачи.

## Триггер обслуживания


Задачи обслуживания выполняются только в том случае, если устройство подключено к сети переменного тока. Подробнее см. в разделе [Использование триггера обслуживания](use-a-maintenance-trigger.md).

## Фоновая задача для датчиков и устройств


Ваше приложение может получать доступ к датчикам и периферийным устройствам из фоновой задачи с помощью класса [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337). Этот триггер можно использовать для продолжительных операций, таких как синхронизация данных или мониторинг. В отличие от задач для системных событий задачу **DeviceUseTrigger** можно инициировать только во время работы приложения на переднем плане, и для нее невозможно установить какие-либо условия.

Некоторые критические операции с устройством, например длительные обновления встроенного ПО, не могут выполняться с помощью класса [**DeviceUseTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297337). Такие операции могут выполняться только на компьютере и только привилегированным приложением, которое использует [**DeviceServicingTrigger**](https://msdn.microsoft.com/library/windows/apps/dn297315). *Привилегированным* называется приложение, которому изготовитель устройства разрешил выполнять эти операции. Метаданные устройства позволяют указать, какое приложение (при его наличии) было назначено в качестве привилегированного приложения на устройстве. См. также раздел [о синхронизации и обновлении устройства с приложениями Магазина Windows для устройств](http://go.microsoft.com/fwlink/p/?LinkId=306619).

## Управление фоновыми задачами


Фоновые задачи могут передавать в приложение сообщения о ходе выполнения, завершении или отмене с помощью событий и локального хранилища. Кроме того, можно перехватывать исключения, поступающие от фоновой задачи, и управлять ее регистрацией в процессе обновления приложения. См. также:

[Обработка отмененной фоновой задачи](handle-a-cancelled-background-task.md)

[Отслеживание хода выполнения и завершения фоновых задач](monitor-background-task-progress-and-completion.md)

**Примечание.**  
Эта статья адресована разработчикам приложений для Windows 10 на базе универсальной платформы Windows (UWP). При разработке приложений для Windows 8.x или Windows Phone 8.x см. раздел [архивной документации](http://go.microsoft.com/fwlink/p/?linkid=619132)

 

## Ссылки по теме


**Концептуальное руководство по многозадачности в Windows 10**

* [Запуск, возобновление и многозадачность](index.md)

**Руководство по фоновым задачам**

* [Доступ к датчикам и устройствам из фоновой задачи](access-sensors-and-devices-from-a-background-task.md)
* [Руководство по работе с фоновыми задачами](guidelines-for-background-tasks.md)
* [Создание и регистрация фоновой задачи](create-and-register-a-background-task.md)
* [Отладка фоновой задачи](debug-a-background-task.md)
* [Объявление фоновых задач в манифесте приложения](declare-background-tasks-in-the-application-manifest.md)
* [Обработка отмененной фоновой задачи](handle-a-cancelled-background-task.md)
* [Отслеживание хода выполнения и завершения фоновых задач](monitor-background-task-progress-and-completion.md)
* [Регистрация фоновой задачи](register-a-background-task.md)
* [Реагирование на системные события с помощью фоновых задач](respond-to-system-events-with-background-tasks.md)
* [Запуск фоновой задачи по таймеру](run-a-background-task-on-a-timer-.md)
* [Задание условий выполнения фоновой задачи](set-conditions-for-running-a-background-task.md)
* [Обновление живой плитки из фоновой задачи](update-a-live-tile-from-a-background-task.md)
* [Использование триггера обслуживания](use-a-maintenance-trigger.md)
* [Активация событий приостановки, возобновления и перевода в фоновый режим приложений Магазина Windows (во время отладки)](http://go.microsoft.com/fwlink/p/?linkid=254345)
* [Синхронизация и обновление устройства с приложениями Магазина Windows для устройств](http://go.microsoft.com/fwlink/p/?LinkId=306619)

 

 





<!--HONumber=May16_HO2-->


