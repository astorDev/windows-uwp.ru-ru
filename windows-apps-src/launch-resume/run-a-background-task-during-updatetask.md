---
title: Запуск фоновой задачи при обновлении приложения UWP
description: Узнайте, как создать фоновую задачу, которая выполняется при обновлении приложения магазина универсальной платформы Windows (UWP).
ms.date: 04/21/2017
ms.topic: article
keywords: Windows 10, uwp, обновление, фоновая задача, updatetask, фоновой задачи
ms.localizationpriority: medium
ms.openlocfilehash: 8cd7d4494340d1c5e617361f2e3d750b35ebabb9
ms.sourcegitcommit: 681c70f964210ab49ac5d06357ae96505bb78741
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2018
ms.locfileid: "7696445"
---
# <a name="run-a-background-task-when-your-uwp-app-is-updated"></a>Запуск фоновой задачи при обновлении приложения UWP

Узнайте, как написать фоновую задачу, которая выполняется после обновлении приложения магазина универсальной платформы Windows (UWP).

Обновление задачи фоновая задача вызывается операционной системой, после пользователь устанавливает обновление для приложения, которое установлено на устройстве. Это позволяет приложению выполнять задачи инициализации как инициализации нового канала Push-уведомлений, обновление схемы базы данных и т. д., прежде чем пользователь запускает обновленного приложения.

Задача обновления отличается от запуска фоновой задачи с помощью триггера [ServicingComplete](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Background.SystemTriggerType) , поскольку в этом случае ваше приложение должно работать по крайней мере один раз прежде чем он обновляется для регистрации фоновой задачи, которая будет активирован, ** ServicingComplete** триггера.  Задача обновления не зарегистрирована и таким образом приложение никогда не запускается, но который обновляется, по-прежнему будет его задача обновления активации.

## <a name="step-1-create-the-background-task-class"></a>Шаг 1: Создание класса фоновой задачи

Как и другие типы фоновых задач, вы реализация задачи обновления фоновой задачи как компонент среды выполнения Windows. Чтобы создать этот компонент, выполните действия, описанные в разделе " **Создание класса фоновой задачи** " [Создание и регистрация вне процесса фоновую задачу](https://docs.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task). Шаги:

- Добавление проекта компонента среды выполнения Windows в свое решение.
- Создание ссылки из вашего приложения в компонент.
- Создании общедоступный запечатанный класс в компоненте, который реализует [**IBackgroundTask**](https://msdn.microsoft.com/library/windows/apps/br224794).
- Реализации метода [**Run**](https://msdn.microsoft.com/library/windows/apps/br224811) , который является точкой входа требуется, который вызывается при выполнении задачи обновления. Если вы собираетесь совершать асинхронные вызовы из фоновой задачи, [Создание и регистрация задачи, выполняемой вне процесса фоновые](https://docs.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task) объясняется, как использовать задержку в методе **запустить** .

Вам не нужно зарегистрировать этой фоновой задачи (раздел «Зарегистрировать фоновую задачу для запуска» в разделе **Создание и регистрация задачи, выполняемой вне процесса фоновые** ) для использования задачи обновления. Это основная причина использовать задачу обновления, так как вам не нужно добавлять никакой код в приложение, чтобы зарегистрировать задачу, а у приложения нет выполнить по крайней мере один раз, прежде чем обновления для регистрации фоновой задачи.

В следующем примере кода показано простая отправная точка для класса фоновой задачи обновления задачи в C#. Класс фоновой задачи сам — и все остальные классы в фоновой задаче — должны быть **открытый** и **запечатанный**. Класс вашей фоновой задачи должен являются производными от **IBackgroundTask** и иметь открытого метода **Run()** с подписью, показано ниже:

```cs
using Windows.ApplicationModel.Background;

namespace BackgroundTasks
{
    public sealed class UpdateTask : IBackgroundTask
    {
        public void Run(IBackgroundTaskInstance taskInstance)
        {
            // your app migration/update code here
        }
    }
}
```

## <a name="step-2-declare-your-background-task-in-the-package-manifest"></a>Шаг 2: Объявление фоновой задачи в манифесте пакета

В обозревателе решений Visual Studio щелкните правой кнопкой мыши **Package.appxmanifest** и выберите **Перейти к коду** для просмотра манифеста пакета. Добавьте следующий `<Extensions>` XML-ФАЙЛ для объявление задачи обновления:

```XML
<Package ...>
    ...
  <Applications>  
    <Application ...>  
        ...
      <Extensions>  
        <Extension Category="windows.updateTask"  EntryPoint="BackgroundTasks.UpdateTask">  
        </Extension>  
      </Extensions>

    </Application>  
  </Applications>  
</Package>
```

В XML-ФАЙЛ выше, убедитесь, что `EntryPoint` атрибуту установить значение namespace.class имя класса задач обновления. Имя учитывается регистр символов.

## <a name="step-3-debugtest-your-update-task"></a>Шаг 3: Отладки и тестирования ваша задача обновления

Убедитесь, что вы развернули приложение на компьютер таким образом, что-то для обновления.

Установите точку останова в методе Run() фоновой задачи.

![Настройка точки останова](images/run-func-breakpoint.png)

Затем в обозревателе решений щелкните правой кнопкой мыши проект вашего приложения (не на проект фоновой задачи) и нажмите кнопку **Свойства**. В окне Свойства приложения щелкните **Отладка** слева, а затем выберите **не запускать, а отлаживать мой код при открытии**:

![задавать параметры отладки](images/do-not-launch-but-debug.png)

Далее чтобы убедиться, что UpdateTask запускается, увеличьте номер версии пакета. В обозревателе решений дважды щелкните файл **Package.appxmanifest** вашего приложения, чтобы открыть конструктор пакетов и обновите номер **сборки** :

![обновление версии](images/bump-version.png)

Теперь в Visual Studio 2017 при нажатии клавиши F5, ваше приложение будет обновляться, и система будет активировать компонент UpdateTask в фоновом режиме. Отладчик будет автоматически присоединить к фонового процесса. Ваше получить останова и выполнять шаги логики кода обновления.

Если фоновая задача завершается, можно запустить приложение переднего плана из меню "Пуск" Windows в того же сеанса отладки. Отладчик снова автоматически присоединит, это время ваш процесс переднего плана и выполнять шаги логики приложения.

> [!NOTE]
> Пользователи Visual Studio 2015: применяются указанные выше действия к Visual Studio 2017. Если вы используете Visual Studio 2015, можно использовать те же методы для триггера и теста UpdateTask, за исключением Visual Studio не будет присоединяться к нему. Альтернативная процедура в Visual STUDIO 2015 — Настройка [ApplicationTrigger](https://docs.microsoft.com/windows/uwp/launch-resume/trigger-background-task-from-app) , который задает UpdateTask как свою точку входа и инициировать выполнение непосредственно из приложения переднего плана.

## <a name="see-also"></a>См. также

[Создание и регистрация фоновой задачи, выполняемой вне процесса](https://docs.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task)
