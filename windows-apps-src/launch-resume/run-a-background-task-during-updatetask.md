---
author: TylerMSFT
title: Запуск фоновой задачи при обновлении приложения UWP
description: Узнайте, как создать фоновую задачу, которая выполняется при обновлении приложения магазина универсальной платформы Windows (UWP).
ms.author: twhitney
ms.date: 04/21/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows 10, uwp, обновления, фоновой задачи, updatetask, фоновом режиме
ms.localizationpriority: medium
ms.openlocfilehash: fcba2cb736f86cebc6d2664e2ec3b557d47c86d7
ms.sourcegitcommit: 9c79fdab9039ff592edf7984732d300a14e81d92
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "2810889"
---
# <a name="run-a-background-task-when-your-uwp-app-is-updated"></a>Запуск фоновой задачи при обновлении приложения UWP

Узнайте, как выполнить запись в фоновом режиме, на котором выполняется после обновления приложения хранилища универсальные платформы Windows (UWP).

В фоновом обновления задач вызывается с операционной системы, когда пользователь выполнит установку обновления для приложения, которая устанавливается на устройстве. Это позволяет ваше приложение для выполнения задачи инициализации, такие как инициализация новый канал push уведомлений, прежде чем пользователь запускает приложение обновленные обновление схемы базы данных и т. д.

Задача обновления отличается от запуска в фоновом режиме с помощью триггер [ServicingComplete](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Background.SystemTriggerType) , так как в этом случае ваше приложение должно работать по крайней мере один раз перед обновлением для регистрации в фоновом, будут активироваться с ** ServicingComplete** триггер.  Обновление задач не зарегистрирована и поэтому приложения, на котором никогда не запущена, но, который обновляется, по-прежнему будет запущено обновление задачи.

## <a name="step-1-create-the-background-task-class"></a>Шаг 1: Создание класса задач фона

Другие типы задач фона реализует фоновом обновления задач как компонент среды выполнения Windows. Чтобы создать данный компонент, выполните действия, описанные в разделе **Создание класса фоновом** [Создать](https://docs.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task)и зарегистрировать задачу фона вне процесса. Следующие действия:

- Добавление компонента среды выполнения Windows проекта в решение.
- Создание ссылки на из вашего приложения в компоненте.
- Создание общедоступный запечатанный класс в компоненте, который реализует [**IBackgroundTask**](https://msdn.microsoft.com/library/windows/apps/br224794).
- Реализация метода [**запуска**](https://msdn.microsoft.com/library/windows/apps/br224811) , которая является точка обязательным параметром, который будет вызываться при запуске обновления задач. Если предполагается выполнять асинхронные вызовы из фоновой задачи, [Создать и зарегистрировать задачу фона вне процесса](https://docs.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task) описывается использование об отсрочках метода **запуска** .

Регистрация фоновом режиме (подраздел «Регистрация в фоновом для запуска» в разделе **Создать и зарегистрировать задачу вне процесса фона** ) для использования задачи обновления не требуется. Это — основная причина для использования задачу обновления, поскольку не нужно добавить любой код приложения для регистрации задачи и приложения не нужно запустить по крайней мере один раз перед обновлением для регистрации в фоновом.

В следующем примере кода показана базовая отправной точки для класса задач фона обновления задач в C#. Фоновые задачи класса - и других классов в проекте задач фона - должны быть **открытый** и **запечатанный**. Класс фонового задач необходимо производными от **IBackgroundTask** и иметь открытый метод **Run()** подписи, показано ниже:

```cs
using Windows.ApplicationModel.Background;

namespace BackgroundTasks
{
    public sealed class UpdateTask : IBackgroundTask
    {
        public void Run(IBackgroundTaskInstance taskInstance)
        {
            // your app migration/update code here
        }
    }
}
```

## <a name="step-2-declare-your-background-task-in-the-package-manifest"></a>Шаг 2: Объявите своей задачи фона в манифесте пакета

В обозревателе решений Visual Studio щелкните правой кнопкой мыши **Package.appxmanifest** и выберите команду **Просмотреть код** для просмотра манифеста пакета. Добавьте следующие `<Extensions>` XML для объявления своей задачи обновления:

```XML
<Package ...>
    ...
  <Applications>  
    <Application ...>  
        ...
      <Extensions>  
        <Extension Category="windows.updateTask"  EntryPoint="BackgroundTasks.UpdateTask">  
        </Extension>  
      </Extensions>

    </Application>  
  </Applications>  
</Package>
```

Убедитесь, что в приведенном выше XML `EntryPoint` атрибута задано значение пространство_имен.класс имя класса задачи обновления. Имя с учетом регистра.

## <a name="step-3-debugtest-your-update-task"></a>Шаг 3: Debug/test вашей обновления задач

Убедитесь, что развертывания вашего приложения на компьютере, чтобы не что-то для обновления.

Задайте точку останова в метод Run() фоновой задачи.

![точка останова Set](images/run-func-breakpoint.png)

Далее в окне Обозреватель решений щелкните правой кнопкой мыши ваше приложение project (не проект фона задач) и выберите пункт **Свойства**. В окне свойств приложения выберите **Отладка** в левой части, а затем выберите **не запускается, но отладки кода при запуске**:

![Задайте параметры отладки](images/do-not-launch-but-debug.png)

Далее чтобы убедиться в том, что инициализируется, UpdateTask, увеличьте номер версии пакета. В обозревателе решений дважды щелкните файл **Package.appxmanifest** ваше приложение, чтобы открыть конструктор пакетов и обновите номер **построения** :

![обновление версии](images/bump-version.png)

Теперь в Visual Studio 2017 при нажатии клавиши F5, приложения будут обновлены, и система будет активирован компонент UpdateTask в фоновом режиме. Отладчик будет автоматически присоединиться к процессу фона. На получение останова и можно пошаговое выполнение вашего кода логику обновления.

По завершении задачи фона можно запустить приложение переднего плана в меню Пуск Windows в одном сеансе отладки. Будет автоматически повторно отладчик, чтобы процесса переднего плана и выполнять шаги логики приложения.

> [!NOTE]
> Пользователи Visual Studio 2015: описанные выше действия применимы к Visual Studio 2017. Если вы используете Visual Studio 2015, можно использовать те же способы триггер и тестирования UpdateTask, за исключением Visual Studio не будет присоединен к нему. Альтернативная процедура в VS 2015 является настройка [ApplicationTrigger](https://docs.microsoft.com/windows/uwp/launch-resume/trigger-background-task-from-app) , который устанавливает UpdateTask в качестве точки входа и запустить выполнение непосредственно из приложения переднего плана.

## <a name="see-also"></a>Статьи по теме

[Создание и регистрация внепроцессной фоновой задачи](https://docs.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task)
