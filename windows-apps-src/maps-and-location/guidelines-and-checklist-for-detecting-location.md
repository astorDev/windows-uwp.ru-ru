---
author: msatranjr
Description: This topic describes performance guidelines for apps that require access to a user's location.
title: Рекомендации относительно приложений с определением расположения
ms.assetid: 16294DD6-5D12-4062-850A-DB5837696B4D
ms.author: misatran
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: windows 10, uwp, расположение, карта, геолокация
ms.localizationpriority: medium
ms.openlocfilehash: 903a7b308c78e4ab9826ea4c46c642cb3361b462
ms.sourcegitcommit: 68fcac3288d5698a13dbcbd57f51b30592f24860
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/19/2018
ms.locfileid: "4053220"
---
# <a name="guidelines-for-location-aware-apps"></a>Рекомендации относительно приложений с определением расположения




**Важные API**

-   [**Geolocation**](https://msdn.microsoft.com/library/windows/apps/br225603)
-   [**Geolocator**](https://msdn.microsoft.com/library/windows/apps/br225534)

В этом разделе содержатся рекомендации по производительности для приложений, которым требуется определение расположения пользователя.

## <a name="recommendations"></a>Рекомендации


-   Начинайте использовать объект расположения только тогда, когда приложению требуются данные о расположении.

    Вызовите метод [**RequestAccessAsync**](https://msdn.microsoft.com/library/windows/apps/dn859152) перед получением доступа к данным о расположении пользователя. В этот момент ваше приложение должно находиться на переднем плане, а из потока пользовательского интерфейса должен быть вызван метод **RequestAccessAsync**. До тех пор пока пользователь не предоставит вашему приложению разрешение на доступ к данным о расположении, приложение не сможет использовать такие данные.

-   Если расположение несущественно для вашего приложения, не открывайте к нему доступ, пока пользователь не попытается выполнить задачу, для которой требуются сведения о расположении. Например, если в приложение социальной сети есть кнопка "Проверить мое расположение", приложение не должно пытаться получить данные о расположении, пока пользователь не нажмет эту кнопку. Немедленный доступ к данным о расположении уместен, если он нужен вашему приложению для выполнения его основной функции.

-   Первое использование объекта [**Geolocator**](https://msdn.microsoft.com/library/windows/apps/br225534) должно быть выполнено в основном потоке пользовательского интерфейса приложения переднего плана для показа пользователю запроса на согласие. Первым использованием **Geolocator** может быть либо первый вызов [**getGeopositionAsync**](https://msdn.microsoft.com/library/windows/apps/hh973536), либо первая регистрация обработчика события [**positionChanged**](https://msdn.microsoft.com/library/windows/apps/br225540).

-   Предупредите пользователя о том, как будут использоваться данные о расположении.
-   Предоставьте пользовательский интерфейс, чтобы пользователь мог вручную обновить свое расположение.
-   Во время получения данных о расположении отображайте индикатор выполнения. <!--For info on the available progress controls and how to use them, see [**Guidelines for progress controls**](guidelines-and-checklist-for-progress-controls.md).-->
-   Отображайте соответствующие сообщения об ошибках или диалоговые окна, когда определение расположения отключено или недоступно.

    Если параметры местоположения не позволяют вашему приложению получать доступ к данным о местоположении пользователя, мы рекомендуем реализовать удобную ссылку на **параметры конфиденциальности данных о местоположении** в приложении **Параметры**. Например, вы можете использовать элемент управления "Гиперссылка" или вызвать метод [**LaunchUriAsync**](https://msdn.microsoft.com/library/windows/apps/hh701476) для запуска приложения **Параметры** из кода с помощью URI `ms-settings:privacy-location`. Дополнительные сведения см. в разделе [Запуск приложения "Параметры" в Windows](https://msdn.microsoft.com/library/windows/apps/mt228342).

-   Очищайте кэшированные данные о расположении и освобождайте объект [**Geolocator**](https://msdn.microsoft.com/library/windows/apps/br225534), когда пользователь отключает доступ к сведениям о расположении.

    Освобождайте объект [**Geolocator**](https://msdn.microsoft.com/library/windows/apps/br225534), если пользователь отключает доступ к сведениям о расположении через "Параметры". Тогда в ответ на любые вызовы API расположения приложение будет получать результаты **ACCESS\_DENIED**. Если приложение сохраняет или кэширует данные о расположении, очищайте все кэшированные данные, когда пользователь отключает доступ к данным о расположении. Предоставьте альтернативный способ ввода данных расположения вручную на случай, если они окажутся недоступны для служб определения расположения.

-   Предусмотрите пользовательский интерфейс для повторного включения определения расположения. Например предоставить кнопку "Обновить", который создает новый экземпляр объекта [**Geolocator**](https://msdn.microsoft.com/library/windows/apps/br225534) и пытается снова получить сведения о расположении.

    Приложение должно предоставлять пользовательский интерфейс для повторного включения служб определения расположения.

    -   Если пользователь повторно включает определение расположения после отключения этой функции, приложение не получает уведомления. Значение свойства [**status**](https://msdn.microsoft.com/library/windows/apps/br225601) не изменяется, и событие [**statusChanged**](https://msdn.microsoft.com/library/windows/apps/br225542) не возникает. Ваше приложение должно создать новый объект [**Geolocator**](https://msdn.microsoft.com/library/windows/apps/br225534) и вызвать [**getGeopositionAsync**](https://msdn.microsoft.com/library/windows/apps/hh973536) для получения обновленных данных о расположении или повторно подписаться на события [**positionChanged**](https://msdn.microsoft.com/library/windows/apps/br225540). Если после этого состояние приложения указывает на повторное включение определения расположения, удалите все элементы пользовательского интерфейса, которые ранее отображались для уведомления пользователя об отключенных службах определения расположения, и обрабатывайте новое состояние соответствующим образом.
    -   Кроме того, ваше приложение должно повторять попытку определения расположения после активации или при явных попытках пользователя применить функции, требующие определения расположения, а также в любое другое время, соответствующее замыслу приложения.

**Производительность**

-   Используйте однократные запросы расположения, если приложению не требуются обновления данных о расположении. Например, приложению, которое добавляет метку о географическом положении на фотографию, обновление данных о расположении не требуется. Вместо этого приложение должно запрашивать расположение с помощью метода [**getGeopositionAsync**](https://msdn.microsoft.com/library/windows/apps/hh973536), как описано в разделе [Получение сведений о текущем расположении](https://msdn.microsoft.com/library/windows/apps/mt219698).

    Когда вы создаете одноразовый запрос на определение расположения, необходимо задать следующие значения.

    -   Укажите для приложения требуемую точность с помощью значений [**DesiredAccuracy**](https://msdn.microsoft.com/library/windows/apps/br225535) или [**DesiredAccuracyInMeters**](https://msdn.microsoft.com/library/windows/apps/jj635271). См. ниже рекомендации по использованию этих параметров.
    -   Задайте параметр максимального возраста [**GetGeopositionAsync**](https://msdn.microsoft.com/library/windows/apps/hh973536), чтобы указать, как долго полученное расположение будет полезным для приложения. Если приложение может использовать позицию, полученную несколько секунд или минут назад, приложение сможет получать данные о расположении почти немедленно, экономя при этом энергию устройства.
    -   Задайте параметр времени ожидания для [**GetGeopositionAsync**](https://msdn.microsoft.com/library/windows/apps/hh973536). Это определит, как долго приложение сможет ожидать получения данных о расположении или возврата ошибки. Вам придется оценить баланс преимуществ и недостатков скорости реагирования и требуемой точности приложения.
-   Используйте непрерывный сеанс определения расположения, если требуются частые обновления позиции. Используйте события [**positionChanged**](https://msdn.microsoft.com/library/windows/apps/br225540) и [**statusChanged**](https://msdn.microsoft.com/library/windows/apps/br225542) для обнаружения перемещений, выходящих за определенные пороговые значения, или для непрерывного обновления данных об изменяющемся местоположении.

    При запросах обновления расположения полезно указать требуемую приложением точность, задавая значения [**DesiredAccuracy**](https://msdn.microsoft.com/library/windows/apps/br225535) или [**DesiredAccuracyInMeters**](https://msdn.microsoft.com/library/windows/apps/jj635271). Вам нужно также задать требуемую приложением частоту обновлений с помощью значений [**MovementThreshold**](https://msdn.microsoft.com/library/windows/apps/br225539) или [**ReportInterval**](https://msdn.microsoft.com/library/windows/apps/br225541).

    -   Укажите пороговое значение перемещения. Некоторым приложениям требуется обновлять данные о расположении, только когда пользователь перемещается на значительное расстояние. Например, приложение, отображающее местные новости или прогноз погоды, потребует обновления данных о расположении, только когда пользователь переместится в другой город. В этом случае с помощью свойства [**MovementThreshold**](https://msdn.microsoft.com/library/windows/apps/br225539) можно настроить минимальное расстояние перемещения, при котором данные о местоположении будут обновляться. Это обеспечивает фильтрацию событий [**PositionChanged**](https://msdn.microsoft.com/library/windows/apps/br225540). Такие события будут вызываться, только если изменение расположения превысит заданный порог.

    -   Используйте значение [**reportInterval**](https://msdn.microsoft.com/library/windows/apps/br225541), чтобы обеспечить подходящие условия для работы приложения и свести к минимуму использование системных ресурсов. Например, приложению, отображающему прогноз погоды, обновление данных может требоваться только каждые 15минут. Для большинства приложений, за исключением приложений для навигации в режиме реального времени, не нужен постоянный высокоточный поток обновлений расположения. Если приложению не требуется поток данных с максимально высокой точностью, а также частое обновление данных, задайте минимальную частоту обновления необходимых приложению данных о расположении в свойстве **ReportInterval**. Тогда источник данных о расположении сможет работать более экономно, вычисляя расположение только по необходимости.

        В приложениях, которым требуются сведения в режиме реального времени, необходимо установить для свойства [**ReportInterval**](https://msdn.microsoft.com/library/windows/apps/br225541) значение0, указав таким образом на отсутствие минимального интервала. Интервал отчетов по умолчанию составляет 1 секунду или значение, соответствующее максимальной частоте, допустимой программным обеспечением, если это значение короче 1 секунды.

        Устройства, предоставляющие данные расположения, могут отслеживать интервалы отчетов для разных приложений и предоставлять отчеты данных с минимальным запрошенным интервалом. Таким образом, приложение, которому нужна наибольшая точность, получает необходимые данные. При этом определитель расположения может создавать обновления чаще, чем необходимо вашему приложению, если для другого приложения задан меньший интервал.

        **Примечание.** Нет гарантии, что источник данных о расположении примет запрос в течение заданного интервала отчетов. Не все устройства, предоставляющие данные расположения, могут отслеживать интервалы отчетов. Тем не менее стоит настроить интервал для тех устройств, которые поддерживают эту функцию.

    -   Для экономии энергии задайте свойство [**desiredAccuracy**](https://msdn.microsoft.com/library/windows/apps/br225535), чтобы сообщить платформе расположения, требуется ли вашему приложению высокая точность данных. Если высокая точность не требуется ни одному из приложений, система может экономить энергию, не включая поставщики данных GPS.

        -   Установите для свойства [**desiredAccuracy**](https://msdn.microsoft.com/library/windows/apps/br225535) значение **HIGH**, чтобы модуль GPS получал данные.
        -   Установите для свойства [**desiredAccuracy**](https://msdn.microsoft.com/library/windows/apps/br225535) значение **Default** и используйте только шаблон однократного вызова, чтобы снизить потребление энергии, если ваше приложение использует сведения о расположении только для определения целевой аудитории рекламы.

        Если у вашего приложения имеются конкретные требования относительно точности, можно использовать свойство [**DesiredAccuracyInMeters**](https://msdn.microsoft.com/library/windows/apps/jj635271) вместо [**DesiredAccuracy**](https://msdn.microsoft.com/library/windows/apps/br225535). Это особенно полезно для устройства Windows Phone, которое обычно может определять расположение по маякам сотовой связи, маякам Wi-Fi и спутникам. Выбор более конкретного значения точности поможет системе определить правильную технологию для использования с минимальным энергопотреблением при определении позиции.

        Например:

        -   Если приложение определяет расположение для настройки рекламы, сводок погоды, новостей и т.п., вполне достаточной будет точность 5000метров.
        -   Если ваше приложение отображает сделки окружения соседству, обычно хорошие результаты точность 300 метров.
        -   Если пользователь ищет рекомендации для ближайших ресторанов, вероятно, требуется позиция в пределах квартала, то есть достаточной будет точность 100метров.
        -   Если пользователь хочет сообщить кому-то о своем местонахождении, приложение должно запрашивать точность около 10метров.
    -   Если у приложения имеются конкретные требования к точности, используйте свойство [**Geocoordinate.accuracy**](https://msdn.microsoft.com/library/windows/apps/br225526). Например, в приложениях для навигации следует использовать свойство **Geocoordinate.accuracy** для определения того, соответствуют ли доступные данные о расположении требованиям приложения.

-   Учитывайте задержки при запуске. При первом запросе данных о расположении возможна короткая (1–2секунды) задержка из-за запуска поставщика данных о расположении. Учитывайте это при разработке пользовательского интерфейса приложения. Например, можно предотвратить блокировку других задач во время ожидания завершения вызова [**GetGeopositionAsync**](https://msdn.microsoft.com/library/windows/apps/hh973536).

-   Учитывайте поведение приложения в фоновом режиме. Если ваше приложение находится не в фокусе, оно не будет получать события обновления данных о расположении, пока оно приостановлено в фоновом режиме. Если приложение регистрирует в журнале все обновления данных о расположении, это следует учитывать. Когда приложение возвращается в активный режим, оно получает информацию только о новых событиях. Обновления, которые происходили, пока оно было в неактивном состоянии, будут потеряны.

-   Эффективно используйте простые и комплексные датчики. Существует два типа датчиков: *простые* и *комплексные*.

    -   Простые датчики включают акселерометр, гирометр и магнитометр.
    -   Комплексные датчики включают ориентацию, инклинометр и компас. Комплексные датчики получают данные от комбинаций простых датчиков.

    API среды выполнения Windows могут обращаться к любому из этих датчиков, кроме магнитометра. Датчики объединенных данных работают более точно и стабильно по сравнению с датчиками необработанных данных, но потребляют больше энергии. Для каждой цели следует использовать подходящие датчики. Подробнее см. в разделе [Датчики](https://msdn.microsoft.com/library/windows/apps/mt187358).

**Режим ожидания с подключением**
- Объекты [**Geolocator**](https://msdn.microsoft.com/library/windows/apps/br225534) могут создаваться и в то время, когда компьютер находится в режиме ожидания с подключением. Однако объект **Geolocator** не сможет обнаружить датчики, которые можно объединить, и поэтому вызовы метода [**GetGeopositionAsync**](https://msdn.microsoft.com/library/windows/apps/hh973536) завершатся тайм-аутом по истечении 7секунд, прослушиватели событий [**PositionChanged**](https://msdn.microsoft.com/library/windows/apps/br225540) никогда не будут вызваны, а прослушиватели событий [**StatusChanged**](https://msdn.microsoft.com/library/windows/apps/br225542) будут вызваны один раз с состоянием **NoData**.

## <a name="additional-usage-guidance"></a>Дополнительные рекомендации по использованию


### <a name="detecting-changes-in-location-settings"></a>Обнаружение изменений в параметрах расположения

Пользователь может отключить функцию определения расположения с помощью **параметров конфиденциальности сведений о местонахождении** в приложении **Параметры**.

-   Чтобы определить, когда пользователь отключает или вновь включает передачу данных о расположении:
    -   Обработайте событие [**StatusChanged**](https://msdn.microsoft.com/library/windows/apps/br225542). Свойство [**Status**](https://msdn.microsoft.com/library/windows/apps/br225601) аргумента события **StatusChanged** имеет значение **Disabled**, если пользователь отключает определение расположения.
    -   Проверьте коды ошибок, возвращаемые методом [**GetGeopositionAsync**](https://msdn.microsoft.com/library/windows/apps/hh973536). Если пользователь отключил службы определения расположения, будет происходить сбой вызовов **GetGeopositionAsync** с ошибкой **ACCESS\_DENIED**, а свойство [**LocationStatus**](https://msdn.microsoft.com/library/windows/apps/br225538) будет иметь значение **Disabled**.
-   Если данные о расположении имеют большое значение для вашего приложения (например, в случае картографического приложения), выполните следующие действия.
    -   Обработайте событие [**PositionChanged**](https://msdn.microsoft.com/library/windows/apps/br225540), чтобы получить обновления при изменении расположения пользователя.
    -   Обработайте событие [**StatusChanged**](https://msdn.microsoft.com/library/windows/apps/br225542), как описано выше, чтобы отследить изменения в параметрах расположения.

Обратите внимание, что служба возвращает данные по мере их поступления. Сначала расположение может возвращаться с большим радиусом ошибки, а затем обновляться более точной информацией, когда она станет доступна. Приложения, отображающие расположение пользователя, обычно пытаются обновлять данные по мере того, как поступает более точная информация.

### <a name="graphical-representations-of-location"></a>Графическое представление расположения

Ваше приложение должно использовать [**Geocoordinate.accuracy**](https://msdn.microsoft.com/library/windows/apps/br225526), чтобы точно показать на карте текущее расположение пользователя. Существуют три основных диапазона точности — радиусы ошибки около 10 метров, около 100 метров и больше 1 километра. Используя сведения о точности, вы обеспечиваете в вашем приложении точное отображение расположения в контексте доступных данных. Общие сведения об использовании элемента управления картой см. в статье [Отображение карт с помощью двумерных и трехмерных представлений, а также представлений Streetside](https://msdn.microsoft.com/library/windows/apps/mt219695).

-   Для точности около 10 метров (разрешение GPS) расположение на карте может быть обозначено точкой или булавкой. Для этой точности также могут быть отображены географические координаты (широта и долгота) и почтовый адрес.

    ![Пример карты с точностью около 10 метров (точность GPS).](images/10metererrorradius.png)

-   Для точности в пределах от 10 до 500метров (приблизительно 100метров) получение данных о расположении происходит с разрешением Wi-Fi. Определение расположения по сотовой связи обычно имеет точность около 300метров. В этом случае мы рекомендуем отображать в приложении радиус ошибки. Если в приложении показываются маршруты и требуется отображение точки центрирования, ее можно отображать в центре радиуса ошибки.

    ![Пример карты с точностью около 100 метров (точность Wi-Fi).](images/100metererrorradius.png)

-   Если возвращаемая точность больше 1 километра, скорее всего получение сведений о расположении происходит с разрешением уровня IP-адреса. Этого уровня точности обычно не хватает, чтобы показать определенную точку на карте. Ваше приложение должно увеличивать карту до уровня города или до уровня подходящей области в зависимости от радиуса ошибки (например, уровень региона).

    ![Пример карты с точностью около 1 километра (точность Wi-Fi).](images/1000metererrorradius.png)

При переходе от одного уровня точности к другому обеспечьте плавный переход между соответствующими графическими представлениями. Как это можно сделать:

-   Выполнить плавную анимацию перехода, плавно и быстро выполнив сам переход.
-   Использовать ряд последовательных сообщений с подтверждением изменения точности, чтобы предотвратить нежелательные и слишком частые изменения масштаба.

### <a name="textual-representations-of-location"></a>Текстовое представление расположения

Для некоторых приложений (например, приложений прогноза погоды и местных информационных приложений) требуется механизм вывода текстового представления расположения для различных диапазонов точности. Отображать расположение следует понятно и только в соответствии с уровнем точности, указанным в данных.

-   Для точности около 10 метров (разрешение GPS) получение сведений о расположении производится довольно точно, и поэтому эти сведения можно сообщать с точностью до названия района. Также можно использовать название города, области, страны (региона).
-   Для точности около 100 метров (разрешение Wi-Fi) получение сведений о расположении производится со средней точностью, и поэтому мы рекомендуем отображать эти сведения с точностью до названия населенного пункта. Название района использовать не следует.
-   Для точности больше 1 километра (разрешение IP) отображайте только название области или страны (региона).

### <a name="privacy-considerations"></a>Соображения конфиденциальности

Данные о географическом положении пользователя являются персональными данными. На следующем веб-сайте приведены рекомендации по защите персональных данных пользователей.

-   [Политика конфиденциальности Майкрософт]( http://go.microsoft.com/fwlink/p/?LinkId=259692)

<!--For more info, see [Guidelines for privacy-aware apps](guidelines-for-enabling-sensitive-devices.md).-->

## <a name="related-topics"></a>Связанные разделы

* [Настройка геозоны](https://msdn.microsoft.com/library/windows/apps/mt219702)
* [Получение сведений о текущем расположении](https://msdn.microsoft.com/library/windows/apps/mt219698)
* [Отображение карт с помощью двумерных и трехмерных представлений, а также с помощью представлений Streetside](https://msdn.microsoft.com/library/windows/apps/mt219695)
<!--* [Design guidelines for privacy-aware apps](guidelines-for-enabling-sensitive-devices.md)-->
* [Пример расположения для UWP (геолокация)](http://go.microsoft.com/fwlink/p/?linkid=533278)
 

 
